{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/js/affix.js","path":"js/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/exturl.js","path":"js/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/js.cookie.js","path":"js/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/post-details.js","path":"js/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/scroll-cookie.js","path":"js/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/scrollspy.js","path":"js/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1}],"Cache":[{"_id":"themes/next/.all-contributorsrc","hash":"d139a3b623b2e40bbff5c96ad44adf7dbdbc5be1","modified":1559313208000},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1559313208000},{"_id":"themes/next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1559313208000},{"_id":"themes/next/.gitattributes","hash":"44bd4729c74ccb88110804f41746fec07bf487d4","modified":1559313208000},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1559313208000},{"_id":"themes/next/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1559313208000},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1559313208000},{"_id":"themes/next/.gitignore","hash":"b80cec1d5e6a73d1cec382aad8046d1352a1e963","modified":1561471206740},{"_id":"themes/next/_config.yml","hash":"3e318c2a51bfb519955382cf6caf12bd01fec32d","modified":1561474153784},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1559313208000},{"_id":"themes/next/.travis.yml","hash":"3d1dc928c4a97933e64379cfde749dedf62f252c","modified":1559313208000},{"_id":"themes/next/bower.json","hash":"dbabc4b5b186070d425777562587de19848b1d56","modified":1561471206741},{"_id":"themes/next/README.md","hash":"7958c3f70b2133b479ddaf525cc4b6d87a37e04a","modified":1559313208000},{"_id":"themes/next/gulpfile.coffee","hash":"23bd9587807edc4dbecb5c5a29ab96ade24458b5","modified":1559313208000},{"_id":"themes/next/package.json","hash":"d1fc59c32d27178d53f9d2c479443ed682e5bd91","modified":1559313208000},{"_id":"source/_posts/hello-world.md","hash":"8a02477044e2b77f1b262da2c48c01429e4a32e4","modified":1560784590696},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"7ce6cdc8adcbfda68fcbcc54c8b9fd3434a37993","modified":1559313208000},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"c149f003d03501565e7688915cd8f2e99fbf8f42","modified":1559313208000},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"3239625bb2573e61f7bcce27a74882a9ff7021e9","modified":1559313208000},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"00c25366764e6b9ccb40b877c60dc13b2916bbf7","modified":1559313208000},{"_id":"themes/next/.github/config.yml","hash":"8a5cbf5aa9529390fe0a782758aca9c3a02f9dcf","modified":1559313208000},{"_id":"themes/next/.github/eslint-disable-bot.yml","hash":"16541fb7b80f5ab90135db96285badb63c4d7d3e","modified":1559313208000},{"_id":"themes/next/.github/auto_assign.yml","hash":"cb68a1dca1c4623448c2ca899614a9f21df1b036","modified":1559313208000},{"_id":"themes/next/.github/lock.yml","hash":"585d2c471047be320aa62f2b74dad797bf09c530","modified":1559313208000},{"_id":"themes/next/.github/mergeable.yml","hash":"0ee56e23bbc71e1e76427d2bd255a9879bd36e22","modified":1559313208000},{"_id":"themes/next/.github/release-drafter.yml","hash":"c9fdbbdf712327a8ae1ed5972973a75802e245bc","modified":1559313208000},{"_id":"themes/next/.github/stale.yml","hash":"41bf97ee86b8940a0b2e754499ec77fd2b44b717","modified":1559313208000},{"_id":"themes/next/.github/topissuebot.yml","hash":"10665bf2b5aba351725715c71e94ad183a0e8f18","modified":1559313208000},{"_id":"themes/next/.github/weekly-digest.yml","hash":"404e4ccb7fcd6587bc9b0247a7a7ff256d21f2cb","modified":1559313208000},{"_id":"themes/next/.github/support.yml","hash":"d75db6ffa7b4ca3b865a925f9de9aef3fc51925c","modified":1559313208000},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"0d2f22ea09dd1ef63c66164e048d8239d2ccb2b8","modified":1559313208000},{"_id":"themes/next/docs/AUTHORS.md","hash":"7b24be2891167bdedb9284a682c2344ec63e50b5","modified":1559313208000},{"_id":"themes/next/docs/DATA-FILES.md","hash":"8e1962dd3e1b700169b3ae5bba43992f100651ce","modified":1559313208000},{"_id":"themes/next/docs/INSTALLATION.md","hash":"2bbdd6c1751b2b42ce9b9335da420c6026a483e9","modified":1559313208000},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"212a36d57495990b5f56e46ca8dce1d76c199660","modified":1559313208000},{"_id":"themes/next/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1559313208000},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"ad57c168d12ba01cf144a1ea0627b2ffd1847d3e","modified":1559313208000},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1559313208000},{"_id":"themes/next/docs/MATH.md","hash":"026d2cff73c22a30ea39c50783557ff4913aceac","modified":1559313208000},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1559313208000},{"_id":"themes/next/scripts/merge-configs.js","hash":"33afe97284d34542015d358a720823feeebef120","modified":1559313208000},{"_id":"themes/next/languages/de.yml","hash":"9e524b2bdfb848504b93a51c5650e76bba5fa9e0","modified":1559313208000},{"_id":"themes/next/languages/default.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1559313208000},{"_id":"themes/next/languages/en.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1559313208000},{"_id":"themes/next/languages/es.yml","hash":"1752429687861b5cedd063c6ebe5dacefbe7e5a7","modified":1559313208000},{"_id":"themes/next/languages/fa.yml","hash":"cd41db832af5e399590b70a5227cfe0b0e98e101","modified":1559313208000},{"_id":"themes/next/languages/fr.yml","hash":"7005c2b42c2c6e82bd7a1be5cc2f443b5fc79105","modified":1559313208000},{"_id":"themes/next/languages/id.yml","hash":"1c4868837f5109f1df863b04fe627352c31d404b","modified":1559313208000},{"_id":"themes/next/languages/it.yml","hash":"b30ff77ad8044e3b021a3b09187cd377dc789fd2","modified":1559313208000},{"_id":"themes/next/languages/ja.yml","hash":"1dc35e436da6214cdb3c2ff44bc4a06d0be5b9a0","modified":1559313208000},{"_id":"themes/next/languages/ko.yml","hash":"20bfaa7600d35235996c18e5c13dcef89c119626","modified":1559313208000},{"_id":"themes/next/languages/nl.yml","hash":"1c44b3cb2f817808607f3bf6ef47f58ce7599995","modified":1559313208000},{"_id":"themes/next/languages/pt-BR.yml","hash":"08b913a5cf4cc160083069cb4dfb2d66eecd1218","modified":1559313208000},{"_id":"themes/next/languages/pt.yml","hash":"8ddac820e2c17b484b56c0da8881e142b10e221b","modified":1559313208000},{"_id":"themes/next/languages/ru.yml","hash":"db0644e738d2306ac38567aa183ca3e859a3980f","modified":1559313208000},{"_id":"themes/next/languages/tr.yml","hash":"c5f0c20743b1dd52ccb256050b1397d023e6bcd9","modified":1559313208000},{"_id":"themes/next/languages/uk.yml","hash":"1eb59e581568da9a81d6e20541b4ada5fc1c55c0","modified":1559313208000},{"_id":"themes/next/languages/vi.yml","hash":"ba7aff8f88e03f69a0acf7f1b90ee03e077ee88e","modified":1559313208000},{"_id":"themes/next/languages/zh-CN.yml","hash":"fbbf3a0b664ae8e927c700b0a813692b94345156","modified":1559313208000},{"_id":"themes/next/languages/zh-HK.yml","hash":"7903b96912c605e630fb695534012501b2fad805","modified":1559313208000},{"_id":"themes/next/languages/zh-TW.yml","hash":"6e6d2cd8f4244cb1b349b94904cb4770935acefd","modified":1559313208000},{"_id":"themes/next/layout/_layout.swig","hash":"74701fcf2303d59400587436ab4c244e04df7ad9","modified":1559313208000},{"_id":"themes/next/layout/archive.swig","hash":"7e8f3a41a68e912f2b2aaba905d314306ccaf794","modified":1559313208000},{"_id":"themes/next/layout/category.swig","hash":"dda0e6b2139decaf5e865d22ec9d45fdb615a703","modified":1559313208000},{"_id":"themes/next/layout/index.swig","hash":"9b4733d037c360e8504645b1d6c6dd17817c9d7b","modified":1561471206769},{"_id":"themes/next/layout/page.swig","hash":"29c64c7031aaf276d3d11cdf2e95025996fd6eed","modified":1561471206769},{"_id":"themes/next/layout/post.swig","hash":"f74929fd792541916eb25c2addfb35431be071ba","modified":1559313208000},{"_id":"themes/next/layout/schedule.swig","hash":"3268dd3d90d8b0e142cfa1a2ebb23355baeda148","modified":1559313208000},{"_id":"themes/next/layout/tag.swig","hash":"a6be69a90924c9d2f4d90fb4867234859bd2c2e9","modified":1559313208000},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1559313208000},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1559313208000},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1559313208000},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1559313208000},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"c37a60580c901c79ccb22564b228a46e06207445","modified":1559313208000},{"_id":"themes/next/.github/ISSUE_TEMPLATE/custom-issue-template.md","hash":"57e1e06e845193e80c7df4a4454af28352526f7a","modified":1559313208000},{"_id":"themes/next/.github/ISSUE_TEMPLATE/non-english.md","hash":"0b0727ff4d5180ae67f930fb4f8e9488e33eda9f","modified":1559313208000},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"07c423cce4157b8e2dbf60907ccbf3f18c4cf98a","modified":1559313208000},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"d6d20f60f77a76c77f8e65d0c9adbd79d0274557","modified":1559313208000},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"6c5d69e94961c793da156217ecf1179e868d7ba1","modified":1559313208000},{"_id":"themes/next/docs/ru/README.md","hash":"4d7ef717d0b57288e606996ee56c20ffd59d5a99","modified":1559313208000},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"b1dd18d9b890b21718883ea1832e7e02a773104a","modified":1559313208000},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"b218e30df4126b6adc87684775ac4c86ea7f7958","modified":1559313208000},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"f3eec572a7d83542e2710a7404082014aaa1a5e7","modified":1559313208000},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"115ffbde2b3ce01ef1f8c2b3833e6f6794650132","modified":1559313208000},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"83feca62190abcca0332915ffe0eefe582573085","modified":1559313208000},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"caa624092175d44e3d3a8c6ca23922718da2354c","modified":1559313208000},{"_id":"themes/next/docs/zh-CN/README.md","hash":"cdd7a8bdcf4a83ff4c74ee6c95c6bcc0b8c1831c","modified":1559313208000},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"5da70d7fa0c988a66a469b9795d33d471a4a4433","modified":1559313208000},{"_id":"themes/next/scripts/filters/exturl.js","hash":"79ad823ca803cb00e0bfc648aa6c9d59711e0519","modified":1559313208000},{"_id":"themes/next/scripts/helpers/engine.js","hash":"60eb1554456d9d0e5afc4a2d16f1580a0aa02da8","modified":1559313208000},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"799a042bbf497a4c7a2981aa2014ff28fa1bb382","modified":1559313208000},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"650fcb9135b6f09d48e866c19e0dbccd831367f1","modified":1559313208000},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"b19a6e0ae96eb7c756fb5b1ba03934c7f9cbb3c3","modified":1559313208000},{"_id":"themes/next/scripts/tags/button.js","hash":"f3b4f7ae7e58072bbf410d950a99a0b53cbc866d","modified":1559313208000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"f13430d9d1c9773b390787c2f046bb1f12a79878","modified":1559313208000},{"_id":"themes/next/scripts/tags/exturl.js","hash":"d605918cf819887e9555212dbe12da97fd887a0b","modified":1559313208000},{"_id":"themes/next/scripts/tags/full-image.js","hash":"fcb41c1c81560ed49dc4024654388a28ee7d32b0","modified":1559313208000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"598220fa92ff3540dcab74f633ba41523daa8364","modified":1559313208000},{"_id":"themes/next/scripts/tags/include-raw.js","hash":"5db59d56f4f4082382bf1c16722e6c383892b0c5","modified":1559313208000},{"_id":"themes/next/scripts/tags/label.js","hash":"fc5b267d903facb7a35001792db28b801cccb1f8","modified":1559313208000},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"983c6c4adea86160ecc0ba2204bc312aa338121d","modified":1559313208000},{"_id":"themes/next/scripts/tags/note.js","hash":"0a02bb4c15aec41f6d5f1271cdb5c65889e265d9","modified":1559313208000},{"_id":"themes/next/scripts/tags/pdf.js","hash":"f780cc72bff91d2720626e7af69eed25e9c12a29","modified":1559313208000},{"_id":"themes/next/scripts/tags/tabs.js","hash":"00ca6340d4fe0ccdae7525373e4729117775bbfa","modified":1559313208000},{"_id":"themes/next/scripts/tags/video.js","hash":"e5ff4c44faee604dd3ea9db6b222828c4750c227","modified":1559313208000},{"_id":"themes/next/layout/_custom/head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1559313208000},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1559313208000},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1559313208000},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"89b0a0e64637bf5b0cfea0a23642df3d95eedfa4","modified":1559313208000},{"_id":"themes/next/layout/_macro/post.swig","hash":"ca89a2a95c149f759274ab68dbc1e9581baadf4a","modified":1561471206751},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"480d93619479dcfcbec6906803bb38b2dfbeae53","modified":1559313208000},{"_id":"themes/next/layout/_partials/comments.swig","hash":"5352f96f4544c1520babf1cec7b44ddf2f8057b3","modified":1559313208000},{"_id":"themes/next/layout/_partials/footer.swig","hash":"589f545333e21a8c7823bce89ab45cf1eb7db6e2","modified":1559313208000},{"_id":"themes/next/layout/_partials/github-banner.swig","hash":"6357537ac0bb114aed4d61bafb39e6690a413697","modified":1559313208000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"dbe321bcf3cf45917cc11a3e3f50d8572bac2c70","modified":1559313208000},{"_id":"themes/next/layout/_partials/post-edit.swig","hash":"06dac109504812b63766a80ede9ddacbd42d227d","modified":1559313208000},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"50be1762f60222379a8bef5e42ab1a0f3872b7ff","modified":1559313208000},{"_id":"themes/next/layout/_scripts/exturl.swig","hash":"61ae10d41f67ece004a025077fdb28724af05090","modified":1559313208000},{"_id":"themes/next/layout/_scripts/next-boot.swig","hash":"012e3ece672cc3b13d5e032139f328d3426d7d65","modified":1559313208000},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"edaff4766e0c05fd5c889d9dd32884d376bef9d9","modified":1559313208000},{"_id":"themes/next/layout/_scripts/scroll-cookie.swig","hash":"ccd13d73429ef91ef5e8b7d9fa43c8188facdf41","modified":1559313208000},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"9cd491b8ff2dc9d6976cd9e89c4e56678e3bcefa","modified":1561471206761},{"_id":"themes/next/layout/_third-party/baidu-push.swig","hash":"4ccf2abbfd070874265b0436a3eff21f7c998dfb","modified":1559313208000},{"_id":"themes/next/layout/_third-party/bookmark.swig","hash":"10b61a8bac671e375916a4d234c120117098a78f","modified":1559313208000},{"_id":"themes/next/layout/_third-party/chatra.swig","hash":"aa0893cddc803bd3fd34ab78d7d003bd86be86b6","modified":1561471206763},{"_id":"themes/next/layout/_third-party/copy-code.swig","hash":"a7126355227236f9433615edfd89e86fd51ed676","modified":1561471206765},{"_id":"themes/next/layout/_third-party/mermaid.swig","hash":"d6e6ddda836bd9e2e8d9767a910c7d3280080e81","modified":1559313208000},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"2c4a66be4677d3e4dec3f169ac8a769098dad1fe","modified":1559313208000},{"_id":"themes/next/layout/_third-party/pangu.swig","hash":"c28f9dc96ab735daeb7f599f86470aa5a83c03cf","modified":1559313208000},{"_id":"themes/next/layout/_third-party/pdf.swig","hash":"810a9b2a6059f46c4a2ddb178f1eaa4c5e23750b","modified":1559313208000},{"_id":"themes/next/layout/_third-party/quicklink.swig","hash":"7757bd285732e857996b99af9d917953589fac5e","modified":1559313208000},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"cbe40cb67dad15ade967b0f396c1a95b6871f76a","modified":1559313208000},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"2398e5cd0cb466953b6e7a42c2b2caddebf3c348","modified":1559313208000},{"_id":"themes/next/layout/_third-party/tidio.swig","hash":"912368c41de675f458b267a49a99ae3e7e420ebb","modified":1559313208000},{"_id":"themes/next/source/css/main.styl","hash":"e010ec8ac73268a0f137204c89e0080ab8d59b3d","modified":1559313208000},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1559313208000},{"_id":"themes/next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1559313208000},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1559313208000},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1559313208000},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1559313208000},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1559313208000},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1559313208000},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1559313208000},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1559313208000},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1559313208000},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1559313208000},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1559313208000},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1559313208000},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1559313208000},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1559313208000},{"_id":"themes/next/source/images/searchicon.png","hash":"025d64ba0160a3a2257dd2b3032b5f7c9dd9b82b","modified":1559313208000},{"_id":"themes/next/source/js/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1559313208000},{"_id":"themes/next/source/js/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1559313208000},{"_id":"themes/next/source/js/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1559313208000},{"_id":"themes/next/source/js/js.cookie.js","hash":"e0afce539f1fb81d59e3c6f0a68d736e2fb45d93","modified":1559313208000},{"_id":"themes/next/source/js/next-boot.js","hash":"e0615efab5f81ba0fd39c0527eac31144deac7ce","modified":1559313208000},{"_id":"themes/next/source/js/post-details.js","hash":"0dde5e6d4547587662a3256317a9d5d1db507692","modified":1559313208000},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1559313208000},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1559313208000},{"_id":"themes/next/source/js/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1559313208000},{"_id":"themes/next/source/js/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1559313208000},{"_id":"themes/next/source/js/utils.js","hash":"81913c5f75d0949443833cf4269ad63bd7f9be6f","modified":1559313208000},{"_id":"themes/next/source/js/motion.js","hash":"a16bc0b701646bf6653484675f4d5dc0f892d184","modified":1559313208000},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1559313208000},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1559313208000},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1559313208000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1559313208000},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1559313208000},{"_id":"themes/next/layout/_macro/menu/menu-badge.swig","hash":"65c5e585982dae7ae1542cada71858b4ea1f73d6","modified":1559313208000},{"_id":"themes/next/layout/_macro/menu/menu-item.swig","hash":"9257da95bd032bb3bd1da670e302fd2c7d5610b6","modified":1561471206750},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"fc6bafc8c633afadc538c5afa5620ea2a1cdcb84","modified":1559313208000},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"02bb5748e8540b024e7f4008a9e640890b45280f","modified":1559313208000},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"f537846ace6a1afdacf122848dd01a32ceb66006","modified":1561471206754},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"648bf7eda66629592cb915c4004534b3913cbc22","modified":1559313208000},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"2082f5077551123e695e8afec471c9c44b436acb","modified":1559313208000},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"71af31fea5913fd30c233e555ef13cf2c9768f72","modified":1559313208000},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"5adc60100e129c1d0307bdcaa0c7b8e8375a6ea4","modified":1559313208000},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"0fa4fadb39467b01cede49f21b22e86b1a2da805","modified":1559313208000},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"2940df694fff28e8bf71b6546b4162f1e38227db","modified":1559313208000},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"3615db591dd910fb9fa96542734c7ec0ef05019c","modified":1559313208000},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"eea95b785c9c36d28e1839619793f66e89773bee","modified":1559313208000},{"_id":"themes/next/layout/_partials/post/reward.swig","hash":"d44f025eb93c99ddf90202d8293ccf80689a00c7","modified":1559313208000},{"_id":"themes/next/layout/_partials/post/wechat-subscriber.swig","hash":"ef11b5be5bfb2f0affe82cf521c002b37fef9819","modified":1559313208000},{"_id":"themes/next/layout/_partials/search/algolia-search.swig","hash":"d9fe715fee716f78c7976c4e8838da71439ee0e0","modified":1561471206758},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"7d1693416a5dc098f4723a53da2e2d1fc2d6e075","modified":1559313208000},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1559313208000},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a5587bd1f60d35e58618576cec45e662aa44ea1f","modified":1559313208000},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"15b542f5b06b7532234af367340b9ed9fcebb0ac","modified":1559313208000},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"6f181cc188ecbe5e607fd989756e470d4cb9765d","modified":1559313208000},{"_id":"themes/next/layout/_partials/share/likely.swig","hash":"b45e934d24d76ec6b6a790e92bdb3d56186b0e2a","modified":1559313208000},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"5b05f165547391bf231e52f56f3d925efc09bc44","modified":1559313208000},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"ffc8e8836714ea79abeb77b75859634615652877","modified":1559313208000},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"108b157fbd1ac3baaf19ae87234fa8728ab79556","modified":1559313208000},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"0097e45e7b671f8006b8b2d3c4f95cacc76a983c","modified":1559313208000},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"e42604fbb17648484e5f12afe230d826de089388","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"a5723950c343d220270bfd27bd30050eda6c3fb3","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"798d67e4a736613ab899eabe6529091bbcda7850","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"591b2ccd9713ccb922b9fcf5e278b6de9c5ec30b","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"8eadb929c9e50e58502ccad2dc2657746f8c592a","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"08cd47ef8572121b7811342d3c9a84a338a18191","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"3d01fa6edc0ad73f81813613f2e8a610777f1852","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"fae69a0e1a1d42f7bb44e594a29857d94594698b","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"9fa1ca7059243197d8fbbd35108c36629a254570","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"4a966b7ffe2d80ff1b3dd0fd14b355766dc5c70f","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"438c6f5e6665d72f4ea7ee206011d669246f6102","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"a09d2af2a8470555eeb265b0eb14dc678079e870","modified":1561471206763},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"f240a50cd9b627620d9a374a29cf95f0c5e99d7c","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"92e04a2b9e0c3df594bc22235d1894e5ad458dfc","modified":1559313208000},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"0dd5b315d1da55dbfc10f51a1f8952f72eba2720","modified":1559313208000},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"3533167c4295637b91d90f3bae7c651cd128bb6e","modified":1559313208000},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"1a00b1b78c429721d6477c2d8f6f68f005285cc8","modified":1561471206764},{"_id":"themes/next/layout/_third-party/comments/disqusjs.swig","hash":"074a995cd630f56fc4a3135173515c86f2cb34b6","modified":1561471206764},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"e8f91c571ceb4b80aafebc4d36b89fb41b1ae040","modified":1559313208000},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"388efc86af7f19c05ad0e26720cd24ee012d20b9","modified":1559313208000},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"2cbaae65a020bbb0e9265364488aff8bf84fa48d","modified":1559313208000},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"5856d5f701e51dfae1fd6fb486cefde67effd555","modified":1559313208000},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"15a4d60d3ecc59db2f23629477f8e7b8324981ed","modified":1561471206764},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"a7e304b05a44279d3e4f611908d7faef9dc14d7c","modified":1559313208000},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"c2cb2f384bc30d31cdccf9794a729c03e687b45c","modified":1559313208000},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"601774d8672577aefbcefac82c94b01f0338da31","modified":1559313208000},{"_id":"themes/next/layout/_third-party/search/algolia-search.swig","hash":"0a13dfd2de52a96901039098c6fc7b515edfc50b","modified":1559313208000},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"ea94aa85034c6d1b6bb865aecea55c73f8a14501","modified":1559313208000},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"b3eaab6a269aa3fcbafe24fd06f0c9206dc12716","modified":1559313208000},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1559313208000},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1559313208000},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"2e8fb29aa92325df39054b5450757858c6cebc41","modified":1559313208000},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"2036bbb73afd43251982ce824f06c6e88d35a2ef","modified":1559313208000},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"a8aa41625b94cf17a7f473ed10dcbe683b1db705","modified":1559313208000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"be087dcc060e8179f7e7f60ab4feb65817bd3d9f","modified":1559313208000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"fc15e277d1504532a09b7b1bd31f900ad95ec4b8","modified":1559313208000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"640f25a63770af5566ccc9cec79c40a4f1c0b29e","modified":1559313208000},{"_id":"themes/next/source/js/schemes/muse.js","hash":"e9bfa6b343b67625f58757efce46ccdaac8f308c","modified":1559313208000},{"_id":"themes/next/source/js/schemes/pisces.js","hash":"9eb63cba0327d3d11b6cbfcbe40b88e97a8378a3","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1559313208000},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1559313208000},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1559313208000},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1559313208000},{"_id":"themes/next/source/lib/jquery/index.js","hash":"88523924351bac0b5d560fe0c5781e2556e7693d","modified":1561471206806},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"fe5ff961b86004a306778c7d33a85b32e5e00e48","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"c8b3225396cb444d8baeb94bac78e5216b992a81","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"b98c65006e2546fbf3870c16fbbcbc009dbaab15","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"9d71f34fa13a41b8c8cd2fbdf3fdea608385277c","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"ce826aedf42b9eca424a044452f5d193866726a6","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/rainbow.styl","hash":"ce2aae8f3ed8ceac3a2417e0481044cf69c788aa","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/scrollbar.styl","hash":"d7b8bcf2a6031296c84bb4f4ecfb037af01d2d82","modified":1559313208000},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"7e51ea64611ab5d678c112b4688d4db4fd2737e2","modified":1559313208000},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"6d900b4159eeb869196a619602578bf4d83a117b","modified":1559313208000},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"8e0740a9ad349ce5555122325da872923135a698","modified":1559313208000},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"9a190ef2f49bdbf69604b48ad1dc7197895ee9b6","modified":1559313208000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"7ffde343bdf10add1f052f3c4308a15180eb4404","modified":1559313208000},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1559313208000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"33456264a74d1bba38264d14713544d67d003733","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"9a2d298dbdcbfd758518fd74b63897bc80ce15a5","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"0bef9f0dc134215bc4d0984ba3a16a1a0b6f87ec","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"24230e46fc9fb7b8551f97bb36e9bc1f7423098e","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"75d2d92af070eb10273558b2436972d3f12b361c","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"fa33213aceed7bf4bf25437ca9c1a00f7734ae65","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"7359880e8d85312861fe0871f58b662e627dae0c","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"a96e46a6ae86c423f932bc2bc78b9f7453e4e4e5","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"6565b4a309325596768d0d32e022c80ef23066cb","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"fc160583f742c94316a0fee05c18468033173534","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"1edf4e69d0ec0dc9cefed6c35d3e803e0da4093d","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"7359880e8d85312861fe0871f58b662e627dae0c","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"a0e2030a606c934fb2c5c7373aaae04a1caac4c5","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"57044a6d19eb418c1c3d28787e82c69efa9e0ca6","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"75737591682a2bafa71db4c03fb79e970ac0e7aa","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"b6dac5bbf20f090cf4b67d156f030d7170dfb39c","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"6400c98a9fd2b9a8502269f33355bd7ab3ff793b","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"b5b936dddb7b4de4720cd1e8428b30a2f06d63fb","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"232aedbd44243b3b80c4503c947060d3269c1afc","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/header/github-banner.styl","hash":"ca97f0b6990eef947039faede80c56d9c4381ee1","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"6c4990d375b640ee4551e62c48c1cbe4c3d62212","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"4cfeec9434a72d5efc6ca225d3445d084d4590f7","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"a410ed529afd46ddf4a96ecf0de6599488716887","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"c0d9e18a9210fdcaf33e488518b3b288eb58c0a1","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"cc6ee18f47f2e1e06df6fa0eadb37079e580fd11","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"71d8d1cc22a2a7627a6db7240f0c4902a14f9bea","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"e9dd8de7d98f1478ac7d351624fffd3d8738c905","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"6904fd7ea6455e008d9884558b68254608af9a3c","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"2d142c6f39853916256ad8fc79eb6b85f4001ae8","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"f1d52954b9a5d1ca8e224382349f525e598dd923","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"80addb9b725e329915c05c27b9fadaf56457a9b3","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"61ca40856e5cacd48e0fa9728fde4605c7dd4c94","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"6a75bb1f2435f4e895cbbb5abbddf6e8f7257804","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"2356226157e8068b0e9bbe2f7d0f74e1ab49199b","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"c961d37190d9bec58a36306c7e716c4e72c4582f","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"1385862a5c0bd845015d165aadbd1a6add7b72d7","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"0bf899fab331add63f0c8ead31ca3a3db2ad74d9","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"b082d07b13a3d55b4c032fd351dfa9a4fd74edec","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"496f931e3a7e313ba8088fb91bb20789cace72c9","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-reading_progress.styl","hash":"3f33bb862c2aa993f54987fbb345da067b79b112","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"5440013a081201ca791582db98159dce93ea9e75","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"8e058c99dd7d41f0bd34c7c28b6ac9fbb17dcb5e","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"d5c8ffed7f2c701052b7a53abaf5ef437374ea72","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"a6c24393dffbdd94dd5c01cdbec5e180b0bfbbbd","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"a3170630d8e085889a4bdc20eb7f09c5a0479c47","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"9224b566cd2632f64c1a964e2c786cee93b93286","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"707527c9950a7459355c8abcf4751c0964de0bc1","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"cc83816614f21c7e1d8d3f867d547ff7c658cec4","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-button.styl","hash":"517d541a80d59ad99a3f648be74891e0c7bc72a8","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"c2d9c3b6fbfa65544e6b5a55d3cb2149df04a8a9","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"9a3bfc878ca797946815bed23cd6f92b24a16358","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"8a24b56524a388fbabd408ffc8ba9b56eb9e01ce","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"c01609176929590f8f347075a9a12b661acd661e","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"8e5c884fb950937afa350c608545455c87aa6129","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"967fb3a3c6c851b34ec5df2d945dc266ed63d146","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"58ec00eebe68d0eebd2eea435c710063877447df","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"6ec8ea7b11a146777b6b8da0f71f0cc1dbd129df","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"d7501ae01fc45fa15b00d1bc5233b9fffa20a3c9","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"21b32840d8b3a14b10770153114778304ba6d1b0","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/tags/pdf.styl","hash":"da8d34729fb6eb0fcb8ee81e67d2be3c02bc1bc4","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"6e4400d6704dee076434726b7a03ac464eb7bcb4","modified":1561471206784},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"cbc0be5a3285b469858ec9ead48e2ea90bd47ae1","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"fc58498d4f5081fcf6218e9e18c5bf2328275bef","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/copy-code.styl","hash":"688ca3eccc26727d050ad098b32b40934719588a","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"ac7753d536341aa824d7bce0332735e838916995","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"f1d9ee1f86a179741f2478f8c70ca11ab578810e","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"7059e24235b7c57a07f3f8abaa06b0bd6a7eda2f","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"9fac89c8146eb2675721a26f528d7d0f8be7debe","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"ef66c0a08e4243a25e41408d70ca66682b8dcea1","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"61466e3e5459960b5802a267751a0c8018918b0b","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"3ae3f3c276d444862033fd3434c632ad0d2f84e6","modified":1559313208000},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"07cb7e9485ef12d9a22a0f821180770e621d084c","modified":1561471206786},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1559313208000},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1559313208000},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1559313208000},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1559313208000},{"_id":"source/.DS_Store","hash":"5102ab6a353158844f7a08c2a45906a731517eb5","modified":1561474985008},{"_id":"source/_posts/2017-11-24-ARKit入门-0.md","hash":"9e2dbace5bbcd1c79be92693363948f466509592","modified":1560784397150},{"_id":"source/_posts/2017-11-24-ARKit入门-1.md","hash":"d565b7735a92d4e423b49b0e4143d161c3ade03e","modified":1560784397150},{"_id":"source/_posts/2017-12-09-Supervisor使用入门.md","hash":"d248abf57d55ae21842115c98668988afadfc6aa","modified":1560784397150},{"_id":"source/_posts/HomeKit Accessory开发基础问题.md","hash":"3cdeee35d53d1f7641d3fc870f09831ee720a562","modified":1560784397150},{"_id":"source/_posts/Swift使用Xib自定义View和Cell.md","hash":"79f9c16af208650709496760125210bf9c01588e","modified":1560699433550},{"_id":"source/_posts/Swift模拟登陆小结.md","hash":"e01037fbef0afd2b1f01049025d790d9e9064be6","modified":1560699433550},{"_id":"source/_posts/iOS-webApp客户端开发小记.md","hash":"8e89f0918fbeeee26b3fcfd3791842dd2a2d1fa0","modified":1560699433551},{"_id":"source/_posts/Swift3-迁移小结.md","hash":"a756ca5d7135b7dc4b5573f058115de5880ae1f1","modified":1560699433550},{"_id":"source/_posts/iOS10-Today-Extension-开发小结.md","hash":"0a39f92cefd385db3714a382066c712503f65153","modified":1560699433551},{"_id":"source/_posts/iOS9-Swift2-Xcode7的APNS使用.md","hash":"d85a5064be04a3077a801c1ffe40ec57d2297e42","modified":1560699433551},{"_id":"source/_posts/一个UITextView的小Bug.md","hash":"baae8ee43436a208092e0fb7f7ecdaa24800e73d","modified":1560699433551},{"_id":"source/_posts/使用Alamofire实现GB2312编码的网络请求.md","hash":"3393f0a331f8d9653007e11b276a5cdc2eb271d5","modified":1560699433551},{"_id":"source/_posts/博文的开始.md","hash":"9133993f816ef944acd112dad0a10db91bfe5d42","modified":1560699433551},{"_id":"source/_posts/阿里百川、友盟推送SDK集成.md","hash":"092d1e23f5cc5fd2d45f8a33c3a0a5dd833e6245","modified":1560699433551},{"_id":"source/_posts/阿里百川即时通讯功能-iOS开发.md","hash":"ffafbcf2a8f0e05af0ca2052e781cc20ca2cdd31","modified":1560699433551},{"_id":"source/_posts/阿里百川用户反馈Swift开发小结.md","hash":"b5431835f785ddcf0413bbbad6324812883e37e1","modified":1560699433551},{"_id":"themes/next/.git/FETCH_HEAD","hash":"9df82dce762174c25d4d3bdde6ce28f388b917fa","modified":1561471276218},{"_id":"themes/next/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1561471206730},{"_id":"themes/next/.git/ORIG_HEAD","hash":"2102126801649888de7928afff348e3ba7c75036","modified":1561471276227},{"_id":"themes/next/.git/config","hash":"e2ca9fa6f115d4406d24bf0df53fc26ce13e0c9b","modified":1561471206733},{"_id":"themes/next/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1561471059287},{"_id":"themes/next/.git/index","hash":"7ce26d7eff00aa6f57469b27cc801e4f5f582bdb","modified":1561471206809},{"_id":"themes/next/.git/packed-refs","hash":"f30f64fe67a736d00316c4d926616a04dde88d4d","modified":1561471206729},{"_id":"themes/next/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1561471059288},{"_id":"themes/next/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1561471059287},{"_id":"themes/next/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1561471059288},{"_id":"themes/next/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1561471059288},{"_id":"themes/next/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1561471059288},{"_id":"themes/next/.git/hooks/pre-commit.sample","hash":"33729ad4ce51acda35094e581e4088f3167a0af8","modified":1561471059287},{"_id":"themes/next/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1561471059288},{"_id":"themes/next/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1561471059287},{"_id":"themes/next/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1561471059288},{"_id":"themes/next/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1561471059288},{"_id":"themes/next/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1561471059289},{"_id":"themes/next/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1561471059287},{"_id":"themes/next/.git/logs/HEAD","hash":"8611a927cdf4c29fcb375bce2c443031171a4675","modified":1561471206731},{"_id":"themes/next/.git/refs/heads/master","hash":"2102126801649888de7928afff348e3ba7c75036","modified":1561471206731},{"_id":"themes/next/.git/logs/refs/heads/master","hash":"8611a927cdf4c29fcb375bce2c443031171a4675","modified":1561471206732},{"_id":"themes/next/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1561471206730},{"_id":"themes/next/.git/objects/pack/pack-8960b7b9248665812a733fd6fda0e2faf19c1676.idx","hash":"878ed7a6960e79ad74435c9ed13b47c46c9f2f23","modified":1561471206722},{"_id":"themes/next/.git/logs/refs/remotes/origin/HEAD","hash":"8611a927cdf4c29fcb375bce2c443031171a4675","modified":1561471206730},{"_id":"themes/next/.git/objects/pack/pack-8960b7b9248665812a733fd6fda0e2faf19c1676.pack","hash":"23e2f31cbe0f3f30cf7dae75c2ee07cd70a647e1","modified":1561471206720},{"_id":"public/archives/2015/index.html","hash":"3acada509e89e048dd9c6d2ae98145f080865ab9","modified":1561475028969},{"_id":"public/archives/2015/10/index.html","hash":"b5e5c9d0c1beb9e6cec9814fe970d336030bfc8e","modified":1561475028969},{"_id":"public/archives/2015/11/index.html","hash":"e2e5bde8ab666cb47c5681bbabffadd502dcbfde","modified":1561475028969},{"_id":"public/archives/2015/12/index.html","hash":"9df4cc398c486875f7e8429a3aef58c835580f2a","modified":1561475028969},{"_id":"public/archives/2016/07/index.html","hash":"abffe87fa7a8997aeb11462a37162106d2d55835","modified":1561475028970},{"_id":"public/archives/2016/08/index.html","hash":"7b868a8b38ec4497823ff0414f82c4d9d03ae346","modified":1561475028970},{"_id":"public/archives/2016/10/index.html","hash":"4f7d334ccafed897665006fabc578873887de4ce","modified":1561475028970},{"_id":"public/archives/2016/12/index.html","hash":"1ab6f6cdc6e5699d133a00610b648880b71ed6dd","modified":1561475028970},{"_id":"public/archives/2017/index.html","hash":"39c84ccd743c81185ed4e62b5ad5ce5415035a63","modified":1561475028970},{"_id":"public/archives/2017/06/index.html","hash":"837d77000b9f37bf502caf950b7b334f62514ce5","modified":1561475028970},{"_id":"public/archives/2017/11/index.html","hash":"c3471627dc8b708b6dd0cc204d47c2898190b76a","modified":1561475028970},{"_id":"public/archives/2017/12/index.html","hash":"069559cdd091482f6c0cf9a044fd616ac788af5d","modified":1561475028970},{"_id":"public/archives/2019/index.html","hash":"55e93d0b0a2faca7ea421f3d49760ea2b606e534","modified":1561474355370},{"_id":"public/archives/2019/06/index.html","hash":"478f3f301d3379ee8746f566f49d5579150e081f","modified":1561474355370},{"_id":"public/categories/ARKit/index.html","hash":"f07a61347269c010206fc96009b5f1e09dc15e6f","modified":1561475028970},{"_id":"public/categories/HomeKit/index.html","hash":"9d7bf000ca9f5cf557b8a7a0d3a2c9e62f5e9235","modified":1561475028970},{"_id":"public/categories/Server/index.html","hash":"0a28142ec1a4ff4d1366968f5d9f3f2a44a95401","modified":1561475028970},{"_id":"public/categories/开发/page/2/index.html","hash":"47875520821b7e932dbb5fdca8565aed7e604c2f","modified":1561475028970},{"_id":"public/categories/ARKit/翻译/index.html","hash":"947858c31be8d9602258f0d30485cdbdc9a03f36","modified":1561475028970},{"_id":"public/categories/Server/Tools/index.html","hash":"7eda6aa2416bf2a62ef2296baec71ec8b1c31aec","modified":1561475028970},{"_id":"public/categories/开发/iOS/page/2/index.html","hash":"af9a3e36cdae05a4eec731c21684a6cfef77075f","modified":1561475028970},{"_id":"public/categories/总结/index.html","hash":"121820497da4b6a0f22b5b60837db5353fd8c1ac","modified":1561475028970},{"_id":"public/tags/ARKit/index.html","hash":"ee6bbb97f7a8a11df3efcc7672fcc947d9950171","modified":1561475028971},{"_id":"public/tags/翻译/index.html","hash":"dde57ad044ab61ab7006b7dc7906b153c321424d","modified":1561475028971},{"_id":"public/tags/HomeKit/index.html","hash":"73118f028e55938a20d003ebaa9494844ff7ef86","modified":1561475028971},{"_id":"public/tags/HomeKit-Accessory-Protocol/index.html","hash":"7c54130771285507c41c68f8fcb11d6076087dc7","modified":1561475028971},{"_id":"public/tags/Server/index.html","hash":"f34c49f5e985c00c36ac3169789bf2d66145363e","modified":1561475028971},{"_id":"public/tags/Tools/index.html","hash":"3325db74277484a8af6a39016dc3d2b3643eb3e3","modified":1561475028971},{"_id":"public/tags/记录/index.html","hash":"6396b27f6d11bb0ba52ac8452ef372304feb9ca5","modified":1561475028971},{"_id":"public/tags/Alamofire/index.html","hash":"4d31ec95d4c8787264b939a204df22d7d73237f0","modified":1561475028971},{"_id":"public/tags/模拟登陆/index.html","hash":"5dbeff7efb66197226f268d0374992fb4f54fffd","modified":1561475028971},{"_id":"public/tags/Xib/index.html","hash":"539671ae743ded23c5c1152cce6f7791a31ef290","modified":1561475028971},{"_id":"public/tags/自定义View/index.html","hash":"5e54e6b415bf79b1e46421ac992c023691958e86","modified":1561475028971},{"_id":"public/tags/iOS/index.html","hash":"85c89b457d90df5f9f823784504c96e78e603f65","modified":1561475028971},{"_id":"public/tags/UIWebView/index.html","hash":"fe501f3610adbab20754b5cce8e3e4f8f74b15af","modified":1561475028971},{"_id":"public/tags/二维码扫描/index.html","hash":"7ab012ce76e9634abb56dbef95c12a188d7e97bb","modified":1561475028971},{"_id":"public/tags/Today-Extension/index.html","hash":"7d4808a6381a37e15b2005c1494d4ad9ea3a281d","modified":1561475028971},{"_id":"public/tags/Swift-3-x/index.html","hash":"b4dd2a8e88d5719e241d06c368492d37e944f9a1","modified":1561475028971},{"_id":"public/tags/Alamofire-4-x/index.html","hash":"ccf937d75843cd222d3dd3b4f701268602ec64ff","modified":1561475028971},{"_id":"public/tags/Kanna-2-x/index.html","hash":"360babf2cab54a531c6f3917d53365038c15afab","modified":1561475028971},{"_id":"public/tags/Eureka-2-x/index.html","hash":"64870cee6329d3fd1d31bc1d6c0dc357ccd05cf0","modified":1561475028971},{"_id":"public/tags/APNS推送/index.html","hash":"5f59cd9fb1fdc3cc22b07750b7386e301c3dfa50","modified":1561475028972},{"_id":"public/tags/UITextView/index.html","hash":"c168ed057c27e3ab828a5a3c26bca4aa6da9cbdf","modified":1561475028972},{"_id":"public/tags/GB2312编码/index.html","hash":"f8560e9fc2f58ee4489f5e7cb4842d72b49a5aba","modified":1561475028972},{"_id":"public/tags/总结/index.html","hash":"2d5eeb1afe968723c1477c0a3cd50f62963d8dbe","modified":1561475028972},{"_id":"public/tags/Android/index.html","hash":"4ed287f6cf2eaa2d2f8b023658f4f713a58f33a0","modified":1561475028972},{"_id":"public/tags/阿里百川/index.html","hash":"e13f394c0af0f4409f354a6e432504d875a58004","modified":1561475028972},{"_id":"public/tags/友盟推送/index.html","hash":"3d34871b91d11696dd9ee3280547d76ea08111b9","modified":1561475028972},{"_id":"public/tags/用户反馈/index.html","hash":"9ac10ec9aab0dec7b3258dcf103e984847f97e08","modified":1561475028972},{"_id":"public/tags/即时通讯/index.html","hash":"e45892389b2b321156a8851033181ef9c3f74a8d","modified":1561475028972},{"_id":"public/2019/06/17/hello-world/index.html","hash":"ed06c5e0eefebd67da7f99aed88b7dbcb95f3ec1","modified":1561474355372},{"_id":"public/2017/12/09/2017-12-09-Supervisor使用入门/index.html","hash":"3cf702b7674f1dc4c4b0d26d07b7375b933b239f","modified":1561475028972},{"_id":"public/2017/11/24/2017-11-24-ARKit入门-1/index.html","hash":"1d09b5611617b6865453a3dc016145e6d2592a59","modified":1561475028972},{"_id":"public/2017/11/24/2017-11-24-ARKit入门-0/index.html","hash":"0df5cb4faad0a957715b6fe2a6e4f3da0d40179a","modified":1561475028972},{"_id":"public/2017/06/09/HomeKit Accessory开发基础问题/index.html","hash":"0fa1d1a6c2eaa13abb54eab908817a1c89a1a850","modified":1561475028972},{"_id":"public/2016/12/29/阿里百川用户反馈Swift开发小结/index.html","hash":"c5c46aec09b3248e5f5a5bd093417d55820d5898","modified":1561475028972},{"_id":"public/2016/10/11/iOS10-Today-Extension-开发小结/index.html","hash":"f4feaded63cee804f9b1fde9af47e4553f6dff97","modified":1561475028972},{"_id":"public/2016/10/08/Swift3-迁移小结/index.html","hash":"7a0ee8a7b2ff55539e44e0c6e7a9d7236900a905","modified":1561475028972},{"_id":"public/2016/08/09/Swift使用Xib自定义View和Cell/index.html","hash":"4cb1df41dec3bac97635b7891edfa291f3c0b75d","modified":1561475028972},{"_id":"public/2016/08/02/Swift模拟登陆小结/index.html","hash":"e45c2422b68b16062ed7f9e146b27ec384302079","modified":1561475028972},{"_id":"public/2016/08/02/使用Alamofire实现GB2312编码的网络请求/index.html","hash":"405edd5734b70e79925ff9959e42952d02f7ebf0","modified":1561475028972},{"_id":"public/2016/07/28/一个UITextView的小Bug/index.html","hash":"edc76a73426356aafd55bd268c7eca574d4f0f4e","modified":1561475028973},{"_id":"public/2015/12/07/阿里百川、友盟推送SDK集成/index.html","hash":"6c6833bda0fa736b0029ef78c84fad0f1929e211","modified":1561475028973},{"_id":"public/2015/11/05/iOS-webApp客户端开发小记/index.html","hash":"8beab4d5f828d2d32c13ba8040dadf4d617d9cee","modified":1561475028973},{"_id":"public/2015/10/19/博文的开始/index.html","hash":"3310d447296363ba248dc2c2a3cddfce2dcc5e9b","modified":1561475028973},{"_id":"public/2015/12/02/iOS9-Swift2-Xcode7的APNS使用/index.html","hash":"1d72c894a915b2470af434bcb85c40c331e8e202","modified":1561475028973},{"_id":"public/2015/12/02/阿里百川即时通讯功能-iOS开发/index.html","hash":"370ec2ae7c84c1ca7769eac6f2677a978e3d08a9","modified":1561475028973},{"_id":"public/archives/index.html","hash":"ab3841268bca83f4053ab8d177987dd314f9486b","modified":1561475028973},{"_id":"public/archives/page/2/index.html","hash":"719c1e00882288c4b2e6e910f68b45077766c2e0","modified":1561475028973},{"_id":"public/archives/2016/index.html","hash":"618f0aa73eb73b4eda49847b21c0beb3b471b13a","modified":1561475028973},{"_id":"public/categories/开发/index.html","hash":"df9825569b6fcb949ae0004f0353c4d687c375ed","modified":1561475028973},{"_id":"public/categories/开发/iOS/index.html","hash":"66e97d61ee6925fdac22252f010cb7cc89e4870b","modified":1561475028973},{"_id":"public/index.html","hash":"859717693d8bb9e15fd31a969bdc0ff2e1cf9c4e","modified":1561475028973},{"_id":"public/page/2/index.html","hash":"74e89de0681f3d731dad2ed1b8e7a0f0fc4aa446","modified":1561475028973},{"_id":"public/tags/Swift/index.html","hash":"d679e0b9d7bc22bbdd10a0ef90d46f16f4cba9d2","modified":1561475028973},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1561474355377},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1561474355377},{"_id":"public/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1561474355377},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1561474355377},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1561474355377},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1561474355377},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1561474355377},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1561474355377},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1561474355378},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1561474355378},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1561474355378},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1561474355378},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1561474355378},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1561474355378},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1561474355378},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1561474355378},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1561474355378},{"_id":"public/images/searchicon.png","hash":"025d64ba0160a3a2257dd2b3032b5f7c9dd9b82b","modified":1561474355378},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1561474355378},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1561474355378},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1561474355632},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1561474355633},{"_id":"public/js/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1561474355635},{"_id":"public/js/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1561474355635},{"_id":"public/js/js.cookie.js","hash":"e0afce539f1fb81d59e3c6f0a68d736e2fb45d93","modified":1561474355635},{"_id":"public/js/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1561474355635},{"_id":"public/js/next-boot.js","hash":"e0615efab5f81ba0fd39c0527eac31144deac7ce","modified":1561474355635},{"_id":"public/js/post-details.js","hash":"0dde5e6d4547587662a3256317a9d5d1db507692","modified":1561474355636},{"_id":"public/js/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1561474355636},{"_id":"public/js/schemes/pisces.js","hash":"9eb63cba0327d3d11b6cbfcbe40b88e97a8378a3","modified":1561474355636},{"_id":"public/js/schemes/muse.js","hash":"e9bfa6b343b67625f58757efce46ccdaac8f308c","modified":1561474355636},{"_id":"public/js/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1561474355636},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1561474355636},{"_id":"public/css/main.css","hash":"e2d1dd6fb5ed4773ee30a4f612e77e7ccc4816c6","modified":1561474355636},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1561474355636},{"_id":"public/js/motion.js","hash":"a16bc0b701646bf6653484675f4d5dc0f892d184","modified":1561474355639},{"_id":"public/js/utils.js","hash":"81913c5f75d0949443833cf4269ad63bd7f9be6f","modified":1561474355639},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1561474355639},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1561474355642},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1561474355644},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1561474355644},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1561474355644},{"_id":"public/lib/jquery/index.js","hash":"88523924351bac0b5d560fe0c5781e2556e7693d","modified":1561474355654},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1561474355657},{"_id":"source/about/index.md","hash":"6e91312cc3beef278eaad65eb216f671f5b95b30","modified":1561474901587},{"_id":"public/about/index.html","hash":"fc634df695c4dd8648a1da92924b8cec4fe6c6a6","modified":1561475028975}],"Category":[{"name":"ARKit","_id":"cjxbvqkb40002wq1kum0ty4oa"},{"name":"HomeKit","_id":"cjxbvqkb80007wq1kcas23rdi"},{"name":"Server","_id":"cjxbvqkbb000bwq1kvggeoetb"},{"name":"开发","_id":"cjxbvqkbe000iwq1khqoaomw4"},{"name":"翻译","parent":"cjxbvqkb40002wq1kum0ty4oa","_id":"cjxbvqkbg000mwq1k9omsaf63"},{"name":"Tools","parent":"cjxbvqkbb000bwq1kvggeoetb","_id":"cjxbvqkbm0016wq1kqa12fs95"},{"name":"iOS","parent":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbm001bwq1kkus8f8nu"},{"name":"总结","_id":"cjxbvqkbo001nwq1kaqjntknk"}],"Data":[],"Page":[{"title":"关于","date":"2016-07-27T05:24:18.000Z","comments":0,"_content":"<p style=\"text-align:center\"> 物联网工程本科，计算机控制方向硕士在读 </p>\n\n<p style=\"text-align:center\"> 对物联网相关技术有着浓厚兴趣，具有实现想法的学习动力和软硬件开发能力</p>\n\n<p style=\"text-align:center\">热爱技术、热爱生活、热爱团队合作</p>\n\n","source":"about/index.md","raw":"---\ntitle: 关于\ndate: 2016-07-27 13:24:18\ncomments: false\n---\n<p style=\"text-align:center\"> 物联网工程本科，计算机控制方向硕士在读 </p>\n\n<p style=\"text-align:center\"> 对物联网相关技术有着浓厚兴趣，具有实现想法的学习动力和软硬件开发能力</p>\n\n<p style=\"text-align:center\">热爱技术、热爱生活、热爱团队合作</p>\n\n","updated":"2019-06-25T15:01:41.587Z","path":"about/index.html","_id":"cjxbxsxo30000501kzbv1wmfl","layout":"page","content":"<p style=\"text-align:center\"> 物联网工程本科，计算机控制方向硕士在读 </p>\n\n<p style=\"text-align:center\"> 对物联网相关技术有着浓厚兴趣，具有实现想法的学习动力和软硬件开发能力</p>\n\n<p style=\"text-align:center\">热爱技术、热爱生活、热爱团队合作</p>\n\n","site":{"data":{}},"excerpt":"","more":"<p style=\"text-align:center\"> 物联网工程本科，计算机控制方向硕士在读 </p>\n\n<p style=\"text-align:center\"> 对物联网相关技术有着浓厚兴趣，具有实现想法的学习动力和软硬件开发能力</p>\n\n<p style=\"text-align:center\">热爱技术、热爱生活、热爱团队合作</p>\n\n"}],"Post":[{"title":"ARKit入门-建立第一个AR体验","date":"2017-11-24T12:01:14.000Z","_content":"\n> 翻译自 [Building Your First AR Experience](https://developer.apple.com/documentation/arkit/building_your_first_ar_experience) \n\n创建一个运行AR session并利用平面检测使用SceneKit来放置3D内容的app。\n\n## 概述\n\n这个示例app运行一个 ARKit 现实追踪 session，并且在 SceneKit 视图中显示内容。为了演示平面检测，这个app仅放置一个 SCNPlane 对象来可视化每个检测到的 ARPlaneAnchor 对象。\n\n## 配置并运行 AR Session \n\nARSCNView 类是一个 SceneKit 视图，包括一个 ARSession 对象，该对象用来管理创建AR体验所需的运动跟踪和图像处理。但是，要运行 AR Session，必须要提供一个 Session 配置。\n\n![](media/15113476634025/15113487703253.jpg)\n\n ARWorldTrackingConfiguration 类提供高精度的运动跟踪，并且可以帮助你将虚拟内容放置在真实物体表面。要启动 AR Session，请使用你想要的选项（例如平面检测）来创建一个Session配置对象，然后在ARSCNView实例的session对象上调用run方法：\n \n ``` swift\n let configuration = ARWorldTrackingConfiguration()\n configuration.planeDetection = .horizontal\n sceneView.session.run(configuration)\n ```\n \n 只有在屏幕上显示View的时候才运行session。\n \n **重要：** 如果你的app的核心功能需要使用ARKit，请使用你app的Info.plist文件 UIRequiredDeviceCapabilities 中的 arkit 键，以确保你的app仅在支持ARKit的设备上可用。\n如果AR只是你app的辅助功能，请使用 isSupported 属性来确定是否提供基于AR的功能。\n\n## 在检测到的平面上放置3D内容\n\n在设置好AR session后，可以使用 SceneKit 来放置虚拟内容在视图里。\n\n当启用平面检测时，ARKit 为每个检测到的平面 添加和更新 anchors。默认情况下，ARSCNView 类为每个anchor 添加一个 ACNNode 对象到 SceneKit 场景。你的View的代理可以实现  renderer(_:didAdd:for:) 方法来向场景中添加内容。\n\n``` swift\nfunc renderer(_ renderer: SCNSceneRenderer, didAdd node: SCNNode, for anchor: ARAnchor) {\n       // Place content only for anchors found by plane detection.\n       // 将内容仅用于通过平面检测发现的anchor\n       guard let planeAnchor = anchor as? ARPlaneAnchor else { return }\n\n       // Create a SceneKit plane to visualize the plane anchor using its position and extent.\n       // 创建一个SceneKit平面，以使用其位置和范围来可视化平面anchor\n       let plane = SCNPlane(width: CGFloat(planeAnchor.extent.x), height: CGFloat(planeAnchor.extent.z))\n       let planeNode = SCNNode(geometry: plane)\n       planeNode.simdPosition = float3(planeAnchor.center.x, 0, planeAnchor.center.z)\n       \n       /*\n        `SCNPlane` is vertically oriented in its local coordinate space, so\n        rotate the plane to match the horizontal orientation of `ARPlaneAnchor`.\n       */\n       \n       /*\n       `SCNPlane` 在本地坐标空间中是垂直的，所以 旋转这个平面来匹配 ‘ARPlaneAnchor’ 的水平方向。\n       */\n       planeNode.eulerAngles.x = -.pi / 2\n       \n       // Make the plane visualization semitransparent to clearly show real-world placement.\n       //  使平面的可视化半透明，以清楚的显示真实事件的位置。\n       planeNode.opacity = 0.25\n       \n       /*\n        Add the plane visualization to the ARKit-managed node so that it tracks\n        changes in the plane anchor as plane estimation continues.\n       */\n       /*\n       将平面可视化添加到ARKit管理的节点中，以便于跟踪平面anchor的改变，随着平面估计的继续。\n       \n       */\n       node.addChildNode(planeNode)\n}\n```\n\n\n如果将内容添加为与anchor相对应的节点的子节点，ARSCNView类会自动的移动改内容，因为ARKit会优化它对平面位置和范围的估计。为了显示估计平面的全部范围，该示例app还实现了[renderer(_:didUpdate:for:) ](https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865799-renderer)方法，更新SCNPlane对象的大小来反映ARKit提供的估计值。\n\n``` swift\nfunc renderer(_ renderer: SCNSceneRenderer, didUpdate node: SCNNode, for anchor: ARAnchor) {\n    // Update content only for plane anchors and nodes matching the setup created in `renderer(_:didAdd:for:)`.\n    // 仅更新 平面的anchor ，和在`renderer(_:didAdd:for:)`中创建设置的nodes 匹配的nodes\n    guard let planeAnchor = anchor as?  ARPlaneAnchor,\n        let planeNode = node.childNodes.first,\n        let plane = planeNode.geometry as? SCNPlane\n        else { return }\n    \n    // Plane estimation may shift the center of a plane relative to its anchor's transform.\n    // 平面估计 可能会移动平面的中心，由于其相关联的anchor的中心发生变换。\n    planeNode.simdPosition = float3(planeAnchor.center.x, 0, planeAnchor.center.z)\n    \n    /*\n     Plane estimation may extend the size of the plane, or combine previously detected\n     planes into a larger one. In the latter case, `ARSCNView` automatically deletes the\n     corresponding node for one plane, then calls this method to update the size of\n     the remaining plane.\n    */\n    /*\n    平面估计可能会增大平面的尺寸，或者与之前检测到的平面结合成一个更大的平面。\n    在后一种情况下，`ARSCNView` 会自动的删除对应平面的节点，然后调用这个方法来更新剩下平面的大小。\n    */\n    plane.width = CGFloat(planeAnchor.extent.x)\n    plane.height = CGFloat(planeAnchor.extent.z)\n}\n```\n\n\n\n\n\n","source":"_posts/2017-11-24-ARKit入门-0.md","raw":"---\ntitle: ARKit入门-建立第一个AR体验\ndate: 2017-11-24 20:01:14\ntags:\n- ARKit \n- 翻译\n\ncategories:\n- ARKit\n- 翻译\n---\n\n> 翻译自 [Building Your First AR Experience](https://developer.apple.com/documentation/arkit/building_your_first_ar_experience) \n\n创建一个运行AR session并利用平面检测使用SceneKit来放置3D内容的app。\n\n## 概述\n\n这个示例app运行一个 ARKit 现实追踪 session，并且在 SceneKit 视图中显示内容。为了演示平面检测，这个app仅放置一个 SCNPlane 对象来可视化每个检测到的 ARPlaneAnchor 对象。\n\n## 配置并运行 AR Session \n\nARSCNView 类是一个 SceneKit 视图，包括一个 ARSession 对象，该对象用来管理创建AR体验所需的运动跟踪和图像处理。但是，要运行 AR Session，必须要提供一个 Session 配置。\n\n![](media/15113476634025/15113487703253.jpg)\n\n ARWorldTrackingConfiguration 类提供高精度的运动跟踪，并且可以帮助你将虚拟内容放置在真实物体表面。要启动 AR Session，请使用你想要的选项（例如平面检测）来创建一个Session配置对象，然后在ARSCNView实例的session对象上调用run方法：\n \n ``` swift\n let configuration = ARWorldTrackingConfiguration()\n configuration.planeDetection = .horizontal\n sceneView.session.run(configuration)\n ```\n \n 只有在屏幕上显示View的时候才运行session。\n \n **重要：** 如果你的app的核心功能需要使用ARKit，请使用你app的Info.plist文件 UIRequiredDeviceCapabilities 中的 arkit 键，以确保你的app仅在支持ARKit的设备上可用。\n如果AR只是你app的辅助功能，请使用 isSupported 属性来确定是否提供基于AR的功能。\n\n## 在检测到的平面上放置3D内容\n\n在设置好AR session后，可以使用 SceneKit 来放置虚拟内容在视图里。\n\n当启用平面检测时，ARKit 为每个检测到的平面 添加和更新 anchors。默认情况下，ARSCNView 类为每个anchor 添加一个 ACNNode 对象到 SceneKit 场景。你的View的代理可以实现  renderer(_:didAdd:for:) 方法来向场景中添加内容。\n\n``` swift\nfunc renderer(_ renderer: SCNSceneRenderer, didAdd node: SCNNode, for anchor: ARAnchor) {\n       // Place content only for anchors found by plane detection.\n       // 将内容仅用于通过平面检测发现的anchor\n       guard let planeAnchor = anchor as? ARPlaneAnchor else { return }\n\n       // Create a SceneKit plane to visualize the plane anchor using its position and extent.\n       // 创建一个SceneKit平面，以使用其位置和范围来可视化平面anchor\n       let plane = SCNPlane(width: CGFloat(planeAnchor.extent.x), height: CGFloat(planeAnchor.extent.z))\n       let planeNode = SCNNode(geometry: plane)\n       planeNode.simdPosition = float3(planeAnchor.center.x, 0, planeAnchor.center.z)\n       \n       /*\n        `SCNPlane` is vertically oriented in its local coordinate space, so\n        rotate the plane to match the horizontal orientation of `ARPlaneAnchor`.\n       */\n       \n       /*\n       `SCNPlane` 在本地坐标空间中是垂直的，所以 旋转这个平面来匹配 ‘ARPlaneAnchor’ 的水平方向。\n       */\n       planeNode.eulerAngles.x = -.pi / 2\n       \n       // Make the plane visualization semitransparent to clearly show real-world placement.\n       //  使平面的可视化半透明，以清楚的显示真实事件的位置。\n       planeNode.opacity = 0.25\n       \n       /*\n        Add the plane visualization to the ARKit-managed node so that it tracks\n        changes in the plane anchor as plane estimation continues.\n       */\n       /*\n       将平面可视化添加到ARKit管理的节点中，以便于跟踪平面anchor的改变，随着平面估计的继续。\n       \n       */\n       node.addChildNode(planeNode)\n}\n```\n\n\n如果将内容添加为与anchor相对应的节点的子节点，ARSCNView类会自动的移动改内容，因为ARKit会优化它对平面位置和范围的估计。为了显示估计平面的全部范围，该示例app还实现了[renderer(_:didUpdate:for:) ](https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865799-renderer)方法，更新SCNPlane对象的大小来反映ARKit提供的估计值。\n\n``` swift\nfunc renderer(_ renderer: SCNSceneRenderer, didUpdate node: SCNNode, for anchor: ARAnchor) {\n    // Update content only for plane anchors and nodes matching the setup created in `renderer(_:didAdd:for:)`.\n    // 仅更新 平面的anchor ，和在`renderer(_:didAdd:for:)`中创建设置的nodes 匹配的nodes\n    guard let planeAnchor = anchor as?  ARPlaneAnchor,\n        let planeNode = node.childNodes.first,\n        let plane = planeNode.geometry as? SCNPlane\n        else { return }\n    \n    // Plane estimation may shift the center of a plane relative to its anchor's transform.\n    // 平面估计 可能会移动平面的中心，由于其相关联的anchor的中心发生变换。\n    planeNode.simdPosition = float3(planeAnchor.center.x, 0, planeAnchor.center.z)\n    \n    /*\n     Plane estimation may extend the size of the plane, or combine previously detected\n     planes into a larger one. In the latter case, `ARSCNView` automatically deletes the\n     corresponding node for one plane, then calls this method to update the size of\n     the remaining plane.\n    */\n    /*\n    平面估计可能会增大平面的尺寸，或者与之前检测到的平面结合成一个更大的平面。\n    在后一种情况下，`ARSCNView` 会自动的删除对应平面的节点，然后调用这个方法来更新剩下平面的大小。\n    */\n    plane.width = CGFloat(planeAnchor.extent.x)\n    plane.height = CGFloat(planeAnchor.extent.z)\n}\n```\n\n\n\n\n\n","slug":"2017-11-24-ARKit入门-0","published":1,"updated":"2019-06-17T15:13:17.150Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkaz0000wq1ke50tw665","content":"<blockquote>\n<p>翻译自 <a href=\"https://developer.apple.com/documentation/arkit/building_your_first_ar_experience\" target=\"_blank\" rel=\"noopener\">Building Your First AR Experience</a> </p>\n</blockquote>\n<p>创建一个运行AR session并利用平面检测使用SceneKit来放置3D内容的app。</p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>这个示例app运行一个 ARKit 现实追踪 session，并且在 SceneKit 视图中显示内容。为了演示平面检测，这个app仅放置一个 SCNPlane 对象来可视化每个检测到的 ARPlaneAnchor 对象。</p>\n<h2 id=\"配置并运行-AR-Session\"><a href=\"#配置并运行-AR-Session\" class=\"headerlink\" title=\"配置并运行 AR Session\"></a>配置并运行 AR Session</h2><p>ARSCNView 类是一个 SceneKit 视图，包括一个 ARSession 对象，该对象用来管理创建AR体验所需的运动跟踪和图像处理。但是，要运行 AR Session，必须要提供一个 Session 配置。</p>\n<p><img src=\"media/15113476634025/15113487703253.jpg\" alt></p>\n<p> ARWorldTrackingConfiguration 类提供高精度的运动跟踪，并且可以帮助你将虚拟内容放置在真实物体表面。要启动 AR Session，请使用你想要的选项（例如平面检测）来创建一个Session配置对象，然后在ARSCNView实例的session对象上调用run方法：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> configuration = <span class=\"type\">ARWorldTrackingConfiguration</span>()</span><br><span class=\"line\">configuration.planeDetection = .horizontal</span><br><span class=\"line\">sceneView.session.run(configuration)</span><br></pre></td></tr></table></figure>\n\n\n<p> 只有在屏幕上显示View的时候才运行session。</p>\n<p> <strong>重要：</strong> 如果你的app的核心功能需要使用ARKit，请使用你app的Info.plist文件 UIRequiredDeviceCapabilities 中的 arkit 键，以确保你的app仅在支持ARKit的设备上可用。<br>如果AR只是你app的辅助功能，请使用 isSupported 属性来确定是否提供基于AR的功能。</p>\n<h2 id=\"在检测到的平面上放置3D内容\"><a href=\"#在检测到的平面上放置3D内容\" class=\"headerlink\" title=\"在检测到的平面上放置3D内容\"></a>在检测到的平面上放置3D内容</h2><p>在设置好AR session后，可以使用 SceneKit 来放置虚拟内容在视图里。</p>\n<p>当启用平面检测时，ARKit 为每个检测到的平面 添加和更新 anchors。默认情况下，ARSCNView 类为每个anchor 添加一个 ACNNode 对象到 SceneKit 场景。你的View的代理可以实现  renderer(_:didAdd:for:) 方法来向场景中添加内容。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">renderer</span><span class=\"params\">(<span class=\"number\">_</span> renderer: SCNSceneRenderer, didAdd node: SCNNode, <span class=\"keyword\">for</span> anchor: ARAnchor)</span></span> &#123;</span><br><span class=\"line\">       <span class=\"comment\">// Place content only for anchors found by plane detection.</span></span><br><span class=\"line\">       <span class=\"comment\">// 将内容仅用于通过平面检测发现的anchor</span></span><br><span class=\"line\">       <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> planeAnchor = anchor <span class=\"keyword\">as</span>? <span class=\"type\">ARPlaneAnchor</span> <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">// Create a SceneKit plane to visualize the plane anchor using its position and extent.</span></span><br><span class=\"line\">       <span class=\"comment\">// 创建一个SceneKit平面，以使用其位置和范围来可视化平面anchor</span></span><br><span class=\"line\">       <span class=\"keyword\">let</span> plane = <span class=\"type\">SCNPlane</span>(width: <span class=\"type\">CGFloat</span>(planeAnchor.extent.x), height: <span class=\"type\">CGFloat</span>(planeAnchor.extent.z))</span><br><span class=\"line\">       <span class=\"keyword\">let</span> planeNode = <span class=\"type\">SCNNode</span>(geometry: plane)</span><br><span class=\"line\">       planeNode.simdPosition = float3(planeAnchor.center.x, <span class=\"number\">0</span>, planeAnchor.center.z)</span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        `SCNPlane` is vertically oriented in its local coordinate space, so</span></span><br><span class=\"line\"><span class=\"comment\">        rotate the plane to match the horizontal orientation of `ARPlaneAnchor`.</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       `SCNPlane` 在本地坐标空间中是垂直的，所以 旋转这个平面来匹配 ‘ARPlaneAnchor’ 的水平方向。</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       planeNode.eulerAngles.x = -.pi / <span class=\"number\">2</span></span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"comment\">// Make the plane visualization semitransparent to clearly show real-world placement.</span></span><br><span class=\"line\">       <span class=\"comment\">//  使平面的可视化半透明，以清楚的显示真实事件的位置。</span></span><br><span class=\"line\">       planeNode.opacity = <span class=\"number\">0.25</span></span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        Add the plane visualization to the ARKit-managed node so that it tracks</span></span><br><span class=\"line\"><span class=\"comment\">        changes in the plane anchor as plane estimation continues.</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       将平面可视化添加到ARKit管理的节点中，以便于跟踪平面anchor的改变，随着平面估计的继续。</span></span><br><span class=\"line\"><span class=\"comment\">       </span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       node.addChildNode(planeNode)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果将内容添加为与anchor相对应的节点的子节点，ARSCNView类会自动的移动改内容，因为ARKit会优化它对平面位置和范围的估计。为了显示估计平面的全部范围，该示例app还实现了<a href=\"https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865799-renderer\" target=\"_blank\" rel=\"noopener\">renderer(_:didUpdate:for:) </a>方法，更新SCNPlane对象的大小来反映ARKit提供的估计值。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">renderer</span><span class=\"params\">(<span class=\"number\">_</span> renderer: SCNSceneRenderer, didUpdate node: SCNNode, <span class=\"keyword\">for</span> anchor: ARAnchor)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Update content only for plane anchors and nodes matching the setup created in `renderer(_:didAdd:for:)`.</span></span><br><span class=\"line\">    <span class=\"comment\">// 仅更新 平面的anchor ，和在`renderer(_:didAdd:for:)`中创建设置的nodes 匹配的nodes</span></span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> planeAnchor = anchor <span class=\"keyword\">as</span>?  <span class=\"type\">ARPlaneAnchor</span>,</span><br><span class=\"line\">        <span class=\"keyword\">let</span> planeNode = node.childNodes.first,</span><br><span class=\"line\">        <span class=\"keyword\">let</span> plane = planeNode.geometry <span class=\"keyword\">as</span>? <span class=\"type\">SCNPlane</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Plane estimation may shift the center of a plane relative to its anchor's transform.</span></span><br><span class=\"line\">    <span class=\"comment\">// 平面估计 可能会移动平面的中心，由于其相关联的anchor的中心发生变换。</span></span><br><span class=\"line\">    planeNode.simdPosition = float3(planeAnchor.center.x, <span class=\"number\">0</span>, planeAnchor.center.z)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     Plane estimation may extend the size of the plane, or combine previously detected</span></span><br><span class=\"line\"><span class=\"comment\">     planes into a larger one. In the latter case, `ARSCNView` automatically deletes the</span></span><br><span class=\"line\"><span class=\"comment\">     corresponding node for one plane, then calls this method to update the size of</span></span><br><span class=\"line\"><span class=\"comment\">     the remaining plane.</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    平面估计可能会增大平面的尺寸，或者与之前检测到的平面结合成一个更大的平面。</span></span><br><span class=\"line\"><span class=\"comment\">    在后一种情况下，`ARSCNView` 会自动的删除对应平面的节点，然后调用这个方法来更新剩下平面的大小。</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    plane.width = <span class=\"type\">CGFloat</span>(planeAnchor.extent.x)</span><br><span class=\"line\">    plane.height = <span class=\"type\">CGFloat</span>(planeAnchor.extent.z)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>翻译自 <a href=\"https://developer.apple.com/documentation/arkit/building_your_first_ar_experience\" target=\"_blank\" rel=\"noopener\">Building Your First AR Experience</a> </p>\n</blockquote>\n<p>创建一个运行AR session并利用平面检测使用SceneKit来放置3D内容的app。</p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>这个示例app运行一个 ARKit 现实追踪 session，并且在 SceneKit 视图中显示内容。为了演示平面检测，这个app仅放置一个 SCNPlane 对象来可视化每个检测到的 ARPlaneAnchor 对象。</p>\n<h2 id=\"配置并运行-AR-Session\"><a href=\"#配置并运行-AR-Session\" class=\"headerlink\" title=\"配置并运行 AR Session\"></a>配置并运行 AR Session</h2><p>ARSCNView 类是一个 SceneKit 视图，包括一个 ARSession 对象，该对象用来管理创建AR体验所需的运动跟踪和图像处理。但是，要运行 AR Session，必须要提供一个 Session 配置。</p>\n<p><img src=\"media/15113476634025/15113487703253.jpg\" alt></p>\n<p> ARWorldTrackingConfiguration 类提供高精度的运动跟踪，并且可以帮助你将虚拟内容放置在真实物体表面。要启动 AR Session，请使用你想要的选项（例如平面检测）来创建一个Session配置对象，然后在ARSCNView实例的session对象上调用run方法：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> configuration = <span class=\"type\">ARWorldTrackingConfiguration</span>()</span><br><span class=\"line\">configuration.planeDetection = .horizontal</span><br><span class=\"line\">sceneView.session.run(configuration)</span><br></pre></td></tr></table></figure>\n\n\n<p> 只有在屏幕上显示View的时候才运行session。</p>\n<p> <strong>重要：</strong> 如果你的app的核心功能需要使用ARKit，请使用你app的Info.plist文件 UIRequiredDeviceCapabilities 中的 arkit 键，以确保你的app仅在支持ARKit的设备上可用。<br>如果AR只是你app的辅助功能，请使用 isSupported 属性来确定是否提供基于AR的功能。</p>\n<h2 id=\"在检测到的平面上放置3D内容\"><a href=\"#在检测到的平面上放置3D内容\" class=\"headerlink\" title=\"在检测到的平面上放置3D内容\"></a>在检测到的平面上放置3D内容</h2><p>在设置好AR session后，可以使用 SceneKit 来放置虚拟内容在视图里。</p>\n<p>当启用平面检测时，ARKit 为每个检测到的平面 添加和更新 anchors。默认情况下，ARSCNView 类为每个anchor 添加一个 ACNNode 对象到 SceneKit 场景。你的View的代理可以实现  renderer(_:didAdd:for:) 方法来向场景中添加内容。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">renderer</span><span class=\"params\">(<span class=\"number\">_</span> renderer: SCNSceneRenderer, didAdd node: SCNNode, <span class=\"keyword\">for</span> anchor: ARAnchor)</span></span> &#123;</span><br><span class=\"line\">       <span class=\"comment\">// Place content only for anchors found by plane detection.</span></span><br><span class=\"line\">       <span class=\"comment\">// 将内容仅用于通过平面检测发现的anchor</span></span><br><span class=\"line\">       <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> planeAnchor = anchor <span class=\"keyword\">as</span>? <span class=\"type\">ARPlaneAnchor</span> <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">// Create a SceneKit plane to visualize the plane anchor using its position and extent.</span></span><br><span class=\"line\">       <span class=\"comment\">// 创建一个SceneKit平面，以使用其位置和范围来可视化平面anchor</span></span><br><span class=\"line\">       <span class=\"keyword\">let</span> plane = <span class=\"type\">SCNPlane</span>(width: <span class=\"type\">CGFloat</span>(planeAnchor.extent.x), height: <span class=\"type\">CGFloat</span>(planeAnchor.extent.z))</span><br><span class=\"line\">       <span class=\"keyword\">let</span> planeNode = <span class=\"type\">SCNNode</span>(geometry: plane)</span><br><span class=\"line\">       planeNode.simdPosition = float3(planeAnchor.center.x, <span class=\"number\">0</span>, planeAnchor.center.z)</span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        `SCNPlane` is vertically oriented in its local coordinate space, so</span></span><br><span class=\"line\"><span class=\"comment\">        rotate the plane to match the horizontal orientation of `ARPlaneAnchor`.</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       `SCNPlane` 在本地坐标空间中是垂直的，所以 旋转这个平面来匹配 ‘ARPlaneAnchor’ 的水平方向。</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       planeNode.eulerAngles.x = -.pi / <span class=\"number\">2</span></span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"comment\">// Make the plane visualization semitransparent to clearly show real-world placement.</span></span><br><span class=\"line\">       <span class=\"comment\">//  使平面的可视化半透明，以清楚的显示真实事件的位置。</span></span><br><span class=\"line\">       planeNode.opacity = <span class=\"number\">0.25</span></span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        Add the plane visualization to the ARKit-managed node so that it tracks</span></span><br><span class=\"line\"><span class=\"comment\">        changes in the plane anchor as plane estimation continues.</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       将平面可视化添加到ARKit管理的节点中，以便于跟踪平面anchor的改变，随着平面估计的继续。</span></span><br><span class=\"line\"><span class=\"comment\">       </span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">       node.addChildNode(planeNode)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果将内容添加为与anchor相对应的节点的子节点，ARSCNView类会自动的移动改内容，因为ARKit会优化它对平面位置和范围的估计。为了显示估计平面的全部范围，该示例app还实现了<a href=\"https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865799-renderer\" target=\"_blank\" rel=\"noopener\">renderer(_:didUpdate:for:) </a>方法，更新SCNPlane对象的大小来反映ARKit提供的估计值。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">renderer</span><span class=\"params\">(<span class=\"number\">_</span> renderer: SCNSceneRenderer, didUpdate node: SCNNode, <span class=\"keyword\">for</span> anchor: ARAnchor)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Update content only for plane anchors and nodes matching the setup created in `renderer(_:didAdd:for:)`.</span></span><br><span class=\"line\">    <span class=\"comment\">// 仅更新 平面的anchor ，和在`renderer(_:didAdd:for:)`中创建设置的nodes 匹配的nodes</span></span><br><span class=\"line\">    <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> planeAnchor = anchor <span class=\"keyword\">as</span>?  <span class=\"type\">ARPlaneAnchor</span>,</span><br><span class=\"line\">        <span class=\"keyword\">let</span> planeNode = node.childNodes.first,</span><br><span class=\"line\">        <span class=\"keyword\">let</span> plane = planeNode.geometry <span class=\"keyword\">as</span>? <span class=\"type\">SCNPlane</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Plane estimation may shift the center of a plane relative to its anchor's transform.</span></span><br><span class=\"line\">    <span class=\"comment\">// 平面估计 可能会移动平面的中心，由于其相关联的anchor的中心发生变换。</span></span><br><span class=\"line\">    planeNode.simdPosition = float3(planeAnchor.center.x, <span class=\"number\">0</span>, planeAnchor.center.z)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     Plane estimation may extend the size of the plane, or combine previously detected</span></span><br><span class=\"line\"><span class=\"comment\">     planes into a larger one. In the latter case, `ARSCNView` automatically deletes the</span></span><br><span class=\"line\"><span class=\"comment\">     corresponding node for one plane, then calls this method to update the size of</span></span><br><span class=\"line\"><span class=\"comment\">     the remaining plane.</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    平面估计可能会增大平面的尺寸，或者与之前检测到的平面结合成一个更大的平面。</span></span><br><span class=\"line\"><span class=\"comment\">    在后一种情况下，`ARSCNView` 会自动的删除对应平面的节点，然后调用这个方法来更新剩下平面的大小。</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    plane.width = <span class=\"type\">CGFloat</span>(planeAnchor.extent.x)</span><br><span class=\"line\">    plane.height = <span class=\"type\">CGFloat</span>(planeAnchor.extent.z)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"layout":"homekit","title":"非商业用途的 HomeKit 配件开发的常见问题","date":"2017-06-09T03:02:07.000Z","_content":"\n# 前言\n\n前天在 iOS11 的家庭 app 中看到苹果提醒我自己开发的智能设备没有经过认证，还以为苹果会关闭黑 HomeBridge 协议这个HomeKit接口，没想到 WWDC2017 今天公布了 HomeKit 非商业用途的配件的接入协议。可以让个人开发者接入自己的WiFi和BLE类型的智能硬件设备。本文是对官网 FAQs 的整理。\n\n# 基础问题\nHomeKit 配件协议（HAP）是苹果专门用来使第三方配件（例如灯、恒湿器和门锁类）和苹果设备（iPhone、iPad、Apple Watch、AppleTV）之间相互通信的协议。HAP 支持两类通信方式：IP 和 BLE 。在 HAP（非商业版）协议中提供了如何为你的非商业用途配件实现 HAP 协议，意思就是我们自己开发的设备怎样以官方认可的方式接入 HomeKit，而不是利用黑 HomeBridge 协议来实现。 \n\n## 如何获得这个协议规范？\nHomeKit 配件协议规范可以从[HomeKit开发者网页](https://developer.apple.com/homekit/)下载。在你下载文档之前，你需要用你的 AppleID 登陆，然后同意开发协议。\n\n## 利用本规范开发的配件和利用商业版本的 HomeKit 的配件有什么不同？\n使用本规范创建的配件不包含 Apple 认证协处理器或者获得Wi-Fi Alliance 认证，并且不会在MFI项目下完成 HomeKit 认证。对于用户来说，差异主要是基于IP的附件添加过程，并且在用户继续添加的过程中会弹出警告对话框，说明该设备没有经过苹果认证。\n\n## 如何开发生产 HomeKit 的配件来发布销售？\n你的公司必须首先参加 MFI 计划，进行商业销售的第三方HomeKit 配件必须在生产销售之前要实现 MFI 计划，包括完成HomeKit 认证。\n\n## 是否可以在我的配件上添加“Works with Apple HomeKit”标志？\n不允许，这个标志只能用于 MFI 项目并且完成 HomeKit 认证的商业配件。\n\n\n# 技术相关问题\n## 是否可以通过 iOS 内置的家庭app 和 Siri 来控制我的配件，并且创建家庭场景？\n可以，如果你使用 Apple 定义的 HomeKit 服务和本规范中的属性实现HAP协议，并且手机中运行 iOS10 及更高版本，则可以使用家庭app 和 Siri 来控制配件的功能。可以通过[家庭App 使用说明](https://support.apple.com/zh-cn/HT204893)来获得更多帮助。\n\n## 可以创建一个配件实现 Apple 尚未定义的 HomeKit 服务吗？\n可以，你可以创建一个使用自定义服务类型，并且实现 HAP 协议的配件。但为了控制这个配件，你需要开发一个使用 HomeKit API 的自定义应用程序。但这样你就无法通过家庭应用程序或者Siri 进行控制你的设备了。\n\n## 我的配件如何与 iOS设备配对？\n对于IP类配件，配件和iOS设备首先得在同一个WiFi网络下，联网显示配件的方式依赖于你所使用的硬件开发平台。然后你可以通过家庭App或者你自己开发的App来完成配对过程。对于BLE类配件，可以像你平常与BLE设备配对那样进行配对。\n\n## 我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？\n可以，如果配件使用 Apple定义的 HomeKit 服务，并且你将iPad 或者 Apple TV（第四代）设置为家庭中枢，你就可以实现远程控制。有关详细信息，可以查看[自动化和远程访问 HomeKit 配件](https://support.apple.com/zh-cn/HT207057)文档。\n\n## HAP使用了什么安全特性？\nHomeKit 配件与 Apple 产品之间通过 HAP 的所有通信都是端到端加密的，并且是相互认证的。\n\n## IP类的 HomeKit 配件是否必须实现 Bonjour？\n是的，配件必须实现Bonjour才能被发现。Bonjour代码和规范可以在[Bonjour](https://developer.apple.com/bonjour/)文档中查看。\n\n## BLE 类配件是否必须遵守蓝牙核心规范？\n强烈推荐设备遵守蓝牙核心规范，这样可以确保配件的正常运行。\n\n## 是否可以从 Apple 获得 HomeKitSDK？\n暂时不行。\n\n## 为什么我的附件在 iOS设备上会有警告对话框？\n不包含Apple认证协处理器的配件将在iOS中触发警告对话框，这表示该配件未经 HomeKit 认证，用户可以点击确认，继续使用该配件。\n\n## 是否可以在我的配件中添加一个Apple认证协处理器？\n不允许，认证协处理器仅用于商用 HomeKit 配件，该组件只适用于经过MFI认证的公司。\n\n## 在哪可以提问关于实现HAP的问题？\n向其他开发者或者智能家居爱好者询问技术问题或者讨论 HomeKit 配件协议，请访问[Apple开发者论坛](https://forums.developer.apple.com/welcome)。\n\n\n\n\n\n","source":"_posts/HomeKit Accessory开发基础问题.md","raw":"layout: homekit\ntitle: 非商业用途的 HomeKit 配件开发的常见问题\ndate: 2017-06-09 11:02:07\ntags:\n- HomeKit\n- HomeKit Accessory Protocol \n\ncategories:\n- HomeKit\n---\n\n# 前言\n\n前天在 iOS11 的家庭 app 中看到苹果提醒我自己开发的智能设备没有经过认证，还以为苹果会关闭黑 HomeBridge 协议这个HomeKit接口，没想到 WWDC2017 今天公布了 HomeKit 非商业用途的配件的接入协议。可以让个人开发者接入自己的WiFi和BLE类型的智能硬件设备。本文是对官网 FAQs 的整理。\n\n# 基础问题\nHomeKit 配件协议（HAP）是苹果专门用来使第三方配件（例如灯、恒湿器和门锁类）和苹果设备（iPhone、iPad、Apple Watch、AppleTV）之间相互通信的协议。HAP 支持两类通信方式：IP 和 BLE 。在 HAP（非商业版）协议中提供了如何为你的非商业用途配件实现 HAP 协议，意思就是我们自己开发的设备怎样以官方认可的方式接入 HomeKit，而不是利用黑 HomeBridge 协议来实现。 \n\n## 如何获得这个协议规范？\nHomeKit 配件协议规范可以从[HomeKit开发者网页](https://developer.apple.com/homekit/)下载。在你下载文档之前，你需要用你的 AppleID 登陆，然后同意开发协议。\n\n## 利用本规范开发的配件和利用商业版本的 HomeKit 的配件有什么不同？\n使用本规范创建的配件不包含 Apple 认证协处理器或者获得Wi-Fi Alliance 认证，并且不会在MFI项目下完成 HomeKit 认证。对于用户来说，差异主要是基于IP的附件添加过程，并且在用户继续添加的过程中会弹出警告对话框，说明该设备没有经过苹果认证。\n\n## 如何开发生产 HomeKit 的配件来发布销售？\n你的公司必须首先参加 MFI 计划，进行商业销售的第三方HomeKit 配件必须在生产销售之前要实现 MFI 计划，包括完成HomeKit 认证。\n\n## 是否可以在我的配件上添加“Works with Apple HomeKit”标志？\n不允许，这个标志只能用于 MFI 项目并且完成 HomeKit 认证的商业配件。\n\n\n# 技术相关问题\n## 是否可以通过 iOS 内置的家庭app 和 Siri 来控制我的配件，并且创建家庭场景？\n可以，如果你使用 Apple 定义的 HomeKit 服务和本规范中的属性实现HAP协议，并且手机中运行 iOS10 及更高版本，则可以使用家庭app 和 Siri 来控制配件的功能。可以通过[家庭App 使用说明](https://support.apple.com/zh-cn/HT204893)来获得更多帮助。\n\n## 可以创建一个配件实现 Apple 尚未定义的 HomeKit 服务吗？\n可以，你可以创建一个使用自定义服务类型，并且实现 HAP 协议的配件。但为了控制这个配件，你需要开发一个使用 HomeKit API 的自定义应用程序。但这样你就无法通过家庭应用程序或者Siri 进行控制你的设备了。\n\n## 我的配件如何与 iOS设备配对？\n对于IP类配件，配件和iOS设备首先得在同一个WiFi网络下，联网显示配件的方式依赖于你所使用的硬件开发平台。然后你可以通过家庭App或者你自己开发的App来完成配对过程。对于BLE类配件，可以像你平常与BLE设备配对那样进行配对。\n\n## 我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？\n可以，如果配件使用 Apple定义的 HomeKit 服务，并且你将iPad 或者 Apple TV（第四代）设置为家庭中枢，你就可以实现远程控制。有关详细信息，可以查看[自动化和远程访问 HomeKit 配件](https://support.apple.com/zh-cn/HT207057)文档。\n\n## HAP使用了什么安全特性？\nHomeKit 配件与 Apple 产品之间通过 HAP 的所有通信都是端到端加密的，并且是相互认证的。\n\n## IP类的 HomeKit 配件是否必须实现 Bonjour？\n是的，配件必须实现Bonjour才能被发现。Bonjour代码和规范可以在[Bonjour](https://developer.apple.com/bonjour/)文档中查看。\n\n## BLE 类配件是否必须遵守蓝牙核心规范？\n强烈推荐设备遵守蓝牙核心规范，这样可以确保配件的正常运行。\n\n## 是否可以从 Apple 获得 HomeKitSDK？\n暂时不行。\n\n## 为什么我的附件在 iOS设备上会有警告对话框？\n不包含Apple认证协处理器的配件将在iOS中触发警告对话框，这表示该配件未经 HomeKit 认证，用户可以点击确认，继续使用该配件。\n\n## 是否可以在我的配件中添加一个Apple认证协处理器？\n不允许，认证协处理器仅用于商用 HomeKit 配件，该组件只适用于经过MFI认证的公司。\n\n## 在哪可以提问关于实现HAP的问题？\n向其他开发者或者智能家居爱好者询问技术问题或者讨论 HomeKit 配件协议，请访问[Apple开发者论坛](https://forums.developer.apple.com/welcome)。\n\n\n\n\n\n","slug":"HomeKit Accessory开发基础问题","published":1,"updated":"2019-06-17T15:13:17.150Z","comments":1,"photos":[],"link":"","_id":"cjxbvqkb20001wq1kczgjyp1y","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>前天在 iOS11 的家庭 app 中看到苹果提醒我自己开发的智能设备没有经过认证，还以为苹果会关闭黑 HomeBridge 协议这个HomeKit接口，没想到 WWDC2017 今天公布了 HomeKit 非商业用途的配件的接入协议。可以让个人开发者接入自己的WiFi和BLE类型的智能硬件设备。本文是对官网 FAQs 的整理。</p>\n<h1 id=\"基础问题\"><a href=\"#基础问题\" class=\"headerlink\" title=\"基础问题\"></a>基础问题</h1><p>HomeKit 配件协议（HAP）是苹果专门用来使第三方配件（例如灯、恒湿器和门锁类）和苹果设备（iPhone、iPad、Apple Watch、AppleTV）之间相互通信的协议。HAP 支持两类通信方式：IP 和 BLE 。在 HAP（非商业版）协议中提供了如何为你的非商业用途配件实现 HAP 协议，意思就是我们自己开发的设备怎样以官方认可的方式接入 HomeKit，而不是利用黑 HomeBridge 协议来实现。 </p>\n<h2 id=\"如何获得这个协议规范？\"><a href=\"#如何获得这个协议规范？\" class=\"headerlink\" title=\"如何获得这个协议规范？\"></a>如何获得这个协议规范？</h2><p>HomeKit 配件协议规范可以从<a href=\"https://developer.apple.com/homekit/\" target=\"_blank\" rel=\"noopener\">HomeKit开发者网页</a>下载。在你下载文档之前，你需要用你的 AppleID 登陆，然后同意开发协议。</p>\n<h2 id=\"利用本规范开发的配件和利用商业版本的-HomeKit-的配件有什么不同？\"><a href=\"#利用本规范开发的配件和利用商业版本的-HomeKit-的配件有什么不同？\" class=\"headerlink\" title=\"利用本规范开发的配件和利用商业版本的 HomeKit 的配件有什么不同？\"></a>利用本规范开发的配件和利用商业版本的 HomeKit 的配件有什么不同？</h2><p>使用本规范创建的配件不包含 Apple 认证协处理器或者获得Wi-Fi Alliance 认证，并且不会在MFI项目下完成 HomeKit 认证。对于用户来说，差异主要是基于IP的附件添加过程，并且在用户继续添加的过程中会弹出警告对话框，说明该设备没有经过苹果认证。</p>\n<h2 id=\"如何开发生产-HomeKit-的配件来发布销售？\"><a href=\"#如何开发生产-HomeKit-的配件来发布销售？\" class=\"headerlink\" title=\"如何开发生产 HomeKit 的配件来发布销售？\"></a>如何开发生产 HomeKit 的配件来发布销售？</h2><p>你的公司必须首先参加 MFI 计划，进行商业销售的第三方HomeKit 配件必须在生产销售之前要实现 MFI 计划，包括完成HomeKit 认证。</p>\n<h2 id=\"是否可以在我的配件上添加“Works-with-Apple-HomeKit”标志？\"><a href=\"#是否可以在我的配件上添加“Works-with-Apple-HomeKit”标志？\" class=\"headerlink\" title=\"是否可以在我的配件上添加“Works with Apple HomeKit”标志？\"></a>是否可以在我的配件上添加“Works with Apple HomeKit”标志？</h2><p>不允许，这个标志只能用于 MFI 项目并且完成 HomeKit 认证的商业配件。</p>\n<h1 id=\"技术相关问题\"><a href=\"#技术相关问题\" class=\"headerlink\" title=\"技术相关问题\"></a>技术相关问题</h1><h2 id=\"是否可以通过-iOS-内置的家庭app-和-Siri-来控制我的配件，并且创建家庭场景？\"><a href=\"#是否可以通过-iOS-内置的家庭app-和-Siri-来控制我的配件，并且创建家庭场景？\" class=\"headerlink\" title=\"是否可以通过 iOS 内置的家庭app 和 Siri 来控制我的配件，并且创建家庭场景？\"></a>是否可以通过 iOS 内置的家庭app 和 Siri 来控制我的配件，并且创建家庭场景？</h2><p>可以，如果你使用 Apple 定义的 HomeKit 服务和本规范中的属性实现HAP协议，并且手机中运行 iOS10 及更高版本，则可以使用家庭app 和 Siri 来控制配件的功能。可以通过<a href=\"https://support.apple.com/zh-cn/HT204893\" target=\"_blank\" rel=\"noopener\">家庭App 使用说明</a>来获得更多帮助。</p>\n<h2 id=\"可以创建一个配件实现-Apple-尚未定义的-HomeKit-服务吗？\"><a href=\"#可以创建一个配件实现-Apple-尚未定义的-HomeKit-服务吗？\" class=\"headerlink\" title=\"可以创建一个配件实现 Apple 尚未定义的 HomeKit 服务吗？\"></a>可以创建一个配件实现 Apple 尚未定义的 HomeKit 服务吗？</h2><p>可以，你可以创建一个使用自定义服务类型，并且实现 HAP 协议的配件。但为了控制这个配件，你需要开发一个使用 HomeKit API 的自定义应用程序。但这样你就无法通过家庭应用程序或者Siri 进行控制你的设备了。</p>\n<h2 id=\"我的配件如何与-iOS设备配对？\"><a href=\"#我的配件如何与-iOS设备配对？\" class=\"headerlink\" title=\"我的配件如何与 iOS设备配对？\"></a>我的配件如何与 iOS设备配对？</h2><p>对于IP类配件，配件和iOS设备首先得在同一个WiFi网络下，联网显示配件的方式依赖于你所使用的硬件开发平台。然后你可以通过家庭App或者你自己开发的App来完成配对过程。对于BLE类配件，可以像你平常与BLE设备配对那样进行配对。</p>\n<h2 id=\"我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？\"><a href=\"#我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？\" class=\"headerlink\" title=\"我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？\"></a>我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？</h2><p>可以，如果配件使用 Apple定义的 HomeKit 服务，并且你将iPad 或者 Apple TV（第四代）设置为家庭中枢，你就可以实现远程控制。有关详细信息，可以查看<a href=\"https://support.apple.com/zh-cn/HT207057\" target=\"_blank\" rel=\"noopener\">自动化和远程访问 HomeKit 配件</a>文档。</p>\n<h2 id=\"HAP使用了什么安全特性？\"><a href=\"#HAP使用了什么安全特性？\" class=\"headerlink\" title=\"HAP使用了什么安全特性？\"></a>HAP使用了什么安全特性？</h2><p>HomeKit 配件与 Apple 产品之间通过 HAP 的所有通信都是端到端加密的，并且是相互认证的。</p>\n<h2 id=\"IP类的-HomeKit-配件是否必须实现-Bonjour？\"><a href=\"#IP类的-HomeKit-配件是否必须实现-Bonjour？\" class=\"headerlink\" title=\"IP类的 HomeKit 配件是否必须实现 Bonjour？\"></a>IP类的 HomeKit 配件是否必须实现 Bonjour？</h2><p>是的，配件必须实现Bonjour才能被发现。Bonjour代码和规范可以在<a href=\"https://developer.apple.com/bonjour/\" target=\"_blank\" rel=\"noopener\">Bonjour</a>文档中查看。</p>\n<h2 id=\"BLE-类配件是否必须遵守蓝牙核心规范？\"><a href=\"#BLE-类配件是否必须遵守蓝牙核心规范？\" class=\"headerlink\" title=\"BLE 类配件是否必须遵守蓝牙核心规范？\"></a>BLE 类配件是否必须遵守蓝牙核心规范？</h2><p>强烈推荐设备遵守蓝牙核心规范，这样可以确保配件的正常运行。</p>\n<h2 id=\"是否可以从-Apple-获得-HomeKitSDK？\"><a href=\"#是否可以从-Apple-获得-HomeKitSDK？\" class=\"headerlink\" title=\"是否可以从 Apple 获得 HomeKitSDK？\"></a>是否可以从 Apple 获得 HomeKitSDK？</h2><p>暂时不行。</p>\n<h2 id=\"为什么我的附件在-iOS设备上会有警告对话框？\"><a href=\"#为什么我的附件在-iOS设备上会有警告对话框？\" class=\"headerlink\" title=\"为什么我的附件在 iOS设备上会有警告对话框？\"></a>为什么我的附件在 iOS设备上会有警告对话框？</h2><p>不包含Apple认证协处理器的配件将在iOS中触发警告对话框，这表示该配件未经 HomeKit 认证，用户可以点击确认，继续使用该配件。</p>\n<h2 id=\"是否可以在我的配件中添加一个Apple认证协处理器？\"><a href=\"#是否可以在我的配件中添加一个Apple认证协处理器？\" class=\"headerlink\" title=\"是否可以在我的配件中添加一个Apple认证协处理器？\"></a>是否可以在我的配件中添加一个Apple认证协处理器？</h2><p>不允许，认证协处理器仅用于商用 HomeKit 配件，该组件只适用于经过MFI认证的公司。</p>\n<h2 id=\"在哪可以提问关于实现HAP的问题？\"><a href=\"#在哪可以提问关于实现HAP的问题？\" class=\"headerlink\" title=\"在哪可以提问关于实现HAP的问题？\"></a>在哪可以提问关于实现HAP的问题？</h2><p>向其他开发者或者智能家居爱好者询问技术问题或者讨论 HomeKit 配件协议，请访问<a href=\"https://forums.developer.apple.com/welcome\" target=\"_blank\" rel=\"noopener\">Apple开发者论坛</a>。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>前天在 iOS11 的家庭 app 中看到苹果提醒我自己开发的智能设备没有经过认证，还以为苹果会关闭黑 HomeBridge 协议这个HomeKit接口，没想到 WWDC2017 今天公布了 HomeKit 非商业用途的配件的接入协议。可以让个人开发者接入自己的WiFi和BLE类型的智能硬件设备。本文是对官网 FAQs 的整理。</p>\n<h1 id=\"基础问题\"><a href=\"#基础问题\" class=\"headerlink\" title=\"基础问题\"></a>基础问题</h1><p>HomeKit 配件协议（HAP）是苹果专门用来使第三方配件（例如灯、恒湿器和门锁类）和苹果设备（iPhone、iPad、Apple Watch、AppleTV）之间相互通信的协议。HAP 支持两类通信方式：IP 和 BLE 。在 HAP（非商业版）协议中提供了如何为你的非商业用途配件实现 HAP 协议，意思就是我们自己开发的设备怎样以官方认可的方式接入 HomeKit，而不是利用黑 HomeBridge 协议来实现。 </p>\n<h2 id=\"如何获得这个协议规范？\"><a href=\"#如何获得这个协议规范？\" class=\"headerlink\" title=\"如何获得这个协议规范？\"></a>如何获得这个协议规范？</h2><p>HomeKit 配件协议规范可以从<a href=\"https://developer.apple.com/homekit/\" target=\"_blank\" rel=\"noopener\">HomeKit开发者网页</a>下载。在你下载文档之前，你需要用你的 AppleID 登陆，然后同意开发协议。</p>\n<h2 id=\"利用本规范开发的配件和利用商业版本的-HomeKit-的配件有什么不同？\"><a href=\"#利用本规范开发的配件和利用商业版本的-HomeKit-的配件有什么不同？\" class=\"headerlink\" title=\"利用本规范开发的配件和利用商业版本的 HomeKit 的配件有什么不同？\"></a>利用本规范开发的配件和利用商业版本的 HomeKit 的配件有什么不同？</h2><p>使用本规范创建的配件不包含 Apple 认证协处理器或者获得Wi-Fi Alliance 认证，并且不会在MFI项目下完成 HomeKit 认证。对于用户来说，差异主要是基于IP的附件添加过程，并且在用户继续添加的过程中会弹出警告对话框，说明该设备没有经过苹果认证。</p>\n<h2 id=\"如何开发生产-HomeKit-的配件来发布销售？\"><a href=\"#如何开发生产-HomeKit-的配件来发布销售？\" class=\"headerlink\" title=\"如何开发生产 HomeKit 的配件来发布销售？\"></a>如何开发生产 HomeKit 的配件来发布销售？</h2><p>你的公司必须首先参加 MFI 计划，进行商业销售的第三方HomeKit 配件必须在生产销售之前要实现 MFI 计划，包括完成HomeKit 认证。</p>\n<h2 id=\"是否可以在我的配件上添加“Works-with-Apple-HomeKit”标志？\"><a href=\"#是否可以在我的配件上添加“Works-with-Apple-HomeKit”标志？\" class=\"headerlink\" title=\"是否可以在我的配件上添加“Works with Apple HomeKit”标志？\"></a>是否可以在我的配件上添加“Works with Apple HomeKit”标志？</h2><p>不允许，这个标志只能用于 MFI 项目并且完成 HomeKit 认证的商业配件。</p>\n<h1 id=\"技术相关问题\"><a href=\"#技术相关问题\" class=\"headerlink\" title=\"技术相关问题\"></a>技术相关问题</h1><h2 id=\"是否可以通过-iOS-内置的家庭app-和-Siri-来控制我的配件，并且创建家庭场景？\"><a href=\"#是否可以通过-iOS-内置的家庭app-和-Siri-来控制我的配件，并且创建家庭场景？\" class=\"headerlink\" title=\"是否可以通过 iOS 内置的家庭app 和 Siri 来控制我的配件，并且创建家庭场景？\"></a>是否可以通过 iOS 内置的家庭app 和 Siri 来控制我的配件，并且创建家庭场景？</h2><p>可以，如果你使用 Apple 定义的 HomeKit 服务和本规范中的属性实现HAP协议，并且手机中运行 iOS10 及更高版本，则可以使用家庭app 和 Siri 来控制配件的功能。可以通过<a href=\"https://support.apple.com/zh-cn/HT204893\" target=\"_blank\" rel=\"noopener\">家庭App 使用说明</a>来获得更多帮助。</p>\n<h2 id=\"可以创建一个配件实现-Apple-尚未定义的-HomeKit-服务吗？\"><a href=\"#可以创建一个配件实现-Apple-尚未定义的-HomeKit-服务吗？\" class=\"headerlink\" title=\"可以创建一个配件实现 Apple 尚未定义的 HomeKit 服务吗？\"></a>可以创建一个配件实现 Apple 尚未定义的 HomeKit 服务吗？</h2><p>可以，你可以创建一个使用自定义服务类型，并且实现 HAP 协议的配件。但为了控制这个配件，你需要开发一个使用 HomeKit API 的自定义应用程序。但这样你就无法通过家庭应用程序或者Siri 进行控制你的设备了。</p>\n<h2 id=\"我的配件如何与-iOS设备配对？\"><a href=\"#我的配件如何与-iOS设备配对？\" class=\"headerlink\" title=\"我的配件如何与 iOS设备配对？\"></a>我的配件如何与 iOS设备配对？</h2><p>对于IP类配件，配件和iOS设备首先得在同一个WiFi网络下，联网显示配件的方式依赖于你所使用的硬件开发平台。然后你可以通过家庭App或者你自己开发的App来完成配对过程。对于BLE类配件，可以像你平常与BLE设备配对那样进行配对。</p>\n<h2 id=\"我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？\"><a href=\"#我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？\" class=\"headerlink\" title=\"我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？\"></a>我是否可以远程控制我的配件，并且使用家庭App设置自动化操作？</h2><p>可以，如果配件使用 Apple定义的 HomeKit 服务，并且你将iPad 或者 Apple TV（第四代）设置为家庭中枢，你就可以实现远程控制。有关详细信息，可以查看<a href=\"https://support.apple.com/zh-cn/HT207057\" target=\"_blank\" rel=\"noopener\">自动化和远程访问 HomeKit 配件</a>文档。</p>\n<h2 id=\"HAP使用了什么安全特性？\"><a href=\"#HAP使用了什么安全特性？\" class=\"headerlink\" title=\"HAP使用了什么安全特性？\"></a>HAP使用了什么安全特性？</h2><p>HomeKit 配件与 Apple 产品之间通过 HAP 的所有通信都是端到端加密的，并且是相互认证的。</p>\n<h2 id=\"IP类的-HomeKit-配件是否必须实现-Bonjour？\"><a href=\"#IP类的-HomeKit-配件是否必须实现-Bonjour？\" class=\"headerlink\" title=\"IP类的 HomeKit 配件是否必须实现 Bonjour？\"></a>IP类的 HomeKit 配件是否必须实现 Bonjour？</h2><p>是的，配件必须实现Bonjour才能被发现。Bonjour代码和规范可以在<a href=\"https://developer.apple.com/bonjour/\" target=\"_blank\" rel=\"noopener\">Bonjour</a>文档中查看。</p>\n<h2 id=\"BLE-类配件是否必须遵守蓝牙核心规范？\"><a href=\"#BLE-类配件是否必须遵守蓝牙核心规范？\" class=\"headerlink\" title=\"BLE 类配件是否必须遵守蓝牙核心规范？\"></a>BLE 类配件是否必须遵守蓝牙核心规范？</h2><p>强烈推荐设备遵守蓝牙核心规范，这样可以确保配件的正常运行。</p>\n<h2 id=\"是否可以从-Apple-获得-HomeKitSDK？\"><a href=\"#是否可以从-Apple-获得-HomeKitSDK？\" class=\"headerlink\" title=\"是否可以从 Apple 获得 HomeKitSDK？\"></a>是否可以从 Apple 获得 HomeKitSDK？</h2><p>暂时不行。</p>\n<h2 id=\"为什么我的附件在-iOS设备上会有警告对话框？\"><a href=\"#为什么我的附件在-iOS设备上会有警告对话框？\" class=\"headerlink\" title=\"为什么我的附件在 iOS设备上会有警告对话框？\"></a>为什么我的附件在 iOS设备上会有警告对话框？</h2><p>不包含Apple认证协处理器的配件将在iOS中触发警告对话框，这表示该配件未经 HomeKit 认证，用户可以点击确认，继续使用该配件。</p>\n<h2 id=\"是否可以在我的配件中添加一个Apple认证协处理器？\"><a href=\"#是否可以在我的配件中添加一个Apple认证协处理器？\" class=\"headerlink\" title=\"是否可以在我的配件中添加一个Apple认证协处理器？\"></a>是否可以在我的配件中添加一个Apple认证协处理器？</h2><p>不允许，认证协处理器仅用于商用 HomeKit 配件，该组件只适用于经过MFI认证的公司。</p>\n<h2 id=\"在哪可以提问关于实现HAP的问题？\"><a href=\"#在哪可以提问关于实现HAP的问题？\" class=\"headerlink\" title=\"在哪可以提问关于实现HAP的问题？\"></a>在哪可以提问关于实现HAP的问题？</h2><p>向其他开发者或者智能家居爱好者询问技术问题或者讨论 HomeKit 配件协议，请访问<a href=\"https://forums.developer.apple.com/welcome\" target=\"_blank\" rel=\"noopener\">Apple开发者论坛</a>。</p>\n"},{"title":"Supervisor使用入门","date":"2017-12-09T11:43:53.000Z","_content":"\n## 前言\n\n之前写的一个TCP Server最近部署到生产环境，Server用的Python的Twisted框架，里面虽然有进程守护的功能，但是我之前一直用的Supervisor做后台进程管理，其比较好的是具有一个Web管理界面，可以可视化的控制后台进程的启停，我比较喜欢。\n\n## 安装Supervisor\n\n由于Supervisor是用python2开发，于是在服务器里就开了一个新的Python虚拟环境，安装了python2.7。直接 `\tpip install supervisor ` 就好。\n\n## 配置Supervisor\n\n### 基本配置\n\n```\n# 生成配置文件\necho_supervisord_conf > /etc/supervisord.conf\n\n# 生成后台进程配置文件文件夹\nmkdir /etc/supervisord.d/\n\n# 修改配置文件：\nvi /etc/supervisord.conf\n\t\n# 在文件最后添上以下命令，意思包括上面文件夹里的配置文件\n[include]\nfiles = /etc/supervisord.d/*.conf\n```\n\n### 配置Web远程控制\n\n```\n# 修改配置文件\nvi /etc/supervisord.conf\n\n# 把以下内容取消注释，建议把这三个都改调，防止端口被扫描\n[inet_http_server]         ; inet (TCP) server disabled by default\nport=0.0.0.0:9001        ; ip_address:port specifier, *:port for all iface\nusername=user              ; default is no username (open server)\npassword=123               ; default is no password (open server)\n```\n\n**注意：**  要想外网访问，还得记得在阿里云的安全组设置里打开对应的端口\n\n### 配置Supervisor为Service\n\n1. 查看好python2.7的路径\n\n    ```\n    which python2.7\n    /usr/local/bin/python2.7\n    ```\n\n2. 添加service启动脚本,将python路径换成上文的路径\n    \n    ```\n    cd /etc/init.d/\n    vi supervisord\n    ```\n\n    将以下内容添加进去\n    \n    ```\n    #!/bin/sh\n    #\n    # /etc/init.d/supervisord\n    #\n    # Supervisor is a client/server system that\n    # allows its users to monitor and control a\n    # number of processes on UNIX-like operating\n    # systems.\n    #\n    # chkconfig: - 64 36\n    # description: Supervisor Server\n    # processname: supervisord\n     \n    # Source init functions\n    . /etc/rc.d/init.d/functions\n     \n    prog=\"supervisord\"\n     \n    prefix=\"/usr/local\"\n    exec_prefix=\"${prefix}\"\n    prog_bin=\"${exec_prefix}/bin/supervisord\"\n    PIDFILE=\"/var/run/$prog.pid\"\n     \n    start()\n    {\n           echo -n $\"Starting $prog: \"\n           ###注意下面这一行一定得有-c /etc/supervisord.conf   不然修改了配置文件根本不生效！\n           daemon $prog_bin -c /etc/supervisord.conf --pidfile $PIDFILE\n           [ -f $PIDFILE ] && success $\"$prog startup\" || failure $\"$prog startup\"\n           echo\n    }\n     \n    stop()\n    {\n           echo -n $\"Shutting down $prog: \"\n           [ -f $PIDFILE ] && killproc $prog || success $\"$prog shutdown\"\n           echo\n    }\n     \n    case \"$1\" in\n     \n     start)\n       start\n     ;;\n     \n     stop)\n       stop\n     ;;\n     \n     status)\n           status $prog\n     ;;\n     \n     restart)\n       stop\n       start\n     ;;\n     \n     *)\n       echo \"Usage: $0 {start|stop|restart|status}\"\n     ;;\n     \n    esac\n    ```\n\n3. 把启动脚本加入service启动项\n\n    ```\n    chmod +x /etc/init.d/supervisord\n    chkconfig --add supervisord\n    chkconfig supervisord on\n    service supervisord start\n    ```\n\n## 配置要管理的进程 \n\n在管理目录下新建配置文件：\n\n```\ncd /etc/supervisord.d/\nvi xxx.conf\n```\n\n```\n[program:xxx]\ncommand=/usr/local/python3/bin/python3  /root/xxx.py\nautostart=true                           ;是否随supervisor启动\nautorestart=true                         ;是否在挂了之后重启，意外关闭后会重启，比如kill掉！\nstartretries=3                           ;启动尝试次数\nstderr_logfile=/tmp/pileSocketServer.err.log        ;标准输出的位置\nstdout_logfile=/tmp/pileSocketServer.out.log        ;标准错误输出的位置\n```\n\n这里更多的配置参数详见[Supervisor官网参数配置页](http://supervisord.org/configuration.html#program-x-section-values)\n\n添加完配置文件后，重启Supervisor服务`service supervisord restart`就大功告成了。\n\n注：我在实测中，虽然调用restart显示成功，但是Supervisor并没有启动成功。测试以后发现，我的环境需要Start两次才能成功，因此我每次重启Supervisor，只能stop->start->start.\n\n```\nservice supervisord stop\nservice supervisord start\nservice supervisord start\n```\n\n## 番外\n\n这个项目是暑期写的，这次回过头来看，重构的时候发现有些业务逻辑都忘了，因此感叹文档记录太重要了。\n\n有了记录文档，以后就算忘了回过头来看也可以更快恢复上下文。\n\n说这些就是提醒自己，笔记和博客都得勤记。\n\n## 参考\n\n- [Centos平台Supervisord全攻略](http://blog.51cto.com/youerning/1714627)\n- [Supervisor官网文档](http://supervisord.org/configuration.html)\n\n\n","source":"_posts/2017-12-09-Supervisor使用入门.md","raw":"---\ntitle: Supervisor使用入门\ndate: 2017-12-09 19:43:53\ntags:\n- Server \n- Tools\n- 记录\n\ncategories:\n- Server\n- Tools\n---\n\n## 前言\n\n之前写的一个TCP Server最近部署到生产环境，Server用的Python的Twisted框架，里面虽然有进程守护的功能，但是我之前一直用的Supervisor做后台进程管理，其比较好的是具有一个Web管理界面，可以可视化的控制后台进程的启停，我比较喜欢。\n\n## 安装Supervisor\n\n由于Supervisor是用python2开发，于是在服务器里就开了一个新的Python虚拟环境，安装了python2.7。直接 `\tpip install supervisor ` 就好。\n\n## 配置Supervisor\n\n### 基本配置\n\n```\n# 生成配置文件\necho_supervisord_conf > /etc/supervisord.conf\n\n# 生成后台进程配置文件文件夹\nmkdir /etc/supervisord.d/\n\n# 修改配置文件：\nvi /etc/supervisord.conf\n\t\n# 在文件最后添上以下命令，意思包括上面文件夹里的配置文件\n[include]\nfiles = /etc/supervisord.d/*.conf\n```\n\n### 配置Web远程控制\n\n```\n# 修改配置文件\nvi /etc/supervisord.conf\n\n# 把以下内容取消注释，建议把这三个都改调，防止端口被扫描\n[inet_http_server]         ; inet (TCP) server disabled by default\nport=0.0.0.0:9001        ; ip_address:port specifier, *:port for all iface\nusername=user              ; default is no username (open server)\npassword=123               ; default is no password (open server)\n```\n\n**注意：**  要想外网访问，还得记得在阿里云的安全组设置里打开对应的端口\n\n### 配置Supervisor为Service\n\n1. 查看好python2.7的路径\n\n    ```\n    which python2.7\n    /usr/local/bin/python2.7\n    ```\n\n2. 添加service启动脚本,将python路径换成上文的路径\n    \n    ```\n    cd /etc/init.d/\n    vi supervisord\n    ```\n\n    将以下内容添加进去\n    \n    ```\n    #!/bin/sh\n    #\n    # /etc/init.d/supervisord\n    #\n    # Supervisor is a client/server system that\n    # allows its users to monitor and control a\n    # number of processes on UNIX-like operating\n    # systems.\n    #\n    # chkconfig: - 64 36\n    # description: Supervisor Server\n    # processname: supervisord\n     \n    # Source init functions\n    . /etc/rc.d/init.d/functions\n     \n    prog=\"supervisord\"\n     \n    prefix=\"/usr/local\"\n    exec_prefix=\"${prefix}\"\n    prog_bin=\"${exec_prefix}/bin/supervisord\"\n    PIDFILE=\"/var/run/$prog.pid\"\n     \n    start()\n    {\n           echo -n $\"Starting $prog: \"\n           ###注意下面这一行一定得有-c /etc/supervisord.conf   不然修改了配置文件根本不生效！\n           daemon $prog_bin -c /etc/supervisord.conf --pidfile $PIDFILE\n           [ -f $PIDFILE ] && success $\"$prog startup\" || failure $\"$prog startup\"\n           echo\n    }\n     \n    stop()\n    {\n           echo -n $\"Shutting down $prog: \"\n           [ -f $PIDFILE ] && killproc $prog || success $\"$prog shutdown\"\n           echo\n    }\n     \n    case \"$1\" in\n     \n     start)\n       start\n     ;;\n     \n     stop)\n       stop\n     ;;\n     \n     status)\n           status $prog\n     ;;\n     \n     restart)\n       stop\n       start\n     ;;\n     \n     *)\n       echo \"Usage: $0 {start|stop|restart|status}\"\n     ;;\n     \n    esac\n    ```\n\n3. 把启动脚本加入service启动项\n\n    ```\n    chmod +x /etc/init.d/supervisord\n    chkconfig --add supervisord\n    chkconfig supervisord on\n    service supervisord start\n    ```\n\n## 配置要管理的进程 \n\n在管理目录下新建配置文件：\n\n```\ncd /etc/supervisord.d/\nvi xxx.conf\n```\n\n```\n[program:xxx]\ncommand=/usr/local/python3/bin/python3  /root/xxx.py\nautostart=true                           ;是否随supervisor启动\nautorestart=true                         ;是否在挂了之后重启，意外关闭后会重启，比如kill掉！\nstartretries=3                           ;启动尝试次数\nstderr_logfile=/tmp/pileSocketServer.err.log        ;标准输出的位置\nstdout_logfile=/tmp/pileSocketServer.out.log        ;标准错误输出的位置\n```\n\n这里更多的配置参数详见[Supervisor官网参数配置页](http://supervisord.org/configuration.html#program-x-section-values)\n\n添加完配置文件后，重启Supervisor服务`service supervisord restart`就大功告成了。\n\n注：我在实测中，虽然调用restart显示成功，但是Supervisor并没有启动成功。测试以后发现，我的环境需要Start两次才能成功，因此我每次重启Supervisor，只能stop->start->start.\n\n```\nservice supervisord stop\nservice supervisord start\nservice supervisord start\n```\n\n## 番外\n\n这个项目是暑期写的，这次回过头来看，重构的时候发现有些业务逻辑都忘了，因此感叹文档记录太重要了。\n\n有了记录文档，以后就算忘了回过头来看也可以更快恢复上下文。\n\n说这些就是提醒自己，笔记和博客都得勤记。\n\n## 参考\n\n- [Centos平台Supervisord全攻略](http://blog.51cto.com/youerning/1714627)\n- [Supervisor官网文档](http://supervisord.org/configuration.html)\n\n\n","slug":"2017-12-09-Supervisor使用入门","published":1,"updated":"2019-06-17T15:13:17.150Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkb60004wq1ksxym311s","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>之前写的一个TCP Server最近部署到生产环境，Server用的Python的Twisted框架，里面虽然有进程守护的功能，但是我之前一直用的Supervisor做后台进程管理，其比较好的是具有一个Web管理界面，可以可视化的控制后台进程的启停，我比较喜欢。</p>\n<h2 id=\"安装Supervisor\"><a href=\"#安装Supervisor\" class=\"headerlink\" title=\"安装Supervisor\"></a>安装Supervisor</h2><p>由于Supervisor是用python2开发，于是在服务器里就开了一个新的Python虚拟环境，安装了python2.7。直接 <code>pip install supervisor</code> 就好。</p>\n<h2 id=\"配置Supervisor\"><a href=\"#配置Supervisor\" class=\"headerlink\" title=\"配置Supervisor\"></a>配置Supervisor</h2><h3 id=\"基本配置\"><a href=\"#基本配置\" class=\"headerlink\" title=\"基本配置\"></a>基本配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 生成配置文件</span><br><span class=\"line\">echo_supervisord_conf &gt; /etc/supervisord.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 生成后台进程配置文件文件夹</span><br><span class=\"line\">mkdir /etc/supervisord.d/</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改配置文件：</span><br><span class=\"line\">vi /etc/supervisord.conf</span><br><span class=\"line\">\t</span><br><span class=\"line\"># 在文件最后添上以下命令，意思包括上面文件夹里的配置文件</span><br><span class=\"line\">[include]</span><br><span class=\"line\">files = /etc/supervisord.d/*.conf</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置Web远程控制\"><a href=\"#配置Web远程控制\" class=\"headerlink\" title=\"配置Web远程控制\"></a>配置Web远程控制</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改配置文件</span><br><span class=\"line\">vi /etc/supervisord.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 把以下内容取消注释，建议把这三个都改调，防止端口被扫描</span><br><span class=\"line\">[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class=\"line\">port=0.0.0.0:9001        ; ip_address:port specifier, *:port for all iface</span><br><span class=\"line\">username=user              ; default is no username (open server)</span><br><span class=\"line\">password=123               ; default is no password (open server)</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：</strong>  要想外网访问，还得记得在阿里云的安全组设置里打开对应的端口</p>\n<h3 id=\"配置Supervisor为Service\"><a href=\"#配置Supervisor为Service\" class=\"headerlink\" title=\"配置Supervisor为Service\"></a>配置Supervisor为Service</h3><ol>\n<li><p>查看好python2.7的路径</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which python2.7</span><br><span class=\"line\">/usr/local/bin/python2.7</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>添加service启动脚本,将python路径换成上文的路径</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /etc/init.d/</span><br><span class=\"line\">vi supervisord</span><br></pre></td></tr></table></figure>\n\n<p> 将以下内容添加进去</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/sh</span><br><span class=\"line\">#</span><br><span class=\"line\"># /etc/init.d/supervisord</span><br><span class=\"line\">#</span><br><span class=\"line\"># Supervisor is a client/server system that</span><br><span class=\"line\"># allows its users to monitor and control a</span><br><span class=\"line\"># number of processes on UNIX-like operating</span><br><span class=\"line\"># systems.</span><br><span class=\"line\">#</span><br><span class=\"line\"># chkconfig: - 64 36</span><br><span class=\"line\"># description: Supervisor Server</span><br><span class=\"line\"># processname: supervisord</span><br><span class=\"line\"> </span><br><span class=\"line\"># Source init functions</span><br><span class=\"line\">. /etc/rc.d/init.d/functions</span><br><span class=\"line\"> </span><br><span class=\"line\">prog=&quot;supervisord&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">prefix=&quot;/usr/local&quot;</span><br><span class=\"line\">exec_prefix=&quot;$&#123;prefix&#125;&quot;</span><br><span class=\"line\">prog_bin=&quot;$&#123;exec_prefix&#125;/bin/supervisord&quot;</span><br><span class=\"line\">PIDFILE=&quot;/var/run/$prog.pid&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">start()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">       echo -n $&quot;Starting $prog: &quot;</span><br><span class=\"line\">       ###注意下面这一行一定得有-c /etc/supervisord.conf   不然修改了配置文件根本不生效！</span><br><span class=\"line\">       daemon $prog_bin -c /etc/supervisord.conf --pidfile $PIDFILE</span><br><span class=\"line\">       [ -f $PIDFILE ] &amp;&amp; success $&quot;$prog startup&quot; || failure $&quot;$prog startup&quot;</span><br><span class=\"line\">       echo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">stop()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">       echo -n $&quot;Shutting down $prog: &quot;</span><br><span class=\"line\">       [ -f $PIDFILE ] &amp;&amp; killproc $prog || success $&quot;$prog shutdown&quot;</span><br><span class=\"line\">       echo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">case &quot;$1&quot; in</span><br><span class=\"line\"> </span><br><span class=\"line\"> start)</span><br><span class=\"line\">   start</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\"> stop)</span><br><span class=\"line\">   stop</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\"> status)</span><br><span class=\"line\">       status $prog</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\"> restart)</span><br><span class=\"line\">   stop</span><br><span class=\"line\">   start</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\"> *)</span><br><span class=\"line\">   echo &quot;Usage: $0 &#123;start|stop|restart|status&#125;&quot;</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\">esac</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>把启动脚本加入service启动项</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x /etc/init.d/supervisord</span><br><span class=\"line\">chkconfig --add supervisord</span><br><span class=\"line\">chkconfig supervisord on</span><br><span class=\"line\">service supervisord start</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"配置要管理的进程\"><a href=\"#配置要管理的进程\" class=\"headerlink\" title=\"配置要管理的进程\"></a>配置要管理的进程</h2><p>在管理目录下新建配置文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /etc/supervisord.d/</span><br><span class=\"line\">vi xxx.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:xxx]</span><br><span class=\"line\">command=/usr/local/python3/bin/python3  /root/xxx.py</span><br><span class=\"line\">autostart=true                           ;是否随supervisor启动</span><br><span class=\"line\">autorestart=true                         ;是否在挂了之后重启，意外关闭后会重启，比如kill掉！</span><br><span class=\"line\">startretries=3                           ;启动尝试次数</span><br><span class=\"line\">stderr_logfile=/tmp/pileSocketServer.err.log        ;标准输出的位置</span><br><span class=\"line\">stdout_logfile=/tmp/pileSocketServer.out.log        ;标准错误输出的位置</span><br></pre></td></tr></table></figure>\n\n<p>这里更多的配置参数详见<a href=\"http://supervisord.org/configuration.html#program-x-section-values\" target=\"_blank\" rel=\"noopener\">Supervisor官网参数配置页</a></p>\n<p>添加完配置文件后，重启Supervisor服务<code>service supervisord restart</code>就大功告成了。</p>\n<p>注：我在实测中，虽然调用restart显示成功，但是Supervisor并没有启动成功。测试以后发现，我的环境需要Start两次才能成功，因此我每次重启Supervisor，只能stop-&gt;start-&gt;start.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service supervisord stop</span><br><span class=\"line\">service supervisord start</span><br><span class=\"line\">service supervisord start</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"番外\"><a href=\"#番外\" class=\"headerlink\" title=\"番外\"></a>番外</h2><p>这个项目是暑期写的，这次回过头来看，重构的时候发现有些业务逻辑都忘了，因此感叹文档记录太重要了。</p>\n<p>有了记录文档，以后就算忘了回过头来看也可以更快恢复上下文。</p>\n<p>说这些就是提醒自己，笔记和博客都得勤记。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://blog.51cto.com/youerning/1714627\" target=\"_blank\" rel=\"noopener\">Centos平台Supervisord全攻略</a></li>\n<li><a href=\"http://supervisord.org/configuration.html\" target=\"_blank\" rel=\"noopener\">Supervisor官网文档</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>之前写的一个TCP Server最近部署到生产环境，Server用的Python的Twisted框架，里面虽然有进程守护的功能，但是我之前一直用的Supervisor做后台进程管理，其比较好的是具有一个Web管理界面，可以可视化的控制后台进程的启停，我比较喜欢。</p>\n<h2 id=\"安装Supervisor\"><a href=\"#安装Supervisor\" class=\"headerlink\" title=\"安装Supervisor\"></a>安装Supervisor</h2><p>由于Supervisor是用python2开发，于是在服务器里就开了一个新的Python虚拟环境，安装了python2.7。直接 <code>pip install supervisor</code> 就好。</p>\n<h2 id=\"配置Supervisor\"><a href=\"#配置Supervisor\" class=\"headerlink\" title=\"配置Supervisor\"></a>配置Supervisor</h2><h3 id=\"基本配置\"><a href=\"#基本配置\" class=\"headerlink\" title=\"基本配置\"></a>基本配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 生成配置文件</span><br><span class=\"line\">echo_supervisord_conf &gt; /etc/supervisord.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 生成后台进程配置文件文件夹</span><br><span class=\"line\">mkdir /etc/supervisord.d/</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改配置文件：</span><br><span class=\"line\">vi /etc/supervisord.conf</span><br><span class=\"line\">\t</span><br><span class=\"line\"># 在文件最后添上以下命令，意思包括上面文件夹里的配置文件</span><br><span class=\"line\">[include]</span><br><span class=\"line\">files = /etc/supervisord.d/*.conf</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置Web远程控制\"><a href=\"#配置Web远程控制\" class=\"headerlink\" title=\"配置Web远程控制\"></a>配置Web远程控制</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改配置文件</span><br><span class=\"line\">vi /etc/supervisord.conf</span><br><span class=\"line\"></span><br><span class=\"line\"># 把以下内容取消注释，建议把这三个都改调，防止端口被扫描</span><br><span class=\"line\">[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class=\"line\">port=0.0.0.0:9001        ; ip_address:port specifier, *:port for all iface</span><br><span class=\"line\">username=user              ; default is no username (open server)</span><br><span class=\"line\">password=123               ; default is no password (open server)</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：</strong>  要想外网访问，还得记得在阿里云的安全组设置里打开对应的端口</p>\n<h3 id=\"配置Supervisor为Service\"><a href=\"#配置Supervisor为Service\" class=\"headerlink\" title=\"配置Supervisor为Service\"></a>配置Supervisor为Service</h3><ol>\n<li><p>查看好python2.7的路径</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which python2.7</span><br><span class=\"line\">/usr/local/bin/python2.7</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>添加service启动脚本,将python路径换成上文的路径</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /etc/init.d/</span><br><span class=\"line\">vi supervisord</span><br></pre></td></tr></table></figure>\n\n<p> 将以下内容添加进去</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/sh</span><br><span class=\"line\">#</span><br><span class=\"line\"># /etc/init.d/supervisord</span><br><span class=\"line\">#</span><br><span class=\"line\"># Supervisor is a client/server system that</span><br><span class=\"line\"># allows its users to monitor and control a</span><br><span class=\"line\"># number of processes on UNIX-like operating</span><br><span class=\"line\"># systems.</span><br><span class=\"line\">#</span><br><span class=\"line\"># chkconfig: - 64 36</span><br><span class=\"line\"># description: Supervisor Server</span><br><span class=\"line\"># processname: supervisord</span><br><span class=\"line\"> </span><br><span class=\"line\"># Source init functions</span><br><span class=\"line\">. /etc/rc.d/init.d/functions</span><br><span class=\"line\"> </span><br><span class=\"line\">prog=&quot;supervisord&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">prefix=&quot;/usr/local&quot;</span><br><span class=\"line\">exec_prefix=&quot;$&#123;prefix&#125;&quot;</span><br><span class=\"line\">prog_bin=&quot;$&#123;exec_prefix&#125;/bin/supervisord&quot;</span><br><span class=\"line\">PIDFILE=&quot;/var/run/$prog.pid&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">start()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">       echo -n $&quot;Starting $prog: &quot;</span><br><span class=\"line\">       ###注意下面这一行一定得有-c /etc/supervisord.conf   不然修改了配置文件根本不生效！</span><br><span class=\"line\">       daemon $prog_bin -c /etc/supervisord.conf --pidfile $PIDFILE</span><br><span class=\"line\">       [ -f $PIDFILE ] &amp;&amp; success $&quot;$prog startup&quot; || failure $&quot;$prog startup&quot;</span><br><span class=\"line\">       echo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">stop()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">       echo -n $&quot;Shutting down $prog: &quot;</span><br><span class=\"line\">       [ -f $PIDFILE ] &amp;&amp; killproc $prog || success $&quot;$prog shutdown&quot;</span><br><span class=\"line\">       echo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">case &quot;$1&quot; in</span><br><span class=\"line\"> </span><br><span class=\"line\"> start)</span><br><span class=\"line\">   start</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\"> stop)</span><br><span class=\"line\">   stop</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\"> status)</span><br><span class=\"line\">       status $prog</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\"> restart)</span><br><span class=\"line\">   stop</span><br><span class=\"line\">   start</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\"> *)</span><br><span class=\"line\">   echo &quot;Usage: $0 &#123;start|stop|restart|status&#125;&quot;</span><br><span class=\"line\"> ;;</span><br><span class=\"line\"> </span><br><span class=\"line\">esac</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>把启动脚本加入service启动项</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x /etc/init.d/supervisord</span><br><span class=\"line\">chkconfig --add supervisord</span><br><span class=\"line\">chkconfig supervisord on</span><br><span class=\"line\">service supervisord start</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"配置要管理的进程\"><a href=\"#配置要管理的进程\" class=\"headerlink\" title=\"配置要管理的进程\"></a>配置要管理的进程</h2><p>在管理目录下新建配置文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /etc/supervisord.d/</span><br><span class=\"line\">vi xxx.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[program:xxx]</span><br><span class=\"line\">command=/usr/local/python3/bin/python3  /root/xxx.py</span><br><span class=\"line\">autostart=true                           ;是否随supervisor启动</span><br><span class=\"line\">autorestart=true                         ;是否在挂了之后重启，意外关闭后会重启，比如kill掉！</span><br><span class=\"line\">startretries=3                           ;启动尝试次数</span><br><span class=\"line\">stderr_logfile=/tmp/pileSocketServer.err.log        ;标准输出的位置</span><br><span class=\"line\">stdout_logfile=/tmp/pileSocketServer.out.log        ;标准错误输出的位置</span><br></pre></td></tr></table></figure>\n\n<p>这里更多的配置参数详见<a href=\"http://supervisord.org/configuration.html#program-x-section-values\" target=\"_blank\" rel=\"noopener\">Supervisor官网参数配置页</a></p>\n<p>添加完配置文件后，重启Supervisor服务<code>service supervisord restart</code>就大功告成了。</p>\n<p>注：我在实测中，虽然调用restart显示成功，但是Supervisor并没有启动成功。测试以后发现，我的环境需要Start两次才能成功，因此我每次重启Supervisor，只能stop-&gt;start-&gt;start.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service supervisord stop</span><br><span class=\"line\">service supervisord start</span><br><span class=\"line\">service supervisord start</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"番外\"><a href=\"#番外\" class=\"headerlink\" title=\"番外\"></a>番外</h2><p>这个项目是暑期写的，这次回过头来看，重构的时候发现有些业务逻辑都忘了，因此感叹文档记录太重要了。</p>\n<p>有了记录文档，以后就算忘了回过头来看也可以更快恢复上下文。</p>\n<p>说这些就是提醒自己，笔记和博客都得勤记。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://blog.51cto.com/youerning/1714627\" target=\"_blank\" rel=\"noopener\">Centos平台Supervisord全攻略</a></li>\n<li><a href=\"http://supervisord.org/configuration.html\" target=\"_blank\" rel=\"noopener\">Supervisor官网文档</a></li>\n</ul>\n"},{"title":"Swift 模拟登陆小结","date":"2016-08-02T10:27:36.000Z","_content":"\n\n# 背景\n\n过完年在学校度过大学的最后一学期，期间加深学习了Python的Django和iOS开发。在学习的过程中，就想着临走前做一个校园应用。由于我们的需要的信息分散在学校各个部门的系统中，此时就需要通过模拟登陆来获取我们想要的信息。一开始是用python来模拟登陆解析数据的，后期由于我对架构设计的改变（主要是服务器资源和流量没钱买😂），我把很多解析放在手机端（暂时为iOS端）来处理，所以就应运而出本篇博文。\n\n# 准备工作\n\n要模拟浏览器登陆，首先得分析浏览器登陆的步骤，再用代码来实现。在分析浏览器登陆之前先介绍一下使用到的工具。\n\n## 工具\n\n### Charles\n\n这是一款常用的网络封包截取工具，在做开发时，我们为了调试与服务器端的网络通讯协议，常常需要截取网络封包来分析。Mac和PC都可以使用。今天好像发布了新版了。这个还可以作为iPhone的http代理，来抓包手机的网络包。关于此软件的使用详情，可以阅读[唐巧老师的博客](\"http://blog.devtang.com/2015/11/14/charles-introduction/\")。\n\n### Postman\n\n这是Mac上Chrome的一个网络调试的工具插件，PC上不知道有没有，可以通过该工具来进行各种http请求。\n\n### 编码工具\n\n这是一个在线的[站长工具](http://tool.chinaz.com/tools/urlencode.aspx)，可以进行各类编码间的转换，最常用的应该就是utf-8的UrlDecode和UrlEncode。这个工具还非常贴心的提供了gb2312格式的UrlDecode和UrlEncode。\n\n### Alamofire（iOS网络库）\n\n1. Alamofire 的前身是 AFNetworking。AFNetworking 是 iOS 和 OS X 上很受欢迎的第三方HTTP网络基础库。\n2. 其实 AFNetwork 的前缀 AF 便是 Alamofire 的缩写。\n3. Swift发布后，AFNetworking的作者又用Swift语言写了个相同功能的库，这便是 Alamofire。\n4. Alamofire 本质是基于`NSURLSession`，并做了封装。使用 Alamofire 可以让我们网络请求相关代码（如获取数据，提交数据，上传文件，下载文件等）更加简洁易用。\n\n**关于Cookie:**\nAlamofire是基于NSURLRequest封装的，所以Cookie会自动保存，就和浏览器请求是一个效果。而且网站Set_cookie多久，本地的Cookie就多久，每次请求的时候都会自动带上cookie，直到过期。（所以像登陆session这些的都不用我们手动去处理）。\n\n## 基础知识\n\nPOST请求和GET请求应该就不用解释了，这里提醒一下编码格式，现在大部分服务器都是utf-8编码格式的，但不排除少量用的GB2312。所以在发现服务器响应数据乱码时要检查返回数据的编码格式。\n\n## 几个例子\n\n### 登陆1\n\n做校园APP想到的第一个功能就是查成绩查课表，于是第一个就是拿教务系统动刀。\n\n通过Charles发现，使用网页登陆教务系统的时候，其实是跳转到一个check页验证账号密码，再跳转回教务系统首页。该网页返回的就是JSON数据，所以用的`responseJSON`。\n\n``` swift\nAlamofire.request(Method.POST, SchoolBaseURL+\"login/check.shtml\"\n, parameters:[\"user\":\"*****\",\"pass\":\"*****\",\"usertype\":\"stu\"]\n, encoding: ParameterEncoding.URL\n, headers: nil).responseJSON {\n                response in\n            \n            guard response.result.isSuccess  else {\n                self.callback?.managerApiCallBackFailed(self)\n                Hud.showError(\"网络错误了\")\n                return\n            }\n            // 登陆成功\n}\n```\n\n### 登陆2\n\n想到的第二个功能就是查询校园网流量使用情况，于是瞄上了信息管理中心的校园网系统。\n\n这里请求时必须带上Content-Type和Referer。否则就会跳到登录页。这个系统就是我讲的GB2312编码的坑货系统。返回的data需要经过GB2312编码。\n\n``` swift\nAlamofire.request(Method.POST, SchoolNetWorkBaseURL\n, parameters:[\"username\":\"*****\",\"password\":\"*****\"]\n, encoding: ParameterEncoding.URL\n, headers: [\"Content-Type\":\"application/x-www-form-urlencoded\",\"Referer\":SchoolNetWorkBaseURL]).response {\n                request, response, data, error in \n                \n                // 业务处理\n                let GB2312Encoding = CFStringConvertEncodingToNSStringEncoding(0x0632)\n                let selfHTMLString:String = NSString(data: data!, encoding: GB2312Encoding)! as String\n}\n\n```\n \n弄到这里感觉还比较轻松，但是最坑爹的是，这个网站的请求参数必须是经过GB2312的URLEncode。而Alamofire只能将参数进行utf-8编码。我开始时以为将请求参数用GB2312编码后传入即可，或者利用GB2312编码的URLEncode后再传入。但是都相当于Alamofire在最外层还是用UTF-8又URLEncode了一遍。\n\n这是Alamofire的源码，这里可以由`charst=utf-8`看出它默认将数据进行utf-8编码。\n``` swift\nif let method = Method(rawValue: mutableURLRequest.HTTPMethod) where encodesParametersInURL(method) {\n    if let\n        URLComponents = NSURLComponents(URL: mutableURLRequest.URL!, resolvingAgainstBaseURL: false)\n        where !parameters.isEmpty\n    {\n        let percentEncodedQuery = (URLComponents.percentEncodedQuery.map { $0 + \"&\" } ?? \"\") + query(parameters)\n        URLComponents.percentEncodedQuery = percentEncodedQuery\n        mutableURLRequest.URL = URLComponents.URL\n    }\n} else {\n    if mutableURLRequest.valueForHTTPHeaderField(\"Content-Type\") == nil {\n        mutableURLRequest.setValue(\n            \"application/x-www-form-urlencoded; charset=utf-8\",\n            forHTTPHeaderField: \"Content-Type\"\n        )\n    }\n\n    mutableURLRequest.HTTPBody = query(parameters).dataUsingEncoding(\n        NSUTF8StringEncoding,\n        allowLossyConversion: false\n    )\n}\n```\n\n这里参考学长给的建议，将request先自己编码后再进行传输。首先封装了自定义编码request方法。\n\n``` swift\nprivate func urlRequestWithComponents(urlString:String,parameters:[String: AnyObject]) -> (URLRequestConvertible,NSData) {\n    \n    // create  url request to send\n    let mutableURLRequest = NSMutableURLRequest(URL: NSURL(string: urlString)!)\n    mutableURLRequest.HTTPMethod = Alamofire.Method.POST.rawValue\n    let contentType = \"application/x-www-form-urlencoded\"\n    mutableURLRequest.setValue(contentType, forHTTPHeaderField: \"Content-Type\")\n    mutableURLRequest.setValue(\"http://nic.ahnu.edu.cn/cgi-bin/service\", forHTTPHeaderField: \"Referer\")\n    \n    // add parameters\n    let uploadData = NSMutableData()\n    for (key,value) in parameters {\n        uploadData.appendData(\"\\(key)=\\(value)&\".dataUsingEncoding(GB2312Encoding)!)\n    }\n    \n    return (Alamofire.ParameterEncoding.URL.encode(mutableURLRequest, parameters: nil).0,uploadData)\n}\n```\n\n\n``` swift\n\nlet urlRequest = urlRequestWithComponents(SchoolNetWorkBaseURL\n, parameters:[\"username\":\"****\",\"credential\":self.credential,\"logtbl\":\"int201607\",\"echo\":\"查询\",\"func\":\"计费网关\"])\n \nAlamofire.upload(urlRequest.0, data: urlRequest.1).response {\n    request, response, data, error in\n    \n    let htmlString:String = NSString(data: data!, encoding: GB2312Encoding)! as String\n    print(htmlString)\n}\n```\n\n\n\n","source":"_posts/Swift模拟登陆小结.md","raw":"---\ntitle: Swift 模拟登陆小结\ndate: 2016-08-02 18:27:36\ntags: \n- Swift \n- Alamofire \n- 模拟登陆\ncategories:\n- 开发\n- iOS\n---\n\n\n# 背景\n\n过完年在学校度过大学的最后一学期，期间加深学习了Python的Django和iOS开发。在学习的过程中，就想着临走前做一个校园应用。由于我们的需要的信息分散在学校各个部门的系统中，此时就需要通过模拟登陆来获取我们想要的信息。一开始是用python来模拟登陆解析数据的，后期由于我对架构设计的改变（主要是服务器资源和流量没钱买😂），我把很多解析放在手机端（暂时为iOS端）来处理，所以就应运而出本篇博文。\n\n# 准备工作\n\n要模拟浏览器登陆，首先得分析浏览器登陆的步骤，再用代码来实现。在分析浏览器登陆之前先介绍一下使用到的工具。\n\n## 工具\n\n### Charles\n\n这是一款常用的网络封包截取工具，在做开发时，我们为了调试与服务器端的网络通讯协议，常常需要截取网络封包来分析。Mac和PC都可以使用。今天好像发布了新版了。这个还可以作为iPhone的http代理，来抓包手机的网络包。关于此软件的使用详情，可以阅读[唐巧老师的博客](\"http://blog.devtang.com/2015/11/14/charles-introduction/\")。\n\n### Postman\n\n这是Mac上Chrome的一个网络调试的工具插件，PC上不知道有没有，可以通过该工具来进行各种http请求。\n\n### 编码工具\n\n这是一个在线的[站长工具](http://tool.chinaz.com/tools/urlencode.aspx)，可以进行各类编码间的转换，最常用的应该就是utf-8的UrlDecode和UrlEncode。这个工具还非常贴心的提供了gb2312格式的UrlDecode和UrlEncode。\n\n### Alamofire（iOS网络库）\n\n1. Alamofire 的前身是 AFNetworking。AFNetworking 是 iOS 和 OS X 上很受欢迎的第三方HTTP网络基础库。\n2. 其实 AFNetwork 的前缀 AF 便是 Alamofire 的缩写。\n3. Swift发布后，AFNetworking的作者又用Swift语言写了个相同功能的库，这便是 Alamofire。\n4. Alamofire 本质是基于`NSURLSession`，并做了封装。使用 Alamofire 可以让我们网络请求相关代码（如获取数据，提交数据，上传文件，下载文件等）更加简洁易用。\n\n**关于Cookie:**\nAlamofire是基于NSURLRequest封装的，所以Cookie会自动保存，就和浏览器请求是一个效果。而且网站Set_cookie多久，本地的Cookie就多久，每次请求的时候都会自动带上cookie，直到过期。（所以像登陆session这些的都不用我们手动去处理）。\n\n## 基础知识\n\nPOST请求和GET请求应该就不用解释了，这里提醒一下编码格式，现在大部分服务器都是utf-8编码格式的，但不排除少量用的GB2312。所以在发现服务器响应数据乱码时要检查返回数据的编码格式。\n\n## 几个例子\n\n### 登陆1\n\n做校园APP想到的第一个功能就是查成绩查课表，于是第一个就是拿教务系统动刀。\n\n通过Charles发现，使用网页登陆教务系统的时候，其实是跳转到一个check页验证账号密码，再跳转回教务系统首页。该网页返回的就是JSON数据，所以用的`responseJSON`。\n\n``` swift\nAlamofire.request(Method.POST, SchoolBaseURL+\"login/check.shtml\"\n, parameters:[\"user\":\"*****\",\"pass\":\"*****\",\"usertype\":\"stu\"]\n, encoding: ParameterEncoding.URL\n, headers: nil).responseJSON {\n                response in\n            \n            guard response.result.isSuccess  else {\n                self.callback?.managerApiCallBackFailed(self)\n                Hud.showError(\"网络错误了\")\n                return\n            }\n            // 登陆成功\n}\n```\n\n### 登陆2\n\n想到的第二个功能就是查询校园网流量使用情况，于是瞄上了信息管理中心的校园网系统。\n\n这里请求时必须带上Content-Type和Referer。否则就会跳到登录页。这个系统就是我讲的GB2312编码的坑货系统。返回的data需要经过GB2312编码。\n\n``` swift\nAlamofire.request(Method.POST, SchoolNetWorkBaseURL\n, parameters:[\"username\":\"*****\",\"password\":\"*****\"]\n, encoding: ParameterEncoding.URL\n, headers: [\"Content-Type\":\"application/x-www-form-urlencoded\",\"Referer\":SchoolNetWorkBaseURL]).response {\n                request, response, data, error in \n                \n                // 业务处理\n                let GB2312Encoding = CFStringConvertEncodingToNSStringEncoding(0x0632)\n                let selfHTMLString:String = NSString(data: data!, encoding: GB2312Encoding)! as String\n}\n\n```\n \n弄到这里感觉还比较轻松，但是最坑爹的是，这个网站的请求参数必须是经过GB2312的URLEncode。而Alamofire只能将参数进行utf-8编码。我开始时以为将请求参数用GB2312编码后传入即可，或者利用GB2312编码的URLEncode后再传入。但是都相当于Alamofire在最外层还是用UTF-8又URLEncode了一遍。\n\n这是Alamofire的源码，这里可以由`charst=utf-8`看出它默认将数据进行utf-8编码。\n``` swift\nif let method = Method(rawValue: mutableURLRequest.HTTPMethod) where encodesParametersInURL(method) {\n    if let\n        URLComponents = NSURLComponents(URL: mutableURLRequest.URL!, resolvingAgainstBaseURL: false)\n        where !parameters.isEmpty\n    {\n        let percentEncodedQuery = (URLComponents.percentEncodedQuery.map { $0 + \"&\" } ?? \"\") + query(parameters)\n        URLComponents.percentEncodedQuery = percentEncodedQuery\n        mutableURLRequest.URL = URLComponents.URL\n    }\n} else {\n    if mutableURLRequest.valueForHTTPHeaderField(\"Content-Type\") == nil {\n        mutableURLRequest.setValue(\n            \"application/x-www-form-urlencoded; charset=utf-8\",\n            forHTTPHeaderField: \"Content-Type\"\n        )\n    }\n\n    mutableURLRequest.HTTPBody = query(parameters).dataUsingEncoding(\n        NSUTF8StringEncoding,\n        allowLossyConversion: false\n    )\n}\n```\n\n这里参考学长给的建议，将request先自己编码后再进行传输。首先封装了自定义编码request方法。\n\n``` swift\nprivate func urlRequestWithComponents(urlString:String,parameters:[String: AnyObject]) -> (URLRequestConvertible,NSData) {\n    \n    // create  url request to send\n    let mutableURLRequest = NSMutableURLRequest(URL: NSURL(string: urlString)!)\n    mutableURLRequest.HTTPMethod = Alamofire.Method.POST.rawValue\n    let contentType = \"application/x-www-form-urlencoded\"\n    mutableURLRequest.setValue(contentType, forHTTPHeaderField: \"Content-Type\")\n    mutableURLRequest.setValue(\"http://nic.ahnu.edu.cn/cgi-bin/service\", forHTTPHeaderField: \"Referer\")\n    \n    // add parameters\n    let uploadData = NSMutableData()\n    for (key,value) in parameters {\n        uploadData.appendData(\"\\(key)=\\(value)&\".dataUsingEncoding(GB2312Encoding)!)\n    }\n    \n    return (Alamofire.ParameterEncoding.URL.encode(mutableURLRequest, parameters: nil).0,uploadData)\n}\n```\n\n\n``` swift\n\nlet urlRequest = urlRequestWithComponents(SchoolNetWorkBaseURL\n, parameters:[\"username\":\"****\",\"credential\":self.credential,\"logtbl\":\"int201607\",\"echo\":\"查询\",\"func\":\"计费网关\"])\n \nAlamofire.upload(urlRequest.0, data: urlRequest.1).response {\n    request, response, data, error in\n    \n    let htmlString:String = NSString(data: data!, encoding: GB2312Encoding)! as String\n    print(htmlString)\n}\n```\n\n\n\n","slug":"Swift模拟登陆小结","published":1,"updated":"2019-06-16T15:37:13.550Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkb70005wq1k5obdme6s","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>过完年在学校度过大学的最后一学期，期间加深学习了Python的Django和iOS开发。在学习的过程中，就想着临走前做一个校园应用。由于我们的需要的信息分散在学校各个部门的系统中，此时就需要通过模拟登陆来获取我们想要的信息。一开始是用python来模拟登陆解析数据的，后期由于我对架构设计的改变（主要是服务器资源和流量没钱买😂），我把很多解析放在手机端（暂时为iOS端）来处理，所以就应运而出本篇博文。</p>\n<h1 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h1><p>要模拟浏览器登陆，首先得分析浏览器登陆的步骤，再用代码来实现。在分析浏览器登陆之前先介绍一下使用到的工具。</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><h3 id=\"Charles\"><a href=\"#Charles\" class=\"headerlink\" title=\"Charles\"></a>Charles</h3><p>这是一款常用的网络封包截取工具，在做开发时，我们为了调试与服务器端的网络通讯协议，常常需要截取网络封包来分析。Mac和PC都可以使用。今天好像发布了新版了。这个还可以作为iPhone的http代理，来抓包手机的网络包。关于此软件的使用详情，可以阅读<a 11 14 2015 href http: blog.devtang.com charles-introduction \"\">唐巧老师的博客</a>。</p>\n<h3 id=\"Postman\"><a href=\"#Postman\" class=\"headerlink\" title=\"Postman\"></a>Postman</h3><p>这是Mac上Chrome的一个网络调试的工具插件，PC上不知道有没有，可以通过该工具来进行各种http请求。</p>\n<h3 id=\"编码工具\"><a href=\"#编码工具\" class=\"headerlink\" title=\"编码工具\"></a>编码工具</h3><p>这是一个在线的<a href=\"http://tool.chinaz.com/tools/urlencode.aspx\" target=\"_blank\" rel=\"noopener\">站长工具</a>，可以进行各类编码间的转换，最常用的应该就是utf-8的UrlDecode和UrlEncode。这个工具还非常贴心的提供了gb2312格式的UrlDecode和UrlEncode。</p>\n<h3 id=\"Alamofire（iOS网络库）\"><a href=\"#Alamofire（iOS网络库）\" class=\"headerlink\" title=\"Alamofire（iOS网络库）\"></a>Alamofire（iOS网络库）</h3><ol>\n<li>Alamofire 的前身是 AFNetworking。AFNetworking 是 iOS 和 OS X 上很受欢迎的第三方HTTP网络基础库。</li>\n<li>其实 AFNetwork 的前缀 AF 便是 Alamofire 的缩写。</li>\n<li>Swift发布后，AFNetworking的作者又用Swift语言写了个相同功能的库，这便是 Alamofire。</li>\n<li>Alamofire 本质是基于<code>NSURLSession</code>，并做了封装。使用 Alamofire 可以让我们网络请求相关代码（如获取数据，提交数据，上传文件，下载文件等）更加简洁易用。</li>\n</ol>\n<p><strong>关于Cookie:</strong><br>Alamofire是基于NSURLRequest封装的，所以Cookie会自动保存，就和浏览器请求是一个效果。而且网站Set_cookie多久，本地的Cookie就多久，每次请求的时候都会自动带上cookie，直到过期。（所以像登陆session这些的都不用我们手动去处理）。</p>\n<h2 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h2><p>POST请求和GET请求应该就不用解释了，这里提醒一下编码格式，现在大部分服务器都是utf-8编码格式的，但不排除少量用的GB2312。所以在发现服务器响应数据乱码时要检查返回数据的编码格式。</p>\n<h2 id=\"几个例子\"><a href=\"#几个例子\" class=\"headerlink\" title=\"几个例子\"></a>几个例子</h2><h3 id=\"登陆1\"><a href=\"#登陆1\" class=\"headerlink\" title=\"登陆1\"></a>登陆1</h3><p>做校园APP想到的第一个功能就是查成绩查课表，于是第一个就是拿教务系统动刀。</p>\n<p>通过Charles发现，使用网页登陆教务系统的时候，其实是跳转到一个check页验证账号密码，再跳转回教务系统首页。该网页返回的就是JSON数据，所以用的<code>responseJSON</code>。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Alamofire</span>.request(<span class=\"type\">Method</span>.<span class=\"type\">POST</span>, <span class=\"type\">SchoolBaseURL</span>+<span class=\"string\">\"login/check.shtml\"</span></span><br><span class=\"line\">, parameters:[<span class=\"string\">\"user\"</span>:<span class=\"string\">\"*****\"</span>,<span class=\"string\">\"pass\"</span>:<span class=\"string\">\"*****\"</span>,<span class=\"string\">\"usertype\"</span>:<span class=\"string\">\"stu\"</span>]</span><br><span class=\"line\">, encoding: <span class=\"type\">ParameterEncoding</span>.<span class=\"type\">URL</span></span><br><span class=\"line\">, headers: <span class=\"literal\">nil</span>).responseJSON &#123;</span><br><span class=\"line\">                response <span class=\"keyword\">in</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">guard</span> response.result.isSuccess  <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">self</span>.callback?.managerApiCallBackFailed(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">                <span class=\"type\">Hud</span>.showError(<span class=\"string\">\"网络错误了\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 登陆成功</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"登陆2\"><a href=\"#登陆2\" class=\"headerlink\" title=\"登陆2\"></a>登陆2</h3><p>想到的第二个功能就是查询校园网流量使用情况，于是瞄上了信息管理中心的校园网系统。</p>\n<p>这里请求时必须带上Content-Type和Referer。否则就会跳到登录页。这个系统就是我讲的GB2312编码的坑货系统。返回的data需要经过GB2312编码。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Alamofire</span>.request(<span class=\"type\">Method</span>.<span class=\"type\">POST</span>, <span class=\"type\">SchoolNetWorkBaseURL</span></span><br><span class=\"line\">, parameters:[<span class=\"string\">\"username\"</span>:<span class=\"string\">\"*****\"</span>,<span class=\"string\">\"password\"</span>:<span class=\"string\">\"*****\"</span>]</span><br><span class=\"line\">, encoding: <span class=\"type\">ParameterEncoding</span>.<span class=\"type\">URL</span></span><br><span class=\"line\">, headers: [<span class=\"string\">\"Content-Type\"</span>:<span class=\"string\">\"application/x-www-form-urlencoded\"</span>,<span class=\"string\">\"Referer\"</span>:<span class=\"type\">SchoolNetWorkBaseURL</span>]).response &#123;</span><br><span class=\"line\">                request, response, data, error <span class=\"keyword\">in</span> </span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 业务处理</span></span><br><span class=\"line\">                <span class=\"keyword\">let</span> <span class=\"type\">GB2312Encoding</span> = <span class=\"type\">CFStringConvertEncodingToNSStringEncoding</span>(<span class=\"number\">0x0632</span>)</span><br><span class=\"line\">                <span class=\"keyword\">let</span> selfHTMLString:<span class=\"type\">String</span> = <span class=\"type\">NSString</span>(data: data!, encoding: <span class=\"type\">GB2312Encoding</span>)! <span class=\"keyword\">as</span> <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<p>弄到这里感觉还比较轻松，但是最坑爹的是，这个网站的请求参数必须是经过GB2312的URLEncode。而Alamofire只能将参数进行utf-8编码。我开始时以为将请求参数用GB2312编码后传入即可，或者利用GB2312编码的URLEncode后再传入。但是都相当于Alamofire在最外层还是用UTF-8又URLEncode了一遍。</p>\n<p>这是Alamofire的源码，这里可以由<code>charst=utf-8</code>看出它默认将数据进行utf-8编码。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> method = <span class=\"type\">Method</span>(rawValue: mutableURLRequest.<span class=\"type\">HTTPMethod</span>) <span class=\"keyword\">where</span> encodesParametersInURL(method) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span></span><br><span class=\"line\">        <span class=\"type\">URLComponents</span> = <span class=\"type\">NSURLComponents</span>(<span class=\"type\">URL</span>: mutableURLRequest.<span class=\"type\">URL!</span>, resolvingAgainstBaseURL: <span class=\"literal\">false</span>)</span><br><span class=\"line\">        <span class=\"keyword\">where</span> !parameters.isEmpty</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> percentEncodedQuery = (<span class=\"type\">URLComponents</span>.percentEncodedQuery.<span class=\"built_in\">map</span> &#123; $<span class=\"number\">0</span> + <span class=\"string\">\"&amp;\"</span> &#125; ?? <span class=\"string\">\"\"</span>) + query(parameters)</span><br><span class=\"line\">        <span class=\"type\">URLComponents</span>.percentEncodedQuery = percentEncodedQuery</span><br><span class=\"line\">        mutableURLRequest.<span class=\"type\">URL</span> = <span class=\"type\">URLComponents</span>.<span class=\"type\">URL</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> mutableURLRequest.valueForHTTPHeaderField(<span class=\"string\">\"Content-Type\"</span>) == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        mutableURLRequest.setValue(</span><br><span class=\"line\">            <span class=\"string\">\"application/x-www-form-urlencoded; charset=utf-8\"</span>,</span><br><span class=\"line\">            forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    mutableURLRequest.<span class=\"type\">HTTPBody</span> = query(parameters).dataUsingEncoding(</span><br><span class=\"line\">        <span class=\"type\">NSUTF8StringEncoding</span>,</span><br><span class=\"line\">        allowLossyConversion: <span class=\"literal\">false</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里参考学长给的建议，将request先自己编码后再进行传输。首先封装了自定义编码request方法。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">urlRequestWithComponents</span><span class=\"params\">(urlString:String,parameters:[String: AnyObject])</span></span> -&gt; (<span class=\"type\">URLRequestConvertible</span>,<span class=\"type\">NSData</span>) &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// create  url request to send</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mutableURLRequest = <span class=\"type\">NSMutableURLRequest</span>(<span class=\"type\">URL</span>: <span class=\"type\">NSURL</span>(string: urlString)!)</span><br><span class=\"line\">    mutableURLRequest.<span class=\"type\">HTTPMethod</span> = <span class=\"type\">Alamofire</span>.<span class=\"type\">Method</span>.<span class=\"type\">POST</span>.rawValue</span><br><span class=\"line\">    <span class=\"keyword\">let</span> contentType = <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">    mutableURLRequest.setValue(contentType, forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span>)</span><br><span class=\"line\">    mutableURLRequest.setValue(<span class=\"string\">\"http://nic.ahnu.edu.cn/cgi-bin/service\"</span>, forHTTPHeaderField: <span class=\"string\">\"Referer\"</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// add parameters</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> uploadData = <span class=\"type\">NSMutableData</span>()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (key,value) <span class=\"keyword\">in</span> parameters &#123;</span><br><span class=\"line\">        uploadData.appendData(<span class=\"string\">\"\\(key)=\\(value)&amp;\"</span>.dataUsingEncoding(<span class=\"type\">GB2312Encoding</span>)!)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"type\">Alamofire</span>.<span class=\"type\">ParameterEncoding</span>.<span class=\"type\">URL</span>.encode(mutableURLRequest, parameters: <span class=\"literal\">nil</span>).<span class=\"number\">0</span>,uploadData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> urlRequest = urlRequestWithComponents(<span class=\"type\">SchoolNetWorkBaseURL</span></span><br><span class=\"line\">, parameters:[<span class=\"string\">\"username\"</span>:<span class=\"string\">\"****\"</span>,<span class=\"string\">\"credential\"</span>:<span class=\"keyword\">self</span>.credential,<span class=\"string\">\"logtbl\"</span>:<span class=\"string\">\"int201607\"</span>,<span class=\"string\">\"echo\"</span>:<span class=\"string\">\"查询\"</span>,<span class=\"string\">\"func\"</span>:<span class=\"string\">\"计费网关\"</span>])</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"type\">Alamofire</span>.upload(urlRequest.<span class=\"number\">0</span>, data: urlRequest.<span class=\"number\">1</span>).response &#123;</span><br><span class=\"line\">    request, response, data, error <span class=\"keyword\">in</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> htmlString:<span class=\"type\">String</span> = <span class=\"type\">NSString</span>(data: data!, encoding: <span class=\"type\">GB2312Encoding</span>)! <span class=\"keyword\">as</span> <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(htmlString)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>过完年在学校度过大学的最后一学期，期间加深学习了Python的Django和iOS开发。在学习的过程中，就想着临走前做一个校园应用。由于我们的需要的信息分散在学校各个部门的系统中，此时就需要通过模拟登陆来获取我们想要的信息。一开始是用python来模拟登陆解析数据的，后期由于我对架构设计的改变（主要是服务器资源和流量没钱买😂），我把很多解析放在手机端（暂时为iOS端）来处理，所以就应运而出本篇博文。</p>\n<h1 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h1><p>要模拟浏览器登陆，首先得分析浏览器登陆的步骤，再用代码来实现。在分析浏览器登陆之前先介绍一下使用到的工具。</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><h3 id=\"Charles\"><a href=\"#Charles\" class=\"headerlink\" title=\"Charles\"></a>Charles</h3><p>这是一款常用的网络封包截取工具，在做开发时，我们为了调试与服务器端的网络通讯协议，常常需要截取网络封包来分析。Mac和PC都可以使用。今天好像发布了新版了。这个还可以作为iPhone的http代理，来抓包手机的网络包。关于此软件的使用详情，可以阅读<a 11 14 2015 href http: blog.devtang.com charles-introduction \"\">唐巧老师的博客</a>。</p>\n<h3 id=\"Postman\"><a href=\"#Postman\" class=\"headerlink\" title=\"Postman\"></a>Postman</h3><p>这是Mac上Chrome的一个网络调试的工具插件，PC上不知道有没有，可以通过该工具来进行各种http请求。</p>\n<h3 id=\"编码工具\"><a href=\"#编码工具\" class=\"headerlink\" title=\"编码工具\"></a>编码工具</h3><p>这是一个在线的<a href=\"http://tool.chinaz.com/tools/urlencode.aspx\" target=\"_blank\" rel=\"noopener\">站长工具</a>，可以进行各类编码间的转换，最常用的应该就是utf-8的UrlDecode和UrlEncode。这个工具还非常贴心的提供了gb2312格式的UrlDecode和UrlEncode。</p>\n<h3 id=\"Alamofire（iOS网络库）\"><a href=\"#Alamofire（iOS网络库）\" class=\"headerlink\" title=\"Alamofire（iOS网络库）\"></a>Alamofire（iOS网络库）</h3><ol>\n<li>Alamofire 的前身是 AFNetworking。AFNetworking 是 iOS 和 OS X 上很受欢迎的第三方HTTP网络基础库。</li>\n<li>其实 AFNetwork 的前缀 AF 便是 Alamofire 的缩写。</li>\n<li>Swift发布后，AFNetworking的作者又用Swift语言写了个相同功能的库，这便是 Alamofire。</li>\n<li>Alamofire 本质是基于<code>NSURLSession</code>，并做了封装。使用 Alamofire 可以让我们网络请求相关代码（如获取数据，提交数据，上传文件，下载文件等）更加简洁易用。</li>\n</ol>\n<p><strong>关于Cookie:</strong><br>Alamofire是基于NSURLRequest封装的，所以Cookie会自动保存，就和浏览器请求是一个效果。而且网站Set_cookie多久，本地的Cookie就多久，每次请求的时候都会自动带上cookie，直到过期。（所以像登陆session这些的都不用我们手动去处理）。</p>\n<h2 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h2><p>POST请求和GET请求应该就不用解释了，这里提醒一下编码格式，现在大部分服务器都是utf-8编码格式的，但不排除少量用的GB2312。所以在发现服务器响应数据乱码时要检查返回数据的编码格式。</p>\n<h2 id=\"几个例子\"><a href=\"#几个例子\" class=\"headerlink\" title=\"几个例子\"></a>几个例子</h2><h3 id=\"登陆1\"><a href=\"#登陆1\" class=\"headerlink\" title=\"登陆1\"></a>登陆1</h3><p>做校园APP想到的第一个功能就是查成绩查课表，于是第一个就是拿教务系统动刀。</p>\n<p>通过Charles发现，使用网页登陆教务系统的时候，其实是跳转到一个check页验证账号密码，再跳转回教务系统首页。该网页返回的就是JSON数据，所以用的<code>responseJSON</code>。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Alamofire</span>.request(<span class=\"type\">Method</span>.<span class=\"type\">POST</span>, <span class=\"type\">SchoolBaseURL</span>+<span class=\"string\">\"login/check.shtml\"</span></span><br><span class=\"line\">, parameters:[<span class=\"string\">\"user\"</span>:<span class=\"string\">\"*****\"</span>,<span class=\"string\">\"pass\"</span>:<span class=\"string\">\"*****\"</span>,<span class=\"string\">\"usertype\"</span>:<span class=\"string\">\"stu\"</span>]</span><br><span class=\"line\">, encoding: <span class=\"type\">ParameterEncoding</span>.<span class=\"type\">URL</span></span><br><span class=\"line\">, headers: <span class=\"literal\">nil</span>).responseJSON &#123;</span><br><span class=\"line\">                response <span class=\"keyword\">in</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">guard</span> response.result.isSuccess  <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">self</span>.callback?.managerApiCallBackFailed(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">                <span class=\"type\">Hud</span>.showError(<span class=\"string\">\"网络错误了\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 登陆成功</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"登陆2\"><a href=\"#登陆2\" class=\"headerlink\" title=\"登陆2\"></a>登陆2</h3><p>想到的第二个功能就是查询校园网流量使用情况，于是瞄上了信息管理中心的校园网系统。</p>\n<p>这里请求时必须带上Content-Type和Referer。否则就会跳到登录页。这个系统就是我讲的GB2312编码的坑货系统。返回的data需要经过GB2312编码。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Alamofire</span>.request(<span class=\"type\">Method</span>.<span class=\"type\">POST</span>, <span class=\"type\">SchoolNetWorkBaseURL</span></span><br><span class=\"line\">, parameters:[<span class=\"string\">\"username\"</span>:<span class=\"string\">\"*****\"</span>,<span class=\"string\">\"password\"</span>:<span class=\"string\">\"*****\"</span>]</span><br><span class=\"line\">, encoding: <span class=\"type\">ParameterEncoding</span>.<span class=\"type\">URL</span></span><br><span class=\"line\">, headers: [<span class=\"string\">\"Content-Type\"</span>:<span class=\"string\">\"application/x-www-form-urlencoded\"</span>,<span class=\"string\">\"Referer\"</span>:<span class=\"type\">SchoolNetWorkBaseURL</span>]).response &#123;</span><br><span class=\"line\">                request, response, data, error <span class=\"keyword\">in</span> </span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// 业务处理</span></span><br><span class=\"line\">                <span class=\"keyword\">let</span> <span class=\"type\">GB2312Encoding</span> = <span class=\"type\">CFStringConvertEncodingToNSStringEncoding</span>(<span class=\"number\">0x0632</span>)</span><br><span class=\"line\">                <span class=\"keyword\">let</span> selfHTMLString:<span class=\"type\">String</span> = <span class=\"type\">NSString</span>(data: data!, encoding: <span class=\"type\">GB2312Encoding</span>)! <span class=\"keyword\">as</span> <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<p>弄到这里感觉还比较轻松，但是最坑爹的是，这个网站的请求参数必须是经过GB2312的URLEncode。而Alamofire只能将参数进行utf-8编码。我开始时以为将请求参数用GB2312编码后传入即可，或者利用GB2312编码的URLEncode后再传入。但是都相当于Alamofire在最外层还是用UTF-8又URLEncode了一遍。</p>\n<p>这是Alamofire的源码，这里可以由<code>charst=utf-8</code>看出它默认将数据进行utf-8编码。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> method = <span class=\"type\">Method</span>(rawValue: mutableURLRequest.<span class=\"type\">HTTPMethod</span>) <span class=\"keyword\">where</span> encodesParametersInURL(method) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span></span><br><span class=\"line\">        <span class=\"type\">URLComponents</span> = <span class=\"type\">NSURLComponents</span>(<span class=\"type\">URL</span>: mutableURLRequest.<span class=\"type\">URL!</span>, resolvingAgainstBaseURL: <span class=\"literal\">false</span>)</span><br><span class=\"line\">        <span class=\"keyword\">where</span> !parameters.isEmpty</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> percentEncodedQuery = (<span class=\"type\">URLComponents</span>.percentEncodedQuery.<span class=\"built_in\">map</span> &#123; $<span class=\"number\">0</span> + <span class=\"string\">\"&amp;\"</span> &#125; ?? <span class=\"string\">\"\"</span>) + query(parameters)</span><br><span class=\"line\">        <span class=\"type\">URLComponents</span>.percentEncodedQuery = percentEncodedQuery</span><br><span class=\"line\">        mutableURLRequest.<span class=\"type\">URL</span> = <span class=\"type\">URLComponents</span>.<span class=\"type\">URL</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> mutableURLRequest.valueForHTTPHeaderField(<span class=\"string\">\"Content-Type\"</span>) == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        mutableURLRequest.setValue(</span><br><span class=\"line\">            <span class=\"string\">\"application/x-www-form-urlencoded; charset=utf-8\"</span>,</span><br><span class=\"line\">            forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    mutableURLRequest.<span class=\"type\">HTTPBody</span> = query(parameters).dataUsingEncoding(</span><br><span class=\"line\">        <span class=\"type\">NSUTF8StringEncoding</span>,</span><br><span class=\"line\">        allowLossyConversion: <span class=\"literal\">false</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里参考学长给的建议，将request先自己编码后再进行传输。首先封装了自定义编码request方法。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">urlRequestWithComponents</span><span class=\"params\">(urlString:String,parameters:[String: AnyObject])</span></span> -&gt; (<span class=\"type\">URLRequestConvertible</span>,<span class=\"type\">NSData</span>) &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// create  url request to send</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mutableURLRequest = <span class=\"type\">NSMutableURLRequest</span>(<span class=\"type\">URL</span>: <span class=\"type\">NSURL</span>(string: urlString)!)</span><br><span class=\"line\">    mutableURLRequest.<span class=\"type\">HTTPMethod</span> = <span class=\"type\">Alamofire</span>.<span class=\"type\">Method</span>.<span class=\"type\">POST</span>.rawValue</span><br><span class=\"line\">    <span class=\"keyword\">let</span> contentType = <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">    mutableURLRequest.setValue(contentType, forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span>)</span><br><span class=\"line\">    mutableURLRequest.setValue(<span class=\"string\">\"http://nic.ahnu.edu.cn/cgi-bin/service\"</span>, forHTTPHeaderField: <span class=\"string\">\"Referer\"</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// add parameters</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> uploadData = <span class=\"type\">NSMutableData</span>()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (key,value) <span class=\"keyword\">in</span> parameters &#123;</span><br><span class=\"line\">        uploadData.appendData(<span class=\"string\">\"\\(key)=\\(value)&amp;\"</span>.dataUsingEncoding(<span class=\"type\">GB2312Encoding</span>)!)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"type\">Alamofire</span>.<span class=\"type\">ParameterEncoding</span>.<span class=\"type\">URL</span>.encode(mutableURLRequest, parameters: <span class=\"literal\">nil</span>).<span class=\"number\">0</span>,uploadData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> urlRequest = urlRequestWithComponents(<span class=\"type\">SchoolNetWorkBaseURL</span></span><br><span class=\"line\">, parameters:[<span class=\"string\">\"username\"</span>:<span class=\"string\">\"****\"</span>,<span class=\"string\">\"credential\"</span>:<span class=\"keyword\">self</span>.credential,<span class=\"string\">\"logtbl\"</span>:<span class=\"string\">\"int201607\"</span>,<span class=\"string\">\"echo\"</span>:<span class=\"string\">\"查询\"</span>,<span class=\"string\">\"func\"</span>:<span class=\"string\">\"计费网关\"</span>])</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"type\">Alamofire</span>.upload(urlRequest.<span class=\"number\">0</span>, data: urlRequest.<span class=\"number\">1</span>).response &#123;</span><br><span class=\"line\">    request, response, data, error <span class=\"keyword\">in</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> htmlString:<span class=\"type\">String</span> = <span class=\"type\">NSString</span>(data: data!, encoding: <span class=\"type\">GB2312Encoding</span>)! <span class=\"keyword\">as</span> <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(htmlString)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"Swift 使用 Xib 自定义 View 和 Cell","date":"2016-08-09T09:06:52.000Z","_content":"\n# 背景\n\n原来一直使用的是Storyboard自定义`UITableViewCell`的，暑期来公司实习，发现公司用的是Xib自定义View，学长说人多用SB不好协同工作。除了这个原因，我之前还发现Storyboard的复用性不好，自定义的Cell不能在多个Storyboard文件中复用😂。\n\n下面介绍利用Xib自定义View和Cell。\n\n# 自定义Cell\n\n新建Cell文件时，勾选生成Xib文件。然后在Xib上使用控件和约束，和Storyboard一样。\n\n在使用自定义的Cell时，要记得注册可复用的Cell。例如:`collectionView.registerReusableCell(FMPersonHelpReportVCCollectionViewCell)`\n\n剩下的使用过程和用Storyboard自定义的Prototype Cell是一致的。\n\n# 自定义View\n\n新建View的时候，是无法勾选生成Xib文件的，所以需要我们自己创建同名的UIView和Xib文件。并且将 Xib文件的 File's Owner -> Custom Class -> Class 属性设为刚才新建的类。\n\n由于自定义View不能直接从View初始化，所以写了一个基类。\n\n``` swift\nclass BaseXibView: UIView {\n    \n    var view:UIView?\n    \n    //初始化方法。\n    func initFromXib(){\n        //获取Xib文件名字\n        let xibName = NSStringFromClass(self.classForCoder)\n        let xibClassName = xibName.characters.split{$0 == \".\"}.map(String.init).last\n        //使用Xib初始化一个View\n        let view = NSBundle.mainBundle().loadNibNamed(xibClassName, owner: self, options: nil).first as! UIView\n        view.frame = self.bounds\n        view.translatesAutoresizingMaskIntoConstraints = true\n        view.autoresizingMask = [.FlexibleWidth,.FlexibleHeight]\n        self.addSubview(view)\n        self.view = view\n    }\n    \n    override init(frame: CGRect) {\n        super.init(frame: frame)\n        initFromXib()\n    }\n    \n    required init(coder aDecoder: NSCoder) {\n        super.init(coder:aDecoder)!\n        initFromXib()\n    }\n}\n\n```\n\n\n这是我写的一个自定义View，主要用来进行新手引导的，覆盖在原视图上，点击view，慢慢改变透明度。\n``` swift\nclass FMHomeNewUserGuideView: BaseXibView {\n    \n    @IBOutlet var imageView: UIImageView!\n    @IBOutlet var label: UILabel!\n    \n    var isMainView = true\n    \n    override func initFromXib() {\n        super.initFromXib()\n    }\n    \n    override func touchesBegan(touches: Set<UITouch>, withEvent event: UIEvent?) {\n        UIView.animateWithDuration(0.25, animations: { \n            self.alpha = 0\n            }) { (isComplete) in\n                self.removeSubviews()\n        }\n    }\n    \n    func setUI() {\n        \n    }\n} \n```\n\n用法：\n``` swift \nlet homeNewUserGuideView = FMHomeNewUserGuideView()\n```\n\n\n# 参考资料\n\n\n\n\n","source":"_posts/Swift使用Xib自定义View和Cell.md","raw":"---\ntitle: Swift 使用 Xib 自定义 View 和 Cell\ndate: 2016-08-09 17:06:52\ntags: \n- Swift \n- Xib\n- 自定义View\ncategories:\n- 开发\n- iOS\n---\n\n# 背景\n\n原来一直使用的是Storyboard自定义`UITableViewCell`的，暑期来公司实习，发现公司用的是Xib自定义View，学长说人多用SB不好协同工作。除了这个原因，我之前还发现Storyboard的复用性不好，自定义的Cell不能在多个Storyboard文件中复用😂。\n\n下面介绍利用Xib自定义View和Cell。\n\n# 自定义Cell\n\n新建Cell文件时，勾选生成Xib文件。然后在Xib上使用控件和约束，和Storyboard一样。\n\n在使用自定义的Cell时，要记得注册可复用的Cell。例如:`collectionView.registerReusableCell(FMPersonHelpReportVCCollectionViewCell)`\n\n剩下的使用过程和用Storyboard自定义的Prototype Cell是一致的。\n\n# 自定义View\n\n新建View的时候，是无法勾选生成Xib文件的，所以需要我们自己创建同名的UIView和Xib文件。并且将 Xib文件的 File's Owner -> Custom Class -> Class 属性设为刚才新建的类。\n\n由于自定义View不能直接从View初始化，所以写了一个基类。\n\n``` swift\nclass BaseXibView: UIView {\n    \n    var view:UIView?\n    \n    //初始化方法。\n    func initFromXib(){\n        //获取Xib文件名字\n        let xibName = NSStringFromClass(self.classForCoder)\n        let xibClassName = xibName.characters.split{$0 == \".\"}.map(String.init).last\n        //使用Xib初始化一个View\n        let view = NSBundle.mainBundle().loadNibNamed(xibClassName, owner: self, options: nil).first as! UIView\n        view.frame = self.bounds\n        view.translatesAutoresizingMaskIntoConstraints = true\n        view.autoresizingMask = [.FlexibleWidth,.FlexibleHeight]\n        self.addSubview(view)\n        self.view = view\n    }\n    \n    override init(frame: CGRect) {\n        super.init(frame: frame)\n        initFromXib()\n    }\n    \n    required init(coder aDecoder: NSCoder) {\n        super.init(coder:aDecoder)!\n        initFromXib()\n    }\n}\n\n```\n\n\n这是我写的一个自定义View，主要用来进行新手引导的，覆盖在原视图上，点击view，慢慢改变透明度。\n``` swift\nclass FMHomeNewUserGuideView: BaseXibView {\n    \n    @IBOutlet var imageView: UIImageView!\n    @IBOutlet var label: UILabel!\n    \n    var isMainView = true\n    \n    override func initFromXib() {\n        super.initFromXib()\n    }\n    \n    override func touchesBegan(touches: Set<UITouch>, withEvent event: UIEvent?) {\n        UIView.animateWithDuration(0.25, animations: { \n            self.alpha = 0\n            }) { (isComplete) in\n                self.removeSubviews()\n        }\n    }\n    \n    func setUI() {\n        \n    }\n} \n```\n\n用法：\n``` swift \nlet homeNewUserGuideView = FMHomeNewUserGuideView()\n```\n\n\n# 参考资料\n\n\n\n\n","slug":"Swift使用Xib自定义View和Cell","published":1,"updated":"2019-06-16T15:37:13.550Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkb70006wq1k8xfwqj86","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>原来一直使用的是Storyboard自定义<code>UITableViewCell</code>的，暑期来公司实习，发现公司用的是Xib自定义View，学长说人多用SB不好协同工作。除了这个原因，我之前还发现Storyboard的复用性不好，自定义的Cell不能在多个Storyboard文件中复用😂。</p>\n<p>下面介绍利用Xib自定义View和Cell。</p>\n<h1 id=\"自定义Cell\"><a href=\"#自定义Cell\" class=\"headerlink\" title=\"自定义Cell\"></a>自定义Cell</h1><p>新建Cell文件时，勾选生成Xib文件。然后在Xib上使用控件和约束，和Storyboard一样。</p>\n<p>在使用自定义的Cell时，要记得注册可复用的Cell。例如:<code>collectionView.registerReusableCell(FMPersonHelpReportVCCollectionViewCell)</code></p>\n<p>剩下的使用过程和用Storyboard自定义的Prototype Cell是一致的。</p>\n<h1 id=\"自定义View\"><a href=\"#自定义View\" class=\"headerlink\" title=\"自定义View\"></a>自定义View</h1><p>新建View的时候，是无法勾选生成Xib文件的，所以需要我们自己创建同名的UIView和Xib文件。并且将 Xib文件的 File’s Owner -&gt; Custom Class -&gt; Class 属性设为刚才新建的类。</p>\n<p>由于自定义View不能直接从View初始化，所以写了一个基类。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseXibView</span>: <span class=\"title\">UIView</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> view:<span class=\"type\">UIView?</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//初始化方法。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">initFromXib</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//获取Xib文件名字</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> xibName = <span class=\"type\">NSStringFromClass</span>(<span class=\"keyword\">self</span>.classForCoder)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> xibClassName = xibName.characters.<span class=\"built_in\">split</span>&#123;$<span class=\"number\">0</span> == <span class=\"string\">\".\"</span>&#125;.<span class=\"built_in\">map</span>(<span class=\"type\">String</span>.<span class=\"keyword\">init</span>).last</span><br><span class=\"line\">        <span class=\"comment\">//使用Xib初始化一个View</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> view = <span class=\"type\">NSBundle</span>.mainBundle().loadNibNamed(xibClassName, owner: <span class=\"keyword\">self</span>, options: <span class=\"literal\">nil</span>).first <span class=\"keyword\">as</span>! <span class=\"type\">UIView</span></span><br><span class=\"line\">        view.frame = <span class=\"keyword\">self</span>.bounds</span><br><span class=\"line\">        view.translatesAutoresizingMaskIntoConstraints = <span class=\"literal\">true</span></span><br><span class=\"line\">        view.autoresizingMask = [.<span class=\"type\">FlexibleWidth</span>,.<span class=\"type\">FlexibleHeight</span>]</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.addSubview(view)</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.view = view</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">init</span>(frame: <span class=\"type\">CGRect</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.<span class=\"keyword\">init</span>(frame: frame)</span><br><span class=\"line\">        initFromXib()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">required</span> <span class=\"keyword\">init</span>(coder aDecoder: <span class=\"type\">NSCoder</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.<span class=\"keyword\">init</span>(coder:aDecoder)!</span><br><span class=\"line\">        initFromXib()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这是我写的一个自定义View，主要用来进行新手引导的，覆盖在原视图上，点击view，慢慢改变透明度。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FMHomeNewUserGuideView</span>: <span class=\"title\">BaseXibView</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@IBOutlet</span> <span class=\"keyword\">var</span> imageView: <span class=\"type\">UIImageView!</span></span><br><span class=\"line\">    <span class=\"meta\">@IBOutlet</span> <span class=\"keyword\">var</span> label: <span class=\"type\">UILabel!</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMainView = <span class=\"literal\">true</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">initFromXib</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.initFromXib()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"type\">UIView</span>.animateWithDuration(<span class=\"number\">0.25</span>, animations: &#123; </span><br><span class=\"line\">            <span class=\"keyword\">self</span>.alpha = <span class=\"number\">0</span></span><br><span class=\"line\">            &#125;) &#123; (isComplete) <span class=\"keyword\">in</span></span><br><span class=\"line\">                <span class=\"keyword\">self</span>.removeSubviews()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">setUI</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>用法：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> homeNewUserGuideView = <span class=\"type\">FMHomeNewUserGuideView</span>()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>原来一直使用的是Storyboard自定义<code>UITableViewCell</code>的，暑期来公司实习，发现公司用的是Xib自定义View，学长说人多用SB不好协同工作。除了这个原因，我之前还发现Storyboard的复用性不好，自定义的Cell不能在多个Storyboard文件中复用😂。</p>\n<p>下面介绍利用Xib自定义View和Cell。</p>\n<h1 id=\"自定义Cell\"><a href=\"#自定义Cell\" class=\"headerlink\" title=\"自定义Cell\"></a>自定义Cell</h1><p>新建Cell文件时，勾选生成Xib文件。然后在Xib上使用控件和约束，和Storyboard一样。</p>\n<p>在使用自定义的Cell时，要记得注册可复用的Cell。例如:<code>collectionView.registerReusableCell(FMPersonHelpReportVCCollectionViewCell)</code></p>\n<p>剩下的使用过程和用Storyboard自定义的Prototype Cell是一致的。</p>\n<h1 id=\"自定义View\"><a href=\"#自定义View\" class=\"headerlink\" title=\"自定义View\"></a>自定义View</h1><p>新建View的时候，是无法勾选生成Xib文件的，所以需要我们自己创建同名的UIView和Xib文件。并且将 Xib文件的 File’s Owner -&gt; Custom Class -&gt; Class 属性设为刚才新建的类。</p>\n<p>由于自定义View不能直接从View初始化，所以写了一个基类。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseXibView</span>: <span class=\"title\">UIView</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> view:<span class=\"type\">UIView?</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//初始化方法。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">initFromXib</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//获取Xib文件名字</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> xibName = <span class=\"type\">NSStringFromClass</span>(<span class=\"keyword\">self</span>.classForCoder)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> xibClassName = xibName.characters.<span class=\"built_in\">split</span>&#123;$<span class=\"number\">0</span> == <span class=\"string\">\".\"</span>&#125;.<span class=\"built_in\">map</span>(<span class=\"type\">String</span>.<span class=\"keyword\">init</span>).last</span><br><span class=\"line\">        <span class=\"comment\">//使用Xib初始化一个View</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> view = <span class=\"type\">NSBundle</span>.mainBundle().loadNibNamed(xibClassName, owner: <span class=\"keyword\">self</span>, options: <span class=\"literal\">nil</span>).first <span class=\"keyword\">as</span>! <span class=\"type\">UIView</span></span><br><span class=\"line\">        view.frame = <span class=\"keyword\">self</span>.bounds</span><br><span class=\"line\">        view.translatesAutoresizingMaskIntoConstraints = <span class=\"literal\">true</span></span><br><span class=\"line\">        view.autoresizingMask = [.<span class=\"type\">FlexibleWidth</span>,.<span class=\"type\">FlexibleHeight</span>]</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.addSubview(view)</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.view = view</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"keyword\">init</span>(frame: <span class=\"type\">CGRect</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.<span class=\"keyword\">init</span>(frame: frame)</span><br><span class=\"line\">        initFromXib()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">required</span> <span class=\"keyword\">init</span>(coder aDecoder: <span class=\"type\">NSCoder</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.<span class=\"keyword\">init</span>(coder:aDecoder)!</span><br><span class=\"line\">        initFromXib()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这是我写的一个自定义View，主要用来进行新手引导的，覆盖在原视图上，点击view，慢慢改变透明度。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FMHomeNewUserGuideView</span>: <span class=\"title\">BaseXibView</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@IBOutlet</span> <span class=\"keyword\">var</span> imageView: <span class=\"type\">UIImageView!</span></span><br><span class=\"line\">    <span class=\"meta\">@IBOutlet</span> <span class=\"keyword\">var</span> label: <span class=\"type\">UILabel!</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> isMainView = <span class=\"literal\">true</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">initFromXib</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.initFromXib()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"type\">UIView</span>.animateWithDuration(<span class=\"number\">0.25</span>, animations: &#123; </span><br><span class=\"line\">            <span class=\"keyword\">self</span>.alpha = <span class=\"number\">0</span></span><br><span class=\"line\">            &#125;) &#123; (isComplete) <span class=\"keyword\">in</span></span><br><span class=\"line\">                <span class=\"keyword\">self</span>.removeSubviews()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">setUI</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>用法：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> homeNewUserGuideView = <span class=\"type\">FMHomeNewUserGuideView</span>()</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h1>"},{"title":"iOS:webApp客户端开发小记","date":"2015-11-05T09:00:15.000Z","_content":"\n>这篇文章，现在是我写的第二遍，因为就在我刚才准备commit的时候，手贱点了sync，结果白写了一个小时。\n\n## 前言\n暑期以来我一直在一家物联网公司实习，刚来的时候开发了一款物联网云服务的iOS客户端，也许你会问为啥一个实习生刚来就开发产品，主要原因是我能力超强，还有一个很小的原因是全公司就我用Mac，并且会点点Swift，哈哈。\n\n刚来是开发一款物联网应用的iOS客户端（[1.0版本](https://itunes.apple.com/us/app/iotcloud/id1045360550?l=zh&ls=1&mt=8)现在已上线），后期开发了一段时间这个产品的后台，主要是MongoDB和Java Web。之后，我又被叫去开发另一款云教育应用的iOS客户端和Android客户端。这篇文章主要介绍的是开发这两款iOS应用的总结，后期会总结一下在Android上实现同样功能的经验。\n\n我们公司的产品都是前端是采用HTML5的，这样每个平台的客户端只要套个UIWebView的壳子就好。但是问题不是全部网页都是从服务器端加载的，因为不能保证网络一直畅通，以及服务器没有错，要是网络不通，那整个应用就是一片空白，这样的体验太差了。\n\n所以我们的想法是欢迎页、登陆页都是本地的资源，这样应用打开，不管服务器啥情况，用户都是可以看见东西的。\n\n***\n\n## 应用逻辑\n\n1. 打开应用，首先加载welcome.htm(原本是jsp文件，在Android平台上可以加载，但是Safari不行，所以直接改了后缀)，welcome.htm的js会从sqlite中取出用户名和密码，若不为空，则直接表单提交登录；如为空，则跳转到本地login.htm界面进行登录\n\n2. 用户在login.htm进行登录，若登录成功，则其中的js文件会将用户名、密码存入sqlite中\n\n3. 应用中有二维码扫描功能，若点击该按钮，则跳转回本地，使用相机进行二维码扫描，然后将结果又返回给网页应用\n\n4. 应用中有退出功能，若点击该按钮，则跳转回本地login.htm界面，其中的js会清空sqlite中数据\n\n***\n\n## 遇到的问题以及解决方法\n\n1. Xcode7导入本地资源\n之前用的是Xcode6，项目下面有一个Supporting Files文件夹，将本地资源导入后都在此文件夹中，升级到Xcode7后，没有这个文件夹了，可以直接将本地资源直接导入项目中。\n\n2. iOS9网络连接问题\n刚开始用Xcode6开发第一项目的时候，UIWebView联网是没有问题的，第二个项目使用的是Xcode7和iOS9，就连打开baidu都无法实现，控制台会报错:\n当时在Stack Overflow找到原因了:\n\n\t```swift\n\tApplication Transport Security has blocked a cleartext HTTP (http://) resource load since it is insecure. Temporary exceptions can be configured via your app's Info.plist file.\n\t```\n\n\t**在iOS9 beta1中，苹果将原http协议改成了https协议，使用 TLS1.2 SSL加密请求数据。**\n解决方法就是：在info.plist中添加\n\n\t```swift\n\t<key>NSAppTransportSecurity</key>\n\t<dict><key>NSAllowsArbitraryLoads</key><true/></dict>\n\t```\n\t后来在[《微信在适配iOS9上遇到的问题和解决方案》](http://www.infoq.com/cn/articles/wechat-ios9-adaptation)也看到了该问题的解决方法。\n\n3. UIWebView加载本地资源\n\n\t我做的项目中，主要是UIWebView加载本地的网页，代码如下：\n\t\n\t```swift\n\tlet path = NSBundle.mainBundle().pathForResource(\"index\", ofType: \"htm\")\n\tlet urlobj = NSURL.fileURLWithPath(path!)\n\tlet request = NSURLRequest(URL: urlobj)\n\tmyWebView.loadRequest(request)\n\t```\n\n4. 从网页跳转回本地\n\n\t前面说到项目的两个功能：一是网页调用本地二维码；二是在网页里退出，本地能清除登录数据。\n\n\t我的解决思路是：web应用中，需要跳转本地的功能，都把链接写成固定格式的\n\n\t```html\n\t<a href=\"m://erweima.com/\" class=\"link_btn link_btn_t\">二维码扫描</a>\n\t```\n\tUIWebView中有一个方法，可以在链接地址改变时触发，我就是利用该方法，判断UIWebView即将要跳转的链接地址，如果是事先确定的，则执行本地相关操作，如上所述的二维码操作：\n\n    ```swift\nfunc webView(webView: UIWebView,shouldStartLoadWithRequest request: NSURLRequest,navigationType: UIWebViewNavigationType) -> Bool {\n    let rurl = request.URL\n    if(rurl!.scheme == \"m\" && rurl!.host == \"erweima.com\") { \n    //启动二维码扫描\n    tiaozhuan()\n    }\n    //返回true就会跳转新地址\n}\n```\n\n5. 二维码扫描功能\n\n\t这里用到一个用Swift2和AVFoundation写的二维码扫描的类[github](https://github.com/Recursion0210/QRCode)，类里用的是UIStoryBoard进行跳转的，我稍微改动了一下，用方法调用的：\n\n    ```swift\nfunc tiaozhuan() {\n    let scannerVC:ScannerViewController = ScannerViewController()\n    scannerVC.delegate = self\n    self.presentViewController(scannerVC, animated: false, completion: nil)\n}\n```\n\n    ViewController继承了`ScannerViewControllerDelegate`协议，实现了：\n    \n    ```swift\nfunc barcodeObtained(viewController:ScannerViewController, data: String) {\n    //打印二维码扫描的结果\n    print(data)\n}\n```\n\n***\n项目本来已经做完了，经理又加了一些功能，因此又来补充了。\n\n今天周三，是光棍节，周一做的是Android和iOS的判断网络状态的功能，周二和今天上午做的是Android的即时通讯和实时音视频功能，今天下午做的是iOS的即时通讯功能，由于SDK用的是OC，而我用的是Swift，所以到现在也没搞出来啥，还好项目不急，所以来更新一下博客。\n\n2015-11-11 17:55\n\n***\n\n6. 判断网络状态\n\n   ##### 问题：\n\n   是这样的，由于产品登陆完之后，全部内容都在UIWebView中，要是网络突然断了，就会显示无法连接界面，这样用户体验不好，如果后面能联网了，又不能返回到断网之前的界面。\n\n   ##### 需求：\n\n   在尽量不改后台的情况下，解决上面的问题\n\n   ##### 解决思路：\n\n   在每次需要跳转之前，先判断一下网络状态，若是可以联网则不处理；若不能联网，则存储当前链接，并跳转到本地一个不能联网的界面，该界面上有刷新按钮，通过不断点击刷新按钮来重复跳转该界面，然后可以判断网络情况，若可以联网了，则加载之前存储的链接。\n\n   上面的逻辑代码就不贴了，没有参考意义，反正就是在上面第四点的webView方法中进行处理。这里我放一个判断网络状态的项目地址[Reachability.swift-github](https://github.com/ashleymills/Reachability.swift)\n\n7. 即时通讯\n\n   ##### 问题：\n\n   由于我们的项目是做教育类的，需要用户之间可以进行类似于微信那样的通信功能，并且可以进行实时音、视频通话功能。\n\n   ##### 需求：\n\n   实现上述功能，还要尽可能的保证服务质量\n\n   ##### 解决思路：\n\n   我想到的方法是集成第三方的服务，目前用的是[容联云服务](http://www.yuntongxun.com/)。还没做完，未完待续。  \n\n\n","source":"_posts/iOS-webApp客户端开发小记.md","raw":"---\ntitle: iOS:webApp客户端开发小记\ndate: 2015-11-05 17:00:15\ntags:\n- iOS\n- Swift\n- UIWebView\n- 二维码扫描\ncategories:\n- 开发\n- iOS\n---\n\n>这篇文章，现在是我写的第二遍，因为就在我刚才准备commit的时候，手贱点了sync，结果白写了一个小时。\n\n## 前言\n暑期以来我一直在一家物联网公司实习，刚来的时候开发了一款物联网云服务的iOS客户端，也许你会问为啥一个实习生刚来就开发产品，主要原因是我能力超强，还有一个很小的原因是全公司就我用Mac，并且会点点Swift，哈哈。\n\n刚来是开发一款物联网应用的iOS客户端（[1.0版本](https://itunes.apple.com/us/app/iotcloud/id1045360550?l=zh&ls=1&mt=8)现在已上线），后期开发了一段时间这个产品的后台，主要是MongoDB和Java Web。之后，我又被叫去开发另一款云教育应用的iOS客户端和Android客户端。这篇文章主要介绍的是开发这两款iOS应用的总结，后期会总结一下在Android上实现同样功能的经验。\n\n我们公司的产品都是前端是采用HTML5的，这样每个平台的客户端只要套个UIWebView的壳子就好。但是问题不是全部网页都是从服务器端加载的，因为不能保证网络一直畅通，以及服务器没有错，要是网络不通，那整个应用就是一片空白，这样的体验太差了。\n\n所以我们的想法是欢迎页、登陆页都是本地的资源，这样应用打开，不管服务器啥情况，用户都是可以看见东西的。\n\n***\n\n## 应用逻辑\n\n1. 打开应用，首先加载welcome.htm(原本是jsp文件，在Android平台上可以加载，但是Safari不行，所以直接改了后缀)，welcome.htm的js会从sqlite中取出用户名和密码，若不为空，则直接表单提交登录；如为空，则跳转到本地login.htm界面进行登录\n\n2. 用户在login.htm进行登录，若登录成功，则其中的js文件会将用户名、密码存入sqlite中\n\n3. 应用中有二维码扫描功能，若点击该按钮，则跳转回本地，使用相机进行二维码扫描，然后将结果又返回给网页应用\n\n4. 应用中有退出功能，若点击该按钮，则跳转回本地login.htm界面，其中的js会清空sqlite中数据\n\n***\n\n## 遇到的问题以及解决方法\n\n1. Xcode7导入本地资源\n之前用的是Xcode6，项目下面有一个Supporting Files文件夹，将本地资源导入后都在此文件夹中，升级到Xcode7后，没有这个文件夹了，可以直接将本地资源直接导入项目中。\n\n2. iOS9网络连接问题\n刚开始用Xcode6开发第一项目的时候，UIWebView联网是没有问题的，第二个项目使用的是Xcode7和iOS9，就连打开baidu都无法实现，控制台会报错:\n当时在Stack Overflow找到原因了:\n\n\t```swift\n\tApplication Transport Security has blocked a cleartext HTTP (http://) resource load since it is insecure. Temporary exceptions can be configured via your app's Info.plist file.\n\t```\n\n\t**在iOS9 beta1中，苹果将原http协议改成了https协议，使用 TLS1.2 SSL加密请求数据。**\n解决方法就是：在info.plist中添加\n\n\t```swift\n\t<key>NSAppTransportSecurity</key>\n\t<dict><key>NSAllowsArbitraryLoads</key><true/></dict>\n\t```\n\t后来在[《微信在适配iOS9上遇到的问题和解决方案》](http://www.infoq.com/cn/articles/wechat-ios9-adaptation)也看到了该问题的解决方法。\n\n3. UIWebView加载本地资源\n\n\t我做的项目中，主要是UIWebView加载本地的网页，代码如下：\n\t\n\t```swift\n\tlet path = NSBundle.mainBundle().pathForResource(\"index\", ofType: \"htm\")\n\tlet urlobj = NSURL.fileURLWithPath(path!)\n\tlet request = NSURLRequest(URL: urlobj)\n\tmyWebView.loadRequest(request)\n\t```\n\n4. 从网页跳转回本地\n\n\t前面说到项目的两个功能：一是网页调用本地二维码；二是在网页里退出，本地能清除登录数据。\n\n\t我的解决思路是：web应用中，需要跳转本地的功能，都把链接写成固定格式的\n\n\t```html\n\t<a href=\"m://erweima.com/\" class=\"link_btn link_btn_t\">二维码扫描</a>\n\t```\n\tUIWebView中有一个方法，可以在链接地址改变时触发，我就是利用该方法，判断UIWebView即将要跳转的链接地址，如果是事先确定的，则执行本地相关操作，如上所述的二维码操作：\n\n    ```swift\nfunc webView(webView: UIWebView,shouldStartLoadWithRequest request: NSURLRequest,navigationType: UIWebViewNavigationType) -> Bool {\n    let rurl = request.URL\n    if(rurl!.scheme == \"m\" && rurl!.host == \"erweima.com\") { \n    //启动二维码扫描\n    tiaozhuan()\n    }\n    //返回true就会跳转新地址\n}\n```\n\n5. 二维码扫描功能\n\n\t这里用到一个用Swift2和AVFoundation写的二维码扫描的类[github](https://github.com/Recursion0210/QRCode)，类里用的是UIStoryBoard进行跳转的，我稍微改动了一下，用方法调用的：\n\n    ```swift\nfunc tiaozhuan() {\n    let scannerVC:ScannerViewController = ScannerViewController()\n    scannerVC.delegate = self\n    self.presentViewController(scannerVC, animated: false, completion: nil)\n}\n```\n\n    ViewController继承了`ScannerViewControllerDelegate`协议，实现了：\n    \n    ```swift\nfunc barcodeObtained(viewController:ScannerViewController, data: String) {\n    //打印二维码扫描的结果\n    print(data)\n}\n```\n\n***\n项目本来已经做完了，经理又加了一些功能，因此又来补充了。\n\n今天周三，是光棍节，周一做的是Android和iOS的判断网络状态的功能，周二和今天上午做的是Android的即时通讯和实时音视频功能，今天下午做的是iOS的即时通讯功能，由于SDK用的是OC，而我用的是Swift，所以到现在也没搞出来啥，还好项目不急，所以来更新一下博客。\n\n2015-11-11 17:55\n\n***\n\n6. 判断网络状态\n\n   ##### 问题：\n\n   是这样的，由于产品登陆完之后，全部内容都在UIWebView中，要是网络突然断了，就会显示无法连接界面，这样用户体验不好，如果后面能联网了，又不能返回到断网之前的界面。\n\n   ##### 需求：\n\n   在尽量不改后台的情况下，解决上面的问题\n\n   ##### 解决思路：\n\n   在每次需要跳转之前，先判断一下网络状态，若是可以联网则不处理；若不能联网，则存储当前链接，并跳转到本地一个不能联网的界面，该界面上有刷新按钮，通过不断点击刷新按钮来重复跳转该界面，然后可以判断网络情况，若可以联网了，则加载之前存储的链接。\n\n   上面的逻辑代码就不贴了，没有参考意义，反正就是在上面第四点的webView方法中进行处理。这里我放一个判断网络状态的项目地址[Reachability.swift-github](https://github.com/ashleymills/Reachability.swift)\n\n7. 即时通讯\n\n   ##### 问题：\n\n   由于我们的项目是做教育类的，需要用户之间可以进行类似于微信那样的通信功能，并且可以进行实时音、视频通话功能。\n\n   ##### 需求：\n\n   实现上述功能，还要尽可能的保证服务质量\n\n   ##### 解决思路：\n\n   我想到的方法是集成第三方的服务，目前用的是[容联云服务](http://www.yuntongxun.com/)。还没做完，未完待续。  \n\n\n","slug":"iOS-webApp客户端开发小记","published":1,"updated":"2019-06-16T15:37:13.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkb90009wq1kinubrl2g","content":"<blockquote>\n<p>这篇文章，现在是我写的第二遍，因为就在我刚才准备commit的时候，手贱点了sync，结果白写了一个小时。</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>暑期以来我一直在一家物联网公司实习，刚来的时候开发了一款物联网云服务的iOS客户端，也许你会问为啥一个实习生刚来就开发产品，主要原因是我能力超强，还有一个很小的原因是全公司就我用Mac，并且会点点Swift，哈哈。</p>\n<p>刚来是开发一款物联网应用的iOS客户端（<a href=\"https://itunes.apple.com/us/app/iotcloud/id1045360550?l=zh&ls=1&mt=8\" target=\"_blank\" rel=\"noopener\">1.0版本</a>现在已上线），后期开发了一段时间这个产品的后台，主要是MongoDB和Java Web。之后，我又被叫去开发另一款云教育应用的iOS客户端和Android客户端。这篇文章主要介绍的是开发这两款iOS应用的总结，后期会总结一下在Android上实现同样功能的经验。</p>\n<p>我们公司的产品都是前端是采用HTML5的，这样每个平台的客户端只要套个UIWebView的壳子就好。但是问题不是全部网页都是从服务器端加载的，因为不能保证网络一直畅通，以及服务器没有错，要是网络不通，那整个应用就是一片空白，这样的体验太差了。</p>\n<p>所以我们的想法是欢迎页、登陆页都是本地的资源，这样应用打开，不管服务器啥情况，用户都是可以看见东西的。</p>\n<hr>\n<h2 id=\"应用逻辑\"><a href=\"#应用逻辑\" class=\"headerlink\" title=\"应用逻辑\"></a>应用逻辑</h2><ol>\n<li><p>打开应用，首先加载welcome.htm(原本是jsp文件，在Android平台上可以加载，但是Safari不行，所以直接改了后缀)，welcome.htm的js会从sqlite中取出用户名和密码，若不为空，则直接表单提交登录；如为空，则跳转到本地login.htm界面进行登录</p>\n</li>\n<li><p>用户在login.htm进行登录，若登录成功，则其中的js文件会将用户名、密码存入sqlite中</p>\n</li>\n<li><p>应用中有二维码扫描功能，若点击该按钮，则跳转回本地，使用相机进行二维码扫描，然后将结果又返回给网页应用</p>\n</li>\n<li><p>应用中有退出功能，若点击该按钮，则跳转回本地login.htm界面，其中的js会清空sqlite中数据</p>\n</li>\n</ol>\n<hr>\n<h2 id=\"遇到的问题以及解决方法\"><a href=\"#遇到的问题以及解决方法\" class=\"headerlink\" title=\"遇到的问题以及解决方法\"></a>遇到的问题以及解决方法</h2><ol>\n<li><p>Xcode7导入本地资源<br>之前用的是Xcode6，项目下面有一个Supporting Files文件夹，将本地资源导入后都在此文件夹中，升级到Xcode7后，没有这个文件夹了，可以直接将本地资源直接导入项目中。</p>\n</li>\n<li><p>iOS9网络连接问题<br>刚开始用Xcode6开发第一项目的时候，UIWebView联网是没有问题的，第二个项目使用的是Xcode7和iOS9，就连打开baidu都无法实现，控制台会报错:<br>当时在Stack Overflow找到原因了:</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Application</span> <span class=\"type\">Transport</span> <span class=\"type\">Security</span> has blocked a cleartext <span class=\"type\">HTTP</span> (http:<span class=\"comment\">//) resource load since it is insecure. Temporary exceptions can be configured via your app's Info.plist file.</span></span><br></pre></td></tr></table></figure>\n\n<p> <strong>在iOS9 beta1中，苹果将原http协议改成了https协议，使用 TLS1.2 SSL加密请求数据。</strong><br>解决方法就是：在info.plist中添加</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;key&gt;<span class=\"type\">NSAppTransportSecurity</span>&lt;/key&gt;</span><br><span class=\"line\">&lt;dict&gt;&lt;key&gt;<span class=\"type\">NSAllowsArbitraryLoads</span>&lt;/key&gt;&lt;<span class=\"literal\">true</span>/&gt;&lt;/dict&gt;</span><br></pre></td></tr></table></figure>\n\n<p> 后来在<a href=\"http://www.infoq.com/cn/articles/wechat-ios9-adaptation\" target=\"_blank\" rel=\"noopener\">《微信在适配iOS9上遇到的问题和解决方案》</a>也看到了该问题的解决方法。</p>\n</li>\n<li><p>UIWebView加载本地资源</p>\n<p> 我做的项目中，主要是UIWebView加载本地的网页，代码如下：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> path = <span class=\"type\">NSBundle</span>.mainBundle().pathForResource(<span class=\"string\">\"index\"</span>, ofType: <span class=\"string\">\"htm\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> urlobj = <span class=\"type\">NSURL</span>.fileURLWithPath(path!)</span><br><span class=\"line\"><span class=\"keyword\">let</span> request = <span class=\"type\">NSURLRequest</span>(<span class=\"type\">URL</span>: urlobj)</span><br><span class=\"line\">myWebView.loadRequest(request)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>从网页跳转回本地</p>\n<p> 前面说到项目的两个功能：一是网页调用本地二维码；二是在网页里退出，本地能清除登录数据。</p>\n<p> 我的解决思路是：web应用中，需要跳转本地的功能，都把链接写成固定格式的</p>\n <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"m://erweima.com/\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"link_btn link_btn_t\"</span>&gt;</span>二维码扫描<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p> UIWebView中有一个方法，可以在链接地址改变时触发，我就是利用该方法，判断UIWebView即将要跳转的链接地址，如果是事先确定的，则执行本地相关操作，如上所述的二维码操作：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">webView</span><span class=\"params\">(webView: UIWebView,shouldStartLoadWithRequest request: NSURLRequest,navigationType: UIWebViewNavigationType)</span></span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rurl = request.<span class=\"type\">URL</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(rurl!.scheme == <span class=\"string\">\"m\"</span> &amp;&amp; rurl!.host == <span class=\"string\">\"erweima.com\"</span>) &#123; </span><br><span class=\"line\">    <span class=\"comment\">//启动二维码扫描</span></span><br><span class=\"line\">    tiaozhuan()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//返回true就会跳转新地址</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>二维码扫描功能</p>\n<p> 这里用到一个用Swift2和AVFoundation写的二维码扫描的类<a href=\"https://github.com/Recursion0210/QRCode\" target=\"_blank\" rel=\"noopener\">github</a>，类里用的是UIStoryBoard进行跳转的，我稍微改动了一下，用方法调用的：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tiaozhuan</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> scannerVC:<span class=\"type\">ScannerViewController</span> = <span class=\"type\">ScannerViewController</span>()</span><br><span class=\"line\">    scannerVC.delegate = <span class=\"keyword\">self</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.presentViewController(scannerVC, animated: <span class=\"literal\">false</span>, completion: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> ViewController继承了<code>ScannerViewControllerDelegate</code>协议，实现了：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">barcodeObtained</span><span class=\"params\">(viewController:ScannerViewController, data: String)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//打印二维码扫描的结果</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(data)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<hr>\n<p>项目本来已经做完了，经理又加了一些功能，因此又来补充了。</p>\n<p>今天周三，是光棍节，周一做的是Android和iOS的判断网络状态的功能，周二和今天上午做的是Android的即时通讯和实时音视频功能，今天下午做的是iOS的即时通讯功能，由于SDK用的是OC，而我用的是Swift，所以到现在也没搞出来啥，还好项目不急，所以来更新一下博客。</p>\n<p>2015-11-11 17:55</p>\n<hr>\n<ol start=\"6\">\n<li><p>判断网络状态</p>\n<h5 id=\"问题：\"><a href=\"#问题：\" class=\"headerlink\" title=\"问题：\"></a>问题：</h5><p>是这样的，由于产品登陆完之后，全部内容都在UIWebView中，要是网络突然断了，就会显示无法连接界面，这样用户体验不好，如果后面能联网了，又不能返回到断网之前的界面。</p>\n<h5 id=\"需求：\"><a href=\"#需求：\" class=\"headerlink\" title=\"需求：\"></a>需求：</h5><p>在尽量不改后台的情况下，解决上面的问题</p>\n<h5 id=\"解决思路：\"><a href=\"#解决思路：\" class=\"headerlink\" title=\"解决思路：\"></a>解决思路：</h5><p>在每次需要跳转之前，先判断一下网络状态，若是可以联网则不处理；若不能联网，则存储当前链接，并跳转到本地一个不能联网的界面，该界面上有刷新按钮，通过不断点击刷新按钮来重复跳转该界面，然后可以判断网络情况，若可以联网了，则加载之前存储的链接。</p>\n<p>上面的逻辑代码就不贴了，没有参考意义，反正就是在上面第四点的webView方法中进行处理。这里我放一个判断网络状态的项目地址<a href=\"https://github.com/ashleymills/Reachability.swift\" target=\"_blank\" rel=\"noopener\">Reachability.swift-github</a></p>\n</li>\n<li><p>即时通讯</p>\n<h5 id=\"问题：-1\"><a href=\"#问题：-1\" class=\"headerlink\" title=\"问题：\"></a>问题：</h5><p>由于我们的项目是做教育类的，需要用户之间可以进行类似于微信那样的通信功能，并且可以进行实时音、视频通话功能。</p>\n<h5 id=\"需求：-1\"><a href=\"#需求：-1\" class=\"headerlink\" title=\"需求：\"></a>需求：</h5><p>实现上述功能，还要尽可能的保证服务质量</p>\n<h5 id=\"解决思路：-1\"><a href=\"#解决思路：-1\" class=\"headerlink\" title=\"解决思路：\"></a>解决思路：</h5><p>我想到的方法是集成第三方的服务，目前用的是<a href=\"http://www.yuntongxun.com/\" target=\"_blank\" rel=\"noopener\">容联云服务</a>。还没做完，未完待续。  </p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>这篇文章，现在是我写的第二遍，因为就在我刚才准备commit的时候，手贱点了sync，结果白写了一个小时。</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>暑期以来我一直在一家物联网公司实习，刚来的时候开发了一款物联网云服务的iOS客户端，也许你会问为啥一个实习生刚来就开发产品，主要原因是我能力超强，还有一个很小的原因是全公司就我用Mac，并且会点点Swift，哈哈。</p>\n<p>刚来是开发一款物联网应用的iOS客户端（<a href=\"https://itunes.apple.com/us/app/iotcloud/id1045360550?l=zh&ls=1&mt=8\" target=\"_blank\" rel=\"noopener\">1.0版本</a>现在已上线），后期开发了一段时间这个产品的后台，主要是MongoDB和Java Web。之后，我又被叫去开发另一款云教育应用的iOS客户端和Android客户端。这篇文章主要介绍的是开发这两款iOS应用的总结，后期会总结一下在Android上实现同样功能的经验。</p>\n<p>我们公司的产品都是前端是采用HTML5的，这样每个平台的客户端只要套个UIWebView的壳子就好。但是问题不是全部网页都是从服务器端加载的，因为不能保证网络一直畅通，以及服务器没有错，要是网络不通，那整个应用就是一片空白，这样的体验太差了。</p>\n<p>所以我们的想法是欢迎页、登陆页都是本地的资源，这样应用打开，不管服务器啥情况，用户都是可以看见东西的。</p>\n<hr>\n<h2 id=\"应用逻辑\"><a href=\"#应用逻辑\" class=\"headerlink\" title=\"应用逻辑\"></a>应用逻辑</h2><ol>\n<li><p>打开应用，首先加载welcome.htm(原本是jsp文件，在Android平台上可以加载，但是Safari不行，所以直接改了后缀)，welcome.htm的js会从sqlite中取出用户名和密码，若不为空，则直接表单提交登录；如为空，则跳转到本地login.htm界面进行登录</p>\n</li>\n<li><p>用户在login.htm进行登录，若登录成功，则其中的js文件会将用户名、密码存入sqlite中</p>\n</li>\n<li><p>应用中有二维码扫描功能，若点击该按钮，则跳转回本地，使用相机进行二维码扫描，然后将结果又返回给网页应用</p>\n</li>\n<li><p>应用中有退出功能，若点击该按钮，则跳转回本地login.htm界面，其中的js会清空sqlite中数据</p>\n</li>\n</ol>\n<hr>\n<h2 id=\"遇到的问题以及解决方法\"><a href=\"#遇到的问题以及解决方法\" class=\"headerlink\" title=\"遇到的问题以及解决方法\"></a>遇到的问题以及解决方法</h2><ol>\n<li><p>Xcode7导入本地资源<br>之前用的是Xcode6，项目下面有一个Supporting Files文件夹，将本地资源导入后都在此文件夹中，升级到Xcode7后，没有这个文件夹了，可以直接将本地资源直接导入项目中。</p>\n</li>\n<li><p>iOS9网络连接问题<br>刚开始用Xcode6开发第一项目的时候，UIWebView联网是没有问题的，第二个项目使用的是Xcode7和iOS9，就连打开baidu都无法实现，控制台会报错:<br>当时在Stack Overflow找到原因了:</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Application</span> <span class=\"type\">Transport</span> <span class=\"type\">Security</span> has blocked a cleartext <span class=\"type\">HTTP</span> (http:<span class=\"comment\">//) resource load since it is insecure. Temporary exceptions can be configured via your app's Info.plist file.</span></span><br></pre></td></tr></table></figure>\n\n<p> <strong>在iOS9 beta1中，苹果将原http协议改成了https协议，使用 TLS1.2 SSL加密请求数据。</strong><br>解决方法就是：在info.plist中添加</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;key&gt;<span class=\"type\">NSAppTransportSecurity</span>&lt;/key&gt;</span><br><span class=\"line\">&lt;dict&gt;&lt;key&gt;<span class=\"type\">NSAllowsArbitraryLoads</span>&lt;/key&gt;&lt;<span class=\"literal\">true</span>/&gt;&lt;/dict&gt;</span><br></pre></td></tr></table></figure>\n\n<p> 后来在<a href=\"http://www.infoq.com/cn/articles/wechat-ios9-adaptation\" target=\"_blank\" rel=\"noopener\">《微信在适配iOS9上遇到的问题和解决方案》</a>也看到了该问题的解决方法。</p>\n</li>\n<li><p>UIWebView加载本地资源</p>\n<p> 我做的项目中，主要是UIWebView加载本地的网页，代码如下：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> path = <span class=\"type\">NSBundle</span>.mainBundle().pathForResource(<span class=\"string\">\"index\"</span>, ofType: <span class=\"string\">\"htm\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> urlobj = <span class=\"type\">NSURL</span>.fileURLWithPath(path!)</span><br><span class=\"line\"><span class=\"keyword\">let</span> request = <span class=\"type\">NSURLRequest</span>(<span class=\"type\">URL</span>: urlobj)</span><br><span class=\"line\">myWebView.loadRequest(request)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>从网页跳转回本地</p>\n<p> 前面说到项目的两个功能：一是网页调用本地二维码；二是在网页里退出，本地能清除登录数据。</p>\n<p> 我的解决思路是：web应用中，需要跳转本地的功能，都把链接写成固定格式的</p>\n <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"m://erweima.com/\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"link_btn link_btn_t\"</span>&gt;</span>二维码扫描<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p> UIWebView中有一个方法，可以在链接地址改变时触发，我就是利用该方法，判断UIWebView即将要跳转的链接地址，如果是事先确定的，则执行本地相关操作，如上所述的二维码操作：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">webView</span><span class=\"params\">(webView: UIWebView,shouldStartLoadWithRequest request: NSURLRequest,navigationType: UIWebViewNavigationType)</span></span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rurl = request.<span class=\"type\">URL</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(rurl!.scheme == <span class=\"string\">\"m\"</span> &amp;&amp; rurl!.host == <span class=\"string\">\"erweima.com\"</span>) &#123; </span><br><span class=\"line\">    <span class=\"comment\">//启动二维码扫描</span></span><br><span class=\"line\">    tiaozhuan()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//返回true就会跳转新地址</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>二维码扫描功能</p>\n<p> 这里用到一个用Swift2和AVFoundation写的二维码扫描的类<a href=\"https://github.com/Recursion0210/QRCode\" target=\"_blank\" rel=\"noopener\">github</a>，类里用的是UIStoryBoard进行跳转的，我稍微改动了一下，用方法调用的：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tiaozhuan</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> scannerVC:<span class=\"type\">ScannerViewController</span> = <span class=\"type\">ScannerViewController</span>()</span><br><span class=\"line\">    scannerVC.delegate = <span class=\"keyword\">self</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.presentViewController(scannerVC, animated: <span class=\"literal\">false</span>, completion: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> ViewController继承了<code>ScannerViewControllerDelegate</code>协议，实现了：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">barcodeObtained</span><span class=\"params\">(viewController:ScannerViewController, data: String)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//打印二维码扫描的结果</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(data)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<hr>\n<p>项目本来已经做完了，经理又加了一些功能，因此又来补充了。</p>\n<p>今天周三，是光棍节，周一做的是Android和iOS的判断网络状态的功能，周二和今天上午做的是Android的即时通讯和实时音视频功能，今天下午做的是iOS的即时通讯功能，由于SDK用的是OC，而我用的是Swift，所以到现在也没搞出来啥，还好项目不急，所以来更新一下博客。</p>\n<p>2015-11-11 17:55</p>\n<hr>\n<ol start=\"6\">\n<li><p>判断网络状态</p>\n<h5 id=\"问题：\"><a href=\"#问题：\" class=\"headerlink\" title=\"问题：\"></a>问题：</h5><p>是这样的，由于产品登陆完之后，全部内容都在UIWebView中，要是网络突然断了，就会显示无法连接界面，这样用户体验不好，如果后面能联网了，又不能返回到断网之前的界面。</p>\n<h5 id=\"需求：\"><a href=\"#需求：\" class=\"headerlink\" title=\"需求：\"></a>需求：</h5><p>在尽量不改后台的情况下，解决上面的问题</p>\n<h5 id=\"解决思路：\"><a href=\"#解决思路：\" class=\"headerlink\" title=\"解决思路：\"></a>解决思路：</h5><p>在每次需要跳转之前，先判断一下网络状态，若是可以联网则不处理；若不能联网，则存储当前链接，并跳转到本地一个不能联网的界面，该界面上有刷新按钮，通过不断点击刷新按钮来重复跳转该界面，然后可以判断网络情况，若可以联网了，则加载之前存储的链接。</p>\n<p>上面的逻辑代码就不贴了，没有参考意义，反正就是在上面第四点的webView方法中进行处理。这里我放一个判断网络状态的项目地址<a href=\"https://github.com/ashleymills/Reachability.swift\" target=\"_blank\" rel=\"noopener\">Reachability.swift-github</a></p>\n</li>\n<li><p>即时通讯</p>\n<h5 id=\"问题：-1\"><a href=\"#问题：-1\" class=\"headerlink\" title=\"问题：\"></a>问题：</h5><p>由于我们的项目是做教育类的，需要用户之间可以进行类似于微信那样的通信功能，并且可以进行实时音、视频通话功能。</p>\n<h5 id=\"需求：-1\"><a href=\"#需求：-1\" class=\"headerlink\" title=\"需求：\"></a>需求：</h5><p>实现上述功能，还要尽可能的保证服务质量</p>\n<h5 id=\"解决思路：-1\"><a href=\"#解决思路：-1\" class=\"headerlink\" title=\"解决思路：\"></a>解决思路：</h5><p>我想到的方法是集成第三方的服务，目前用的是<a href=\"http://www.yuntongxun.com/\" target=\"_blank\" rel=\"noopener\">容联云服务</a>。还没做完，未完待续。  </p>\n</li>\n</ol>\n"},{"title":"iOS10 Today Extension 开发小结 ","date":"2016-10-11T09:30:20.000Z","_content":"\n## 背景\n\n9.15号中秋节那天发布了[师大助手App](https://itunes.apple.com/us/app/shi-da-zhu-shou-hui-shi-fan/id1150983683?l=zh&ls=1&mt=8)后，就在想还加点什么功能。后来想到了可以在 Today Widgets 里面加一个今日课程，于是就开始动手做了。先给大家看一下最终效果：\n![最终效果](http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_1)\n一开始开发的时候，还是 Xcode7 和 Swift2 ，等到准备上架审核的时候，Xcode8 正式版发布了，然后就做了 Swift3 迁移和 iOS10 适配。\n\n## 步骤\n\n### Part1 基本搭建 \n\n1. 新建 iOS Project ，这就不用说了哈\n2. 新建一个 Target ，选择 Today-Extension ，Target名字就设置为 TodayWidget\n3. 在 MainInterface.storyboard 画 UI ，然后运行就可以看到效果了，由于我是显示课程，就在里面添加了一个 UITableView ，并且增加了两个 Prototype Cell 用于自定义Cell\n\n\n### Part2 依赖项目引入\n\n1. 在 Podfile 项目中新建一个target，并加入需要引入的项目，代码如下：\n    ``` swift\n    target 'TodayWidget' do\n      pod 'YYModel'\n    end\n    ```\n2. 在 TodayWidget Target 下面新建一个桥接头文件，这里为省去设置的头文件的方法，可以直接新建oc文件，xcode会问你要不要自动添加一个桥接头文件，建好之后删除oc文件即可\n3. 接下来在测试过程中，我们就可以愉快的通过 Cocoapods 使用第三方库了，但是提交代码到AppStore就会报如下的错误了：\n    ![上传报错](http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_2)\n4. 解决targets不能使用Cocoapods的方法是：在TodayWidget -> Build Phases -> New Run Script Phase ，再添加如下代码\n    ``` swift\n    cd \"${CONFIGURATION_BUILD_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}/\"\n    if [[ -d \"Frameworks\" ]]; then\n    rm -fr Frameworks\n    fi\n    ```\n5. 这样就可以顺利提交到AppStore了\n\n### Part3 TodayExtension Target 和 main Target 之间数据共享\n\n在讲如何具体实现数据共享之前，需要先打开两个Target -> Capabilities -> App Groups，只有在同一个Groups内的target才能共同读写数据。\n![设置Group](http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_3.png)\n有两种解决方式：UserDefaults 和 FileManager \n\n#### Solution1  UserDefaults方式\n\nUserDefaults Apple 官方文档：\n> The NSUserDefaults class provides a programmatic interface for interacting with the defaults system. The defaults system allows an application to customize its behavior to match a user’s preferences. For example, you can allow users to determine what units of measurement your application displays or how often documents are automatically saved. Applications record such preferences by assigning values to a set of parameters in a user’s defaults database. The parameters are referred to as defaults since they’re commonly used to determine an application’s default state at startup or the way it acts by default.\n\n在本App中，我需要将当前是第几教学周在 targets 间传递，数据量很小，于是采用了 UserDefaults 方法，代码如下：\n    ``` swift\n    // 写入\n    UserDefaults.init(suiteName: \"group.com.huangshuai.xxx\")?.set(week, forKey: \"currentWeek\")\n    // 读取\n    let currentWeek = UserDefaults.init(suiteName: \"group.com.huangshuai.xxx\")?.object(forKey: \"currentWeek\") as? Int ?? 1\n    ```\n注：这里是 group 间的 UserDefaults 数据共享，而不是平常的单一target下面的 UserDefaults 使用：\n    ``` swift \n    // 写入\n    UserDefaults.standard.set(false, forKey: \"isFirstLaunch\")\n    // 读取\n    let isFirstLaunch = UserDefaults.standard.object(forKey: \"isFirstLaunch\") as? Bool ?? true\n    ```\n\n#### Solution2  FileManager方式\n\nFileManager Apple 官方文档：\n> An FileManager object lets you examine the contents of the file system and make changes to it. The FileManager class provides convenient access to a shared file manager object that is suitable for most types of file-related manipulations. A file manager object is typically your primary mode of interaction with the file system. You use it to locate, create, copy, and move files and directories. You also use it to get information about a file or directory or change some of its attributes.\n\n在本App中，我需要将所有的课表数据在 targets 间传递，数据量较大，于是采用了 FileManager 方法，代码如下：\n\n``` swift\nlet name = \"course.plist\"\nlet groupPath = FileManager.default.containerURL(forSecurityApplicationGroupIdentifier: \"group.com.huangshuai.xxx\")\nlet groupPathString = groupPath!.absoluteString.replacingOccurrences(of:\"file:///private\", with: \"\").replacingOccurrences(of:\"file:///\", with: \"\")\ndestPath = (groupPathString as NSString).appendingPathComponent(name).characters.split{$0 == \".\"}.map(String.init).first!\n// 写入\nlet dic = [:] as NSDictionary\ndic.write(toFile: destPath, atomically: true)\n// 读取\nlet dict = NSDictionary(contentsOfFile: destPath) \n```\n    \n### Part4 适配 iOS10 Widgets 新特性\n\n#### 处理 Widgets 展开/折叠的情况\n在 iOS10 之前，Widgets 的高度可以自定义设置，但是在 iOS10 中，Widgets 的 activeDisplayMode 有两种状态：.expanded 和 .compact。 需要根据当前用户的选择来处理 Widgets 的高度，代码如下：\n\n``` swift \n@available(iOSApplicationExtension 10.0, *)\nfunc widgetActiveDisplayModeDidChange(_ activeDisplayMode: NCWidgetDisplayMode, withMaximumSize maxSize: CGSize) {\n    if activeDisplayMode == .compact {\n        self.preferredContentSize = maxSize\n    } else {\n        self.preferredContentSize = self.tableView.contentSize\n    }\n}\n```\n\n这里有个Bug：就是在 .compact 下无法设置尺寸，不管怎么设置都是 maxsize。还有待解决。\n\n#### 处理 Widgets 在 iOS9 和 iOS10 下的显示 Bug\n在 iOS10 中，Widgets 的背景是白色的，于是字体颜色设置为黑色的，但是在 iOS9 中，背景是黑色的，App 在iOS9中运行就会看不见字。感觉这是iOS10适配的Bug，为了解决这个问题，只能通过判断系统版本来设置字体颜色了，代码如下：\n\n``` swift \nif #available(iOSApplicationExtension 10.0, *) {\n    mainTextColor = UIColor.black\n} else {\n    mainTextColor = UIColor.white\n}\n```\n\n#### Bug:\n在 iOS10 下，Widgets 的 displayBundleName 设置也不起作用了，不管怎么设置只跟 mainTarget 的displayBundleName 一致，还未找到解决方法。\n\n## 番外篇\n\n女票说她们学校课程很多，每天看课表不方便，在国庆节陪她过生日的时候，现场撸了一个App只供她使用，她每次不用解锁直接下拉Widgets就可以看到今日课程，她开心的不得了还发了朋友圈炫耀一番。哈哈，女票是第一生产力☺️\n\n说到这，本文也就结束了，以上提到的Bug，我会在解决之后再来更新代码。\n\n","source":"_posts/iOS10-Today-Extension-开发小结.md","raw":"---\ntitle: 'iOS10 Today Extension 开发小结 '\ndate: 2016-10-11 17:30:20\ntags: \n- Swift \n- Alamofire \n- Today-Extension\ncategories:\n- 开发\n- iOS\n---\n\n## 背景\n\n9.15号中秋节那天发布了[师大助手App](https://itunes.apple.com/us/app/shi-da-zhu-shou-hui-shi-fan/id1150983683?l=zh&ls=1&mt=8)后，就在想还加点什么功能。后来想到了可以在 Today Widgets 里面加一个今日课程，于是就开始动手做了。先给大家看一下最终效果：\n![最终效果](http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_1)\n一开始开发的时候，还是 Xcode7 和 Swift2 ，等到准备上架审核的时候，Xcode8 正式版发布了，然后就做了 Swift3 迁移和 iOS10 适配。\n\n## 步骤\n\n### Part1 基本搭建 \n\n1. 新建 iOS Project ，这就不用说了哈\n2. 新建一个 Target ，选择 Today-Extension ，Target名字就设置为 TodayWidget\n3. 在 MainInterface.storyboard 画 UI ，然后运行就可以看到效果了，由于我是显示课程，就在里面添加了一个 UITableView ，并且增加了两个 Prototype Cell 用于自定义Cell\n\n\n### Part2 依赖项目引入\n\n1. 在 Podfile 项目中新建一个target，并加入需要引入的项目，代码如下：\n    ``` swift\n    target 'TodayWidget' do\n      pod 'YYModel'\n    end\n    ```\n2. 在 TodayWidget Target 下面新建一个桥接头文件，这里为省去设置的头文件的方法，可以直接新建oc文件，xcode会问你要不要自动添加一个桥接头文件，建好之后删除oc文件即可\n3. 接下来在测试过程中，我们就可以愉快的通过 Cocoapods 使用第三方库了，但是提交代码到AppStore就会报如下的错误了：\n    ![上传报错](http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_2)\n4. 解决targets不能使用Cocoapods的方法是：在TodayWidget -> Build Phases -> New Run Script Phase ，再添加如下代码\n    ``` swift\n    cd \"${CONFIGURATION_BUILD_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}/\"\n    if [[ -d \"Frameworks\" ]]; then\n    rm -fr Frameworks\n    fi\n    ```\n5. 这样就可以顺利提交到AppStore了\n\n### Part3 TodayExtension Target 和 main Target 之间数据共享\n\n在讲如何具体实现数据共享之前，需要先打开两个Target -> Capabilities -> App Groups，只有在同一个Groups内的target才能共同读写数据。\n![设置Group](http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_3.png)\n有两种解决方式：UserDefaults 和 FileManager \n\n#### Solution1  UserDefaults方式\n\nUserDefaults Apple 官方文档：\n> The NSUserDefaults class provides a programmatic interface for interacting with the defaults system. The defaults system allows an application to customize its behavior to match a user’s preferences. For example, you can allow users to determine what units of measurement your application displays or how often documents are automatically saved. Applications record such preferences by assigning values to a set of parameters in a user’s defaults database. The parameters are referred to as defaults since they’re commonly used to determine an application’s default state at startup or the way it acts by default.\n\n在本App中，我需要将当前是第几教学周在 targets 间传递，数据量很小，于是采用了 UserDefaults 方法，代码如下：\n    ``` swift\n    // 写入\n    UserDefaults.init(suiteName: \"group.com.huangshuai.xxx\")?.set(week, forKey: \"currentWeek\")\n    // 读取\n    let currentWeek = UserDefaults.init(suiteName: \"group.com.huangshuai.xxx\")?.object(forKey: \"currentWeek\") as? Int ?? 1\n    ```\n注：这里是 group 间的 UserDefaults 数据共享，而不是平常的单一target下面的 UserDefaults 使用：\n    ``` swift \n    // 写入\n    UserDefaults.standard.set(false, forKey: \"isFirstLaunch\")\n    // 读取\n    let isFirstLaunch = UserDefaults.standard.object(forKey: \"isFirstLaunch\") as? Bool ?? true\n    ```\n\n#### Solution2  FileManager方式\n\nFileManager Apple 官方文档：\n> An FileManager object lets you examine the contents of the file system and make changes to it. The FileManager class provides convenient access to a shared file manager object that is suitable for most types of file-related manipulations. A file manager object is typically your primary mode of interaction with the file system. You use it to locate, create, copy, and move files and directories. You also use it to get information about a file or directory or change some of its attributes.\n\n在本App中，我需要将所有的课表数据在 targets 间传递，数据量较大，于是采用了 FileManager 方法，代码如下：\n\n``` swift\nlet name = \"course.plist\"\nlet groupPath = FileManager.default.containerURL(forSecurityApplicationGroupIdentifier: \"group.com.huangshuai.xxx\")\nlet groupPathString = groupPath!.absoluteString.replacingOccurrences(of:\"file:///private\", with: \"\").replacingOccurrences(of:\"file:///\", with: \"\")\ndestPath = (groupPathString as NSString).appendingPathComponent(name).characters.split{$0 == \".\"}.map(String.init).first!\n// 写入\nlet dic = [:] as NSDictionary\ndic.write(toFile: destPath, atomically: true)\n// 读取\nlet dict = NSDictionary(contentsOfFile: destPath) \n```\n    \n### Part4 适配 iOS10 Widgets 新特性\n\n#### 处理 Widgets 展开/折叠的情况\n在 iOS10 之前，Widgets 的高度可以自定义设置，但是在 iOS10 中，Widgets 的 activeDisplayMode 有两种状态：.expanded 和 .compact。 需要根据当前用户的选择来处理 Widgets 的高度，代码如下：\n\n``` swift \n@available(iOSApplicationExtension 10.0, *)\nfunc widgetActiveDisplayModeDidChange(_ activeDisplayMode: NCWidgetDisplayMode, withMaximumSize maxSize: CGSize) {\n    if activeDisplayMode == .compact {\n        self.preferredContentSize = maxSize\n    } else {\n        self.preferredContentSize = self.tableView.contentSize\n    }\n}\n```\n\n这里有个Bug：就是在 .compact 下无法设置尺寸，不管怎么设置都是 maxsize。还有待解决。\n\n#### 处理 Widgets 在 iOS9 和 iOS10 下的显示 Bug\n在 iOS10 中，Widgets 的背景是白色的，于是字体颜色设置为黑色的，但是在 iOS9 中，背景是黑色的，App 在iOS9中运行就会看不见字。感觉这是iOS10适配的Bug，为了解决这个问题，只能通过判断系统版本来设置字体颜色了，代码如下：\n\n``` swift \nif #available(iOSApplicationExtension 10.0, *) {\n    mainTextColor = UIColor.black\n} else {\n    mainTextColor = UIColor.white\n}\n```\n\n#### Bug:\n在 iOS10 下，Widgets 的 displayBundleName 设置也不起作用了，不管怎么设置只跟 mainTarget 的displayBundleName 一致，还未找到解决方法。\n\n## 番外篇\n\n女票说她们学校课程很多，每天看课表不方便，在国庆节陪她过生日的时候，现场撸了一个App只供她使用，她每次不用解锁直接下拉Widgets就可以看到今日课程，她开心的不得了还发了朋友圈炫耀一番。哈哈，女票是第一生产力☺️\n\n说到这，本文也就结束了，以上提到的Bug，我会在解决之后再来更新代码。\n\n","slug":"iOS10-Today-Extension-开发小结","published":1,"updated":"2019-06-16T15:37:13.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkba000awq1kvtctgpaq","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>9.15号中秋节那天发布了<a href=\"https://itunes.apple.com/us/app/shi-da-zhu-shou-hui-shi-fan/id1150983683?l=zh&ls=1&mt=8\" target=\"_blank\" rel=\"noopener\">师大助手App</a>后，就在想还加点什么功能。后来想到了可以在 Today Widgets 里面加一个今日课程，于是就开始动手做了。先给大家看一下最终效果：<br><img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_1\" alt=\"最终效果\"><br>一开始开发的时候，还是 Xcode7 和 Swift2 ，等到准备上架审核的时候，Xcode8 正式版发布了，然后就做了 Swift3 迁移和 iOS10 适配。</p>\n<h2 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h2><h3 id=\"Part1-基本搭建\"><a href=\"#Part1-基本搭建\" class=\"headerlink\" title=\"Part1 基本搭建\"></a>Part1 基本搭建</h3><ol>\n<li>新建 iOS Project ，这就不用说了哈</li>\n<li>新建一个 Target ，选择 Today-Extension ，Target名字就设置为 TodayWidget</li>\n<li>在 MainInterface.storyboard 画 UI ，然后运行就可以看到效果了，由于我是显示课程，就在里面添加了一个 UITableView ，并且增加了两个 Prototype Cell 用于自定义Cell</li>\n</ol>\n<h3 id=\"Part2-依赖项目引入\"><a href=\"#Part2-依赖项目引入\" class=\"headerlink\" title=\"Part2 依赖项目引入\"></a>Part2 依赖项目引入</h3><ol>\n<li><p>在 Podfile 项目中新建一个target，并加入需要引入的项目，代码如下：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target '<span class=\"type\">TodayWidget'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  pod '<span class=\"type\">YYModel'</span></span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在 TodayWidget Target 下面新建一个桥接头文件，这里为省去设置的头文件的方法，可以直接新建oc文件，xcode会问你要不要自动添加一个桥接头文件，建好之后删除oc文件即可</p>\n</li>\n<li><p>接下来在测试过程中，我们就可以愉快的通过 Cocoapods 使用第三方库了，但是提交代码到AppStore就会报如下的错误了：<br> <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_2\" alt=\"上传报错\"></p>\n</li>\n<li><p>解决targets不能使用Cocoapods的方法是：在TodayWidget -&gt; Build Phases -&gt; New Run Script Phase ，再添加如下代码</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd <span class=\"string\">\"$&#123;CONFIGURATION_BUILD_DIR&#125;/$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;/\"</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ -d <span class=\"string\">\"Frameworks\"</span> ]]; then</span><br><span class=\"line\">rm -fr <span class=\"type\">Frameworks</span></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>这样就可以顺利提交到AppStore了</p>\n</li>\n</ol>\n<h3 id=\"Part3-TodayExtension-Target-和-main-Target-之间数据共享\"><a href=\"#Part3-TodayExtension-Target-和-main-Target-之间数据共享\" class=\"headerlink\" title=\"Part3 TodayExtension Target 和 main Target 之间数据共享\"></a>Part3 TodayExtension Target 和 main Target 之间数据共享</h3><p>在讲如何具体实现数据共享之前，需要先打开两个Target -&gt; Capabilities -&gt; App Groups，只有在同一个Groups内的target才能共同读写数据。<br><img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_3.png\" alt=\"设置Group\"><br>有两种解决方式：UserDefaults 和 FileManager </p>\n<h4 id=\"Solution1-UserDefaults方式\"><a href=\"#Solution1-UserDefaults方式\" class=\"headerlink\" title=\"Solution1  UserDefaults方式\"></a>Solution1  UserDefaults方式</h4><p>UserDefaults Apple 官方文档：</p>\n<blockquote>\n<p>The NSUserDefaults class provides a programmatic interface for interacting with the defaults system. The defaults system allows an application to customize its behavior to match a user’s preferences. For example, you can allow users to determine what units of measurement your application displays or how often documents are automatically saved. Applications record such preferences by assigning values to a set of parameters in a user’s defaults database. The parameters are referred to as defaults since they’re commonly used to determine an application’s default state at startup or the way it acts by default.</p>\n</blockquote>\n<p>在本App中，我需要将当前是第几教学周在 targets 间传递，数据量很小，于是采用了 UserDefaults 方法，代码如下：<br>    <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 写入</span></span><br><span class=\"line\"><span class=\"type\">UserDefaults</span>.<span class=\"keyword\">init</span>(suiteName: <span class=\"string\">\"group.com.huangshuai.xxx\"</span>)?.<span class=\"keyword\">set</span>(week, forKey: <span class=\"string\">\"currentWeek\"</span>)</span><br><span class=\"line\"><span class=\"comment\">// 读取</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> currentWeek = <span class=\"type\">UserDefaults</span>.<span class=\"keyword\">init</span>(suiteName: <span class=\"string\">\"group.com.huangshuai.xxx\"</span>)?.object(forKey: <span class=\"string\">\"currentWeek\"</span>) <span class=\"keyword\">as</span>? <span class=\"type\">Int</span> ?? <span class=\"number\">1</span></span><br></pre></td></tr></table></figure></p>\n<p>注：这里是 group 间的 UserDefaults 数据共享，而不是平常的单一target下面的 UserDefaults 使用：<br>    <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 写入</span></span><br><span class=\"line\"><span class=\"type\">UserDefaults</span>.standard.<span class=\"keyword\">set</span>(<span class=\"literal\">false</span>, forKey: <span class=\"string\">\"isFirstLaunch\"</span>)</span><br><span class=\"line\"><span class=\"comment\">// 读取</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isFirstLaunch = <span class=\"type\">UserDefaults</span>.standard.object(forKey: <span class=\"string\">\"isFirstLaunch\"</span>) <span class=\"keyword\">as</span>? <span class=\"type\">Bool</span> ?? <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"Solution2-FileManager方式\"><a href=\"#Solution2-FileManager方式\" class=\"headerlink\" title=\"Solution2  FileManager方式\"></a>Solution2  FileManager方式</h4><p>FileManager Apple 官方文档：</p>\n<blockquote>\n<p>An FileManager object lets you examine the contents of the file system and make changes to it. The FileManager class provides convenient access to a shared file manager object that is suitable for most types of file-related manipulations. A file manager object is typically your primary mode of interaction with the file system. You use it to locate, create, copy, and move files and directories. You also use it to get information about a file or directory or change some of its attributes.</p>\n</blockquote>\n<p>在本App中，我需要将所有的课表数据在 targets 间传递，数据量较大，于是采用了 FileManager 方法，代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> name = <span class=\"string\">\"course.plist\"</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> groupPath = <span class=\"type\">FileManager</span>.<span class=\"keyword\">default</span>.containerURL(forSecurityApplicationGroupIdentifier: <span class=\"string\">\"group.com.huangshuai.xxx\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> groupPathString = groupPath!.absoluteString.replacingOccurrences(of:<span class=\"string\">\"file:///private\"</span>, with: <span class=\"string\">\"\"</span>).replacingOccurrences(of:<span class=\"string\">\"file:///\"</span>, with: <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">destPath = (groupPathString <span class=\"keyword\">as</span> <span class=\"type\">NSString</span>).appendingPathComponent(name).characters.<span class=\"built_in\">split</span>&#123;$<span class=\"number\">0</span> == <span class=\"string\">\".\"</span>&#125;.<span class=\"built_in\">map</span>(<span class=\"type\">String</span>.<span class=\"keyword\">init</span>).first!</span><br><span class=\"line\"><span class=\"comment\">// 写入</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> dic = [:] <span class=\"keyword\">as</span> <span class=\"type\">NSDictionary</span></span><br><span class=\"line\">dic.write(toFile: destPath, atomically: <span class=\"literal\">true</span>)</span><br><span class=\"line\"><span class=\"comment\">// 读取</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> dict = <span class=\"type\">NSDictionary</span>(contentsOfFile: destPath)</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Part4-适配-iOS10-Widgets-新特性\"><a href=\"#Part4-适配-iOS10-Widgets-新特性\" class=\"headerlink\" title=\"Part4 适配 iOS10 Widgets 新特性\"></a>Part4 适配 iOS10 Widgets 新特性</h3><h4 id=\"处理-Widgets-展开-折叠的情况\"><a href=\"#处理-Widgets-展开-折叠的情况\" class=\"headerlink\" title=\"处理 Widgets 展开/折叠的情况\"></a>处理 Widgets 展开/折叠的情况</h4><p>在 iOS10 之前，Widgets 的高度可以自定义设置，但是在 iOS10 中，Widgets 的 activeDisplayMode 有两种状态：.expanded 和 .compact。 需要根据当前用户的选择来处理 Widgets 的高度，代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@available</span>(iOSApplicationExtension <span class=\"number\">10.0</span>, *)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">widgetActiveDisplayModeDidChange</span><span class=\"params\">(<span class=\"number\">_</span> activeDisplayMode: NCWidgetDisplayMode, withMaximumSize maxSize: CGSize)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> activeDisplayMode == .compact &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.preferredContentSize = maxSize</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.preferredContentSize = <span class=\"keyword\">self</span>.tableView.contentSize</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里有个Bug：就是在 .compact 下无法设置尺寸，不管怎么设置都是 maxsize。还有待解决。</p>\n<h4 id=\"处理-Widgets-在-iOS9-和-iOS10-下的显示-Bug\"><a href=\"#处理-Widgets-在-iOS9-和-iOS10-下的显示-Bug\" class=\"headerlink\" title=\"处理 Widgets 在 iOS9 和 iOS10 下的显示 Bug\"></a>处理 Widgets 在 iOS9 和 iOS10 下的显示 Bug</h4><p>在 iOS10 中，Widgets 的背景是白色的，于是字体颜色设置为黑色的，但是在 iOS9 中，背景是黑色的，App 在iOS9中运行就会看不见字。感觉这是iOS10适配的Bug，为了解决这个问题，只能通过判断系统版本来设置字体颜色了，代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> #available(iOSApplicationExtension <span class=\"number\">10.0</span>, *) &#123;</span><br><span class=\"line\">    mainTextColor = <span class=\"type\">UIColor</span>.black</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    mainTextColor = <span class=\"type\">UIColor</span>.white</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Bug\"><a href=\"#Bug\" class=\"headerlink\" title=\"Bug:\"></a>Bug:</h4><p>在 iOS10 下，Widgets 的 displayBundleName 设置也不起作用了，不管怎么设置只跟 mainTarget 的displayBundleName 一致，还未找到解决方法。</p>\n<h2 id=\"番外篇\"><a href=\"#番外篇\" class=\"headerlink\" title=\"番外篇\"></a>番外篇</h2><p>女票说她们学校课程很多，每天看课表不方便，在国庆节陪她过生日的时候，现场撸了一个App只供她使用，她每次不用解锁直接下拉Widgets就可以看到今日课程，她开心的不得了还发了朋友圈炫耀一番。哈哈，女票是第一生产力☺️</p>\n<p>说到这，本文也就结束了，以上提到的Bug，我会在解决之后再来更新代码。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>9.15号中秋节那天发布了<a href=\"https://itunes.apple.com/us/app/shi-da-zhu-shou-hui-shi-fan/id1150983683?l=zh&ls=1&mt=8\" target=\"_blank\" rel=\"noopener\">师大助手App</a>后，就在想还加点什么功能。后来想到了可以在 Today Widgets 里面加一个今日课程，于是就开始动手做了。先给大家看一下最终效果：<br><img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_1\" alt=\"最终效果\"><br>一开始开发的时候，还是 Xcode7 和 Swift2 ，等到准备上架审核的时候，Xcode8 正式版发布了，然后就做了 Swift3 迁移和 iOS10 适配。</p>\n<h2 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h2><h3 id=\"Part1-基本搭建\"><a href=\"#Part1-基本搭建\" class=\"headerlink\" title=\"Part1 基本搭建\"></a>Part1 基本搭建</h3><ol>\n<li>新建 iOS Project ，这就不用说了哈</li>\n<li>新建一个 Target ，选择 Today-Extension ，Target名字就设置为 TodayWidget</li>\n<li>在 MainInterface.storyboard 画 UI ，然后运行就可以看到效果了，由于我是显示课程，就在里面添加了一个 UITableView ，并且增加了两个 Prototype Cell 用于自定义Cell</li>\n</ol>\n<h3 id=\"Part2-依赖项目引入\"><a href=\"#Part2-依赖项目引入\" class=\"headerlink\" title=\"Part2 依赖项目引入\"></a>Part2 依赖项目引入</h3><ol>\n<li><p>在 Podfile 项目中新建一个target，并加入需要引入的项目，代码如下：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target '<span class=\"type\">TodayWidget'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  pod '<span class=\"type\">YYModel'</span></span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在 TodayWidget Target 下面新建一个桥接头文件，这里为省去设置的头文件的方法，可以直接新建oc文件，xcode会问你要不要自动添加一个桥接头文件，建好之后删除oc文件即可</p>\n</li>\n<li><p>接下来在测试过程中，我们就可以愉快的通过 Cocoapods 使用第三方库了，但是提交代码到AppStore就会报如下的错误了：<br> <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_2\" alt=\"上传报错\"></p>\n</li>\n<li><p>解决targets不能使用Cocoapods的方法是：在TodayWidget -&gt; Build Phases -&gt; New Run Script Phase ，再添加如下代码</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd <span class=\"string\">\"$&#123;CONFIGURATION_BUILD_DIR&#125;/$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;/\"</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ -d <span class=\"string\">\"Frameworks\"</span> ]]; then</span><br><span class=\"line\">rm -fr <span class=\"type\">Frameworks</span></span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>这样就可以顺利提交到AppStore了</p>\n</li>\n</ol>\n<h3 id=\"Part3-TodayExtension-Target-和-main-Target-之间数据共享\"><a href=\"#Part3-TodayExtension-Target-和-main-Target-之间数据共享\" class=\"headerlink\" title=\"Part3 TodayExtension Target 和 main Target 之间数据共享\"></a>Part3 TodayExtension Target 和 main Target 之间数据共享</h3><p>在讲如何具体实现数据共享之前，需要先打开两个Target -&gt; Capabilities -&gt; App Groups，只有在同一个Groups内的target才能共同读写数据。<br><img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Widgets_3.png\" alt=\"设置Group\"><br>有两种解决方式：UserDefaults 和 FileManager </p>\n<h4 id=\"Solution1-UserDefaults方式\"><a href=\"#Solution1-UserDefaults方式\" class=\"headerlink\" title=\"Solution1  UserDefaults方式\"></a>Solution1  UserDefaults方式</h4><p>UserDefaults Apple 官方文档：</p>\n<blockquote>\n<p>The NSUserDefaults class provides a programmatic interface for interacting with the defaults system. The defaults system allows an application to customize its behavior to match a user’s preferences. For example, you can allow users to determine what units of measurement your application displays or how often documents are automatically saved. Applications record such preferences by assigning values to a set of parameters in a user’s defaults database. The parameters are referred to as defaults since they’re commonly used to determine an application’s default state at startup or the way it acts by default.</p>\n</blockquote>\n<p>在本App中，我需要将当前是第几教学周在 targets 间传递，数据量很小，于是采用了 UserDefaults 方法，代码如下：<br>    <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 写入</span></span><br><span class=\"line\"><span class=\"type\">UserDefaults</span>.<span class=\"keyword\">init</span>(suiteName: <span class=\"string\">\"group.com.huangshuai.xxx\"</span>)?.<span class=\"keyword\">set</span>(week, forKey: <span class=\"string\">\"currentWeek\"</span>)</span><br><span class=\"line\"><span class=\"comment\">// 读取</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> currentWeek = <span class=\"type\">UserDefaults</span>.<span class=\"keyword\">init</span>(suiteName: <span class=\"string\">\"group.com.huangshuai.xxx\"</span>)?.object(forKey: <span class=\"string\">\"currentWeek\"</span>) <span class=\"keyword\">as</span>? <span class=\"type\">Int</span> ?? <span class=\"number\">1</span></span><br></pre></td></tr></table></figure></p>\n<p>注：这里是 group 间的 UserDefaults 数据共享，而不是平常的单一target下面的 UserDefaults 使用：<br>    <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 写入</span></span><br><span class=\"line\"><span class=\"type\">UserDefaults</span>.standard.<span class=\"keyword\">set</span>(<span class=\"literal\">false</span>, forKey: <span class=\"string\">\"isFirstLaunch\"</span>)</span><br><span class=\"line\"><span class=\"comment\">// 读取</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isFirstLaunch = <span class=\"type\">UserDefaults</span>.standard.object(forKey: <span class=\"string\">\"isFirstLaunch\"</span>) <span class=\"keyword\">as</span>? <span class=\"type\">Bool</span> ?? <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"Solution2-FileManager方式\"><a href=\"#Solution2-FileManager方式\" class=\"headerlink\" title=\"Solution2  FileManager方式\"></a>Solution2  FileManager方式</h4><p>FileManager Apple 官方文档：</p>\n<blockquote>\n<p>An FileManager object lets you examine the contents of the file system and make changes to it. The FileManager class provides convenient access to a shared file manager object that is suitable for most types of file-related manipulations. A file manager object is typically your primary mode of interaction with the file system. You use it to locate, create, copy, and move files and directories. You also use it to get information about a file or directory or change some of its attributes.</p>\n</blockquote>\n<p>在本App中，我需要将所有的课表数据在 targets 间传递，数据量较大，于是采用了 FileManager 方法，代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> name = <span class=\"string\">\"course.plist\"</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> groupPath = <span class=\"type\">FileManager</span>.<span class=\"keyword\">default</span>.containerURL(forSecurityApplicationGroupIdentifier: <span class=\"string\">\"group.com.huangshuai.xxx\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">let</span> groupPathString = groupPath!.absoluteString.replacingOccurrences(of:<span class=\"string\">\"file:///private\"</span>, with: <span class=\"string\">\"\"</span>).replacingOccurrences(of:<span class=\"string\">\"file:///\"</span>, with: <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">destPath = (groupPathString <span class=\"keyword\">as</span> <span class=\"type\">NSString</span>).appendingPathComponent(name).characters.<span class=\"built_in\">split</span>&#123;$<span class=\"number\">0</span> == <span class=\"string\">\".\"</span>&#125;.<span class=\"built_in\">map</span>(<span class=\"type\">String</span>.<span class=\"keyword\">init</span>).first!</span><br><span class=\"line\"><span class=\"comment\">// 写入</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> dic = [:] <span class=\"keyword\">as</span> <span class=\"type\">NSDictionary</span></span><br><span class=\"line\">dic.write(toFile: destPath, atomically: <span class=\"literal\">true</span>)</span><br><span class=\"line\"><span class=\"comment\">// 读取</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> dict = <span class=\"type\">NSDictionary</span>(contentsOfFile: destPath)</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Part4-适配-iOS10-Widgets-新特性\"><a href=\"#Part4-适配-iOS10-Widgets-新特性\" class=\"headerlink\" title=\"Part4 适配 iOS10 Widgets 新特性\"></a>Part4 适配 iOS10 Widgets 新特性</h3><h4 id=\"处理-Widgets-展开-折叠的情况\"><a href=\"#处理-Widgets-展开-折叠的情况\" class=\"headerlink\" title=\"处理 Widgets 展开/折叠的情况\"></a>处理 Widgets 展开/折叠的情况</h4><p>在 iOS10 之前，Widgets 的高度可以自定义设置，但是在 iOS10 中，Widgets 的 activeDisplayMode 有两种状态：.expanded 和 .compact。 需要根据当前用户的选择来处理 Widgets 的高度，代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@available</span>(iOSApplicationExtension <span class=\"number\">10.0</span>, *)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">widgetActiveDisplayModeDidChange</span><span class=\"params\">(<span class=\"number\">_</span> activeDisplayMode: NCWidgetDisplayMode, withMaximumSize maxSize: CGSize)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> activeDisplayMode == .compact &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.preferredContentSize = maxSize</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.preferredContentSize = <span class=\"keyword\">self</span>.tableView.contentSize</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里有个Bug：就是在 .compact 下无法设置尺寸，不管怎么设置都是 maxsize。还有待解决。</p>\n<h4 id=\"处理-Widgets-在-iOS9-和-iOS10-下的显示-Bug\"><a href=\"#处理-Widgets-在-iOS9-和-iOS10-下的显示-Bug\" class=\"headerlink\" title=\"处理 Widgets 在 iOS9 和 iOS10 下的显示 Bug\"></a>处理 Widgets 在 iOS9 和 iOS10 下的显示 Bug</h4><p>在 iOS10 中，Widgets 的背景是白色的，于是字体颜色设置为黑色的，但是在 iOS9 中，背景是黑色的，App 在iOS9中运行就会看不见字。感觉这是iOS10适配的Bug，为了解决这个问题，只能通过判断系统版本来设置字体颜色了，代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> #available(iOSApplicationExtension <span class=\"number\">10.0</span>, *) &#123;</span><br><span class=\"line\">    mainTextColor = <span class=\"type\">UIColor</span>.black</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    mainTextColor = <span class=\"type\">UIColor</span>.white</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Bug\"><a href=\"#Bug\" class=\"headerlink\" title=\"Bug:\"></a>Bug:</h4><p>在 iOS10 下，Widgets 的 displayBundleName 设置也不起作用了，不管怎么设置只跟 mainTarget 的displayBundleName 一致，还未找到解决方法。</p>\n<h2 id=\"番外篇\"><a href=\"#番外篇\" class=\"headerlink\" title=\"番外篇\"></a>番外篇</h2><p>女票说她们学校课程很多，每天看课表不方便，在国庆节陪她过生日的时候，现场撸了一个App只供她使用，她每次不用解锁直接下拉Widgets就可以看到今日课程，她开心的不得了还发了朋友圈炫耀一番。哈哈，女票是第一生产力☺️</p>\n<p>说到这，本文也就结束了，以上提到的Bug，我会在解决之后再来更新代码。</p>\n"},{"title":"Swift3 迁移小结","date":"2016-10-08T14:56:05.000Z","_content":"## 背景\n\n9.15号中秋节那天发布了[师大助手App](https://itunes.apple.com/us/app/shi-da-zhu-shou-hui-shi-fan/id1150983683?l=zh&ls=1&mt=8)，后来有次在 Yosemite OS 下更新到 Xcode8 ，打开后项目一片红，当时只是想修复一下 bug，还没想要迁移到 Swift3，于是默默的 重新装了 Xcode7，又继续愉快的改bug了，然后9月20号提交到商店更新也没问题。21号提示 Sierra 可以更新了，于是手贱更新了一波。然后悲剧就开始了。\n更新完 Sierra 后，我添加了Widgets功能，于是准备上传到商店，然后就是 一直传不上去。试了一下几个方法：\n\n1. Xcode7 打包，Xcode8 上传\n2. Xcode7 打包，在 Sierra 下用 Application Loader 上传\n3. Xcode7 打包，在同学 Yosemite 下用 Application Loader 上传\n\n结果以上都不行，一直卡在验证那里，于是我就一狠心，说用 Xcode8 ，做一下 Swift3 迁移😂，开启了升级打怪之旅\n\n## 步骤\n\n### 自动代码 Convert\n\n在这里，我只 Convert 自己写的代码，事实证明是明智的，因为第三方库自己都做了适配，不需要我们来进行 Convert，这一步做完，自己的代码大致上没什么问题了，主要错误都集中在第三方库的接口调用上\n\n### 第三方库 Update\n\n我有个习惯，就是 update 之前喜欢先去项目主页看一下，看看有没有什么坑。\n\n#### CocoaPods \n\n1. 卸载已有的 CocoaPods (非必须)\n``` swift \n$ which pod\n/usr/local/bin/pod\n$ sudo rm -rf /usr/local/bin/pod\n```\n2. 安装支持 Xcode8 的 CocoaPods\n``` swift\nsudo gem install cocoapods --pre\n```\n更新完 CocoaPods 还有更新本地库，就不说了。\n\n#### Alamofire\n\n去官网看了一下，真是坑爹，Alamofire 4.0 变化好大，接口都按照 Swift3 重新弄了，二话不说，先更新一下。\n``` swift\npod 'Alamofire', '~> 4.0'\n```\n基本的代码更新看[官方文档](https://github.com/Alamofire/Alamofire/blob/master/Documentation/Alamofire%204.0%20Migration%20Guide.md)就差不多了。下面写几个官方文档没有提到的：\n\n##### 配置https证书\n``` swift\nfunc configureAlamofireManager() {\n   let manager = SessionManager.default\n   manager.delegate.sessionDidReceiveChallenge = { session, challenge in\n       var disposition: URLSession.AuthChallengeDisposition = .performDefaultHandling\n       var credential: URLCredential?\n       \n       if challenge.protectionSpace.authenticationMethod == NSURLAuthenticationMethodServerTrust {\n           disposition = URLSession.AuthChallengeDisposition.useCredential\n           credential = URLCredential(trust: challenge.protectionSpace.serverTrust!)\n       } else {\n           if challenge.previousFailureCount > 0 {\n               disposition = .cancelAuthenticationChallenge\n           } else {\n               credential = manager.session.configuration.urlCredentialStorage?.defaultCredential(for: challenge.protectionSpace)\n               \n               if credential != nil {\n                   disposition = .useCredential\n               }\n           }\n       }\n       return (disposition, credential)\n   }\n}\n```\n\n##### 自定义Request请求\n\n``` Swift\nlet urlRequest = urlRequestWithComponents(SchoolNetWorkBaseURL, parameters: parameters)\nAlamofire.upload(urlRequest.1, with: urlRequest.0).response {\n    response in\n        \n    let htmlString:String = NSString(data: response.data!, encoding: GB2312Encoding)! as String\n    print(htmlString)\n}\n\nfileprivate func urlRequestWithComponents(_ urlString:String,parameters:[String: AnyObject]) -> (URLRequestConvertible,Data) {\n        \n   // create  url request to send\n   var mutableURLRequest = URLRequest(url: URL(string: urlString)!)\n   mutableURLRequest.httpMethod = HTTPMethod.post.rawValue\n   let contentType = \"application/x-www-form-urlencoded\"\n   mutableURLRequest.setValue(contentType, forHTTPHeaderField: \"Content-Type\")\n   mutableURLRequest.setValue(\"****\", forHTTPHeaderField: \"Referer\")\n   \n   // add parameters\n   var uploadData = Data()\n   for (key,value) in parameters {\n       uploadData.append(\"\\(key)=\\(value)&\".data(using: String.Encoding(rawValue: GB2312Encoding))!)\n   }\n   \n   return (try! URLEncoding.default.encode(mutableURLRequest, with: nil),uploadData)\n}\n```\n\n#### Eureka\n\nEureka 在新版本中删除了 ImageRow，我之前代码有一处无法调用，后来提了个[issue](https://github.com/xmartlabs/Eureka/issues/688)，问了作者。\n![Issue](http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Swift3_1.png)\n由于在 iOS10 中，app 需要对相册和相机的使用进行权限申明，不然会闪退，未避免其他 app 闪退，就删了 imageRow，作者也给了解决方法，按照他给方法，本地添加 imageRow 就可继续使用了，或者自己实现CustomRow，准备过段时间试一下自定义 CustomRow。\n\n#### Kanna\n\n项目中需要解析 html ，一直用的 Kanna，在 swift3 中，原来的`doc.xpath(\"//table/tr\").count`变成了 `doc.xpath(\"//table/tr\").nodeSet.count`。\n\n\n","source":"_posts/Swift3-迁移小结.md","raw":"---\ntitle: Swift3 迁移小结\ndate: 2016-10-8 22:56:05\ntags: \n- Swift 3.x\n- Alamofire 4.x\n- Kanna 2.x\n- Eureka 2.x\ncategories:\n- 开发\n- iOS\n---\n## 背景\n\n9.15号中秋节那天发布了[师大助手App](https://itunes.apple.com/us/app/shi-da-zhu-shou-hui-shi-fan/id1150983683?l=zh&ls=1&mt=8)，后来有次在 Yosemite OS 下更新到 Xcode8 ，打开后项目一片红，当时只是想修复一下 bug，还没想要迁移到 Swift3，于是默默的 重新装了 Xcode7，又继续愉快的改bug了，然后9月20号提交到商店更新也没问题。21号提示 Sierra 可以更新了，于是手贱更新了一波。然后悲剧就开始了。\n更新完 Sierra 后，我添加了Widgets功能，于是准备上传到商店，然后就是 一直传不上去。试了一下几个方法：\n\n1. Xcode7 打包，Xcode8 上传\n2. Xcode7 打包，在 Sierra 下用 Application Loader 上传\n3. Xcode7 打包，在同学 Yosemite 下用 Application Loader 上传\n\n结果以上都不行，一直卡在验证那里，于是我就一狠心，说用 Xcode8 ，做一下 Swift3 迁移😂，开启了升级打怪之旅\n\n## 步骤\n\n### 自动代码 Convert\n\n在这里，我只 Convert 自己写的代码，事实证明是明智的，因为第三方库自己都做了适配，不需要我们来进行 Convert，这一步做完，自己的代码大致上没什么问题了，主要错误都集中在第三方库的接口调用上\n\n### 第三方库 Update\n\n我有个习惯，就是 update 之前喜欢先去项目主页看一下，看看有没有什么坑。\n\n#### CocoaPods \n\n1. 卸载已有的 CocoaPods (非必须)\n``` swift \n$ which pod\n/usr/local/bin/pod\n$ sudo rm -rf /usr/local/bin/pod\n```\n2. 安装支持 Xcode8 的 CocoaPods\n``` swift\nsudo gem install cocoapods --pre\n```\n更新完 CocoaPods 还有更新本地库，就不说了。\n\n#### Alamofire\n\n去官网看了一下，真是坑爹，Alamofire 4.0 变化好大，接口都按照 Swift3 重新弄了，二话不说，先更新一下。\n``` swift\npod 'Alamofire', '~> 4.0'\n```\n基本的代码更新看[官方文档](https://github.com/Alamofire/Alamofire/blob/master/Documentation/Alamofire%204.0%20Migration%20Guide.md)就差不多了。下面写几个官方文档没有提到的：\n\n##### 配置https证书\n``` swift\nfunc configureAlamofireManager() {\n   let manager = SessionManager.default\n   manager.delegate.sessionDidReceiveChallenge = { session, challenge in\n       var disposition: URLSession.AuthChallengeDisposition = .performDefaultHandling\n       var credential: URLCredential?\n       \n       if challenge.protectionSpace.authenticationMethod == NSURLAuthenticationMethodServerTrust {\n           disposition = URLSession.AuthChallengeDisposition.useCredential\n           credential = URLCredential(trust: challenge.protectionSpace.serverTrust!)\n       } else {\n           if challenge.previousFailureCount > 0 {\n               disposition = .cancelAuthenticationChallenge\n           } else {\n               credential = manager.session.configuration.urlCredentialStorage?.defaultCredential(for: challenge.protectionSpace)\n               \n               if credential != nil {\n                   disposition = .useCredential\n               }\n           }\n       }\n       return (disposition, credential)\n   }\n}\n```\n\n##### 自定义Request请求\n\n``` Swift\nlet urlRequest = urlRequestWithComponents(SchoolNetWorkBaseURL, parameters: parameters)\nAlamofire.upload(urlRequest.1, with: urlRequest.0).response {\n    response in\n        \n    let htmlString:String = NSString(data: response.data!, encoding: GB2312Encoding)! as String\n    print(htmlString)\n}\n\nfileprivate func urlRequestWithComponents(_ urlString:String,parameters:[String: AnyObject]) -> (URLRequestConvertible,Data) {\n        \n   // create  url request to send\n   var mutableURLRequest = URLRequest(url: URL(string: urlString)!)\n   mutableURLRequest.httpMethod = HTTPMethod.post.rawValue\n   let contentType = \"application/x-www-form-urlencoded\"\n   mutableURLRequest.setValue(contentType, forHTTPHeaderField: \"Content-Type\")\n   mutableURLRequest.setValue(\"****\", forHTTPHeaderField: \"Referer\")\n   \n   // add parameters\n   var uploadData = Data()\n   for (key,value) in parameters {\n       uploadData.append(\"\\(key)=\\(value)&\".data(using: String.Encoding(rawValue: GB2312Encoding))!)\n   }\n   \n   return (try! URLEncoding.default.encode(mutableURLRequest, with: nil),uploadData)\n}\n```\n\n#### Eureka\n\nEureka 在新版本中删除了 ImageRow，我之前代码有一处无法调用，后来提了个[issue](https://github.com/xmartlabs/Eureka/issues/688)，问了作者。\n![Issue](http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Swift3_1.png)\n由于在 iOS10 中，app 需要对相册和相机的使用进行权限申明，不然会闪退，未避免其他 app 闪退，就删了 imageRow，作者也给了解决方法，按照他给方法，本地添加 imageRow 就可继续使用了，或者自己实现CustomRow，准备过段时间试一下自定义 CustomRow。\n\n#### Kanna\n\n项目中需要解析 html ，一直用的 Kanna，在 swift3 中，原来的`doc.xpath(\"//table/tr\").count`变成了 `doc.xpath(\"//table/tr\").nodeSet.count`。\n\n\n","slug":"Swift3-迁移小结","published":1,"updated":"2019-06-16T15:37:13.550Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkbc000dwq1k3j5t3lam","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>9.15号中秋节那天发布了<a href=\"https://itunes.apple.com/us/app/shi-da-zhu-shou-hui-shi-fan/id1150983683?l=zh&ls=1&mt=8\" target=\"_blank\" rel=\"noopener\">师大助手App</a>，后来有次在 Yosemite OS 下更新到 Xcode8 ，打开后项目一片红，当时只是想修复一下 bug，还没想要迁移到 Swift3，于是默默的 重新装了 Xcode7，又继续愉快的改bug了，然后9月20号提交到商店更新也没问题。21号提示 Sierra 可以更新了，于是手贱更新了一波。然后悲剧就开始了。<br>更新完 Sierra 后，我添加了Widgets功能，于是准备上传到商店，然后就是 一直传不上去。试了一下几个方法：</p>\n<ol>\n<li>Xcode7 打包，Xcode8 上传</li>\n<li>Xcode7 打包，在 Sierra 下用 Application Loader 上传</li>\n<li>Xcode7 打包，在同学 Yosemite 下用 Application Loader 上传</li>\n</ol>\n<p>结果以上都不行，一直卡在验证那里，于是我就一狠心，说用 Xcode8 ，做一下 Swift3 迁移😂，开启了升级打怪之旅</p>\n<h2 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h2><h3 id=\"自动代码-Convert\"><a href=\"#自动代码-Convert\" class=\"headerlink\" title=\"自动代码 Convert\"></a>自动代码 Convert</h3><p>在这里，我只 Convert 自己写的代码，事实证明是明智的，因为第三方库自己都做了适配，不需要我们来进行 Convert，这一步做完，自己的代码大致上没什么问题了，主要错误都集中在第三方库的接口调用上</p>\n<h3 id=\"第三方库-Update\"><a href=\"#第三方库-Update\" class=\"headerlink\" title=\"第三方库 Update\"></a>第三方库 Update</h3><p>我有个习惯，就是 update 之前喜欢先去项目主页看一下，看看有没有什么坑。</p>\n<h4 id=\"CocoaPods\"><a href=\"#CocoaPods\" class=\"headerlink\" title=\"CocoaPods\"></a>CocoaPods</h4><ol>\n<li><p>卸载已有的 CocoaPods (非必须)</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ which pod</span><br><span class=\"line\">/usr/local/bin/pod</span><br><span class=\"line\">$ sudo rm -rf /usr/local/bin/pod</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安装支持 Xcode8 的 CocoaPods</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gem install cocoapods --pre</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p>更新完 CocoaPods 还有更新本地库，就不说了。</p>\n<h4 id=\"Alamofire\"><a href=\"#Alamofire\" class=\"headerlink\" title=\"Alamofire\"></a>Alamofire</h4><p>去官网看了一下，真是坑爹，Alamofire 4.0 变化好大，接口都按照 Swift3 重新弄了，二话不说，先更新一下。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pod '<span class=\"type\">Alamofire'</span>, '~&gt; <span class=\"number\">4.0</span>'</span><br></pre></td></tr></table></figure>\n\n<p>基本的代码更新看<a href=\"https://github.com/Alamofire/Alamofire/blob/master/Documentation/Alamofire%204.0%20Migration%20Guide.md\" target=\"_blank\" rel=\"noopener\">官方文档</a>就差不多了。下面写几个官方文档没有提到的：</p>\n<h5 id=\"配置https证书\"><a href=\"#配置https证书\" class=\"headerlink\" title=\"配置https证书\"></a>配置https证书</h5><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">configureAlamofireManager</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">let</span> manager = <span class=\"type\">SessionManager</span>.<span class=\"keyword\">default</span></span><br><span class=\"line\">   manager.delegate.sessionDidReceiveChallenge = &#123; session, challenge <span class=\"keyword\">in</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> disposition: <span class=\"type\">URLSession</span>.<span class=\"type\">AuthChallengeDisposition</span> = .performDefaultHandling</span><br><span class=\"line\">       <span class=\"keyword\">var</span> credential: <span class=\"type\">URLCredential?</span></span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"keyword\">if</span> challenge.protectionSpace.authenticationMethod == <span class=\"type\">NSURLAuthenticationMethodServerTrust</span> &#123;</span><br><span class=\"line\">           disposition = <span class=\"type\">URLSession</span>.<span class=\"type\">AuthChallengeDisposition</span>.useCredential</span><br><span class=\"line\">           credential = <span class=\"type\">URLCredential</span>(trust: challenge.protectionSpace.serverTrust!)</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> challenge.previousFailureCount &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">               disposition = .cancelAuthenticationChallenge</span><br><span class=\"line\">           &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">               credential = manager.session.configuration.urlCredentialStorage?.defaultCredential(<span class=\"keyword\">for</span>: challenge.protectionSpace)</span><br><span class=\"line\">               </span><br><span class=\"line\">               <span class=\"keyword\">if</span> credential != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">                   disposition = .useCredential</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> (disposition, credential)</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"自定义Request请求\"><a href=\"#自定义Request请求\" class=\"headerlink\" title=\"自定义Request请求\"></a>自定义Request请求</h5><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> urlRequest = urlRequestWithComponents(<span class=\"type\">SchoolNetWorkBaseURL</span>, parameters: parameters)</span><br><span class=\"line\"><span class=\"type\">Alamofire</span>.upload(urlRequest.<span class=\"number\">1</span>, with: urlRequest.<span class=\"number\">0</span>).response &#123;</span><br><span class=\"line\">    response <span class=\"keyword\">in</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"keyword\">let</span> htmlString:<span class=\"type\">String</span> = <span class=\"type\">NSString</span>(data: response.data!, encoding: <span class=\"type\">GB2312Encoding</span>)! <span class=\"keyword\">as</span> <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(htmlString)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fileprivate</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">urlRequestWithComponents</span><span class=\"params\">(<span class=\"number\">_</span> urlString:String,parameters:[String: AnyObject])</span></span> -&gt; (<span class=\"type\">URLRequestConvertible</span>,<span class=\"type\">Data</span>) &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">   <span class=\"comment\">// create  url request to send</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> mutableURLRequest = <span class=\"type\">URLRequest</span>(url: <span class=\"type\">URL</span>(string: urlString)!)</span><br><span class=\"line\">   mutableURLRequest.httpMethod = <span class=\"type\">HTTPMethod</span>.post.rawValue</span><br><span class=\"line\">   <span class=\"keyword\">let</span> contentType = <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">   mutableURLRequest.setValue(contentType, forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span>)</span><br><span class=\"line\">   mutableURLRequest.setValue(<span class=\"string\">\"****\"</span>, forHTTPHeaderField: <span class=\"string\">\"Referer\"</span>)</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">// add parameters</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> uploadData = <span class=\"type\">Data</span>()</span><br><span class=\"line\">   <span class=\"keyword\">for</span> (key,value) <span class=\"keyword\">in</span> parameters &#123;</span><br><span class=\"line\">       uploadData.append(<span class=\"string\">\"\\(key)=\\(value)&amp;\"</span>.data(using: <span class=\"type\">String</span>.<span class=\"type\">Encoding</span>(rawValue: <span class=\"type\">GB2312Encoding</span>))!)</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"keyword\">return</span> (<span class=\"keyword\">try</span>! <span class=\"type\">URLEncoding</span>.<span class=\"keyword\">default</span>.encode(mutableURLRequest, with: <span class=\"literal\">nil</span>),uploadData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Eureka\"><a href=\"#Eureka\" class=\"headerlink\" title=\"Eureka\"></a>Eureka</h4><p>Eureka 在新版本中删除了 ImageRow，我之前代码有一处无法调用，后来提了个<a href=\"https://github.com/xmartlabs/Eureka/issues/688\" target=\"_blank\" rel=\"noopener\">issue</a>，问了作者。<br><img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Swift3_1.png\" alt=\"Issue\"><br>由于在 iOS10 中，app 需要对相册和相机的使用进行权限申明，不然会闪退，未避免其他 app 闪退，就删了 imageRow，作者也给了解决方法，按照他给方法，本地添加 imageRow 就可继续使用了，或者自己实现CustomRow，准备过段时间试一下自定义 CustomRow。</p>\n<h4 id=\"Kanna\"><a href=\"#Kanna\" class=\"headerlink\" title=\"Kanna\"></a>Kanna</h4><p>项目中需要解析 html ，一直用的 Kanna，在 swift3 中，原来的<code>doc.xpath(&quot;//table/tr&quot;).count</code>变成了 <code>doc.xpath(&quot;//table/tr&quot;).nodeSet.count</code>。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>9.15号中秋节那天发布了<a href=\"https://itunes.apple.com/us/app/shi-da-zhu-shou-hui-shi-fan/id1150983683?l=zh&ls=1&mt=8\" target=\"_blank\" rel=\"noopener\">师大助手App</a>，后来有次在 Yosemite OS 下更新到 Xcode8 ，打开后项目一片红，当时只是想修复一下 bug，还没想要迁移到 Swift3，于是默默的 重新装了 Xcode7，又继续愉快的改bug了，然后9月20号提交到商店更新也没问题。21号提示 Sierra 可以更新了，于是手贱更新了一波。然后悲剧就开始了。<br>更新完 Sierra 后，我添加了Widgets功能，于是准备上传到商店，然后就是 一直传不上去。试了一下几个方法：</p>\n<ol>\n<li>Xcode7 打包，Xcode8 上传</li>\n<li>Xcode7 打包，在 Sierra 下用 Application Loader 上传</li>\n<li>Xcode7 打包，在同学 Yosemite 下用 Application Loader 上传</li>\n</ol>\n<p>结果以上都不行，一直卡在验证那里，于是我就一狠心，说用 Xcode8 ，做一下 Swift3 迁移😂，开启了升级打怪之旅</p>\n<h2 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h2><h3 id=\"自动代码-Convert\"><a href=\"#自动代码-Convert\" class=\"headerlink\" title=\"自动代码 Convert\"></a>自动代码 Convert</h3><p>在这里，我只 Convert 自己写的代码，事实证明是明智的，因为第三方库自己都做了适配，不需要我们来进行 Convert，这一步做完，自己的代码大致上没什么问题了，主要错误都集中在第三方库的接口调用上</p>\n<h3 id=\"第三方库-Update\"><a href=\"#第三方库-Update\" class=\"headerlink\" title=\"第三方库 Update\"></a>第三方库 Update</h3><p>我有个习惯，就是 update 之前喜欢先去项目主页看一下，看看有没有什么坑。</p>\n<h4 id=\"CocoaPods\"><a href=\"#CocoaPods\" class=\"headerlink\" title=\"CocoaPods\"></a>CocoaPods</h4><ol>\n<li><p>卸载已有的 CocoaPods (非必须)</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ which pod</span><br><span class=\"line\">/usr/local/bin/pod</span><br><span class=\"line\">$ sudo rm -rf /usr/local/bin/pod</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安装支持 Xcode8 的 CocoaPods</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo gem install cocoapods --pre</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p>更新完 CocoaPods 还有更新本地库，就不说了。</p>\n<h4 id=\"Alamofire\"><a href=\"#Alamofire\" class=\"headerlink\" title=\"Alamofire\"></a>Alamofire</h4><p>去官网看了一下，真是坑爹，Alamofire 4.0 变化好大，接口都按照 Swift3 重新弄了，二话不说，先更新一下。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pod '<span class=\"type\">Alamofire'</span>, '~&gt; <span class=\"number\">4.0</span>'</span><br></pre></td></tr></table></figure>\n\n<p>基本的代码更新看<a href=\"https://github.com/Alamofire/Alamofire/blob/master/Documentation/Alamofire%204.0%20Migration%20Guide.md\" target=\"_blank\" rel=\"noopener\">官方文档</a>就差不多了。下面写几个官方文档没有提到的：</p>\n<h5 id=\"配置https证书\"><a href=\"#配置https证书\" class=\"headerlink\" title=\"配置https证书\"></a>配置https证书</h5><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">configureAlamofireManager</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">let</span> manager = <span class=\"type\">SessionManager</span>.<span class=\"keyword\">default</span></span><br><span class=\"line\">   manager.delegate.sessionDidReceiveChallenge = &#123; session, challenge <span class=\"keyword\">in</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> disposition: <span class=\"type\">URLSession</span>.<span class=\"type\">AuthChallengeDisposition</span> = .performDefaultHandling</span><br><span class=\"line\">       <span class=\"keyword\">var</span> credential: <span class=\"type\">URLCredential?</span></span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"keyword\">if</span> challenge.protectionSpace.authenticationMethod == <span class=\"type\">NSURLAuthenticationMethodServerTrust</span> &#123;</span><br><span class=\"line\">           disposition = <span class=\"type\">URLSession</span>.<span class=\"type\">AuthChallengeDisposition</span>.useCredential</span><br><span class=\"line\">           credential = <span class=\"type\">URLCredential</span>(trust: challenge.protectionSpace.serverTrust!)</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> challenge.previousFailureCount &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">               disposition = .cancelAuthenticationChallenge</span><br><span class=\"line\">           &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">               credential = manager.session.configuration.urlCredentialStorage?.defaultCredential(<span class=\"keyword\">for</span>: challenge.protectionSpace)</span><br><span class=\"line\">               </span><br><span class=\"line\">               <span class=\"keyword\">if</span> credential != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">                   disposition = .useCredential</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> (disposition, credential)</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"自定义Request请求\"><a href=\"#自定义Request请求\" class=\"headerlink\" title=\"自定义Request请求\"></a>自定义Request请求</h5><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> urlRequest = urlRequestWithComponents(<span class=\"type\">SchoolNetWorkBaseURL</span>, parameters: parameters)</span><br><span class=\"line\"><span class=\"type\">Alamofire</span>.upload(urlRequest.<span class=\"number\">1</span>, with: urlRequest.<span class=\"number\">0</span>).response &#123;</span><br><span class=\"line\">    response <span class=\"keyword\">in</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"keyword\">let</span> htmlString:<span class=\"type\">String</span> = <span class=\"type\">NSString</span>(data: response.data!, encoding: <span class=\"type\">GB2312Encoding</span>)! <span class=\"keyword\">as</span> <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(htmlString)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fileprivate</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">urlRequestWithComponents</span><span class=\"params\">(<span class=\"number\">_</span> urlString:String,parameters:[String: AnyObject])</span></span> -&gt; (<span class=\"type\">URLRequestConvertible</span>,<span class=\"type\">Data</span>) &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">   <span class=\"comment\">// create  url request to send</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> mutableURLRequest = <span class=\"type\">URLRequest</span>(url: <span class=\"type\">URL</span>(string: urlString)!)</span><br><span class=\"line\">   mutableURLRequest.httpMethod = <span class=\"type\">HTTPMethod</span>.post.rawValue</span><br><span class=\"line\">   <span class=\"keyword\">let</span> contentType = <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">   mutableURLRequest.setValue(contentType, forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span>)</span><br><span class=\"line\">   mutableURLRequest.setValue(<span class=\"string\">\"****\"</span>, forHTTPHeaderField: <span class=\"string\">\"Referer\"</span>)</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">// add parameters</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> uploadData = <span class=\"type\">Data</span>()</span><br><span class=\"line\">   <span class=\"keyword\">for</span> (key,value) <span class=\"keyword\">in</span> parameters &#123;</span><br><span class=\"line\">       uploadData.append(<span class=\"string\">\"\\(key)=\\(value)&amp;\"</span>.data(using: <span class=\"type\">String</span>.<span class=\"type\">Encoding</span>(rawValue: <span class=\"type\">GB2312Encoding</span>))!)</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"keyword\">return</span> (<span class=\"keyword\">try</span>! <span class=\"type\">URLEncoding</span>.<span class=\"keyword\">default</span>.encode(mutableURLRequest, with: <span class=\"literal\">nil</span>),uploadData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Eureka\"><a href=\"#Eureka\" class=\"headerlink\" title=\"Eureka\"></a>Eureka</h4><p>Eureka 在新版本中删除了 ImageRow，我之前代码有一处无法调用，后来提了个<a href=\"https://github.com/xmartlabs/Eureka/issues/688\" target=\"_blank\" rel=\"noopener\">issue</a>，问了作者。<br><img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Swift3_1.png\" alt=\"Issue\"><br>由于在 iOS10 中，app 需要对相册和相机的使用进行权限申明，不然会闪退，未避免其他 app 闪退，就删了 imageRow，作者也给了解决方法，按照他给方法，本地添加 imageRow 就可继续使用了，或者自己实现CustomRow，准备过段时间试一下自定义 CustomRow。</p>\n<h4 id=\"Kanna\"><a href=\"#Kanna\" class=\"headerlink\" title=\"Kanna\"></a>Kanna</h4><p>项目中需要解析 html ，一直用的 Kanna，在 swift3 中，原来的<code>doc.xpath(&quot;//table/tr&quot;).count</code>变成了 <code>doc.xpath(&quot;//table/tr&quot;).nodeSet.count</code>。</p>\n"},{"title":"iOS Swift Xcode7 的 APNS 使用","date":"2015-12-02T12:55:15.000Z","_content":"# iOS9-Swift2-Xcode7的APNS使用\n\n## 前言\n\n最近在开发基于阿里百川的即时通信功能，其中对于iOS平台的消息推送是要使用苹果的APNS服务的，对于这个服务不太了解的同学，可以看[apple开发者文档](https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ApplePushService.html?spm=0.0.0.0.EUOBVe)学习一下。\n\n## 总结一下使用APNS推送的步骤：\n\n1.iOS应用需要向APNS系统申请DeviceToken\n\n2.应用需要向应用服务器上传DeviceToken\n\n3.服务器通过DeviceToken向APNS系统推送消息\n\n4.APNS系统往用户的手机推送消息\n\n## 实现步骤：\n\n### 1.申请DeviceToken\n\n在AppDelegate.swift中的application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool中添加以下函数向系统申请DeviceToken\n\n```swift\nUIApplication.sharedApplication().registerUserNotificationSettings(UIUserNotificationSettings(forTypes: [UIUserNotificationType.Sound , UIUserNotificationType.Alert , UIUserNotificationType.Badge], categories: nil))\nUIApplication.sharedApplication().registerForRemoteNotifications()\n```\n\n### 2.获取DeviceToken\n\n在AppDelegate.swift中添加下面这个回调函数，用于获取DeviceToken\n\n```swift\nfunc application(application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: NSData) {\n    let token:String = deviceToken.description.stringByTrimmingCharactersInSet(NSCharacterSet(charactersInString: \"<>\"))\n    print(\"token==\\(token)\")\n    //将token发送到服务器\n}\n```\n\n使用阿里百川的SDK不需要将DeviceToken发送到服务器，IMSDK会自动得到该DeviceToken，你无须手动传给IMSDK\n\n### 3.获取APNS推送证书\n\n在iOSAppIDs你的应用里的证书里，点击edit，打开Push Notifications功能，然后会生成两个证书。Production SSL Certificate和Development SSL Certificate。前面是生产环境推送证书，后面是沙箱环境推送证书。将其下载下来，并安装到钥匙串中。\n\n在钥匙串应用找到这两个证书，右键点击导出，生产p12格式（阿里百川需要p12格式)，在将其上传到阿里百川的控制台。\n\n### 4.测试消息推送\n使用[该工具](http://pan.baidu.com/s/1ntngmcL),使用你上传的证书，向设备控制台打印出的DeviceToken，发送一条Push，确认是否可以收到Push。\n\n需要注意的是：项目的证书要和推送证书的类型一致，若是Disturbution证书就得使用Production SSL Certificate，若是Developer证书就得使用Development SSL Certificate。\n\n\n","source":"_posts/iOS9-Swift2-Xcode7的APNS使用.md","raw":"---\ntitle: iOS Swift Xcode7 的 APNS 使用\ndate: 2015-12-02 20:55:15\ntags:\n- iOS\n- Swift\n- APNS推送\ncategories:\n- 开发\n- iOS\n---\n# iOS9-Swift2-Xcode7的APNS使用\n\n## 前言\n\n最近在开发基于阿里百川的即时通信功能，其中对于iOS平台的消息推送是要使用苹果的APNS服务的，对于这个服务不太了解的同学，可以看[apple开发者文档](https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ApplePushService.html?spm=0.0.0.0.EUOBVe)学习一下。\n\n## 总结一下使用APNS推送的步骤：\n\n1.iOS应用需要向APNS系统申请DeviceToken\n\n2.应用需要向应用服务器上传DeviceToken\n\n3.服务器通过DeviceToken向APNS系统推送消息\n\n4.APNS系统往用户的手机推送消息\n\n## 实现步骤：\n\n### 1.申请DeviceToken\n\n在AppDelegate.swift中的application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool中添加以下函数向系统申请DeviceToken\n\n```swift\nUIApplication.sharedApplication().registerUserNotificationSettings(UIUserNotificationSettings(forTypes: [UIUserNotificationType.Sound , UIUserNotificationType.Alert , UIUserNotificationType.Badge], categories: nil))\nUIApplication.sharedApplication().registerForRemoteNotifications()\n```\n\n### 2.获取DeviceToken\n\n在AppDelegate.swift中添加下面这个回调函数，用于获取DeviceToken\n\n```swift\nfunc application(application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: NSData) {\n    let token:String = deviceToken.description.stringByTrimmingCharactersInSet(NSCharacterSet(charactersInString: \"<>\"))\n    print(\"token==\\(token)\")\n    //将token发送到服务器\n}\n```\n\n使用阿里百川的SDK不需要将DeviceToken发送到服务器，IMSDK会自动得到该DeviceToken，你无须手动传给IMSDK\n\n### 3.获取APNS推送证书\n\n在iOSAppIDs你的应用里的证书里，点击edit，打开Push Notifications功能，然后会生成两个证书。Production SSL Certificate和Development SSL Certificate。前面是生产环境推送证书，后面是沙箱环境推送证书。将其下载下来，并安装到钥匙串中。\n\n在钥匙串应用找到这两个证书，右键点击导出，生产p12格式（阿里百川需要p12格式)，在将其上传到阿里百川的控制台。\n\n### 4.测试消息推送\n使用[该工具](http://pan.baidu.com/s/1ntngmcL),使用你上传的证书，向设备控制台打印出的DeviceToken，发送一条Push，确认是否可以收到Push。\n\n需要注意的是：项目的证书要和推送证书的类型一致，若是Disturbution证书就得使用Production SSL Certificate，若是Developer证书就得使用Development SSL Certificate。\n\n\n","slug":"iOS9-Swift2-Xcode7的APNS使用","published":1,"updated":"2019-06-16T15:37:13.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkbd000fwq1k6u96q8y4","content":"<h1 id=\"iOS9-Swift2-Xcode7的APNS使用\"><a href=\"#iOS9-Swift2-Xcode7的APNS使用\" class=\"headerlink\" title=\"iOS9-Swift2-Xcode7的APNS使用\"></a>iOS9-Swift2-Xcode7的APNS使用</h1><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近在开发基于阿里百川的即时通信功能，其中对于iOS平台的消息推送是要使用苹果的APNS服务的，对于这个服务不太了解的同学，可以看<a href=\"https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ApplePushService.html?spm=0.0.0.0.EUOBVe\" target=\"_blank\" rel=\"noopener\">apple开发者文档</a>学习一下。</p>\n<h2 id=\"总结一下使用APNS推送的步骤：\"><a href=\"#总结一下使用APNS推送的步骤：\" class=\"headerlink\" title=\"总结一下使用APNS推送的步骤：\"></a>总结一下使用APNS推送的步骤：</h2><p>1.iOS应用需要向APNS系统申请DeviceToken</p>\n<p>2.应用需要向应用服务器上传DeviceToken</p>\n<p>3.服务器通过DeviceToken向APNS系统推送消息</p>\n<p>4.APNS系统往用户的手机推送消息</p>\n<h2 id=\"实现步骤：\"><a href=\"#实现步骤：\" class=\"headerlink\" title=\"实现步骤：\"></a>实现步骤：</h2><h3 id=\"1-申请DeviceToken\"><a href=\"#1-申请DeviceToken\" class=\"headerlink\" title=\"1.申请DeviceToken\"></a>1.申请DeviceToken</h3><p>在AppDelegate.swift中的application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -&gt; Bool中添加以下函数向系统申请DeviceToken</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">UIApplication</span>.sharedApplication().registerUserNotificationSettings(<span class=\"type\">UIUserNotificationSettings</span>(forTypes: [<span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Sound</span> , <span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Alert</span> , <span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Badge</span>], categories: <span class=\"literal\">nil</span>))</span><br><span class=\"line\"><span class=\"type\">UIApplication</span>.sharedApplication().registerForRemoteNotifications()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-获取DeviceToken\"><a href=\"#2-获取DeviceToken\" class=\"headerlink\" title=\"2.获取DeviceToken\"></a>2.获取DeviceToken</h3><p>在AppDelegate.swift中添加下面这个回调函数，用于获取DeviceToken</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">application</span><span class=\"params\">(application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: NSData)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> token:<span class=\"type\">String</span> = deviceToken.description.stringByTrimmingCharactersInSet(<span class=\"type\">NSCharacterSet</span>(charactersInString: <span class=\"string\">\"&lt;&gt;\"</span>))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"token==\\(token)\"</span>)</span><br><span class=\"line\">    <span class=\"comment\">//将token发送到服务器</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用阿里百川的SDK不需要将DeviceToken发送到服务器，IMSDK会自动得到该DeviceToken，你无须手动传给IMSDK</p>\n<h3 id=\"3-获取APNS推送证书\"><a href=\"#3-获取APNS推送证书\" class=\"headerlink\" title=\"3.获取APNS推送证书\"></a>3.获取APNS推送证书</h3><p>在iOSAppIDs你的应用里的证书里，点击edit，打开Push Notifications功能，然后会生成两个证书。Production SSL Certificate和Development SSL Certificate。前面是生产环境推送证书，后面是沙箱环境推送证书。将其下载下来，并安装到钥匙串中。</p>\n<p>在钥匙串应用找到这两个证书，右键点击导出，生产p12格式（阿里百川需要p12格式)，在将其上传到阿里百川的控制台。</p>\n<h3 id=\"4-测试消息推送\"><a href=\"#4-测试消息推送\" class=\"headerlink\" title=\"4.测试消息推送\"></a>4.测试消息推送</h3><p>使用<a href=\"http://pan.baidu.com/s/1ntngmcL\" target=\"_blank\" rel=\"noopener\">该工具</a>,使用你上传的证书，向设备控制台打印出的DeviceToken，发送一条Push，确认是否可以收到Push。</p>\n<p>需要注意的是：项目的证书要和推送证书的类型一致，若是Disturbution证书就得使用Production SSL Certificate，若是Developer证书就得使用Development SSL Certificate。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"iOS9-Swift2-Xcode7的APNS使用\"><a href=\"#iOS9-Swift2-Xcode7的APNS使用\" class=\"headerlink\" title=\"iOS9-Swift2-Xcode7的APNS使用\"></a>iOS9-Swift2-Xcode7的APNS使用</h1><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近在开发基于阿里百川的即时通信功能，其中对于iOS平台的消息推送是要使用苹果的APNS服务的，对于这个服务不太了解的同学，可以看<a href=\"https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ApplePushService.html?spm=0.0.0.0.EUOBVe\" target=\"_blank\" rel=\"noopener\">apple开发者文档</a>学习一下。</p>\n<h2 id=\"总结一下使用APNS推送的步骤：\"><a href=\"#总结一下使用APNS推送的步骤：\" class=\"headerlink\" title=\"总结一下使用APNS推送的步骤：\"></a>总结一下使用APNS推送的步骤：</h2><p>1.iOS应用需要向APNS系统申请DeviceToken</p>\n<p>2.应用需要向应用服务器上传DeviceToken</p>\n<p>3.服务器通过DeviceToken向APNS系统推送消息</p>\n<p>4.APNS系统往用户的手机推送消息</p>\n<h2 id=\"实现步骤：\"><a href=\"#实现步骤：\" class=\"headerlink\" title=\"实现步骤：\"></a>实现步骤：</h2><h3 id=\"1-申请DeviceToken\"><a href=\"#1-申请DeviceToken\" class=\"headerlink\" title=\"1.申请DeviceToken\"></a>1.申请DeviceToken</h3><p>在AppDelegate.swift中的application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -&gt; Bool中添加以下函数向系统申请DeviceToken</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">UIApplication</span>.sharedApplication().registerUserNotificationSettings(<span class=\"type\">UIUserNotificationSettings</span>(forTypes: [<span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Sound</span> , <span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Alert</span> , <span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Badge</span>], categories: <span class=\"literal\">nil</span>))</span><br><span class=\"line\"><span class=\"type\">UIApplication</span>.sharedApplication().registerForRemoteNotifications()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-获取DeviceToken\"><a href=\"#2-获取DeviceToken\" class=\"headerlink\" title=\"2.获取DeviceToken\"></a>2.获取DeviceToken</h3><p>在AppDelegate.swift中添加下面这个回调函数，用于获取DeviceToken</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">application</span><span class=\"params\">(application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: NSData)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> token:<span class=\"type\">String</span> = deviceToken.description.stringByTrimmingCharactersInSet(<span class=\"type\">NSCharacterSet</span>(charactersInString: <span class=\"string\">\"&lt;&gt;\"</span>))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"token==\\(token)\"</span>)</span><br><span class=\"line\">    <span class=\"comment\">//将token发送到服务器</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用阿里百川的SDK不需要将DeviceToken发送到服务器，IMSDK会自动得到该DeviceToken，你无须手动传给IMSDK</p>\n<h3 id=\"3-获取APNS推送证书\"><a href=\"#3-获取APNS推送证书\" class=\"headerlink\" title=\"3.获取APNS推送证书\"></a>3.获取APNS推送证书</h3><p>在iOSAppIDs你的应用里的证书里，点击edit，打开Push Notifications功能，然后会生成两个证书。Production SSL Certificate和Development SSL Certificate。前面是生产环境推送证书，后面是沙箱环境推送证书。将其下载下来，并安装到钥匙串中。</p>\n<p>在钥匙串应用找到这两个证书，右键点击导出，生产p12格式（阿里百川需要p12格式)，在将其上传到阿里百川的控制台。</p>\n<h3 id=\"4-测试消息推送\"><a href=\"#4-测试消息推送\" class=\"headerlink\" title=\"4.测试消息推送\"></a>4.测试消息推送</h3><p>使用<a href=\"http://pan.baidu.com/s/1ntngmcL\" target=\"_blank\" rel=\"noopener\">该工具</a>,使用你上传的证书，向设备控制台打印出的DeviceToken，发送一条Push，确认是否可以收到Push。</p>\n<p>需要注意的是：项目的证书要和推送证书的类型一致，若是Disturbution证书就得使用Production SSL Certificate，若是Developer证书就得使用Development SSL Certificate。</p>\n"},{"title":"iOS 一个 UITextView 的小 Bug","date":"2016-07-28T06:55:25.000Z","_content":"\n# 起因\n\n今天上午测试提了一个很神奇的Bug，在输入框输入某些iOS自带的表情，删除后会有残留物。例如：💺💺💺看到这个Bug，我的内心是觉得不可能啊。然后亲自试了一下，发现真会这样。至此，我发自内心佩服了我司的测试，这种问题都能发现。\n\n我想，这仅仅就是一个UITextView，应该不会我写的是个例，于是，我找了微信试了一下,这是微信的个人签名框，在输入完表情后，再删除，可以看到，后面留了一串残留物。\n![微信上Bug复现](/uploads/blog/1-1.jpg)\n我本来想直接关了这个Bug，毕竟微信这种大厂的App都能允许这个Bug。后来一想，也许是他们的测试没有我们的牛逼。\n\n# 解决方法\n\n微信的这个Bug复现，在保存后再进去，就会发现残留物没有了。所以解决思路是，在UITextView一边输入，一边给它赋值。于是实现了`UITextViewDelegate`的`textViewDidChange`方法。\n\n``` swift\nextension FMPersonEditSignVC : UITextViewDelegate {\n    \n    func textViewDidChange(textView:UITextView) {\n        self.textView.text = textView.text\n    } \n}\n```\n\n# 番外篇\n\n说到`UITextViewDelegate`，我又想起来之前提的一个Bug。我们的baseVC中都加了点击空白页隐藏键盘的功能，但是在某些小屏幕机型中，比如iPhone5上，如果UITextView的高度设置的比较高，用户就点击不到空白页（我当时给测试演示，用鼠标点击的，我说这很好点啊，哈哈哈哈），进而就隐藏不了键盘。\n\n这里如果去重新画UI设置约束，我感觉劳动量太大了，于是就想着用户在输入完回车键可以隐藏键盘。另外，iOS的键盘的回车键是可以自定义设置的，我将Return Key设置显示为“Done”，更便于用户理解。\n\n检测用户输入回车的代码如下：\n\n``` swift \nextension FMPersonEditSignVC : UITextViewDelegate {\n    \n    func textView(textView: UITextView, shouldChangeTextInRange range: NSRange, replacementText text: String) -> Bool {\n        if text == \"\\n\" {\n            textView.resignFirstResponder()\n            return false\n        }\n        return true\n    }\n}\n\n```\n\n","source":"_posts/一个UITextView的小Bug.md","raw":"---\ntitle: iOS 一个 UITextView 的小 Bug\ndate: 2016-07-28 14:55:25\ntags:\n- iOS\n- UITextView\ncategories:\n- 开发\n- iOS\n---\n\n# 起因\n\n今天上午测试提了一个很神奇的Bug，在输入框输入某些iOS自带的表情，删除后会有残留物。例如：💺💺💺看到这个Bug，我的内心是觉得不可能啊。然后亲自试了一下，发现真会这样。至此，我发自内心佩服了我司的测试，这种问题都能发现。\n\n我想，这仅仅就是一个UITextView，应该不会我写的是个例，于是，我找了微信试了一下,这是微信的个人签名框，在输入完表情后，再删除，可以看到，后面留了一串残留物。\n![微信上Bug复现](/uploads/blog/1-1.jpg)\n我本来想直接关了这个Bug，毕竟微信这种大厂的App都能允许这个Bug。后来一想，也许是他们的测试没有我们的牛逼。\n\n# 解决方法\n\n微信的这个Bug复现，在保存后再进去，就会发现残留物没有了。所以解决思路是，在UITextView一边输入，一边给它赋值。于是实现了`UITextViewDelegate`的`textViewDidChange`方法。\n\n``` swift\nextension FMPersonEditSignVC : UITextViewDelegate {\n    \n    func textViewDidChange(textView:UITextView) {\n        self.textView.text = textView.text\n    } \n}\n```\n\n# 番外篇\n\n说到`UITextViewDelegate`，我又想起来之前提的一个Bug。我们的baseVC中都加了点击空白页隐藏键盘的功能，但是在某些小屏幕机型中，比如iPhone5上，如果UITextView的高度设置的比较高，用户就点击不到空白页（我当时给测试演示，用鼠标点击的，我说这很好点啊，哈哈哈哈），进而就隐藏不了键盘。\n\n这里如果去重新画UI设置约束，我感觉劳动量太大了，于是就想着用户在输入完回车键可以隐藏键盘。另外，iOS的键盘的回车键是可以自定义设置的，我将Return Key设置显示为“Done”，更便于用户理解。\n\n检测用户输入回车的代码如下：\n\n``` swift \nextension FMPersonEditSignVC : UITextViewDelegate {\n    \n    func textView(textView: UITextView, shouldChangeTextInRange range: NSRange, replacementText text: String) -> Bool {\n        if text == \"\\n\" {\n            textView.resignFirstResponder()\n            return false\n        }\n        return true\n    }\n}\n\n```\n\n","slug":"一个UITextView的小Bug","published":1,"updated":"2019-06-16T15:37:13.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkbe000kwq1k580a2sun","content":"<h1 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h1><p>今天上午测试提了一个很神奇的Bug，在输入框输入某些iOS自带的表情，删除后会有残留物。例如：💺💺💺看到这个Bug，我的内心是觉得不可能啊。然后亲自试了一下，发现真会这样。至此，我发自内心佩服了我司的测试，这种问题都能发现。</p>\n<p>我想，这仅仅就是一个UITextView，应该不会我写的是个例，于是，我找了微信试了一下,这是微信的个人签名框，在输入完表情后，再删除，可以看到，后面留了一串残留物。<br><img src=\"/uploads/blog/1-1.jpg\" alt=\"微信上Bug复现\"><br>我本来想直接关了这个Bug，毕竟微信这种大厂的App都能允许这个Bug。后来一想，也许是他们的测试没有我们的牛逼。</p>\n<h1 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h1><p>微信的这个Bug复现，在保存后再进去，就会发现残留物没有了。所以解决思路是，在UITextView一边输入，一边给它赋值。于是实现了<code>UITextViewDelegate</code>的<code>textViewDidChange</code>方法。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">FMPersonEditSignVC</span> : <span class=\"title\">UITextViewDelegate</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">textViewDidChange</span><span class=\"params\">(textView:UITextView)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.textView.text = textView.text</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"番外篇\"><a href=\"#番外篇\" class=\"headerlink\" title=\"番外篇\"></a>番外篇</h1><p>说到<code>UITextViewDelegate</code>，我又想起来之前提的一个Bug。我们的baseVC中都加了点击空白页隐藏键盘的功能，但是在某些小屏幕机型中，比如iPhone5上，如果UITextView的高度设置的比较高，用户就点击不到空白页（我当时给测试演示，用鼠标点击的，我说这很好点啊，哈哈哈哈），进而就隐藏不了键盘。</p>\n<p>这里如果去重新画UI设置约束，我感觉劳动量太大了，于是就想着用户在输入完回车键可以隐藏键盘。另外，iOS的键盘的回车键是可以自定义设置的，我将Return Key设置显示为“Done”，更便于用户理解。</p>\n<p>检测用户输入回车的代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">FMPersonEditSignVC</span> : <span class=\"title\">UITextViewDelegate</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">textView</span><span class=\"params\">(textView: UITextView, shouldChangeTextInRange range: NSRange, replacementText text: String)</span></span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> text == <span class=\"string\">\"\\n\"</span> &#123;</span><br><span class=\"line\">            textView.resignFirstResponder()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h1><p>今天上午测试提了一个很神奇的Bug，在输入框输入某些iOS自带的表情，删除后会有残留物。例如：💺💺💺看到这个Bug，我的内心是觉得不可能啊。然后亲自试了一下，发现真会这样。至此，我发自内心佩服了我司的测试，这种问题都能发现。</p>\n<p>我想，这仅仅就是一个UITextView，应该不会我写的是个例，于是，我找了微信试了一下,这是微信的个人签名框，在输入完表情后，再删除，可以看到，后面留了一串残留物。<br><img src=\"/uploads/blog/1-1.jpg\" alt=\"微信上Bug复现\"><br>我本来想直接关了这个Bug，毕竟微信这种大厂的App都能允许这个Bug。后来一想，也许是他们的测试没有我们的牛逼。</p>\n<h1 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h1><p>微信的这个Bug复现，在保存后再进去，就会发现残留物没有了。所以解决思路是，在UITextView一边输入，一边给它赋值。于是实现了<code>UITextViewDelegate</code>的<code>textViewDidChange</code>方法。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">FMPersonEditSignVC</span> : <span class=\"title\">UITextViewDelegate</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">textViewDidChange</span><span class=\"params\">(textView:UITextView)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.textView.text = textView.text</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"番外篇\"><a href=\"#番外篇\" class=\"headerlink\" title=\"番外篇\"></a>番外篇</h1><p>说到<code>UITextViewDelegate</code>，我又想起来之前提的一个Bug。我们的baseVC中都加了点击空白页隐藏键盘的功能，但是在某些小屏幕机型中，比如iPhone5上，如果UITextView的高度设置的比较高，用户就点击不到空白页（我当时给测试演示，用鼠标点击的，我说这很好点啊，哈哈哈哈），进而就隐藏不了键盘。</p>\n<p>这里如果去重新画UI设置约束，我感觉劳动量太大了，于是就想着用户在输入完回车键可以隐藏键盘。另外，iOS的键盘的回车键是可以自定义设置的，我将Return Key设置显示为“Done”，更便于用户理解。</p>\n<p>检测用户输入回车的代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">FMPersonEditSignVC</span> : <span class=\"title\">UITextViewDelegate</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">textView</span><span class=\"params\">(textView: UITextView, shouldChangeTextInRange range: NSRange, replacementText text: String)</span></span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> text == <span class=\"string\">\"\\n\"</span> &#123;</span><br><span class=\"line\">            textView.resignFirstResponder()</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"Swift 使用 Alamofire 实现 GB2312 编码的网络请求","date":"2016-08-02T06:04:58.000Z","_content":"\n# 背景\n\n最近在做一个校园工具，其中有个功能是查看自己校园网账户的剩余流量。学校的网络管理中心没有开放接口，于是只能利用Alamofire来模拟登录解析数据。一开始通过GET请求获取用户账户余额都是没有问题的，但是通过POST请求的话，就无法正确访问数据。\n\n# 原因\n\n之前知道该网站是GB2312编码的，于是在解析data为HTML的时候就用GB2312解码的。但在POST数据时，也需要GB2312编码。我开始时将post的string参数用GB2312编码，发现不行。于是就查看了Alamofire的源码，发现其默认的参数编码是UTF-8，而且只有这一个选择😂。\n\n``` swift\nif mutableURLRequest.valueForHTTPHeaderField(\"Content-Type\") == nil {\n    mutableURLRequest.setValue(\"application/x-www-form-urlencoded; charset=utf-8\",forHTTPHeaderField: \"Content-Type\")\n}\n```\n\n这样就很尴尬了。在Google搜了半天，也没找到类似的问题。于是问了我一个经常抓包的哥们，他说GB2312编码的服务器遇到的次数非常少。再加上本来用swift模拟请求的场景就不多了，难怪没同样的问题呢。试了很久，我都准备鸣金收兵了。\n\n# 解决\n\n后来问了学长这个问题，他说可以自定义Alamofire的request，在request中进行参数的GB2312编码或许可以。于是带着最后一丝希望去试了一下，发现学长真行🤗。\n\n自定义Alamofire的request代码如下：\n```swift\nlet GB2312Encoding = CFStringConvertEncodingToNSStringEncoding(0x0632)\nprivate func urlRequestWithComponents(urlString:String,parameters:[String: AnyObject]) ->(URLRequestConvertible,NSData) {\n        \n    // create  url request to send\n    let mutableURLRequest = NSMutableURLRequest(URL: NSURL(string: urlString)!)\n    mutableURLRequest.HTTPMethod = Alamofire.Method.POST.rawValue\n    let contentType = \"application/x-www-form-urlencoded\"\n    mutableURLRequest.setValue(contentType, forHTTPHeaderField: \"Content-Type\")\n    mutableURLRequest.setValue(\"*******\", forHTTPHeaderField: \"Referer\")\n        \n    // add parameters\n    let uploadData = NSMutableData()\n    for (key,value) in parameters {\n        uploadData.appendData(\"\\(key)=\\(value)&\".dataUsingEncoding(GB2312Encoding)!)\n    }\n        \n    return (Alamofire.ParameterEncoding.URL.encode(mutableURLRequest, parameters: nil).0,uploadData)\n}\n```\n\n调用该自定义Request的方法如下：\n\n``` swift\nlet urlRequest = urlRequestWithComponents(SchoolNetWorkBaseURL, parameters: parameters)\nAlamofire.upload(urlRequest.0, data: urlRequest.1).response {\n    request, response, data, error in\n}\n```\n\n通过这个，就可以实现使用Alamofire实现GB2312编码的请求了。\n\n# 番外篇：关于使用Alamofire实现gzip压缩参数的网络请求\n\n在解决上面的问题时，我一度偏失了方向，以为是参数没有压缩的问题。下面记录一下gzip压缩的参数问题。\n\n下面是对ParameterEncoding的扩展，Alamofire在请求的request的encoding中，选择ParameterEncoding.gzipped即可。\n\n``` swift\n//\n//  ParameterEncoding-Extension.swift\n//  AHNUer\n//\n//  Created by 黄帅 on 16/7/28.\n//  Copyright © 2016年 帅帅. All rights reserved.\n//\n\nimport Foundation\nimport Alamofire\n\n// Actual gzipping from https://github.com/1024jp/NSData-GZIP\n\n// Example: ParameterEncoding.JSON.gzipped\n\ninfix operator • { associativity left }\nfunc • <A, B, C>(f: B -> C, g: A -> B) -> A -> C {\n    return { x in f(g(x)) }\n}\n\nextension ParameterEncoding {\n    \n    var gzipped:ParameterEncoding {\n        \n        return gzip(self)\n    }\n    \n    private func gzip(encoding:ParameterEncoding) -> ParameterEncoding {\n        \n        let gzipEncoding = self.gzipOrError • encoding.encode\n        \n        return ParameterEncoding.Custom(gzipEncoding)\n    }\n    \n    private func gzipOrError(request:NSURLRequest, error:NSError?) -> (NSMutableURLRequest, NSError?) {\n        \n        let mutableRequest = request.mutableCopy() as! NSMutableURLRequest\n        \n        if error != nil {\n            return (mutableRequest, error)\n        }\n        \n        var gzipEncodingError: NSError? = nil\n        \n        do {\n            let gzippedData = try mutableRequest.HTTPBody?.gzippedData()\n            mutableRequest.HTTPBody = gzippedData\n            \n            if mutableRequest.HTTPBody != nil {\n                mutableRequest.setValue(\"gzip\", forHTTPHeaderField: \"Content-Encoding\")\n            }\n        } catch {\n            gzipEncodingError = error as NSError\n        }\n        \n        return (mutableRequest, gzipEncodingError)\n    }\n}\n\n```\n\n# 参考\n\n* [Swift - 使用gzip压缩NSData数据](http://www.hangge.com/blog/cache/detail_1032.html)\n* [blender/ParameterEncodingExt](https://gist.github.com/blender/923f1c1de2f00514ed12)\n\n\n","source":"_posts/使用Alamofire实现GB2312编码的网络请求.md","raw":"---\ntitle: Swift 使用 Alamofire 实现 GB2312 编码的网络请求\ndate: 2016-08-02 14:04:58\ntags:\n- iOS\n- Swift\n- Alamofire\n- GB2312编码\ncategories:\n- 开发\n- iOS\n---\n\n# 背景\n\n最近在做一个校园工具，其中有个功能是查看自己校园网账户的剩余流量。学校的网络管理中心没有开放接口，于是只能利用Alamofire来模拟登录解析数据。一开始通过GET请求获取用户账户余额都是没有问题的，但是通过POST请求的话，就无法正确访问数据。\n\n# 原因\n\n之前知道该网站是GB2312编码的，于是在解析data为HTML的时候就用GB2312解码的。但在POST数据时，也需要GB2312编码。我开始时将post的string参数用GB2312编码，发现不行。于是就查看了Alamofire的源码，发现其默认的参数编码是UTF-8，而且只有这一个选择😂。\n\n``` swift\nif mutableURLRequest.valueForHTTPHeaderField(\"Content-Type\") == nil {\n    mutableURLRequest.setValue(\"application/x-www-form-urlencoded; charset=utf-8\",forHTTPHeaderField: \"Content-Type\")\n}\n```\n\n这样就很尴尬了。在Google搜了半天，也没找到类似的问题。于是问了我一个经常抓包的哥们，他说GB2312编码的服务器遇到的次数非常少。再加上本来用swift模拟请求的场景就不多了，难怪没同样的问题呢。试了很久，我都准备鸣金收兵了。\n\n# 解决\n\n后来问了学长这个问题，他说可以自定义Alamofire的request，在request中进行参数的GB2312编码或许可以。于是带着最后一丝希望去试了一下，发现学长真行🤗。\n\n自定义Alamofire的request代码如下：\n```swift\nlet GB2312Encoding = CFStringConvertEncodingToNSStringEncoding(0x0632)\nprivate func urlRequestWithComponents(urlString:String,parameters:[String: AnyObject]) ->(URLRequestConvertible,NSData) {\n        \n    // create  url request to send\n    let mutableURLRequest = NSMutableURLRequest(URL: NSURL(string: urlString)!)\n    mutableURLRequest.HTTPMethod = Alamofire.Method.POST.rawValue\n    let contentType = \"application/x-www-form-urlencoded\"\n    mutableURLRequest.setValue(contentType, forHTTPHeaderField: \"Content-Type\")\n    mutableURLRequest.setValue(\"*******\", forHTTPHeaderField: \"Referer\")\n        \n    // add parameters\n    let uploadData = NSMutableData()\n    for (key,value) in parameters {\n        uploadData.appendData(\"\\(key)=\\(value)&\".dataUsingEncoding(GB2312Encoding)!)\n    }\n        \n    return (Alamofire.ParameterEncoding.URL.encode(mutableURLRequest, parameters: nil).0,uploadData)\n}\n```\n\n调用该自定义Request的方法如下：\n\n``` swift\nlet urlRequest = urlRequestWithComponents(SchoolNetWorkBaseURL, parameters: parameters)\nAlamofire.upload(urlRequest.0, data: urlRequest.1).response {\n    request, response, data, error in\n}\n```\n\n通过这个，就可以实现使用Alamofire实现GB2312编码的请求了。\n\n# 番外篇：关于使用Alamofire实现gzip压缩参数的网络请求\n\n在解决上面的问题时，我一度偏失了方向，以为是参数没有压缩的问题。下面记录一下gzip压缩的参数问题。\n\n下面是对ParameterEncoding的扩展，Alamofire在请求的request的encoding中，选择ParameterEncoding.gzipped即可。\n\n``` swift\n//\n//  ParameterEncoding-Extension.swift\n//  AHNUer\n//\n//  Created by 黄帅 on 16/7/28.\n//  Copyright © 2016年 帅帅. All rights reserved.\n//\n\nimport Foundation\nimport Alamofire\n\n// Actual gzipping from https://github.com/1024jp/NSData-GZIP\n\n// Example: ParameterEncoding.JSON.gzipped\n\ninfix operator • { associativity left }\nfunc • <A, B, C>(f: B -> C, g: A -> B) -> A -> C {\n    return { x in f(g(x)) }\n}\n\nextension ParameterEncoding {\n    \n    var gzipped:ParameterEncoding {\n        \n        return gzip(self)\n    }\n    \n    private func gzip(encoding:ParameterEncoding) -> ParameterEncoding {\n        \n        let gzipEncoding = self.gzipOrError • encoding.encode\n        \n        return ParameterEncoding.Custom(gzipEncoding)\n    }\n    \n    private func gzipOrError(request:NSURLRequest, error:NSError?) -> (NSMutableURLRequest, NSError?) {\n        \n        let mutableRequest = request.mutableCopy() as! NSMutableURLRequest\n        \n        if error != nil {\n            return (mutableRequest, error)\n        }\n        \n        var gzipEncodingError: NSError? = nil\n        \n        do {\n            let gzippedData = try mutableRequest.HTTPBody?.gzippedData()\n            mutableRequest.HTTPBody = gzippedData\n            \n            if mutableRequest.HTTPBody != nil {\n                mutableRequest.setValue(\"gzip\", forHTTPHeaderField: \"Content-Encoding\")\n            }\n        } catch {\n            gzipEncodingError = error as NSError\n        }\n        \n        return (mutableRequest, gzipEncodingError)\n    }\n}\n\n```\n\n# 参考\n\n* [Swift - 使用gzip压缩NSData数据](http://www.hangge.com/blog/cache/detail_1032.html)\n* [blender/ParameterEncodingExt](https://gist.github.com/blender/923f1c1de2f00514ed12)\n\n\n","slug":"使用Alamofire实现GB2312编码的网络请求","published":1,"updated":"2019-06-16T15:37:13.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkbf000lwq1k9wzmf6np","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>最近在做一个校园工具，其中有个功能是查看自己校园网账户的剩余流量。学校的网络管理中心没有开放接口，于是只能利用Alamofire来模拟登录解析数据。一开始通过GET请求获取用户账户余额都是没有问题的，但是通过POST请求的话，就无法正确访问数据。</p>\n<h1 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h1><p>之前知道该网站是GB2312编码的，于是在解析data为HTML的时候就用GB2312解码的。但在POST数据时，也需要GB2312编码。我开始时将post的string参数用GB2312编码，发现不行。于是就查看了Alamofire的源码，发现其默认的参数编码是UTF-8，而且只有这一个选择😂。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> mutableURLRequest.valueForHTTPHeaderField(<span class=\"string\">\"Content-Type\"</span>) == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    mutableURLRequest.setValue(<span class=\"string\">\"application/x-www-form-urlencoded; charset=utf-8\"</span>,forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样就很尴尬了。在Google搜了半天，也没找到类似的问题。于是问了我一个经常抓包的哥们，他说GB2312编码的服务器遇到的次数非常少。再加上本来用swift模拟请求的场景就不多了，难怪没同样的问题呢。试了很久，我都准备鸣金收兵了。</p>\n<h1 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h1><p>后来问了学长这个问题，他说可以自定义Alamofire的request，在request中进行参数的GB2312编码或许可以。于是带着最后一丝希望去试了一下，发现学长真行🤗。</p>\n<p>自定义Alamofire的request代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"type\">GB2312Encoding</span> = <span class=\"type\">CFStringConvertEncodingToNSStringEncoding</span>(<span class=\"number\">0x0632</span>)</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">urlRequestWithComponents</span><span class=\"params\">(urlString:String,parameters:[String: AnyObject])</span></span> -&gt;(<span class=\"type\">URLRequestConvertible</span>,<span class=\"type\">NSData</span>) &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// create  url request to send</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mutableURLRequest = <span class=\"type\">NSMutableURLRequest</span>(<span class=\"type\">URL</span>: <span class=\"type\">NSURL</span>(string: urlString)!)</span><br><span class=\"line\">    mutableURLRequest.<span class=\"type\">HTTPMethod</span> = <span class=\"type\">Alamofire</span>.<span class=\"type\">Method</span>.<span class=\"type\">POST</span>.rawValue</span><br><span class=\"line\">    <span class=\"keyword\">let</span> contentType = <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">    mutableURLRequest.setValue(contentType, forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span>)</span><br><span class=\"line\">    mutableURLRequest.setValue(<span class=\"string\">\"*******\"</span>, forHTTPHeaderField: <span class=\"string\">\"Referer\"</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// add parameters</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> uploadData = <span class=\"type\">NSMutableData</span>()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (key,value) <span class=\"keyword\">in</span> parameters &#123;</span><br><span class=\"line\">        uploadData.appendData(<span class=\"string\">\"\\(key)=\\(value)&amp;\"</span>.dataUsingEncoding(<span class=\"type\">GB2312Encoding</span>)!)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"type\">Alamofire</span>.<span class=\"type\">ParameterEncoding</span>.<span class=\"type\">URL</span>.encode(mutableURLRequest, parameters: <span class=\"literal\">nil</span>).<span class=\"number\">0</span>,uploadData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>调用该自定义Request的方法如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> urlRequest = urlRequestWithComponents(<span class=\"type\">SchoolNetWorkBaseURL</span>, parameters: parameters)</span><br><span class=\"line\"><span class=\"type\">Alamofire</span>.upload(urlRequest.<span class=\"number\">0</span>, data: urlRequest.<span class=\"number\">1</span>).response &#123;</span><br><span class=\"line\">    request, response, data, error <span class=\"keyword\">in</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通过这个，就可以实现使用Alamofire实现GB2312编码的请求了。</p>\n<h1 id=\"番外篇：关于使用Alamofire实现gzip压缩参数的网络请求\"><a href=\"#番外篇：关于使用Alamofire实现gzip压缩参数的网络请求\" class=\"headerlink\" title=\"番外篇：关于使用Alamofire实现gzip压缩参数的网络请求\"></a>番外篇：关于使用Alamofire实现gzip压缩参数的网络请求</h1><p>在解决上面的问题时，我一度偏失了方向，以为是参数没有压缩的问题。下面记录一下gzip压缩的参数问题。</p>\n<p>下面是对ParameterEncoding的扩展，Alamofire在请求的request的encoding中，选择ParameterEncoding.gzipped即可。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//  ParameterEncoding-Extension.swift</span></span><br><span class=\"line\"><span class=\"comment\">//  AHNUer</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//  Created by 黄帅 on 16/7/28.</span></span><br><span class=\"line\"><span class=\"comment\">//  Copyright © 2016年 帅帅. All rights reserved.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> Foundation</span><br><span class=\"line\"><span class=\"keyword\">import</span> Alamofire</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Actual gzipping from https://github.com/1024jp/NSData-GZIP</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Example: ParameterEncoding.JSON.gzipped</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">infix</span> <span class=\"keyword\">operator</span> • &#123; <span class=\"keyword\">associativity</span> <span class=\"keyword\">left</span> &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> • &lt;A, B, C&gt;<span class=\"params\">(f: B -&gt; C, g: A -&gt; B)</span></span> -&gt; <span class=\"type\">A</span> -&gt; <span class=\"type\">C</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123; x <span class=\"keyword\">in</span> f(g(x)) &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">ParameterEncoding</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> gzipped:<span class=\"type\">ParameterEncoding</span> &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> gzip(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">gzip</span><span class=\"params\">(encoding:ParameterEncoding)</span></span> -&gt; <span class=\"type\">ParameterEncoding</span> &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> gzipEncoding = <span class=\"keyword\">self</span>.gzipOrError • encoding.encode</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">ParameterEncoding</span>.<span class=\"type\">Custom</span>(gzipEncoding)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">gzipOrError</span><span class=\"params\">(request:NSURLRequest, error:NSError?)</span></span> -&gt; (<span class=\"type\">NSMutableURLRequest</span>, <span class=\"type\">NSError?</span>) &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> mutableRequest = request.mutableCopy() <span class=\"keyword\">as</span>! <span class=\"type\">NSMutableURLRequest</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> error != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (mutableRequest, error)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> gzipEncodingError: <span class=\"type\">NSError?</span> = <span class=\"literal\">nil</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> gzippedData = <span class=\"keyword\">try</span> mutableRequest.<span class=\"type\">HTTPBody?</span>.gzippedData()</span><br><span class=\"line\">            mutableRequest.<span class=\"type\">HTTPBody</span> = gzippedData</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> mutableRequest.<span class=\"type\">HTTPBody</span> != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">                mutableRequest.setValue(<span class=\"string\">\"gzip\"</span>, forHTTPHeaderField: <span class=\"string\">\"Content-Encoding\"</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\">            gzipEncodingError = error <span class=\"keyword\">as</span> <span class=\"type\">NSError</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> (mutableRequest, gzipEncodingError)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://www.hangge.com/blog/cache/detail_1032.html\" target=\"_blank\" rel=\"noopener\">Swift - 使用gzip压缩NSData数据</a></li>\n<li><a href=\"https://gist.github.com/blender/923f1c1de2f00514ed12\" target=\"_blank\" rel=\"noopener\">blender/ParameterEncodingExt</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>最近在做一个校园工具，其中有个功能是查看自己校园网账户的剩余流量。学校的网络管理中心没有开放接口，于是只能利用Alamofire来模拟登录解析数据。一开始通过GET请求获取用户账户余额都是没有问题的，但是通过POST请求的话，就无法正确访问数据。</p>\n<h1 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h1><p>之前知道该网站是GB2312编码的，于是在解析data为HTML的时候就用GB2312解码的。但在POST数据时，也需要GB2312编码。我开始时将post的string参数用GB2312编码，发现不行。于是就查看了Alamofire的源码，发现其默认的参数编码是UTF-8，而且只有这一个选择😂。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> mutableURLRequest.valueForHTTPHeaderField(<span class=\"string\">\"Content-Type\"</span>) == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    mutableURLRequest.setValue(<span class=\"string\">\"application/x-www-form-urlencoded; charset=utf-8\"</span>,forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样就很尴尬了。在Google搜了半天，也没找到类似的问题。于是问了我一个经常抓包的哥们，他说GB2312编码的服务器遇到的次数非常少。再加上本来用swift模拟请求的场景就不多了，难怪没同样的问题呢。试了很久，我都准备鸣金收兵了。</p>\n<h1 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h1><p>后来问了学长这个问题，他说可以自定义Alamofire的request，在request中进行参数的GB2312编码或许可以。于是带着最后一丝希望去试了一下，发现学长真行🤗。</p>\n<p>自定义Alamofire的request代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"type\">GB2312Encoding</span> = <span class=\"type\">CFStringConvertEncodingToNSStringEncoding</span>(<span class=\"number\">0x0632</span>)</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">urlRequestWithComponents</span><span class=\"params\">(urlString:String,parameters:[String: AnyObject])</span></span> -&gt;(<span class=\"type\">URLRequestConvertible</span>,<span class=\"type\">NSData</span>) &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// create  url request to send</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mutableURLRequest = <span class=\"type\">NSMutableURLRequest</span>(<span class=\"type\">URL</span>: <span class=\"type\">NSURL</span>(string: urlString)!)</span><br><span class=\"line\">    mutableURLRequest.<span class=\"type\">HTTPMethod</span> = <span class=\"type\">Alamofire</span>.<span class=\"type\">Method</span>.<span class=\"type\">POST</span>.rawValue</span><br><span class=\"line\">    <span class=\"keyword\">let</span> contentType = <span class=\"string\">\"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">    mutableURLRequest.setValue(contentType, forHTTPHeaderField: <span class=\"string\">\"Content-Type\"</span>)</span><br><span class=\"line\">    mutableURLRequest.setValue(<span class=\"string\">\"*******\"</span>, forHTTPHeaderField: <span class=\"string\">\"Referer\"</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// add parameters</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> uploadData = <span class=\"type\">NSMutableData</span>()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (key,value) <span class=\"keyword\">in</span> parameters &#123;</span><br><span class=\"line\">        uploadData.appendData(<span class=\"string\">\"\\(key)=\\(value)&amp;\"</span>.dataUsingEncoding(<span class=\"type\">GB2312Encoding</span>)!)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"type\">Alamofire</span>.<span class=\"type\">ParameterEncoding</span>.<span class=\"type\">URL</span>.encode(mutableURLRequest, parameters: <span class=\"literal\">nil</span>).<span class=\"number\">0</span>,uploadData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>调用该自定义Request的方法如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> urlRequest = urlRequestWithComponents(<span class=\"type\">SchoolNetWorkBaseURL</span>, parameters: parameters)</span><br><span class=\"line\"><span class=\"type\">Alamofire</span>.upload(urlRequest.<span class=\"number\">0</span>, data: urlRequest.<span class=\"number\">1</span>).response &#123;</span><br><span class=\"line\">    request, response, data, error <span class=\"keyword\">in</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通过这个，就可以实现使用Alamofire实现GB2312编码的请求了。</p>\n<h1 id=\"番外篇：关于使用Alamofire实现gzip压缩参数的网络请求\"><a href=\"#番外篇：关于使用Alamofire实现gzip压缩参数的网络请求\" class=\"headerlink\" title=\"番外篇：关于使用Alamofire实现gzip压缩参数的网络请求\"></a>番外篇：关于使用Alamofire实现gzip压缩参数的网络请求</h1><p>在解决上面的问题时，我一度偏失了方向，以为是参数没有压缩的问题。下面记录一下gzip压缩的参数问题。</p>\n<p>下面是对ParameterEncoding的扩展，Alamofire在请求的request的encoding中，选择ParameterEncoding.gzipped即可。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//  ParameterEncoding-Extension.swift</span></span><br><span class=\"line\"><span class=\"comment\">//  AHNUer</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//  Created by 黄帅 on 16/7/28.</span></span><br><span class=\"line\"><span class=\"comment\">//  Copyright © 2016年 帅帅. All rights reserved.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> Foundation</span><br><span class=\"line\"><span class=\"keyword\">import</span> Alamofire</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Actual gzipping from https://github.com/1024jp/NSData-GZIP</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Example: ParameterEncoding.JSON.gzipped</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">infix</span> <span class=\"keyword\">operator</span> • &#123; <span class=\"keyword\">associativity</span> <span class=\"keyword\">left</span> &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> • &lt;A, B, C&gt;<span class=\"params\">(f: B -&gt; C, g: A -&gt; B)</span></span> -&gt; <span class=\"type\">A</span> -&gt; <span class=\"type\">C</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123; x <span class=\"keyword\">in</span> f(g(x)) &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">ParameterEncoding</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> gzipped:<span class=\"type\">ParameterEncoding</span> &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> gzip(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">gzip</span><span class=\"params\">(encoding:ParameterEncoding)</span></span> -&gt; <span class=\"type\">ParameterEncoding</span> &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> gzipEncoding = <span class=\"keyword\">self</span>.gzipOrError • encoding.encode</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">ParameterEncoding</span>.<span class=\"type\">Custom</span>(gzipEncoding)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">gzipOrError</span><span class=\"params\">(request:NSURLRequest, error:NSError?)</span></span> -&gt; (<span class=\"type\">NSMutableURLRequest</span>, <span class=\"type\">NSError?</span>) &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> mutableRequest = request.mutableCopy() <span class=\"keyword\">as</span>! <span class=\"type\">NSMutableURLRequest</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> error != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (mutableRequest, error)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> gzipEncodingError: <span class=\"type\">NSError?</span> = <span class=\"literal\">nil</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> gzippedData = <span class=\"keyword\">try</span> mutableRequest.<span class=\"type\">HTTPBody?</span>.gzippedData()</span><br><span class=\"line\">            mutableRequest.<span class=\"type\">HTTPBody</span> = gzippedData</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> mutableRequest.<span class=\"type\">HTTPBody</span> != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">                mutableRequest.setValue(<span class=\"string\">\"gzip\"</span>, forHTTPHeaderField: <span class=\"string\">\"Content-Encoding\"</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\">            gzipEncodingError = error <span class=\"keyword\">as</span> <span class=\"type\">NSError</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> (mutableRequest, gzipEncodingError)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"http://www.hangge.com/blog/cache/detail_1032.html\" target=\"_blank\" rel=\"noopener\">Swift - 使用gzip压缩NSData数据</a></li>\n<li><a href=\"https://gist.github.com/blender/923f1c1de2f00514ed12\" target=\"_blank\" rel=\"noopener\">blender/ParameterEncodingExt</a></li>\n</ul>\n"},{"title":"博文的开始","date":"2015-10-19T02:38:15.000Z","_content":"\n起这个题目，是向我一个学长[致敬](http://blog.csdn.net/decting/article/details/8062457)。\n\n今天是2015年元旦，照这样说来就算是去年，我认识了这个学长。当初是请教学长安卓问题，然后由于时间问题直接到学长寝室请他帮忙调程序。说真的，看着高手调程序真的能学到太多，他们解决问题的思路和方法真的很值得我们去学习，我记得当时学会了用Log.i(\"\",\"\")来跟踪程序运行状况。\n\n   进入大学三年了，期间从网上学习了很多东西，一直以来我只是有一个互联网内容消费者，没有创造过什么。CSDN的账号创建很久了，每次看到技术牛人写的关于各类问题的解决方法以及他们自身对于问题的思考，就非常的崇拜以及感谢他们的付出。经常在看完他们的技术博客之后，在想自己是不是也能写一点什么，就像知乎说的那样，与世界分享你的知识和见解，然而一拖就拖到现在。其实，原来也真的什么都不会，没得内容来与大家分享。渐渐的我也做了一些项目，成为了学弟们的学长，我想我也应该把自己遇到问题的一些解决方法和对这些方法的思考写出来，而不是只记录在我自己的OneNote里面。\n\n   我是物联网专业学生，所开发的一些也都是软硬件结合的项目，我会在此与大家分享经验。\n\n   好了，那这第一篇文章就作为我新阶段的开始，2015年我会准备考研，因此会对相关的科目进行复习与总结，我也会在此记录我考研路上对于专业相关问题的感悟。\n   最后，从学长那抄一句：\n\n   >我们的目标是没有遗憾。\n\n   ------\n\n   以上是我在2015年1月1日在CSDN上写的第一篇博文，\n\n   当时已值大三，开博的目的是可以分享一些项目经验以及记录一下考研备战路上的点点滴滴。可惜当时准备考研，后期在写过一篇《Android-Lint使用后的错误解决》之后便停滞项目开发了，后来到了五月份，我放弃了考研，一心想着就业，于是暑期开始便一直在北京一家物联网公司实习，时间飞快，有些事情却偏偏以它奇怪的姿势改变我的轨迹，比如：我保研了。\n\n   前段时间把公司一个产品的iOS客户端写好，然后从注册开发者账号开始到最后弄上App Store，至此我也算一个iOS开发菜鸟了，哈哈。上周把MongoDB项目暂时完成了，经理儿子出世回家去了，所以这几天也没有人给我安排工作，在网上瞎逛的时候，突然想起来今年第一天给自己安排的任务，于是花了一上午学习Markdown和Github Page以及jekyll。\n\n   我想在未来的日子里，我应该做点什么了，逝者如斯夫，应该把生活过的像自己想要的那样，才对嘛。\n\n\n","source":"_posts/博文的开始.md","raw":"---\ntitle: 博文的开始\ndate: 2015-10-19 10:38:15\ntags: \n- 总结\ncategories:\n- 总结\n---\n\n起这个题目，是向我一个学长[致敬](http://blog.csdn.net/decting/article/details/8062457)。\n\n今天是2015年元旦，照这样说来就算是去年，我认识了这个学长。当初是请教学长安卓问题，然后由于时间问题直接到学长寝室请他帮忙调程序。说真的，看着高手调程序真的能学到太多，他们解决问题的思路和方法真的很值得我们去学习，我记得当时学会了用Log.i(\"\",\"\")来跟踪程序运行状况。\n\n   进入大学三年了，期间从网上学习了很多东西，一直以来我只是有一个互联网内容消费者，没有创造过什么。CSDN的账号创建很久了，每次看到技术牛人写的关于各类问题的解决方法以及他们自身对于问题的思考，就非常的崇拜以及感谢他们的付出。经常在看完他们的技术博客之后，在想自己是不是也能写一点什么，就像知乎说的那样，与世界分享你的知识和见解，然而一拖就拖到现在。其实，原来也真的什么都不会，没得内容来与大家分享。渐渐的我也做了一些项目，成为了学弟们的学长，我想我也应该把自己遇到问题的一些解决方法和对这些方法的思考写出来，而不是只记录在我自己的OneNote里面。\n\n   我是物联网专业学生，所开发的一些也都是软硬件结合的项目，我会在此与大家分享经验。\n\n   好了，那这第一篇文章就作为我新阶段的开始，2015年我会准备考研，因此会对相关的科目进行复习与总结，我也会在此记录我考研路上对于专业相关问题的感悟。\n   最后，从学长那抄一句：\n\n   >我们的目标是没有遗憾。\n\n   ------\n\n   以上是我在2015年1月1日在CSDN上写的第一篇博文，\n\n   当时已值大三，开博的目的是可以分享一些项目经验以及记录一下考研备战路上的点点滴滴。可惜当时准备考研，后期在写过一篇《Android-Lint使用后的错误解决》之后便停滞项目开发了，后来到了五月份，我放弃了考研，一心想着就业，于是暑期开始便一直在北京一家物联网公司实习，时间飞快，有些事情却偏偏以它奇怪的姿势改变我的轨迹，比如：我保研了。\n\n   前段时间把公司一个产品的iOS客户端写好，然后从注册开发者账号开始到最后弄上App Store，至此我也算一个iOS开发菜鸟了，哈哈。上周把MongoDB项目暂时完成了，经理儿子出世回家去了，所以这几天也没有人给我安排工作，在网上瞎逛的时候，突然想起来今年第一天给自己安排的任务，于是花了一上午学习Markdown和Github Page以及jekyll。\n\n   我想在未来的日子里，我应该做点什么了，逝者如斯夫，应该把生活过的像自己想要的那样，才对嘛。\n\n\n","slug":"博文的开始","published":1,"updated":"2019-06-16T15:37:13.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkbg000owq1kbkjbyg83","content":"<p>起这个题目，是向我一个学长<a href=\"http://blog.csdn.net/decting/article/details/8062457\" target=\"_blank\" rel=\"noopener\">致敬</a>。</p>\n<p>今天是2015年元旦，照这样说来就算是去年，我认识了这个学长。当初是请教学长安卓问题，然后由于时间问题直接到学长寝室请他帮忙调程序。说真的，看着高手调程序真的能学到太多，他们解决问题的思路和方法真的很值得我们去学习，我记得当时学会了用Log.i(“”,””)来跟踪程序运行状况。</p>\n<p>   进入大学三年了，期间从网上学习了很多东西，一直以来我只是有一个互联网内容消费者，没有创造过什么。CSDN的账号创建很久了，每次看到技术牛人写的关于各类问题的解决方法以及他们自身对于问题的思考，就非常的崇拜以及感谢他们的付出。经常在看完他们的技术博客之后，在想自己是不是也能写一点什么，就像知乎说的那样，与世界分享你的知识和见解，然而一拖就拖到现在。其实，原来也真的什么都不会，没得内容来与大家分享。渐渐的我也做了一些项目，成为了学弟们的学长，我想我也应该把自己遇到问题的一些解决方法和对这些方法的思考写出来，而不是只记录在我自己的OneNote里面。</p>\n<p>   我是物联网专业学生，所开发的一些也都是软硬件结合的项目，我会在此与大家分享经验。</p>\n<p>   好了，那这第一篇文章就作为我新阶段的开始，2015年我会准备考研，因此会对相关的科目进行复习与总结，我也会在此记录我考研路上对于专业相关问题的感悟。<br>   最后，从学长那抄一句：</p>\n<blockquote>\n<p>我们的目标是没有遗憾。</p>\n</blockquote>\n<hr>\n<p>   以上是我在2015年1月1日在CSDN上写的第一篇博文，</p>\n<p>   当时已值大三，开博的目的是可以分享一些项目经验以及记录一下考研备战路上的点点滴滴。可惜当时准备考研，后期在写过一篇《Android-Lint使用后的错误解决》之后便停滞项目开发了，后来到了五月份，我放弃了考研，一心想着就业，于是暑期开始便一直在北京一家物联网公司实习，时间飞快，有些事情却偏偏以它奇怪的姿势改变我的轨迹，比如：我保研了。</p>\n<p>   前段时间把公司一个产品的iOS客户端写好，然后从注册开发者账号开始到最后弄上App Store，至此我也算一个iOS开发菜鸟了，哈哈。上周把MongoDB项目暂时完成了，经理儿子出世回家去了，所以这几天也没有人给我安排工作，在网上瞎逛的时候，突然想起来今年第一天给自己安排的任务，于是花了一上午学习Markdown和Github Page以及jekyll。</p>\n<p>   我想在未来的日子里，我应该做点什么了，逝者如斯夫，应该把生活过的像自己想要的那样，才对嘛。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>起这个题目，是向我一个学长<a href=\"http://blog.csdn.net/decting/article/details/8062457\" target=\"_blank\" rel=\"noopener\">致敬</a>。</p>\n<p>今天是2015年元旦，照这样说来就算是去年，我认识了这个学长。当初是请教学长安卓问题，然后由于时间问题直接到学长寝室请他帮忙调程序。说真的，看着高手调程序真的能学到太多，他们解决问题的思路和方法真的很值得我们去学习，我记得当时学会了用Log.i(“”,””)来跟踪程序运行状况。</p>\n<p>   进入大学三年了，期间从网上学习了很多东西，一直以来我只是有一个互联网内容消费者，没有创造过什么。CSDN的账号创建很久了，每次看到技术牛人写的关于各类问题的解决方法以及他们自身对于问题的思考，就非常的崇拜以及感谢他们的付出。经常在看完他们的技术博客之后，在想自己是不是也能写一点什么，就像知乎说的那样，与世界分享你的知识和见解，然而一拖就拖到现在。其实，原来也真的什么都不会，没得内容来与大家分享。渐渐的我也做了一些项目，成为了学弟们的学长，我想我也应该把自己遇到问题的一些解决方法和对这些方法的思考写出来，而不是只记录在我自己的OneNote里面。</p>\n<p>   我是物联网专业学生，所开发的一些也都是软硬件结合的项目，我会在此与大家分享经验。</p>\n<p>   好了，那这第一篇文章就作为我新阶段的开始，2015年我会准备考研，因此会对相关的科目进行复习与总结，我也会在此记录我考研路上对于专业相关问题的感悟。<br>   最后，从学长那抄一句：</p>\n<blockquote>\n<p>我们的目标是没有遗憾。</p>\n</blockquote>\n<hr>\n<p>   以上是我在2015年1月1日在CSDN上写的第一篇博文，</p>\n<p>   当时已值大三，开博的目的是可以分享一些项目经验以及记录一下考研备战路上的点点滴滴。可惜当时准备考研，后期在写过一篇《Android-Lint使用后的错误解决》之后便停滞项目开发了，后来到了五月份，我放弃了考研，一心想着就业，于是暑期开始便一直在北京一家物联网公司实习，时间飞快，有些事情却偏偏以它奇怪的姿势改变我的轨迹，比如：我保研了。</p>\n<p>   前段时间把公司一个产品的iOS客户端写好，然后从注册开发者账号开始到最后弄上App Store，至此我也算一个iOS开发菜鸟了，哈哈。上周把MongoDB项目暂时完成了，经理儿子出世回家去了，所以这几天也没有人给我安排工作，在网上瞎逛的时候，突然想起来今年第一天给自己安排的任务，于是花了一上午学习Markdown和Github Page以及jekyll。</p>\n<p>   我想在未来的日子里，我应该做点什么了，逝者如斯夫，应该把生活过的像自己想要的那样，才对嘛。</p>\n"},{"title":"Android:阿里百川、友盟推送SDK集成问题","date":"2015-12-07T07:50:15.000Z","_content":"## 前言\n\n我在安卓项目中先集成了阿里百川即时通讯的SDK，后又集成友盟的消息推送SDK，项目编译的时候就会报以下错误。\n\n```java\nMultiple dex files define Lcom/ta/utdid2/android/utils/UTDID\n```\n\n报错说的很清楚:是项目引用的JAR包有重复的地方。后发现集成阿里系的SDK（支付宝等）都会出现此错误。\n\n## 错误原因\n\n1.友盟推送SDK为了提高设备标识的唯一性，除了UMID之外，还用到了Taobao提供的一个设备标识生成库(UTDID.jar)做双向保证。当前推送SDK兼容的UDID版本是V1.1.0。\n\n2.淘宝提供的设备标识生成库(UTDID.jar)已经广泛应用在阿里系的App中了，包括支付宝。部分集成过支付宝SDK的App，在集成友盟推送SDK的时候，会存在包冲突的问题。 为此我们提供了去UTDID版本的SDK供开发者集成使用\n\n## 解决方法\n\n1.到友盟[SDK下载页](http://dev.umeng.com/push/android/sdk-download)去下载去UTDID版本的SDK，再集成到安卓项目中\n\n\n","source":"_posts/阿里百川、友盟推送SDK集成.md","raw":"---\ntitle: Android:阿里百川、友盟推送SDK集成问题\ndate: 2015-12-07 15:50:15\ntags:\n- Android\n- 阿里百川\n- 友盟推送\ncategories:\n- 开发\n- iOS\n---\n## 前言\n\n我在安卓项目中先集成了阿里百川即时通讯的SDK，后又集成友盟的消息推送SDK，项目编译的时候就会报以下错误。\n\n```java\nMultiple dex files define Lcom/ta/utdid2/android/utils/UTDID\n```\n\n报错说的很清楚:是项目引用的JAR包有重复的地方。后发现集成阿里系的SDK（支付宝等）都会出现此错误。\n\n## 错误原因\n\n1.友盟推送SDK为了提高设备标识的唯一性，除了UMID之外，还用到了Taobao提供的一个设备标识生成库(UTDID.jar)做双向保证。当前推送SDK兼容的UDID版本是V1.1.0。\n\n2.淘宝提供的设备标识生成库(UTDID.jar)已经广泛应用在阿里系的App中了，包括支付宝。部分集成过支付宝SDK的App，在集成友盟推送SDK的时候，会存在包冲突的问题。 为此我们提供了去UTDID版本的SDK供开发者集成使用\n\n## 解决方法\n\n1.到友盟[SDK下载页](http://dev.umeng.com/push/android/sdk-download)去下载去UTDID版本的SDK，再集成到安卓项目中\n\n\n","slug":"阿里百川、友盟推送SDK集成","published":1,"updated":"2019-06-16T15:37:13.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkbh000qwq1k8do3y9a0","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>我在安卓项目中先集成了阿里百川即时通讯的SDK，后又集成友盟的消息推送SDK，项目编译的时候就会报以下错误。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Multiple dex files define Lcom/ta/utdid2/android/utils/UTDID</span><br></pre></td></tr></table></figure>\n\n<p>报错说的很清楚:是项目引用的JAR包有重复的地方。后发现集成阿里系的SDK（支付宝等）都会出现此错误。</p>\n<h2 id=\"错误原因\"><a href=\"#错误原因\" class=\"headerlink\" title=\"错误原因\"></a>错误原因</h2><p>1.友盟推送SDK为了提高设备标识的唯一性，除了UMID之外，还用到了Taobao提供的一个设备标识生成库(UTDID.jar)做双向保证。当前推送SDK兼容的UDID版本是V1.1.0。</p>\n<p>2.淘宝提供的设备标识生成库(UTDID.jar)已经广泛应用在阿里系的App中了，包括支付宝。部分集成过支付宝SDK的App，在集成友盟推送SDK的时候，会存在包冲突的问题。 为此我们提供了去UTDID版本的SDK供开发者集成使用</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>1.到友盟<a href=\"http://dev.umeng.com/push/android/sdk-download\" target=\"_blank\" rel=\"noopener\">SDK下载页</a>去下载去UTDID版本的SDK，再集成到安卓项目中</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>我在安卓项目中先集成了阿里百川即时通讯的SDK，后又集成友盟的消息推送SDK，项目编译的时候就会报以下错误。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Multiple dex files define Lcom/ta/utdid2/android/utils/UTDID</span><br></pre></td></tr></table></figure>\n\n<p>报错说的很清楚:是项目引用的JAR包有重复的地方。后发现集成阿里系的SDK（支付宝等）都会出现此错误。</p>\n<h2 id=\"错误原因\"><a href=\"#错误原因\" class=\"headerlink\" title=\"错误原因\"></a>错误原因</h2><p>1.友盟推送SDK为了提高设备标识的唯一性，除了UMID之外，还用到了Taobao提供的一个设备标识生成库(UTDID.jar)做双向保证。当前推送SDK兼容的UDID版本是V1.1.0。</p>\n<p>2.淘宝提供的设备标识生成库(UTDID.jar)已经广泛应用在阿里系的App中了，包括支付宝。部分集成过支付宝SDK的App，在集成友盟推送SDK的时候，会存在包冲突的问题。 为此我们提供了去UTDID版本的SDK供开发者集成使用</p>\n<h2 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h2><p>1.到友盟<a href=\"http://dev.umeng.com/push/android/sdk-download\" target=\"_blank\" rel=\"noopener\">SDK下载页</a>去下载去UTDID版本的SDK，再集成到安卓项目中</p>\n"},{"title":"阿里百川用户反馈Swift开发小结","date":"2016-12-29T11:41:25.000Z","_content":"\n## 背景\n\n所有的App都需要给用户一个反馈意见的功能，这样才能让用户使用的更好更方便。不想自己写这一套组件，因此调研了几款第三方的反馈组件。\n\n### Instabug \n九月份上架的师大助手App用的就是这个反馈组件，知乎日报用的也是这个，不管在App任何界面摇一摇就可以触发，Instabug会把当前界面进行截图并且支持用户编辑，非常方便好用的组件，这个用来反馈bug我觉得非常好用，但是作为反馈意见的话，感觉还是缺少一个入口。另外，Instabug采集Bug还是非常准确的。\n\n### LeanCloud\nLeanCloud的反馈组件号称两行代码接入，非常方便，它做成一个对话框的形式，客服与用户可以进行交流，并且用户的反馈可以及时发给开发人员的LeanCloud 手机客户端，实时性非常高。\n\n### 阿里百川\n一年之前开发的app用了阿里百川（阿里巴巴无限开放平台）的即时通讯功能，当时阿里巴巴刚把友盟这些公司收购，阿里巴巴无线开放平台还没有现在这么多功能，一年过去了，现在的功能已经非常多了。今天看用户反馈功能时，看到了他们的2.0版本的反馈组件，觉得这种加入了常见反馈问题这一页特别好，用户在反馈之前，可以先自行查看相似问题的解答。并且，相似问题的解答是可以实时在后台添加修改，这极大方便了用户。\n\n于是就暂定了使用阿里百川，于是进行了接入的技术验证。先看一下效果图：\n<div id=\"tt\" style=\"display: inline-block;\">\n       <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Baichuan_1.PNG\" width=\"50%\" height=\"25%\" />\n       <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Baichuan_2.PNG\" width=\"50%\" height=\"25%\" />\n</div>\n\n## 步骤\n### Part1 阿里百川平台注册\n这里按照官方的接入流程就可以很容易完成了，就不赘述了。\n\n### Part2 用户反馈SDK导入\n我选择使用的是专业版2.0，SDK用的是Cocoapods安装方式，在Podfile添加阿里的私有源。\n\n```swift\nsource 'http://repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecs.git'\nsource 'http://repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecsMirror.git'\ntarget 'YourTargetName' do\n    pod 'YWFeedbackFMWK', '~> 2.0.3.1'\nend\n```\n\n接着使用 `pod install` 安装出现了一个问题，就是我之前用的 Alamofire 等其他很多组件安装不了，出现需要更新的问题，我这里猜测 AliBCSpecsMirror 和 CocoaPods/Specs 有一些差异，弄了一会索性直接在上面再添加 CocoaPods 的仓库，`source 'https://github.com/CocoaPods/Specs.git'`, 这样就能同时安装YWFeedbackFMWK和我之前的其他组件了，但是又会出现repo仓库有两份的warning，这个还没解决好，我考完试再找找解决方法。\n\n注意： Cocoapods集成方式不需要手动添加依赖系统库\n\n修改编译选项：\n在Target->Linking->Other Linker Flags中添加-ObjC选项。\n\niOS 10中隐私权限设置：\n如果不做设置，可能会导致崩溃、审核不通过等情况。需要在info plist中增加字段：\n``` xml\n<key>NSCameraUsageDescription</key>\n<string>访问相机</string>\n<key>NSPhotoLibraryUsageDescription</key>\n<string>访问相册</string>\n```\n### Part3 初始化SDK，打开反馈页面\n1. 在桥接头文件中加入：\n\n``` swift\n#import <YWFeedbackFMWK/YWFeedbackKit.h>\n#import <YWFeedbackFMWK/YWFeedbackViewController.h>\n```\n\n2. 调用初始化方法：\n\n``` swift\nvar bcKit = BCFeedbackKit(appKey: \"自己的appkey\")\n```\n**注意：**这里需要将在阿里百川后台生成的安全图片添加进项目目录中\n\n3. 设置业务方扩展的反馈数据：\n相当于给反馈信息中加入反馈用户的个人信息，可设置任意字段，在创建反馈页面前设置，可在后台扩展信息中查看。\n\n``` swift\nbcKit.extInfo = [\"username\":\"自己app用户体系中的用户id\"]\n```\n\n4. 打开反馈页面：\n5. \n``` swift\nbcKit.makeFeedbackViewController(completionBlock: { (feedbackVC, error) in\n    if let vc = feedbackVC {\n    // 当用户关闭用户反馈，将调用该block进行dismiss或pop\n        vc.closeBlock = {(aParentController) in\n            aParentController?.navigationController?.popViewController(animated: false)\n        }\n        \n        self.navigationController?.isNavigationBarHidden = false        \n        self.navigationController?.pushViewController(vc, animated: false)\n    }\n})\n```\n\n这样就完成了在app中加入反馈页面的添加。\n\n### Part4 阿里百川控制台配置反馈组件\n在阿里百川用户反馈后台，可以在App内反馈中查看用户发送的反馈信息，还可以在Mobile客户端配置中自定义配置app中反馈页面的UI。这是我觉得的该产品的亮点所在，可以实时配置热门问题，减去了在app开发时需要考虑的动态获取生成热门问题的过程，而且整个appUI全都实时动态设置。具体操作大家用一下就很容易了解了。\n\n## 思考\n通过使用阿里百川用户反馈组件，我又一次看到了H5的用途。对于这类弱使用强度、高数据变更、低页面逻辑的页面，我觉得H5的用途大大体现了，虽然讲这样的一个反馈的原生页面以及一套后台处理系统没有什么技术实现上的困难点，但是对于大部分app开发来讲，还是需要消耗时间精力来做的，更重要的是这不是用户使用app的刚需，因此这种即插即用可服务端实时配置的H5反馈页面的出现恰到好处。\n\n## 番外篇\npush 百川 feedbackVC 的时候，因此 NavigationBar 部分会黑一下再显示。很奇怪的是我如果在 push之前 navigationController 隐藏了 NavigationBar ，这个 feedbackVC 就没有了 NavigationBar。反馈页面其实就是一个 webView，因此我没有搞懂为什么 navigationController 的NavigationBar 显示与否会影响一个 webView 里面 H5 页面的 NavigationBar 显示。这个问题我得再研究研究。\n\n\n\n","source":"_posts/阿里百川用户反馈Swift开发小结.md","raw":"---\ntitle: 阿里百川用户反馈Swift开发小结\ndate: 2016-12-29 19:41:25\ntags:\n- Swift  \n- 阿里百川\n- 用户反馈\ncategories:\n- 开发\n- iOS\n---\n\n## 背景\n\n所有的App都需要给用户一个反馈意见的功能，这样才能让用户使用的更好更方便。不想自己写这一套组件，因此调研了几款第三方的反馈组件。\n\n### Instabug \n九月份上架的师大助手App用的就是这个反馈组件，知乎日报用的也是这个，不管在App任何界面摇一摇就可以触发，Instabug会把当前界面进行截图并且支持用户编辑，非常方便好用的组件，这个用来反馈bug我觉得非常好用，但是作为反馈意见的话，感觉还是缺少一个入口。另外，Instabug采集Bug还是非常准确的。\n\n### LeanCloud\nLeanCloud的反馈组件号称两行代码接入，非常方便，它做成一个对话框的形式，客服与用户可以进行交流，并且用户的反馈可以及时发给开发人员的LeanCloud 手机客户端，实时性非常高。\n\n### 阿里百川\n一年之前开发的app用了阿里百川（阿里巴巴无限开放平台）的即时通讯功能，当时阿里巴巴刚把友盟这些公司收购，阿里巴巴无线开放平台还没有现在这么多功能，一年过去了，现在的功能已经非常多了。今天看用户反馈功能时，看到了他们的2.0版本的反馈组件，觉得这种加入了常见反馈问题这一页特别好，用户在反馈之前，可以先自行查看相似问题的解答。并且，相似问题的解答是可以实时在后台添加修改，这极大方便了用户。\n\n于是就暂定了使用阿里百川，于是进行了接入的技术验证。先看一下效果图：\n<div id=\"tt\" style=\"display: inline-block;\">\n       <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Baichuan_1.PNG\" width=\"50%\" height=\"25%\" />\n       <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Baichuan_2.PNG\" width=\"50%\" height=\"25%\" />\n</div>\n\n## 步骤\n### Part1 阿里百川平台注册\n这里按照官方的接入流程就可以很容易完成了，就不赘述了。\n\n### Part2 用户反馈SDK导入\n我选择使用的是专业版2.0，SDK用的是Cocoapods安装方式，在Podfile添加阿里的私有源。\n\n```swift\nsource 'http://repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecs.git'\nsource 'http://repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecsMirror.git'\ntarget 'YourTargetName' do\n    pod 'YWFeedbackFMWK', '~> 2.0.3.1'\nend\n```\n\n接着使用 `pod install` 安装出现了一个问题，就是我之前用的 Alamofire 等其他很多组件安装不了，出现需要更新的问题，我这里猜测 AliBCSpecsMirror 和 CocoaPods/Specs 有一些差异，弄了一会索性直接在上面再添加 CocoaPods 的仓库，`source 'https://github.com/CocoaPods/Specs.git'`, 这样就能同时安装YWFeedbackFMWK和我之前的其他组件了，但是又会出现repo仓库有两份的warning，这个还没解决好，我考完试再找找解决方法。\n\n注意： Cocoapods集成方式不需要手动添加依赖系统库\n\n修改编译选项：\n在Target->Linking->Other Linker Flags中添加-ObjC选项。\n\niOS 10中隐私权限设置：\n如果不做设置，可能会导致崩溃、审核不通过等情况。需要在info plist中增加字段：\n``` xml\n<key>NSCameraUsageDescription</key>\n<string>访问相机</string>\n<key>NSPhotoLibraryUsageDescription</key>\n<string>访问相册</string>\n```\n### Part3 初始化SDK，打开反馈页面\n1. 在桥接头文件中加入：\n\n``` swift\n#import <YWFeedbackFMWK/YWFeedbackKit.h>\n#import <YWFeedbackFMWK/YWFeedbackViewController.h>\n```\n\n2. 调用初始化方法：\n\n``` swift\nvar bcKit = BCFeedbackKit(appKey: \"自己的appkey\")\n```\n**注意：**这里需要将在阿里百川后台生成的安全图片添加进项目目录中\n\n3. 设置业务方扩展的反馈数据：\n相当于给反馈信息中加入反馈用户的个人信息，可设置任意字段，在创建反馈页面前设置，可在后台扩展信息中查看。\n\n``` swift\nbcKit.extInfo = [\"username\":\"自己app用户体系中的用户id\"]\n```\n\n4. 打开反馈页面：\n5. \n``` swift\nbcKit.makeFeedbackViewController(completionBlock: { (feedbackVC, error) in\n    if let vc = feedbackVC {\n    // 当用户关闭用户反馈，将调用该block进行dismiss或pop\n        vc.closeBlock = {(aParentController) in\n            aParentController?.navigationController?.popViewController(animated: false)\n        }\n        \n        self.navigationController?.isNavigationBarHidden = false        \n        self.navigationController?.pushViewController(vc, animated: false)\n    }\n})\n```\n\n这样就完成了在app中加入反馈页面的添加。\n\n### Part4 阿里百川控制台配置反馈组件\n在阿里百川用户反馈后台，可以在App内反馈中查看用户发送的反馈信息，还可以在Mobile客户端配置中自定义配置app中反馈页面的UI。这是我觉得的该产品的亮点所在，可以实时配置热门问题，减去了在app开发时需要考虑的动态获取生成热门问题的过程，而且整个appUI全都实时动态设置。具体操作大家用一下就很容易了解了。\n\n## 思考\n通过使用阿里百川用户反馈组件，我又一次看到了H5的用途。对于这类弱使用强度、高数据变更、低页面逻辑的页面，我觉得H5的用途大大体现了，虽然讲这样的一个反馈的原生页面以及一套后台处理系统没有什么技术实现上的困难点，但是对于大部分app开发来讲，还是需要消耗时间精力来做的，更重要的是这不是用户使用app的刚需，因此这种即插即用可服务端实时配置的H5反馈页面的出现恰到好处。\n\n## 番外篇\npush 百川 feedbackVC 的时候，因此 NavigationBar 部分会黑一下再显示。很奇怪的是我如果在 push之前 navigationController 隐藏了 NavigationBar ，这个 feedbackVC 就没有了 NavigationBar。反馈页面其实就是一个 webView，因此我没有搞懂为什么 navigationController 的NavigationBar 显示与否会影响一个 webView 里面 H5 页面的 NavigationBar 显示。这个问题我得再研究研究。\n\n\n\n","slug":"阿里百川用户反馈Swift开发小结","published":1,"updated":"2019-06-16T15:37:13.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkbi000swq1kscnqmsul","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>所有的App都需要给用户一个反馈意见的功能，这样才能让用户使用的更好更方便。不想自己写这一套组件，因此调研了几款第三方的反馈组件。</p>\n<h3 id=\"Instabug\"><a href=\"#Instabug\" class=\"headerlink\" title=\"Instabug\"></a>Instabug</h3><p>九月份上架的师大助手App用的就是这个反馈组件，知乎日报用的也是这个，不管在App任何界面摇一摇就可以触发，Instabug会把当前界面进行截图并且支持用户编辑，非常方便好用的组件，这个用来反馈bug我觉得非常好用，但是作为反馈意见的话，感觉还是缺少一个入口。另外，Instabug采集Bug还是非常准确的。</p>\n<h3 id=\"LeanCloud\"><a href=\"#LeanCloud\" class=\"headerlink\" title=\"LeanCloud\"></a>LeanCloud</h3><p>LeanCloud的反馈组件号称两行代码接入，非常方便，它做成一个对话框的形式，客服与用户可以进行交流，并且用户的反馈可以及时发给开发人员的LeanCloud 手机客户端，实时性非常高。</p>\n<h3 id=\"阿里百川\"><a href=\"#阿里百川\" class=\"headerlink\" title=\"阿里百川\"></a>阿里百川</h3><p>一年之前开发的app用了阿里百川（阿里巴巴无限开放平台）的即时通讯功能，当时阿里巴巴刚把友盟这些公司收购，阿里巴巴无线开放平台还没有现在这么多功能，一年过去了，现在的功能已经非常多了。今天看用户反馈功能时，看到了他们的2.0版本的反馈组件，觉得这种加入了常见反馈问题这一页特别好，用户在反馈之前，可以先自行查看相似问题的解答。并且，相似问题的解答是可以实时在后台添加修改，这极大方便了用户。</p>\n<p>于是就暂定了使用阿里百川，于是进行了接入的技术验证。先看一下效果图：</p>\n<div id=\"tt\" style=\"display: inline-block;\">\n       <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Baichuan_1.PNG\" width=\"50%\" height=\"25%\">\n       <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Baichuan_2.PNG\" width=\"50%\" height=\"25%\">\n</div>\n\n<h2 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h2><h3 id=\"Part1-阿里百川平台注册\"><a href=\"#Part1-阿里百川平台注册\" class=\"headerlink\" title=\"Part1 阿里百川平台注册\"></a>Part1 阿里百川平台注册</h3><p>这里按照官方的接入流程就可以很容易完成了，就不赘述了。</p>\n<h3 id=\"Part2-用户反馈SDK导入\"><a href=\"#Part2-用户反馈SDK导入\" class=\"headerlink\" title=\"Part2 用户反馈SDK导入\"></a>Part2 用户反馈SDK导入</h3><p>我选择使用的是专业版2.0，SDK用的是Cocoapods安装方式，在Podfile添加阿里的私有源。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source 'http:<span class=\"comment\">//repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecs.git'</span></span><br><span class=\"line\">source 'http:<span class=\"comment\">//repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecsMirror.git'</span></span><br><span class=\"line\">target '<span class=\"type\">YourTargetName'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    pod '<span class=\"type\">YWFeedbackFMWK'</span>, '~&gt; <span class=\"number\">2.0</span>.<span class=\"number\">3.1</span>'</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n\n<p>接着使用 <code>pod install</code> 安装出现了一个问题，就是我之前用的 Alamofire 等其他很多组件安装不了，出现需要更新的问题，我这里猜测 AliBCSpecsMirror 和 CocoaPods/Specs 有一些差异，弄了一会索性直接在上面再添加 CocoaPods 的仓库，<code>source &#39;https://github.com/CocoaPods/Specs.git&#39;</code>, 这样就能同时安装YWFeedbackFMWK和我之前的其他组件了，但是又会出现repo仓库有两份的warning，这个还没解决好，我考完试再找找解决方法。</p>\n<p>注意： Cocoapods集成方式不需要手动添加依赖系统库</p>\n<p>修改编译选项：<br>在Target-&gt;Linking-&gt;Other Linker Flags中添加-ObjC选项。</p>\n<p>iOS 10中隐私权限设置：<br>如果不做设置，可能会导致崩溃、审核不通过等情况。需要在info plist中增加字段：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>NSCameraUsageDescription<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>访问相机<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>NSPhotoLibraryUsageDescription<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>访问相册<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Part3-初始化SDK，打开反馈页面\"><a href=\"#Part3-初始化SDK，打开反馈页面\" class=\"headerlink\" title=\"Part3 初始化SDK，打开反馈页面\"></a>Part3 初始化SDK，打开反馈页面</h3><ol>\n<li>在桥接头文件中加入：</li>\n</ol>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">import</span> &lt;YWFeedbackFMWK/YWFeedbackKit.h&gt;</span><br><span class=\"line\">#<span class=\"keyword\">import</span> &lt;YWFeedbackFMWK/YWFeedbackViewController.h&gt;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>调用初始化方法：</li>\n</ol>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> bcKit = <span class=\"type\">BCFeedbackKit</span>(appKey: <span class=\"string\">\"自己的appkey\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：</strong>这里需要将在阿里百川后台生成的安全图片添加进项目目录中</p>\n<ol start=\"3\">\n<li>设置业务方扩展的反馈数据：<br>相当于给反馈信息中加入反馈用户的个人信息，可设置任意字段，在创建反馈页面前设置，可在后台扩展信息中查看。</li>\n</ol>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bcKit.extInfo = [<span class=\"string\">\"username\"</span>:<span class=\"string\">\"自己app用户体系中的用户id\"</span>]</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>打开反馈页面：</li>\n<li><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bcKit.makeFeedbackViewController(completionBlock: &#123; (feedbackVC, error) <span class=\"keyword\">in</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> vc = feedbackVC &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 当用户关闭用户反馈，将调用该block进行dismiss或pop</span></span><br><span class=\"line\">        vc.closeBlock = &#123;(aParentController) <span class=\"keyword\">in</span></span><br><span class=\"line\">            aParentController?.navigationController?.popViewController(animated: <span class=\"literal\">false</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">self</span>.navigationController?.isNavigationBarHidden = <span class=\"literal\">false</span>        </span><br><span class=\"line\">        <span class=\"keyword\">self</span>.navigationController?.pushViewController(vc, animated: <span class=\"literal\">false</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p>这样就完成了在app中加入反馈页面的添加。</p>\n<h3 id=\"Part4-阿里百川控制台配置反馈组件\"><a href=\"#Part4-阿里百川控制台配置反馈组件\" class=\"headerlink\" title=\"Part4 阿里百川控制台配置反馈组件\"></a>Part4 阿里百川控制台配置反馈组件</h3><p>在阿里百川用户反馈后台，可以在App内反馈中查看用户发送的反馈信息，还可以在Mobile客户端配置中自定义配置app中反馈页面的UI。这是我觉得的该产品的亮点所在，可以实时配置热门问题，减去了在app开发时需要考虑的动态获取生成热门问题的过程，而且整个appUI全都实时动态设置。具体操作大家用一下就很容易了解了。</p>\n<h2 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h2><p>通过使用阿里百川用户反馈组件，我又一次看到了H5的用途。对于这类弱使用强度、高数据变更、低页面逻辑的页面，我觉得H5的用途大大体现了，虽然讲这样的一个反馈的原生页面以及一套后台处理系统没有什么技术实现上的困难点，但是对于大部分app开发来讲，还是需要消耗时间精力来做的，更重要的是这不是用户使用app的刚需，因此这种即插即用可服务端实时配置的H5反馈页面的出现恰到好处。</p>\n<h2 id=\"番外篇\"><a href=\"#番外篇\" class=\"headerlink\" title=\"番外篇\"></a>番外篇</h2><p>push 百川 feedbackVC 的时候，因此 NavigationBar 部分会黑一下再显示。很奇怪的是我如果在 push之前 navigationController 隐藏了 NavigationBar ，这个 feedbackVC 就没有了 NavigationBar。反馈页面其实就是一个 webView，因此我没有搞懂为什么 navigationController 的NavigationBar 显示与否会影响一个 webView 里面 H5 页面的 NavigationBar 显示。这个问题我得再研究研究。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>所有的App都需要给用户一个反馈意见的功能，这样才能让用户使用的更好更方便。不想自己写这一套组件，因此调研了几款第三方的反馈组件。</p>\n<h3 id=\"Instabug\"><a href=\"#Instabug\" class=\"headerlink\" title=\"Instabug\"></a>Instabug</h3><p>九月份上架的师大助手App用的就是这个反馈组件，知乎日报用的也是这个，不管在App任何界面摇一摇就可以触发，Instabug会把当前界面进行截图并且支持用户编辑，非常方便好用的组件，这个用来反馈bug我觉得非常好用，但是作为反馈意见的话，感觉还是缺少一个入口。另外，Instabug采集Bug还是非常准确的。</p>\n<h3 id=\"LeanCloud\"><a href=\"#LeanCloud\" class=\"headerlink\" title=\"LeanCloud\"></a>LeanCloud</h3><p>LeanCloud的反馈组件号称两行代码接入，非常方便，它做成一个对话框的形式，客服与用户可以进行交流，并且用户的反馈可以及时发给开发人员的LeanCloud 手机客户端，实时性非常高。</p>\n<h3 id=\"阿里百川\"><a href=\"#阿里百川\" class=\"headerlink\" title=\"阿里百川\"></a>阿里百川</h3><p>一年之前开发的app用了阿里百川（阿里巴巴无限开放平台）的即时通讯功能，当时阿里巴巴刚把友盟这些公司收购，阿里巴巴无线开放平台还没有现在这么多功能，一年过去了，现在的功能已经非常多了。今天看用户反馈功能时，看到了他们的2.0版本的反馈组件，觉得这种加入了常见反馈问题这一页特别好，用户在反馈之前，可以先自行查看相似问题的解答。并且，相似问题的解答是可以实时在后台添加修改，这极大方便了用户。</p>\n<p>于是就暂定了使用阿里百川，于是进行了接入的技术验证。先看一下效果图：</p>\n<div id=\"tt\" style=\"display: inline-block;\">\n       <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Baichuan_1.PNG\" width=\"50%\" height=\"25%\">\n       <img src=\"http://7xqj7o.com1.z0.glb.clouddn.com/blog/Blog_Baichuan_2.PNG\" width=\"50%\" height=\"25%\">\n</div>\n\n<h2 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h2><h3 id=\"Part1-阿里百川平台注册\"><a href=\"#Part1-阿里百川平台注册\" class=\"headerlink\" title=\"Part1 阿里百川平台注册\"></a>Part1 阿里百川平台注册</h3><p>这里按照官方的接入流程就可以很容易完成了，就不赘述了。</p>\n<h3 id=\"Part2-用户反馈SDK导入\"><a href=\"#Part2-用户反馈SDK导入\" class=\"headerlink\" title=\"Part2 用户反馈SDK导入\"></a>Part2 用户反馈SDK导入</h3><p>我选择使用的是专业版2.0，SDK用的是Cocoapods安装方式，在Podfile添加阿里的私有源。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source 'http:<span class=\"comment\">//repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecs.git'</span></span><br><span class=\"line\">source 'http:<span class=\"comment\">//repo.baichuan-ios.taobao.com/baichuanSDK/AliBCSpecsMirror.git'</span></span><br><span class=\"line\">target '<span class=\"type\">YourTargetName'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    pod '<span class=\"type\">YWFeedbackFMWK'</span>, '~&gt; <span class=\"number\">2.0</span>.<span class=\"number\">3.1</span>'</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n\n<p>接着使用 <code>pod install</code> 安装出现了一个问题，就是我之前用的 Alamofire 等其他很多组件安装不了，出现需要更新的问题，我这里猜测 AliBCSpecsMirror 和 CocoaPods/Specs 有一些差异，弄了一会索性直接在上面再添加 CocoaPods 的仓库，<code>source &#39;https://github.com/CocoaPods/Specs.git&#39;</code>, 这样就能同时安装YWFeedbackFMWK和我之前的其他组件了，但是又会出现repo仓库有两份的warning，这个还没解决好，我考完试再找找解决方法。</p>\n<p>注意： Cocoapods集成方式不需要手动添加依赖系统库</p>\n<p>修改编译选项：<br>在Target-&gt;Linking-&gt;Other Linker Flags中添加-ObjC选项。</p>\n<p>iOS 10中隐私权限设置：<br>如果不做设置，可能会导致崩溃、审核不通过等情况。需要在info plist中增加字段：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>NSCameraUsageDescription<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>访问相机<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>NSPhotoLibraryUsageDescription<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>访问相册<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Part3-初始化SDK，打开反馈页面\"><a href=\"#Part3-初始化SDK，打开反馈页面\" class=\"headerlink\" title=\"Part3 初始化SDK，打开反馈页面\"></a>Part3 初始化SDK，打开反馈页面</h3><ol>\n<li>在桥接头文件中加入：</li>\n</ol>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">import</span> &lt;YWFeedbackFMWK/YWFeedbackKit.h&gt;</span><br><span class=\"line\">#<span class=\"keyword\">import</span> &lt;YWFeedbackFMWK/YWFeedbackViewController.h&gt;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>调用初始化方法：</li>\n</ol>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> bcKit = <span class=\"type\">BCFeedbackKit</span>(appKey: <span class=\"string\">\"自己的appkey\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：</strong>这里需要将在阿里百川后台生成的安全图片添加进项目目录中</p>\n<ol start=\"3\">\n<li>设置业务方扩展的反馈数据：<br>相当于给反馈信息中加入反馈用户的个人信息，可设置任意字段，在创建反馈页面前设置，可在后台扩展信息中查看。</li>\n</ol>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bcKit.extInfo = [<span class=\"string\">\"username\"</span>:<span class=\"string\">\"自己app用户体系中的用户id\"</span>]</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>打开反馈页面：</li>\n<li><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bcKit.makeFeedbackViewController(completionBlock: &#123; (feedbackVC, error) <span class=\"keyword\">in</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> vc = feedbackVC &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 当用户关闭用户反馈，将调用该block进行dismiss或pop</span></span><br><span class=\"line\">        vc.closeBlock = &#123;(aParentController) <span class=\"keyword\">in</span></span><br><span class=\"line\">            aParentController?.navigationController?.popViewController(animated: <span class=\"literal\">false</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">self</span>.navigationController?.isNavigationBarHidden = <span class=\"literal\">false</span>        </span><br><span class=\"line\">        <span class=\"keyword\">self</span>.navigationController?.pushViewController(vc, animated: <span class=\"literal\">false</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p>这样就完成了在app中加入反馈页面的添加。</p>\n<h3 id=\"Part4-阿里百川控制台配置反馈组件\"><a href=\"#Part4-阿里百川控制台配置反馈组件\" class=\"headerlink\" title=\"Part4 阿里百川控制台配置反馈组件\"></a>Part4 阿里百川控制台配置反馈组件</h3><p>在阿里百川用户反馈后台，可以在App内反馈中查看用户发送的反馈信息，还可以在Mobile客户端配置中自定义配置app中反馈页面的UI。这是我觉得的该产品的亮点所在，可以实时配置热门问题，减去了在app开发时需要考虑的动态获取生成热门问题的过程，而且整个appUI全都实时动态设置。具体操作大家用一下就很容易了解了。</p>\n<h2 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h2><p>通过使用阿里百川用户反馈组件，我又一次看到了H5的用途。对于这类弱使用强度、高数据变更、低页面逻辑的页面，我觉得H5的用途大大体现了，虽然讲这样的一个反馈的原生页面以及一套后台处理系统没有什么技术实现上的困难点，但是对于大部分app开发来讲，还是需要消耗时间精力来做的，更重要的是这不是用户使用app的刚需，因此这种即插即用可服务端实时配置的H5反馈页面的出现恰到好处。</p>\n<h2 id=\"番外篇\"><a href=\"#番外篇\" class=\"headerlink\" title=\"番外篇\"></a>番外篇</h2><p>push 百川 feedbackVC 的时候，因此 NavigationBar 部分会黑一下再显示。很奇怪的是我如果在 push之前 navigationController 隐藏了 NavigationBar ，这个 feedbackVC 就没有了 NavigationBar。反馈页面其实就是一个 webView，因此我没有搞懂为什么 navigationController 的NavigationBar 显示与否会影响一个 webView 里面 H5 页面的 NavigationBar 显示。这个问题我得再研究研究。</p>\n"},{"title":"ARKit入门-在AR中处理3D交互和UI控制","date":"2017-11-24T12:05:19.000Z","_content":"\n> 翻译自 [Handling 3D Interaction and UI Controls in Augmented Reality](https://developer.apple.com/documentation/arkit/handling_3d_interaction_and_ui_controls_in_augmented_reality)\n\n遵循AR体验中的视觉反馈、手势交互和现实渲染的最佳实践。\n\n## 概述\n\nAR为用户提供了在app中与现实和虚拟3D内容交互的新方法。但是，人机界面设计的许多基本原理仍然有效。令人信服的AR幻想同样需要仔细关注3D资源和渲染。iOS人机界面指南包含有关AR人机界面原则的建议。该项目展示了如何应用这些指导方法轻松地创建身临其境、直观的AR体验。\n\n这个示例app提供了一个简单的AR体验，允许用户将一个或多个真实的虚拟对象放置在现实世界的环境中，然后试用直观的手势来排列这些对象。该app提供了用户界面提示，以帮助用户了解AR体验的状态以及交互选项。\n\n以下各节对应于 [iOS人机交互指南>AR](https://developer.apple.com/ios/human-interface-guidelines/technologies/augmented-reality/) 中的各个部分，并提供有关该示例app如何实现这些指南的详细信息。有关每个部分的更详细的推理，请参阅iOS人机界面的指南的相应部分。\n\n## 放置虚拟对象\n\n帮助人们了解何时定位平面和放置虚拟对象。FocusSquare 类在AR View中绘制方形轮廓，为用户提供有关 ARKit 世界跟踪状态的提示。\n\n![Demo](https://docs-assets.developer.apple.com/published/d43e250ee6/de02235f-216c-4d3f-8730-e3d433163b62.png)\n\n\n正方形改变大小和方向以反映估计的场景深度，并以动效形式在打开和关闭状态间切换，以指示ARKit是否检测到适合放置虚拟对象的平面。在用户放置虚拟对象后，焦点正方形小时，保持隐藏状态，直到用户将相机指向另一个表面。\n\n**当用户放置一个虚拟对象时要做出适当的响应**。当用户选择要放置的虚拟对象时，示例app的 setPosition(_:relativeTo:smoothMovement) 方法使用 FocusSquare 对象的简单启发式方法将虚拟对象放置于屏幕中间的大致现实的位置，即使ARKit没有在那个地方发现一个平面。\n\n``` swift\nguard let cameraTransform = session.currentFrame?.camera.transform,\n    let focusSquarePosition = focusSquare.lastPosition else {\n    statusViewController.showMessage(\"CANNOT PLACE OBJECT\\nTry moving left or right.\")\n    return\n}\n        \nvirtualObjectInteraction.selectedObject = virtualObject\nvirtualObject.setPosition(focusSquarePosition, relativeTo: cameraTransform, smoothMovement: false)\n        \nupdateQueue.async {\n    self.sceneView.scene.rootNode.addChildNode(virtualObject)\n}\n```\n\n这个位置可能不是用户想要放置虚拟对象的真实世界表面的精确估计，但它足够接近，以快速地将物体添加到屏幕上。\n\n随着时间的推移，ARKit 会检测平面并提高其位置的估计值，调用 [renderer(_:didAdd:for:)](https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865794-renderer) 和 [renderer(_:didUpdate:for:)](https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865799-renderer) 委托方法来报告结果。在这些方法中，示例app调用其 `adjustOntoPlaneAnchor(_:using:)` 方法来确定之前放置的虚拟对象是否靠近检测到的平面。如果靠近，该方法使用微妙的动画将虚拟对象移动到检测到的平面上，受益于ARKit在该位置对现实世界表面的精确估计，是虚拟对象看起来在用户选择的位置：\n\n``` swift\n// Move onto the plane if it is near it (within 5 centimeters).\nlet verticalAllowance: Float = 0.05\nlet epsilon: Float = 0.001 // Do not update if the difference is less than 1 mm.\nlet distanceToPlane = abs(planePosition.y)\nif distanceToPlane > epsilon && distanceToPlane < verticalAllowance {\n    SCNTransaction.begin()\n    SCNTransaction.animationDuration = CFTimeInterval(distanceToPlane * 500) // Move 2 mm per second.\n    SCNTransaction.animationTimingFunction = CAMediaTimingFunction(name: kCAMediaTimingFunctionEaseInEaseOut)\n    position.y = anchor.transform.columns.3.y\n    SCNTransaction.commit()\n}\n```\n\n## 用户与虚拟对象的交互\n\n**允许用户使用标准的、熟悉的手势与虚拟对象直接进行交互。**该示例app使用单指轻拍，单/双指平移，双指旋转手势识别，以使用户放置和旋转虚拟对象。示例app的代码中 `VirtualObjectInteraction` 类管理这些手势。\n\n**一般来说，要保持交互简单。**当拖动一个虚拟对象时（参见 `translate(_:basedOn:infinitePlane:) ` 方法），示例app将虚拟对象的移动限制在它被放置的二维平面上。类似的，由于虚拟对象停留在水平面上，旋转手势（参见 `didRotate(_:) ` 方法）只能绕着垂直轴来旋转对象，以使得对象保持在平面上。\n\n**在合理接近交互式虚拟对象时对用户手势做出响应。**示例代码的 ` objectInteracting(with:in:) ` 方法使用手势识别器提供的触摸位置执行hit测试。通过针对虚拟对象边界框进行hit测试，该方法使得即使用户触摸位置不在虚拟对象的可见内容的点上，用户触摸也有可能影响虚拟对象。通过对多点触摸手势执行多个hit测试，该方法使得用户触摸更有可能影响预期的对象：\n\n``` swift\nfor index in 0..<gesture.numberOfTouches {\n    let touchLocation = gesture.location(ofTouch: index, in: view)\n    \n    // Look for an object directly under the `touchLocation`.\n    if let object = sceneView.virtualObject(at: touchLocation) {\n        return object\n    }\n}\n        \n// As a last resort look for an object under the center of the touches.\nreturn sceneView.virtualObject(at: gesture.center(in: view))\n```\n\n**考虑用户启动的对象缩放是否必要。** 这个AR app放置了可能自然出现在用户真实环境中的逼真虚拟对象，因此保留虚拟对象的固有尺寸有助于保持真实感。因此，该app没有添加手势或者其他UI来启用虚拟对象缩放。此外，通过不使用缩放手势，示例app防止用户对手势调整虚拟对象大小 或 改变虚拟对象与相机的距离 产生困惑。（如果你选择再app中启动虚拟对象缩放，请使用pinch捏合手势。）\n\n**警惕潜在的冲突手势。**示例app的 `ThresholdPanGesture` 类是一个 [UIPanGestureRecognizer](https://developer.apple.com/documentation/uikit/uipangesturerecognizer) 子类，它提供了一种方法，延迟手势识别器效果，直到手势正在进行通过指定的移动阈值。示例app的`touchesMoved(with:)` 方法使用该类来让用户在单指拖动虚拟对象手势和双指旋转对象手势间平滑过渡：\n\n``` swift\noverride func touchesMoved(_ touches: Set<UITouch>, with event: UIEvent) {\n    super.touchesMoved(touches, with: event)\n    \n    let translationMagnitude = translation(in: view).length\n    \n    // Adjust the threshold based on the number of touches being used.\n    let threshold = ThresholdPanGesture.threshold(forTouchCount: touches.count)\n    \n    if !isThresholdExceeded && translationMagnitude > threshold {\n        isThresholdExceeded = true\n        \n        // Set the overall translation to zero as the gesture should now begin.\n        setTranslation(.zero, in: view)\n    }\n}\n```\n\n**确保虚拟对象的移动平稳。**示例app的 `setPosition(_:relativeTo:smoothMovement)` 方法在触摸手势引起的拖动虚拟对象位置 和 该对象近期位置之间插值。通过平均 基于相机距离的近期位置，该方法产生平滑的拖动移动，而不会使 被拖动物体滞后于用户的手势：\n\n``` swift\nif smoothMovement {\n    let hitTestResultDistance = simd_length(positionOffsetFromCamera)\n    \n    // Add the latest position and keep up to 10 recent distances to smooth with.\n    recentVirtualObjectDistances.append(hitTestResultDistance)\n    recentVirtualObjectDistances = Array(recentVirtualObjectDistances.suffix(10))\n    \n    let averageDistance = recentVirtualObjectDistances.average!\n    let averagedDistancePosition = simd_normalize(positionOffsetFromCamera) * averageDistance\n    simdPosition = cameraWorldPosition + averagedDistancePosition\n} else {\n    simdPosition = cameraWorldPosition + positionOffsetFromCamera\n}\n```\n\n**探索更吸引用户的交互方法。**在AR体验中，pan平移手势（将手指移动到设备的屏幕上）并不是将虚拟对象拖动到新位置的唯一自然方式。用户也可以在移动设备时直观地将手指一直放置在虚拟对象上，从而将虚拟对象拖到AR场景中的新位置。\n\n即使手势在屏幕上的触摸位置没有改变，示例app也通过在拖动手势时不断的调用其 `updateObjectToCurrentTrackingPosition()` 方法来支持这种手势。若设备在拖动过程中发生移动，则该方法会计算其对应于触摸位置的新的现实位置，并相应地移动虚拟对象。\n\n## 进入AR\n\n**指示用户何时进行初始化。**该示例app通过文本提示显示有关AR session状态，通过浮动的文本视图显示与AR进行交互的说明。示例app的 `StatusViewController` 类管理此视图，可显示短暂的说明，该说明允许用户在读取它们之后消失，或显示始终保持可见的重要状态信息直至用户纠正问题。\n\n![image](https://docs-assets.developer.apple.com/published/f385e426f2/d665844f-2945-44f9-9896-06a1bb53251a.png)\n\n## 解决问题\n\n**如果不符合用户的期望可以重置。**示例app具有一个始终在UI界面右上角的Reset重置按钮，允许用户重启AR体验不管其状态如何。参见示例代码的 `restartExperience()` 方法。\n\n**仅在支持的设备上提供AR功能**。示例App的核心功能需要使用ARKit，因此它在Info.plist文件的 [UIRequiredDeviceCapabilities](https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html#//apple_ref/doc/uid/TP40009252-SW3) 部分定义了 arkit 键。在部署构建的项目时，该键的设置可以防止在不支持ARKit的设备上安装。\n\n如果你的应用把ARKit作为辅助功能，请使用 [isSupported](https://developer.apple.com/documentation/arkit/arconfiguration/2923553-issupported) 方法确定是否需要隐藏 ARKit 功能。\n\n\n\n\n","source":"_posts/2017-11-24-ARKit入门-1.md","raw":"---\ntitle: ARKit入门-在AR中处理3D交互和UI控制\ndate: 2017-11-24 20:05:19\ntags:\n- ARKit \n- 翻译\n\ncategories:\n- ARKit\n- 翻译\n---\n\n> 翻译自 [Handling 3D Interaction and UI Controls in Augmented Reality](https://developer.apple.com/documentation/arkit/handling_3d_interaction_and_ui_controls_in_augmented_reality)\n\n遵循AR体验中的视觉反馈、手势交互和现实渲染的最佳实践。\n\n## 概述\n\nAR为用户提供了在app中与现实和虚拟3D内容交互的新方法。但是，人机界面设计的许多基本原理仍然有效。令人信服的AR幻想同样需要仔细关注3D资源和渲染。iOS人机界面指南包含有关AR人机界面原则的建议。该项目展示了如何应用这些指导方法轻松地创建身临其境、直观的AR体验。\n\n这个示例app提供了一个简单的AR体验，允许用户将一个或多个真实的虚拟对象放置在现实世界的环境中，然后试用直观的手势来排列这些对象。该app提供了用户界面提示，以帮助用户了解AR体验的状态以及交互选项。\n\n以下各节对应于 [iOS人机交互指南>AR](https://developer.apple.com/ios/human-interface-guidelines/technologies/augmented-reality/) 中的各个部分，并提供有关该示例app如何实现这些指南的详细信息。有关每个部分的更详细的推理，请参阅iOS人机界面的指南的相应部分。\n\n## 放置虚拟对象\n\n帮助人们了解何时定位平面和放置虚拟对象。FocusSquare 类在AR View中绘制方形轮廓，为用户提供有关 ARKit 世界跟踪状态的提示。\n\n![Demo](https://docs-assets.developer.apple.com/published/d43e250ee6/de02235f-216c-4d3f-8730-e3d433163b62.png)\n\n\n正方形改变大小和方向以反映估计的场景深度，并以动效形式在打开和关闭状态间切换，以指示ARKit是否检测到适合放置虚拟对象的平面。在用户放置虚拟对象后，焦点正方形小时，保持隐藏状态，直到用户将相机指向另一个表面。\n\n**当用户放置一个虚拟对象时要做出适当的响应**。当用户选择要放置的虚拟对象时，示例app的 setPosition(_:relativeTo:smoothMovement) 方法使用 FocusSquare 对象的简单启发式方法将虚拟对象放置于屏幕中间的大致现实的位置，即使ARKit没有在那个地方发现一个平面。\n\n``` swift\nguard let cameraTransform = session.currentFrame?.camera.transform,\n    let focusSquarePosition = focusSquare.lastPosition else {\n    statusViewController.showMessage(\"CANNOT PLACE OBJECT\\nTry moving left or right.\")\n    return\n}\n        \nvirtualObjectInteraction.selectedObject = virtualObject\nvirtualObject.setPosition(focusSquarePosition, relativeTo: cameraTransform, smoothMovement: false)\n        \nupdateQueue.async {\n    self.sceneView.scene.rootNode.addChildNode(virtualObject)\n}\n```\n\n这个位置可能不是用户想要放置虚拟对象的真实世界表面的精确估计，但它足够接近，以快速地将物体添加到屏幕上。\n\n随着时间的推移，ARKit 会检测平面并提高其位置的估计值，调用 [renderer(_:didAdd:for:)](https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865794-renderer) 和 [renderer(_:didUpdate:for:)](https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865799-renderer) 委托方法来报告结果。在这些方法中，示例app调用其 `adjustOntoPlaneAnchor(_:using:)` 方法来确定之前放置的虚拟对象是否靠近检测到的平面。如果靠近，该方法使用微妙的动画将虚拟对象移动到检测到的平面上，受益于ARKit在该位置对现实世界表面的精确估计，是虚拟对象看起来在用户选择的位置：\n\n``` swift\n// Move onto the plane if it is near it (within 5 centimeters).\nlet verticalAllowance: Float = 0.05\nlet epsilon: Float = 0.001 // Do not update if the difference is less than 1 mm.\nlet distanceToPlane = abs(planePosition.y)\nif distanceToPlane > epsilon && distanceToPlane < verticalAllowance {\n    SCNTransaction.begin()\n    SCNTransaction.animationDuration = CFTimeInterval(distanceToPlane * 500) // Move 2 mm per second.\n    SCNTransaction.animationTimingFunction = CAMediaTimingFunction(name: kCAMediaTimingFunctionEaseInEaseOut)\n    position.y = anchor.transform.columns.3.y\n    SCNTransaction.commit()\n}\n```\n\n## 用户与虚拟对象的交互\n\n**允许用户使用标准的、熟悉的手势与虚拟对象直接进行交互。**该示例app使用单指轻拍，单/双指平移，双指旋转手势识别，以使用户放置和旋转虚拟对象。示例app的代码中 `VirtualObjectInteraction` 类管理这些手势。\n\n**一般来说，要保持交互简单。**当拖动一个虚拟对象时（参见 `translate(_:basedOn:infinitePlane:) ` 方法），示例app将虚拟对象的移动限制在它被放置的二维平面上。类似的，由于虚拟对象停留在水平面上，旋转手势（参见 `didRotate(_:) ` 方法）只能绕着垂直轴来旋转对象，以使得对象保持在平面上。\n\n**在合理接近交互式虚拟对象时对用户手势做出响应。**示例代码的 ` objectInteracting(with:in:) ` 方法使用手势识别器提供的触摸位置执行hit测试。通过针对虚拟对象边界框进行hit测试，该方法使得即使用户触摸位置不在虚拟对象的可见内容的点上，用户触摸也有可能影响虚拟对象。通过对多点触摸手势执行多个hit测试，该方法使得用户触摸更有可能影响预期的对象：\n\n``` swift\nfor index in 0..<gesture.numberOfTouches {\n    let touchLocation = gesture.location(ofTouch: index, in: view)\n    \n    // Look for an object directly under the `touchLocation`.\n    if let object = sceneView.virtualObject(at: touchLocation) {\n        return object\n    }\n}\n        \n// As a last resort look for an object under the center of the touches.\nreturn sceneView.virtualObject(at: gesture.center(in: view))\n```\n\n**考虑用户启动的对象缩放是否必要。** 这个AR app放置了可能自然出现在用户真实环境中的逼真虚拟对象，因此保留虚拟对象的固有尺寸有助于保持真实感。因此，该app没有添加手势或者其他UI来启用虚拟对象缩放。此外，通过不使用缩放手势，示例app防止用户对手势调整虚拟对象大小 或 改变虚拟对象与相机的距离 产生困惑。（如果你选择再app中启动虚拟对象缩放，请使用pinch捏合手势。）\n\n**警惕潜在的冲突手势。**示例app的 `ThresholdPanGesture` 类是一个 [UIPanGestureRecognizer](https://developer.apple.com/documentation/uikit/uipangesturerecognizer) 子类，它提供了一种方法，延迟手势识别器效果，直到手势正在进行通过指定的移动阈值。示例app的`touchesMoved(with:)` 方法使用该类来让用户在单指拖动虚拟对象手势和双指旋转对象手势间平滑过渡：\n\n``` swift\noverride func touchesMoved(_ touches: Set<UITouch>, with event: UIEvent) {\n    super.touchesMoved(touches, with: event)\n    \n    let translationMagnitude = translation(in: view).length\n    \n    // Adjust the threshold based on the number of touches being used.\n    let threshold = ThresholdPanGesture.threshold(forTouchCount: touches.count)\n    \n    if !isThresholdExceeded && translationMagnitude > threshold {\n        isThresholdExceeded = true\n        \n        // Set the overall translation to zero as the gesture should now begin.\n        setTranslation(.zero, in: view)\n    }\n}\n```\n\n**确保虚拟对象的移动平稳。**示例app的 `setPosition(_:relativeTo:smoothMovement)` 方法在触摸手势引起的拖动虚拟对象位置 和 该对象近期位置之间插值。通过平均 基于相机距离的近期位置，该方法产生平滑的拖动移动，而不会使 被拖动物体滞后于用户的手势：\n\n``` swift\nif smoothMovement {\n    let hitTestResultDistance = simd_length(positionOffsetFromCamera)\n    \n    // Add the latest position and keep up to 10 recent distances to smooth with.\n    recentVirtualObjectDistances.append(hitTestResultDistance)\n    recentVirtualObjectDistances = Array(recentVirtualObjectDistances.suffix(10))\n    \n    let averageDistance = recentVirtualObjectDistances.average!\n    let averagedDistancePosition = simd_normalize(positionOffsetFromCamera) * averageDistance\n    simdPosition = cameraWorldPosition + averagedDistancePosition\n} else {\n    simdPosition = cameraWorldPosition + positionOffsetFromCamera\n}\n```\n\n**探索更吸引用户的交互方法。**在AR体验中，pan平移手势（将手指移动到设备的屏幕上）并不是将虚拟对象拖动到新位置的唯一自然方式。用户也可以在移动设备时直观地将手指一直放置在虚拟对象上，从而将虚拟对象拖到AR场景中的新位置。\n\n即使手势在屏幕上的触摸位置没有改变，示例app也通过在拖动手势时不断的调用其 `updateObjectToCurrentTrackingPosition()` 方法来支持这种手势。若设备在拖动过程中发生移动，则该方法会计算其对应于触摸位置的新的现实位置，并相应地移动虚拟对象。\n\n## 进入AR\n\n**指示用户何时进行初始化。**该示例app通过文本提示显示有关AR session状态，通过浮动的文本视图显示与AR进行交互的说明。示例app的 `StatusViewController` 类管理此视图，可显示短暂的说明，该说明允许用户在读取它们之后消失，或显示始终保持可见的重要状态信息直至用户纠正问题。\n\n![image](https://docs-assets.developer.apple.com/published/f385e426f2/d665844f-2945-44f9-9896-06a1bb53251a.png)\n\n## 解决问题\n\n**如果不符合用户的期望可以重置。**示例app具有一个始终在UI界面右上角的Reset重置按钮，允许用户重启AR体验不管其状态如何。参见示例代码的 `restartExperience()` 方法。\n\n**仅在支持的设备上提供AR功能**。示例App的核心功能需要使用ARKit，因此它在Info.plist文件的 [UIRequiredDeviceCapabilities](https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html#//apple_ref/doc/uid/TP40009252-SW3) 部分定义了 arkit 键。在部署构建的项目时，该键的设置可以防止在不支持ARKit的设备上安装。\n\n如果你的应用把ARKit作为辅助功能，请使用 [isSupported](https://developer.apple.com/documentation/arkit/arconfiguration/2923553-issupported) 方法确定是否需要隐藏 ARKit 功能。\n\n\n\n\n","slug":"2017-11-24-ARKit入门-1","published":1,"updated":"2019-06-17T15:13:17.150Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkfl003ywq1kpb48bsh0","content":"<blockquote>\n<p>翻译自 <a href=\"https://developer.apple.com/documentation/arkit/handling_3d_interaction_and_ui_controls_in_augmented_reality\" target=\"_blank\" rel=\"noopener\">Handling 3D Interaction and UI Controls in Augmented Reality</a></p>\n</blockquote>\n<p>遵循AR体验中的视觉反馈、手势交互和现实渲染的最佳实践。</p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>AR为用户提供了在app中与现实和虚拟3D内容交互的新方法。但是，人机界面设计的许多基本原理仍然有效。令人信服的AR幻想同样需要仔细关注3D资源和渲染。iOS人机界面指南包含有关AR人机界面原则的建议。该项目展示了如何应用这些指导方法轻松地创建身临其境、直观的AR体验。</p>\n<p>这个示例app提供了一个简单的AR体验，允许用户将一个或多个真实的虚拟对象放置在现实世界的环境中，然后试用直观的手势来排列这些对象。该app提供了用户界面提示，以帮助用户了解AR体验的状态以及交互选项。</p>\n<p>以下各节对应于 <a href=\"https://developer.apple.com/ios/human-interface-guidelines/technologies/augmented-reality/\" target=\"_blank\" rel=\"noopener\">iOS人机交互指南&gt;AR</a> 中的各个部分，并提供有关该示例app如何实现这些指南的详细信息。有关每个部分的更详细的推理，请参阅iOS人机界面的指南的相应部分。</p>\n<h2 id=\"放置虚拟对象\"><a href=\"#放置虚拟对象\" class=\"headerlink\" title=\"放置虚拟对象\"></a>放置虚拟对象</h2><p>帮助人们了解何时定位平面和放置虚拟对象。FocusSquare 类在AR View中绘制方形轮廓，为用户提供有关 ARKit 世界跟踪状态的提示。</p>\n<p><img src=\"https://docs-assets.developer.apple.com/published/d43e250ee6/de02235f-216c-4d3f-8730-e3d433163b62.png\" alt=\"Demo\"></p>\n<p>正方形改变大小和方向以反映估计的场景深度，并以动效形式在打开和关闭状态间切换，以指示ARKit是否检测到适合放置虚拟对象的平面。在用户放置虚拟对象后，焦点正方形小时，保持隐藏状态，直到用户将相机指向另一个表面。</p>\n<p><strong>当用户放置一个虚拟对象时要做出适当的响应</strong>。当用户选择要放置的虚拟对象时，示例app的 setPosition(_:relativeTo:smoothMovement) 方法使用 FocusSquare 对象的简单启发式方法将虚拟对象放置于屏幕中间的大致现实的位置，即使ARKit没有在那个地方发现一个平面。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> cameraTransform = session.currentFrame?.camera.transform,</span><br><span class=\"line\">    <span class=\"keyword\">let</span> focusSquarePosition = focusSquare.lastPosition <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    statusViewController.showMessage(<span class=\"string\">\"CANNOT PLACE OBJECT\\nTry moving left or right.\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">virtualObjectInteraction.selectedObject = virtualObject</span><br><span class=\"line\">virtualObject.setPosition(focusSquarePosition, relativeTo: cameraTransform, smoothMovement: <span class=\"literal\">false</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">updateQueue.async &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.sceneView.scene.rootNode.addChildNode(virtualObject)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个位置可能不是用户想要放置虚拟对象的真实世界表面的精确估计，但它足够接近，以快速地将物体添加到屏幕上。</p>\n<p>随着时间的推移，ARKit 会检测平面并提高其位置的估计值，调用 <a href=\"https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865794-renderer\" target=\"_blank\" rel=\"noopener\">renderer(_:didAdd:for:)</a> 和 <a href=\"https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865799-renderer\" target=\"_blank\" rel=\"noopener\">renderer(_:didUpdate:for:)</a> 委托方法来报告结果。在这些方法中，示例app调用其 <code>adjustOntoPlaneAnchor(_:using:)</code> 方法来确定之前放置的虚拟对象是否靠近检测到的平面。如果靠近，该方法使用微妙的动画将虚拟对象移动到检测到的平面上，受益于ARKit在该位置对现实世界表面的精确估计，是虚拟对象看起来在用户选择的位置：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Move onto the plane if it is near it (within 5 centimeters).</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> verticalAllowance: <span class=\"type\">Float</span> = <span class=\"number\">0.05</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> epsilon: <span class=\"type\">Float</span> = <span class=\"number\">0.001</span> <span class=\"comment\">// Do not update if the difference is less than 1 mm.</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> distanceToPlane = <span class=\"built_in\">abs</span>(planePosition.y)</span><br><span class=\"line\"><span class=\"keyword\">if</span> distanceToPlane &gt; epsilon &amp;&amp; distanceToPlane &lt; verticalAllowance &#123;</span><br><span class=\"line\">    <span class=\"type\">SCNTransaction</span>.begin()</span><br><span class=\"line\">    <span class=\"type\">SCNTransaction</span>.animationDuration = <span class=\"type\">CFTimeInterval</span>(distanceToPlane * <span class=\"number\">500</span>) <span class=\"comment\">// Move 2 mm per second.</span></span><br><span class=\"line\">    <span class=\"type\">SCNTransaction</span>.animationTimingFunction = <span class=\"type\">CAMediaTimingFunction</span>(name: kCAMediaTimingFunctionEaseInEaseOut)</span><br><span class=\"line\">    position.y = anchor.transform.columns.<span class=\"number\">3</span>.y</span><br><span class=\"line\">    <span class=\"type\">SCNTransaction</span>.commit()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"用户与虚拟对象的交互\"><a href=\"#用户与虚拟对象的交互\" class=\"headerlink\" title=\"用户与虚拟对象的交互\"></a>用户与虚拟对象的交互</h2><p><strong>允许用户使用标准的、熟悉的手势与虚拟对象直接进行交互。</strong>该示例app使用单指轻拍，单/双指平移，双指旋转手势识别，以使用户放置和旋转虚拟对象。示例app的代码中 <code>VirtualObjectInteraction</code> 类管理这些手势。</p>\n<p><strong>一般来说，要保持交互简单。</strong>当拖动一个虚拟对象时（参见 <code>translate(_:basedOn:infinitePlane:)</code> 方法），示例app将虚拟对象的移动限制在它被放置的二维平面上。类似的，由于虚拟对象停留在水平面上，旋转手势（参见 <code>didRotate(_:)</code> 方法）只能绕着垂直轴来旋转对象，以使得对象保持在平面上。</p>\n<p><strong>在合理接近交互式虚拟对象时对用户手势做出响应。</strong>示例代码的 <code>objectInteracting(with:in:)</code> 方法使用手势识别器提供的触摸位置执行hit测试。通过针对虚拟对象边界框进行hit测试，该方法使得即使用户触摸位置不在虚拟对象的可见内容的点上，用户触摸也有可能影响虚拟对象。通过对多点触摸手势执行多个hit测试，该方法使得用户触摸更有可能影响预期的对象：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> index <span class=\"keyword\">in</span> <span class=\"number\">0</span>..&lt;gesture.numberOfTouches &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> touchLocation = gesture.location(ofTouch: index, <span class=\"keyword\">in</span>: view)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Look for an object directly under the `touchLocation`.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> object = sceneView.virtualObject(at: touchLocation) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> object</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"comment\">// As a last resort look for an object under the center of the touches.</span></span><br><span class=\"line\"><span class=\"keyword\">return</span> sceneView.virtualObject(at: gesture.center(<span class=\"keyword\">in</span>: view))</span><br></pre></td></tr></table></figure>\n\n<p><strong>考虑用户启动的对象缩放是否必要。</strong> 这个AR app放置了可能自然出现在用户真实环境中的逼真虚拟对象，因此保留虚拟对象的固有尺寸有助于保持真实感。因此，该app没有添加手势或者其他UI来启用虚拟对象缩放。此外，通过不使用缩放手势，示例app防止用户对手势调整虚拟对象大小 或 改变虚拟对象与相机的距离 产生困惑。（如果你选择再app中启动虚拟对象缩放，请使用pinch捏合手势。）</p>\n<p><strong>警惕潜在的冲突手势。</strong>示例app的 <code>ThresholdPanGesture</code> 类是一个 <a href=\"https://developer.apple.com/documentation/uikit/uipangesturerecognizer\" target=\"_blank\" rel=\"noopener\">UIPanGestureRecognizer</a> 子类，它提供了一种方法，延迟手势识别器效果，直到手势正在进行通过指定的移动阈值。示例app的<code>touchesMoved(with:)</code> 方法使用该类来让用户在单指拖动虚拟对象手势和双指旋转对象手势间平滑过渡：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesMoved</span><span class=\"params\">(<span class=\"number\">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.touchesMoved(touches, with: event)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> translationMagnitude = translation(<span class=\"keyword\">in</span>: view).length</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Adjust the threshold based on the number of touches being used.</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> threshold = <span class=\"type\">ThresholdPanGesture</span>.threshold(forTouchCount: touches.<span class=\"built_in\">count</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> !isThresholdExceeded &amp;&amp; translationMagnitude &gt; threshold &#123;</span><br><span class=\"line\">        isThresholdExceeded = <span class=\"literal\">true</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// Set the overall translation to zero as the gesture should now begin.</span></span><br><span class=\"line\">        setTranslation(.zero, <span class=\"keyword\">in</span>: view)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>确保虚拟对象的移动平稳。</strong>示例app的 <code>setPosition(_:relativeTo:smoothMovement)</code> 方法在触摸手势引起的拖动虚拟对象位置 和 该对象近期位置之间插值。通过平均 基于相机距离的近期位置，该方法产生平滑的拖动移动，而不会使 被拖动物体滞后于用户的手势：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> smoothMovement &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> hitTestResultDistance = simd_length(positionOffsetFromCamera)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Add the latest position and keep up to 10 recent distances to smooth with.</span></span><br><span class=\"line\">    recentVirtualObjectDistances.append(hitTestResultDistance)</span><br><span class=\"line\">    recentVirtualObjectDistances = <span class=\"type\">Array</span>(recentVirtualObjectDistances.suffix(<span class=\"number\">10</span>))</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> averageDistance = recentVirtualObjectDistances.average!</span><br><span class=\"line\">    <span class=\"keyword\">let</span> averagedDistancePosition = simd_normalize(positionOffsetFromCamera) * averageDistance</span><br><span class=\"line\">    simdPosition = cameraWorldPosition + averagedDistancePosition</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    simdPosition = cameraWorldPosition + positionOffsetFromCamera</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>探索更吸引用户的交互方法。</strong>在AR体验中，pan平移手势（将手指移动到设备的屏幕上）并不是将虚拟对象拖动到新位置的唯一自然方式。用户也可以在移动设备时直观地将手指一直放置在虚拟对象上，从而将虚拟对象拖到AR场景中的新位置。</p>\n<p>即使手势在屏幕上的触摸位置没有改变，示例app也通过在拖动手势时不断的调用其 <code>updateObjectToCurrentTrackingPosition()</code> 方法来支持这种手势。若设备在拖动过程中发生移动，则该方法会计算其对应于触摸位置的新的现实位置，并相应地移动虚拟对象。</p>\n<h2 id=\"进入AR\"><a href=\"#进入AR\" class=\"headerlink\" title=\"进入AR\"></a>进入AR</h2><p><strong>指示用户何时进行初始化。</strong>该示例app通过文本提示显示有关AR session状态，通过浮动的文本视图显示与AR进行交互的说明。示例app的 <code>StatusViewController</code> 类管理此视图，可显示短暂的说明，该说明允许用户在读取它们之后消失，或显示始终保持可见的重要状态信息直至用户纠正问题。</p>\n<p><img src=\"https://docs-assets.developer.apple.com/published/f385e426f2/d665844f-2945-44f9-9896-06a1bb53251a.png\" alt=\"image\"></p>\n<h2 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h2><p><strong>如果不符合用户的期望可以重置。</strong>示例app具有一个始终在UI界面右上角的Reset重置按钮，允许用户重启AR体验不管其状态如何。参见示例代码的 <code>restartExperience()</code> 方法。</p>\n<p><strong>仅在支持的设备上提供AR功能</strong>。示例App的核心功能需要使用ARKit，因此它在Info.plist文件的 <a href=\"https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html#//apple_ref/doc/uid/TP40009252-SW3\" target=\"_blank\" rel=\"noopener\">UIRequiredDeviceCapabilities</a> 部分定义了 arkit 键。在部署构建的项目时，该键的设置可以防止在不支持ARKit的设备上安装。</p>\n<p>如果你的应用把ARKit作为辅助功能，请使用 <a href=\"https://developer.apple.com/documentation/arkit/arconfiguration/2923553-issupported\" target=\"_blank\" rel=\"noopener\">isSupported</a> 方法确定是否需要隐藏 ARKit 功能。</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>翻译自 <a href=\"https://developer.apple.com/documentation/arkit/handling_3d_interaction_and_ui_controls_in_augmented_reality\" target=\"_blank\" rel=\"noopener\">Handling 3D Interaction and UI Controls in Augmented Reality</a></p>\n</blockquote>\n<p>遵循AR体验中的视觉反馈、手势交互和现实渲染的最佳实践。</p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>AR为用户提供了在app中与现实和虚拟3D内容交互的新方法。但是，人机界面设计的许多基本原理仍然有效。令人信服的AR幻想同样需要仔细关注3D资源和渲染。iOS人机界面指南包含有关AR人机界面原则的建议。该项目展示了如何应用这些指导方法轻松地创建身临其境、直观的AR体验。</p>\n<p>这个示例app提供了一个简单的AR体验，允许用户将一个或多个真实的虚拟对象放置在现实世界的环境中，然后试用直观的手势来排列这些对象。该app提供了用户界面提示，以帮助用户了解AR体验的状态以及交互选项。</p>\n<p>以下各节对应于 <a href=\"https://developer.apple.com/ios/human-interface-guidelines/technologies/augmented-reality/\" target=\"_blank\" rel=\"noopener\">iOS人机交互指南&gt;AR</a> 中的各个部分，并提供有关该示例app如何实现这些指南的详细信息。有关每个部分的更详细的推理，请参阅iOS人机界面的指南的相应部分。</p>\n<h2 id=\"放置虚拟对象\"><a href=\"#放置虚拟对象\" class=\"headerlink\" title=\"放置虚拟对象\"></a>放置虚拟对象</h2><p>帮助人们了解何时定位平面和放置虚拟对象。FocusSquare 类在AR View中绘制方形轮廓，为用户提供有关 ARKit 世界跟踪状态的提示。</p>\n<p><img src=\"https://docs-assets.developer.apple.com/published/d43e250ee6/de02235f-216c-4d3f-8730-e3d433163b62.png\" alt=\"Demo\"></p>\n<p>正方形改变大小和方向以反映估计的场景深度，并以动效形式在打开和关闭状态间切换，以指示ARKit是否检测到适合放置虚拟对象的平面。在用户放置虚拟对象后，焦点正方形小时，保持隐藏状态，直到用户将相机指向另一个表面。</p>\n<p><strong>当用户放置一个虚拟对象时要做出适当的响应</strong>。当用户选择要放置的虚拟对象时，示例app的 setPosition(_:relativeTo:smoothMovement) 方法使用 FocusSquare 对象的简单启发式方法将虚拟对象放置于屏幕中间的大致现实的位置，即使ARKit没有在那个地方发现一个平面。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> cameraTransform = session.currentFrame?.camera.transform,</span><br><span class=\"line\">    <span class=\"keyword\">let</span> focusSquarePosition = focusSquare.lastPosition <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    statusViewController.showMessage(<span class=\"string\">\"CANNOT PLACE OBJECT\\nTry moving left or right.\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">virtualObjectInteraction.selectedObject = virtualObject</span><br><span class=\"line\">virtualObject.setPosition(focusSquarePosition, relativeTo: cameraTransform, smoothMovement: <span class=\"literal\">false</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">updateQueue.async &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.sceneView.scene.rootNode.addChildNode(virtualObject)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这个位置可能不是用户想要放置虚拟对象的真实世界表面的精确估计，但它足够接近，以快速地将物体添加到屏幕上。</p>\n<p>随着时间的推移，ARKit 会检测平面并提高其位置的估计值，调用 <a href=\"https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865794-renderer\" target=\"_blank\" rel=\"noopener\">renderer(_:didAdd:for:)</a> 和 <a href=\"https://developer.apple.com/documentation/arkit/arscnviewdelegate/2865799-renderer\" target=\"_blank\" rel=\"noopener\">renderer(_:didUpdate:for:)</a> 委托方法来报告结果。在这些方法中，示例app调用其 <code>adjustOntoPlaneAnchor(_:using:)</code> 方法来确定之前放置的虚拟对象是否靠近检测到的平面。如果靠近，该方法使用微妙的动画将虚拟对象移动到检测到的平面上，受益于ARKit在该位置对现实世界表面的精确估计，是虚拟对象看起来在用户选择的位置：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Move onto the plane if it is near it (within 5 centimeters).</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> verticalAllowance: <span class=\"type\">Float</span> = <span class=\"number\">0.05</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> epsilon: <span class=\"type\">Float</span> = <span class=\"number\">0.001</span> <span class=\"comment\">// Do not update if the difference is less than 1 mm.</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> distanceToPlane = <span class=\"built_in\">abs</span>(planePosition.y)</span><br><span class=\"line\"><span class=\"keyword\">if</span> distanceToPlane &gt; epsilon &amp;&amp; distanceToPlane &lt; verticalAllowance &#123;</span><br><span class=\"line\">    <span class=\"type\">SCNTransaction</span>.begin()</span><br><span class=\"line\">    <span class=\"type\">SCNTransaction</span>.animationDuration = <span class=\"type\">CFTimeInterval</span>(distanceToPlane * <span class=\"number\">500</span>) <span class=\"comment\">// Move 2 mm per second.</span></span><br><span class=\"line\">    <span class=\"type\">SCNTransaction</span>.animationTimingFunction = <span class=\"type\">CAMediaTimingFunction</span>(name: kCAMediaTimingFunctionEaseInEaseOut)</span><br><span class=\"line\">    position.y = anchor.transform.columns.<span class=\"number\">3</span>.y</span><br><span class=\"line\">    <span class=\"type\">SCNTransaction</span>.commit()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"用户与虚拟对象的交互\"><a href=\"#用户与虚拟对象的交互\" class=\"headerlink\" title=\"用户与虚拟对象的交互\"></a>用户与虚拟对象的交互</h2><p><strong>允许用户使用标准的、熟悉的手势与虚拟对象直接进行交互。</strong>该示例app使用单指轻拍，单/双指平移，双指旋转手势识别，以使用户放置和旋转虚拟对象。示例app的代码中 <code>VirtualObjectInteraction</code> 类管理这些手势。</p>\n<p><strong>一般来说，要保持交互简单。</strong>当拖动一个虚拟对象时（参见 <code>translate(_:basedOn:infinitePlane:)</code> 方法），示例app将虚拟对象的移动限制在它被放置的二维平面上。类似的，由于虚拟对象停留在水平面上，旋转手势（参见 <code>didRotate(_:)</code> 方法）只能绕着垂直轴来旋转对象，以使得对象保持在平面上。</p>\n<p><strong>在合理接近交互式虚拟对象时对用户手势做出响应。</strong>示例代码的 <code>objectInteracting(with:in:)</code> 方法使用手势识别器提供的触摸位置执行hit测试。通过针对虚拟对象边界框进行hit测试，该方法使得即使用户触摸位置不在虚拟对象的可见内容的点上，用户触摸也有可能影响虚拟对象。通过对多点触摸手势执行多个hit测试，该方法使得用户触摸更有可能影响预期的对象：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> index <span class=\"keyword\">in</span> <span class=\"number\">0</span>..&lt;gesture.numberOfTouches &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> touchLocation = gesture.location(ofTouch: index, <span class=\"keyword\">in</span>: view)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Look for an object directly under the `touchLocation`.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> object = sceneView.virtualObject(at: touchLocation) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> object</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"comment\">// As a last resort look for an object under the center of the touches.</span></span><br><span class=\"line\"><span class=\"keyword\">return</span> sceneView.virtualObject(at: gesture.center(<span class=\"keyword\">in</span>: view))</span><br></pre></td></tr></table></figure>\n\n<p><strong>考虑用户启动的对象缩放是否必要。</strong> 这个AR app放置了可能自然出现在用户真实环境中的逼真虚拟对象，因此保留虚拟对象的固有尺寸有助于保持真实感。因此，该app没有添加手势或者其他UI来启用虚拟对象缩放。此外，通过不使用缩放手势，示例app防止用户对手势调整虚拟对象大小 或 改变虚拟对象与相机的距离 产生困惑。（如果你选择再app中启动虚拟对象缩放，请使用pinch捏合手势。）</p>\n<p><strong>警惕潜在的冲突手势。</strong>示例app的 <code>ThresholdPanGesture</code> 类是一个 <a href=\"https://developer.apple.com/documentation/uikit/uipangesturerecognizer\" target=\"_blank\" rel=\"noopener\">UIPanGestureRecognizer</a> 子类，它提供了一种方法，延迟手势识别器效果，直到手势正在进行通过指定的移动阈值。示例app的<code>touchesMoved(with:)</code> 方法使用该类来让用户在单指拖动虚拟对象手势和双指旋转对象手势间平滑过渡：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesMoved</span><span class=\"params\">(<span class=\"number\">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.touchesMoved(touches, with: event)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> translationMagnitude = translation(<span class=\"keyword\">in</span>: view).length</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Adjust the threshold based on the number of touches being used.</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> threshold = <span class=\"type\">ThresholdPanGesture</span>.threshold(forTouchCount: touches.<span class=\"built_in\">count</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> !isThresholdExceeded &amp;&amp; translationMagnitude &gt; threshold &#123;</span><br><span class=\"line\">        isThresholdExceeded = <span class=\"literal\">true</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// Set the overall translation to zero as the gesture should now begin.</span></span><br><span class=\"line\">        setTranslation(.zero, <span class=\"keyword\">in</span>: view)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>确保虚拟对象的移动平稳。</strong>示例app的 <code>setPosition(_:relativeTo:smoothMovement)</code> 方法在触摸手势引起的拖动虚拟对象位置 和 该对象近期位置之间插值。通过平均 基于相机距离的近期位置，该方法产生平滑的拖动移动，而不会使 被拖动物体滞后于用户的手势：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> smoothMovement &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> hitTestResultDistance = simd_length(positionOffsetFromCamera)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// Add the latest position and keep up to 10 recent distances to smooth with.</span></span><br><span class=\"line\">    recentVirtualObjectDistances.append(hitTestResultDistance)</span><br><span class=\"line\">    recentVirtualObjectDistances = <span class=\"type\">Array</span>(recentVirtualObjectDistances.suffix(<span class=\"number\">10</span>))</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">let</span> averageDistance = recentVirtualObjectDistances.average!</span><br><span class=\"line\">    <span class=\"keyword\">let</span> averagedDistancePosition = simd_normalize(positionOffsetFromCamera) * averageDistance</span><br><span class=\"line\">    simdPosition = cameraWorldPosition + averagedDistancePosition</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    simdPosition = cameraWorldPosition + positionOffsetFromCamera</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>探索更吸引用户的交互方法。</strong>在AR体验中，pan平移手势（将手指移动到设备的屏幕上）并不是将虚拟对象拖动到新位置的唯一自然方式。用户也可以在移动设备时直观地将手指一直放置在虚拟对象上，从而将虚拟对象拖到AR场景中的新位置。</p>\n<p>即使手势在屏幕上的触摸位置没有改变，示例app也通过在拖动手势时不断的调用其 <code>updateObjectToCurrentTrackingPosition()</code> 方法来支持这种手势。若设备在拖动过程中发生移动，则该方法会计算其对应于触摸位置的新的现实位置，并相应地移动虚拟对象。</p>\n<h2 id=\"进入AR\"><a href=\"#进入AR\" class=\"headerlink\" title=\"进入AR\"></a>进入AR</h2><p><strong>指示用户何时进行初始化。</strong>该示例app通过文本提示显示有关AR session状态，通过浮动的文本视图显示与AR进行交互的说明。示例app的 <code>StatusViewController</code> 类管理此视图，可显示短暂的说明，该说明允许用户在读取它们之后消失，或显示始终保持可见的重要状态信息直至用户纠正问题。</p>\n<p><img src=\"https://docs-assets.developer.apple.com/published/f385e426f2/d665844f-2945-44f9-9896-06a1bb53251a.png\" alt=\"image\"></p>\n<h2 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h2><p><strong>如果不符合用户的期望可以重置。</strong>示例app具有一个始终在UI界面右上角的Reset重置按钮，允许用户重启AR体验不管其状态如何。参见示例代码的 <code>restartExperience()</code> 方法。</p>\n<p><strong>仅在支持的设备上提供AR功能</strong>。示例App的核心功能需要使用ARKit，因此它在Info.plist文件的 <a href=\"https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html#//apple_ref/doc/uid/TP40009252-SW3\" target=\"_blank\" rel=\"noopener\">UIRequiredDeviceCapabilities</a> 部分定义了 arkit 键。在部署构建的项目时，该键的设置可以防止在不支持ARKit的设备上安装。</p>\n<p>如果你的应用把ARKit作为辅助功能，请使用 <a href=\"https://developer.apple.com/documentation/arkit/arconfiguration/2923553-issupported\" target=\"_blank\" rel=\"noopener\">isSupported</a> 方法确定是否需要隐藏 ARKit 功能。</p>\n"},{"title":"iOS:阿里百川即时通讯功能","date":"2015-12-02T12:55:15.000Z","_content":"\n## 前言\n   \n在[iOS-webApp客户端开发小记](../../../../2015/11/06/iOS-webApp客户端开发-小记/) 的最后，我提到我们公司的产品需要在现有产品结构中加入即时通讯功能。经过对现有第三方即时通讯产品的试用和分析，我们最终选择了阿里百川提供的及时通讯功能。\n\n## 项目需求\n\n1.学生与老师之间要能沟通（单聊）\n\n2.在同一门课程中，老师与学生们在一个聊天群里（群聊）\n\n3.学生和老师要可以和我们公司的技术支持人员能沟通（客服）\n\n\n## 技术选型\n\n前期调研了容联云、LeanCloud、环信、Bmob、阿里百川、友盟等一些做即时通信服务的第三方服务。首先我们需要其提供iOS、Android、h5、Java的SDK，接着试用了他们的Demo，然后看他们的开发文档是否详尽（公司与公司之间的开发文档真的差距好大），最后看他们的技术实力与公司实力（总不能比我们的产品先倒闭吧，哈哈）。\n\n最后选中了阿里百川，首先其是阿里无线事业部下属的，他们的技术实力和公司实力不用怀疑。其实我第一眼看中的还是他们的开发文档，非常的完善，其次是这个项目应该开始不久，他们的技术支持非常给力，一线的开发人员在充当客服，在开发的时候还跟他们打了好几通电话，技术支持非常的棒。\n\n## 项目开发\n\n这里讲的是iOS端如何整合阿里百川的SDK。我采用的是Swift开发，而阿里百川提供的官方文档是针对Objective-C项目的，所以在此记录一下Swift项目是怎样整合的。下面主要介绍快速集成和APNS推送，相信通过这两点，就会对如何在Swift中调用IMSDK相关功能有个了解，那么其他功能调用也会容易实现。\n\n### 1.快速集成\n\n#### Step1-Step5 引入IMSDK\n按照阿里百川的即时通信服务的快速集成文档，完成Step1-Step5都是没有什么问题的。百川提供了非常好的胶水代码（将我们的App和IMSDK粘合起来的中间代码），其中包含对IMSDK主流程接口的调用代码，例如初始化、登录准备、登录、注销、打开会话列表、打开聊天页面。\n通过调用、学习胶水代码可以为我们后期自己直接操作IMSDK来定制功能提供方向。\n\n在拖入胶水代码后就是初始化IMSDK，由于胶水代码是OC文件，在Swift项目中需要建立桥接头文件，这里可以偷个懒，直接在项目中新建一个OC文件，然后会自动生成一个桥接头文件，然后再把刚才这个OC文件删除即可，这样可以省去在项目中配置桥接头文件这一步。接着，在桥接头文件中，引入胶水代码的头文件：`#import \"SPKitExample.h\"`\n\n#### Step6 初始化IMSDK\n\n在AppDelegate.swift调用基础入口胶水函数：`callThisInDidFinishLaunching`\n\n``` swift\nfunc application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool {\n    // Override point for customization after application launch.\n    //函数中初始化IMSDK\n        SPKitExample.sharedInstance().callThisInDidFinishLaunching()\n    return true\n}\n```\n注意：要到SPKitExample.m里exampleInit登录函数这把key换成我们自己申请的AppKey\n\n#### Step7 登录IMSDK\n\n在用户登录我们自己App的账号成功后，调用基础入口胶水函数callThisAfterISVAccountLoginSuccessWithYWLoginId，使其登录IMSDK。在应用里，我用Swift稍微封装了一下登录的代码:\n\n```swift\nfunc loginBaichuan(userid:String,password:String) {\n    //应用登陆成功后，调用SDK\n        SPKitExample.sharedInstance().callThisAfterISVAccountLoginSuccessWithYWLoginId(userid, passWord:password, preloginedBlock: nil, successBlock: {() -> Void in (\nprint(\"哈哈哈，登录成功！\"))}, failedBlock: nil)\n}\n```\n\n注意：在用户退出我们的App之后，还需要使其退出IMSDK，不然App在后台，用户没有登录我们的账号体系，但是还会受到来自即时通讯功能的新消息推送。这是退出的代码：\n\n`SPKitExample.sharedInstance().callThisBeforeISVAccountLogout()`\n\n#### Step8 打开会话列表和聊天页面\n\n1. 打开会话列表\n\n\t我们app采用的是UINavigationController方式，所以打开会话列表的代码如下：\n\n\t```swift\nfunc openTalkList(){\n    let result:YWConversationListViewController = SPKitExample.sharedInstance().ywIMKit.makeConversationListViewController()\n    result.title = \"最近联系人\"\n    result.setDidSelectItemBlock { (YWConversation) -> Void in (\n        SPKitExample.sharedInstance().exampleOpenConversationViewControllerWithConversation(YWConversation, fromNavigationController: self.navigationController))\n    }\n    self.navigationController?.navigationBarHidden = false\n    self.navigationController?.pushViewController(result, animated: true)\n}\n\t```\n\n2. 打开单聊页面\n\n\t我直接调用是胶水函数里面的`exampleOpenConversationViewControllerWithPerson`方法\n\t\n\t```swift\nfunc talk2Teacher(teacherId:String) { \n    SPKitExample.sharedInstance().exampleOpenConversationViewControllerWithPerson(YWPerson(personId:teacherId),fromNavigationController:self.navigationController)\n}\n\t```\n\n3. 打开群聊界面\n\n    阿里百川的文档里面写的是调用胶水函数里面的`exampleOpenConversationViewControllerWithTribe`方法，但是该方法要求传入一个`YWTribe`类型的群组聊天变量。由于阿里百川即时通讯的架构是自建账号体系，所以我们的App只能从服务器处获取当前用户所在群的群ID，但是胶水函数里面没有现成的通过群ID打开群聊的功能，所以我通过看胶水代码以及IMSDK的群服务相关的头文件`IYWTribeService.h`，找到`IMCore.getTribeService().requestTribeFromServer`函数，它可以返回一个`YWTribe`类型的群变量。所以我先通过该函数根据群ID查询到群信息，并且根据YWTribe类型的群变量再调用`exampleOpenConversationViewControllerWithTribe`方法。\n \n\t```swift\nfunc talk2Group(groudId:String) { \n    SPKitExample.sharedInstance().ywIMKit.IMCore.getTribeService().requestTribeFromServer(groudId, completion: { (YWTribe, NSError) -> Void in SPKitExample.sharedInstance().exampleOpenConversationViewControllerWithTribe(YWTribe,fromNavigationController:self.navigationController))\n}\n```\n\n\t我觉得，胶水函数里既然有根据对方的用户ID来打开单聊界面的封装函数，就应该有这样一个根据群ID来打开群聊界面的封装函数。当时，由于对IMSDK结构的不熟悉，这个功能我还花了一些时间来找接口实现。\n\n### 2.APNS推送\n\n我在另外一篇博文里介绍了在iOS9-Swift2-Xcode7环境下的APNS推送相关的内容，这里介绍一下具体的在阿里百川环境下的实现。\n\n#### Step1 制作并上传证书\n\n申请推送证书这个百度有很多教程，这里不在赘述了，反正要注意阿里百川的后台需要的生产环境的证书。\n\n#### Step2 申请DeviceToken\n\n首先需要在`AppDelegate.swift`文件的`func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool`函数里添加以下两句来向Apple的APNS服务器注册申请DeviceToken，这里可以设置新消息推送来App的展现形式，有Sound、Alert、Badge三种。\n\n```swift\nUIApplication.sharedApplication().registerUserNotificationSettings(UIUserNotificationSettings(forTypes: [UIUserNotificationType.Sound , UIUserNotificationType.Alert , UIUserNotificationType.Badge], categories: nil))\nUIApplication.sharedApplication().registerForRemoteNotifications()\n```\n\n接着添加注册申请DeviceToken成功的回调函数：\n\n\n```swift\nfunc application(application:UIApplication,didRegisterForRemoteNotificationsWithDeviceToken deviceToken:NSData) {\n    let token:String = deviceToken.description.stringByTrimmingCharactersInSet(NSCharacterSet(charactersInString: \"<>\"))\n    print(\"token==\\(token)\")\n    //将token发送到服务器\n}\n```\n注意：IMSDK会自动得到该DeviceToken，你无须手动传给IMSDK\n\n#### Step3 处理APNS消息\n\n由于初始化SDK的时候就调用了`SPKitExample.sharedInstance().callThisInDidFinishLaunching()`函数，在`callThisInDidFinishLaunching`里面已经调用了`exampleHandleAPNSPush()`,所以就不用像文档里面说的那样再在`AppDelegate didFinishLoadingWithOptions`调用`IYWPushService`的`setHandlePushBlockV3:`方法。\n\n#### Step4 Xcode设置为Distribution证书的AdHoc Provision打包\n\n由于阿里百川使用的生产环节下的推送证书，而我们又不能等到应用上线到AppStore后再测试，所以这里Provisioning Profiles使用AdHoc Provision，如何申请百度也有很多教程，这里就不在赘述。\n\n这里讲一下Xcode7设置打包环境的过程：\n\n首先设置Project下的Code Signing：\nCode Signing Identity 全部设置为Distribution证书\nProvisioning Profiles设置为申请的Distribution-AdHoc Provision证书\n\n再设置Target下的Code Signing：\nCode Signing Identity 全部设置为Automatic证书\nProvisioning Profiles设置为申请的Distribution-AdHoc Provision证书\n\n在这里我遇到很多坑，经过不断的测试才发现这样的设置可以正常使用。这里我有一个疑问，就是我在第一次使用阿里百川APNS推送时，对证书不是很了解，都没有申请Distribution-AdHoc Provision，糊里糊涂就实现了推送，但是后来不知道自己怎么改动了设置，APNS就不能推送到app了。后期我学习了苹果的证书系统，申请了Distribution-AdHoc Provision证书，才又实现了APNS推送，关于第一次是如何实现功能的，我到现在都没弄明白。\n\n#### Q&A\n\n如果App在后台收不到推送的消息，请参考我那篇博文以及百川的文档，里面有教我们如何利用APNS调试工具通过使用我们的证书，手动Push一条消息到我们的App。通过此方法检测推送证书和DeviceToken是否正确。如果手动推送可以，则说明App证书打包以及申请DeviceToken都是没有问题的，此时应该检测一下提交到阿里百川后台的证书有没有问题。\n\n## 项目总结\n\n即时通讯功能虽然只是我开发的app中的一个功能，但通过在项目中引用阿里百川即时通讯服务，让我懂了一点如何在Swift项目调用OC-SDK，这为我调用更多第三方OC语言SDK提供了基础。\n\n在这里非常感谢阿里百川-即时通讯的技术支持在我开发过程中提供的帮助！\n\n\n","source":"_posts/阿里百川即时通讯功能-iOS开发.md","raw":"---\ntitle: iOS:阿里百川即时通讯功能\ndate: 2015-12-02 20:55:15\ntags:\n- iOS\n- Swift\n- 即时通讯\n- 阿里百川\ncategories:\n- 开发\n- iOS\n---\n\n## 前言\n   \n在[iOS-webApp客户端开发小记](../../../../2015/11/06/iOS-webApp客户端开发-小记/) 的最后，我提到我们公司的产品需要在现有产品结构中加入即时通讯功能。经过对现有第三方即时通讯产品的试用和分析，我们最终选择了阿里百川提供的及时通讯功能。\n\n## 项目需求\n\n1.学生与老师之间要能沟通（单聊）\n\n2.在同一门课程中，老师与学生们在一个聊天群里（群聊）\n\n3.学生和老师要可以和我们公司的技术支持人员能沟通（客服）\n\n\n## 技术选型\n\n前期调研了容联云、LeanCloud、环信、Bmob、阿里百川、友盟等一些做即时通信服务的第三方服务。首先我们需要其提供iOS、Android、h5、Java的SDK，接着试用了他们的Demo，然后看他们的开发文档是否详尽（公司与公司之间的开发文档真的差距好大），最后看他们的技术实力与公司实力（总不能比我们的产品先倒闭吧，哈哈）。\n\n最后选中了阿里百川，首先其是阿里无线事业部下属的，他们的技术实力和公司实力不用怀疑。其实我第一眼看中的还是他们的开发文档，非常的完善，其次是这个项目应该开始不久，他们的技术支持非常给力，一线的开发人员在充当客服，在开发的时候还跟他们打了好几通电话，技术支持非常的棒。\n\n## 项目开发\n\n这里讲的是iOS端如何整合阿里百川的SDK。我采用的是Swift开发，而阿里百川提供的官方文档是针对Objective-C项目的，所以在此记录一下Swift项目是怎样整合的。下面主要介绍快速集成和APNS推送，相信通过这两点，就会对如何在Swift中调用IMSDK相关功能有个了解，那么其他功能调用也会容易实现。\n\n### 1.快速集成\n\n#### Step1-Step5 引入IMSDK\n按照阿里百川的即时通信服务的快速集成文档，完成Step1-Step5都是没有什么问题的。百川提供了非常好的胶水代码（将我们的App和IMSDK粘合起来的中间代码），其中包含对IMSDK主流程接口的调用代码，例如初始化、登录准备、登录、注销、打开会话列表、打开聊天页面。\n通过调用、学习胶水代码可以为我们后期自己直接操作IMSDK来定制功能提供方向。\n\n在拖入胶水代码后就是初始化IMSDK，由于胶水代码是OC文件，在Swift项目中需要建立桥接头文件，这里可以偷个懒，直接在项目中新建一个OC文件，然后会自动生成一个桥接头文件，然后再把刚才这个OC文件删除即可，这样可以省去在项目中配置桥接头文件这一步。接着，在桥接头文件中，引入胶水代码的头文件：`#import \"SPKitExample.h\"`\n\n#### Step6 初始化IMSDK\n\n在AppDelegate.swift调用基础入口胶水函数：`callThisInDidFinishLaunching`\n\n``` swift\nfunc application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool {\n    // Override point for customization after application launch.\n    //函数中初始化IMSDK\n        SPKitExample.sharedInstance().callThisInDidFinishLaunching()\n    return true\n}\n```\n注意：要到SPKitExample.m里exampleInit登录函数这把key换成我们自己申请的AppKey\n\n#### Step7 登录IMSDK\n\n在用户登录我们自己App的账号成功后，调用基础入口胶水函数callThisAfterISVAccountLoginSuccessWithYWLoginId，使其登录IMSDK。在应用里，我用Swift稍微封装了一下登录的代码:\n\n```swift\nfunc loginBaichuan(userid:String,password:String) {\n    //应用登陆成功后，调用SDK\n        SPKitExample.sharedInstance().callThisAfterISVAccountLoginSuccessWithYWLoginId(userid, passWord:password, preloginedBlock: nil, successBlock: {() -> Void in (\nprint(\"哈哈哈，登录成功！\"))}, failedBlock: nil)\n}\n```\n\n注意：在用户退出我们的App之后，还需要使其退出IMSDK，不然App在后台，用户没有登录我们的账号体系，但是还会受到来自即时通讯功能的新消息推送。这是退出的代码：\n\n`SPKitExample.sharedInstance().callThisBeforeISVAccountLogout()`\n\n#### Step8 打开会话列表和聊天页面\n\n1. 打开会话列表\n\n\t我们app采用的是UINavigationController方式，所以打开会话列表的代码如下：\n\n\t```swift\nfunc openTalkList(){\n    let result:YWConversationListViewController = SPKitExample.sharedInstance().ywIMKit.makeConversationListViewController()\n    result.title = \"最近联系人\"\n    result.setDidSelectItemBlock { (YWConversation) -> Void in (\n        SPKitExample.sharedInstance().exampleOpenConversationViewControllerWithConversation(YWConversation, fromNavigationController: self.navigationController))\n    }\n    self.navigationController?.navigationBarHidden = false\n    self.navigationController?.pushViewController(result, animated: true)\n}\n\t```\n\n2. 打开单聊页面\n\n\t我直接调用是胶水函数里面的`exampleOpenConversationViewControllerWithPerson`方法\n\t\n\t```swift\nfunc talk2Teacher(teacherId:String) { \n    SPKitExample.sharedInstance().exampleOpenConversationViewControllerWithPerson(YWPerson(personId:teacherId),fromNavigationController:self.navigationController)\n}\n\t```\n\n3. 打开群聊界面\n\n    阿里百川的文档里面写的是调用胶水函数里面的`exampleOpenConversationViewControllerWithTribe`方法，但是该方法要求传入一个`YWTribe`类型的群组聊天变量。由于阿里百川即时通讯的架构是自建账号体系，所以我们的App只能从服务器处获取当前用户所在群的群ID，但是胶水函数里面没有现成的通过群ID打开群聊的功能，所以我通过看胶水代码以及IMSDK的群服务相关的头文件`IYWTribeService.h`，找到`IMCore.getTribeService().requestTribeFromServer`函数，它可以返回一个`YWTribe`类型的群变量。所以我先通过该函数根据群ID查询到群信息，并且根据YWTribe类型的群变量再调用`exampleOpenConversationViewControllerWithTribe`方法。\n \n\t```swift\nfunc talk2Group(groudId:String) { \n    SPKitExample.sharedInstance().ywIMKit.IMCore.getTribeService().requestTribeFromServer(groudId, completion: { (YWTribe, NSError) -> Void in SPKitExample.sharedInstance().exampleOpenConversationViewControllerWithTribe(YWTribe,fromNavigationController:self.navigationController))\n}\n```\n\n\t我觉得，胶水函数里既然有根据对方的用户ID来打开单聊界面的封装函数，就应该有这样一个根据群ID来打开群聊界面的封装函数。当时，由于对IMSDK结构的不熟悉，这个功能我还花了一些时间来找接口实现。\n\n### 2.APNS推送\n\n我在另外一篇博文里介绍了在iOS9-Swift2-Xcode7环境下的APNS推送相关的内容，这里介绍一下具体的在阿里百川环境下的实现。\n\n#### Step1 制作并上传证书\n\n申请推送证书这个百度有很多教程，这里不在赘述了，反正要注意阿里百川的后台需要的生产环境的证书。\n\n#### Step2 申请DeviceToken\n\n首先需要在`AppDelegate.swift`文件的`func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool`函数里添加以下两句来向Apple的APNS服务器注册申请DeviceToken，这里可以设置新消息推送来App的展现形式，有Sound、Alert、Badge三种。\n\n```swift\nUIApplication.sharedApplication().registerUserNotificationSettings(UIUserNotificationSettings(forTypes: [UIUserNotificationType.Sound , UIUserNotificationType.Alert , UIUserNotificationType.Badge], categories: nil))\nUIApplication.sharedApplication().registerForRemoteNotifications()\n```\n\n接着添加注册申请DeviceToken成功的回调函数：\n\n\n```swift\nfunc application(application:UIApplication,didRegisterForRemoteNotificationsWithDeviceToken deviceToken:NSData) {\n    let token:String = deviceToken.description.stringByTrimmingCharactersInSet(NSCharacterSet(charactersInString: \"<>\"))\n    print(\"token==\\(token)\")\n    //将token发送到服务器\n}\n```\n注意：IMSDK会自动得到该DeviceToken，你无须手动传给IMSDK\n\n#### Step3 处理APNS消息\n\n由于初始化SDK的时候就调用了`SPKitExample.sharedInstance().callThisInDidFinishLaunching()`函数，在`callThisInDidFinishLaunching`里面已经调用了`exampleHandleAPNSPush()`,所以就不用像文档里面说的那样再在`AppDelegate didFinishLoadingWithOptions`调用`IYWPushService`的`setHandlePushBlockV3:`方法。\n\n#### Step4 Xcode设置为Distribution证书的AdHoc Provision打包\n\n由于阿里百川使用的生产环节下的推送证书，而我们又不能等到应用上线到AppStore后再测试，所以这里Provisioning Profiles使用AdHoc Provision，如何申请百度也有很多教程，这里就不在赘述。\n\n这里讲一下Xcode7设置打包环境的过程：\n\n首先设置Project下的Code Signing：\nCode Signing Identity 全部设置为Distribution证书\nProvisioning Profiles设置为申请的Distribution-AdHoc Provision证书\n\n再设置Target下的Code Signing：\nCode Signing Identity 全部设置为Automatic证书\nProvisioning Profiles设置为申请的Distribution-AdHoc Provision证书\n\n在这里我遇到很多坑，经过不断的测试才发现这样的设置可以正常使用。这里我有一个疑问，就是我在第一次使用阿里百川APNS推送时，对证书不是很了解，都没有申请Distribution-AdHoc Provision，糊里糊涂就实现了推送，但是后来不知道自己怎么改动了设置，APNS就不能推送到app了。后期我学习了苹果的证书系统，申请了Distribution-AdHoc Provision证书，才又实现了APNS推送，关于第一次是如何实现功能的，我到现在都没弄明白。\n\n#### Q&A\n\n如果App在后台收不到推送的消息，请参考我那篇博文以及百川的文档，里面有教我们如何利用APNS调试工具通过使用我们的证书，手动Push一条消息到我们的App。通过此方法检测推送证书和DeviceToken是否正确。如果手动推送可以，则说明App证书打包以及申请DeviceToken都是没有问题的，此时应该检测一下提交到阿里百川后台的证书有没有问题。\n\n## 项目总结\n\n即时通讯功能虽然只是我开发的app中的一个功能，但通过在项目中引用阿里百川即时通讯服务，让我懂了一点如何在Swift项目调用OC-SDK，这为我调用更多第三方OC语言SDK提供了基础。\n\n在这里非常感谢阿里百川-即时通讯的技术支持在我开发过程中提供的帮助！\n\n\n","slug":"阿里百川即时通讯功能-iOS开发","published":1,"updated":"2019-06-16T15:37:13.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjxbvqkfn003zwq1kb74tpjsy","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>在<a href=\"../../../../2015/11/06/iOS-webApp客户端开发-小记/\">iOS-webApp客户端开发小记</a> 的最后，我提到我们公司的产品需要在现有产品结构中加入即时通讯功能。经过对现有第三方即时通讯产品的试用和分析，我们最终选择了阿里百川提供的及时通讯功能。</p>\n<h2 id=\"项目需求\"><a href=\"#项目需求\" class=\"headerlink\" title=\"项目需求\"></a>项目需求</h2><p>1.学生与老师之间要能沟通（单聊）</p>\n<p>2.在同一门课程中，老师与学生们在一个聊天群里（群聊）</p>\n<p>3.学生和老师要可以和我们公司的技术支持人员能沟通（客服）</p>\n<h2 id=\"技术选型\"><a href=\"#技术选型\" class=\"headerlink\" title=\"技术选型\"></a>技术选型</h2><p>前期调研了容联云、LeanCloud、环信、Bmob、阿里百川、友盟等一些做即时通信服务的第三方服务。首先我们需要其提供iOS、Android、h5、Java的SDK，接着试用了他们的Demo，然后看他们的开发文档是否详尽（公司与公司之间的开发文档真的差距好大），最后看他们的技术实力与公司实力（总不能比我们的产品先倒闭吧，哈哈）。</p>\n<p>最后选中了阿里百川，首先其是阿里无线事业部下属的，他们的技术实力和公司实力不用怀疑。其实我第一眼看中的还是他们的开发文档，非常的完善，其次是这个项目应该开始不久，他们的技术支持非常给力，一线的开发人员在充当客服，在开发的时候还跟他们打了好几通电话，技术支持非常的棒。</p>\n<h2 id=\"项目开发\"><a href=\"#项目开发\" class=\"headerlink\" title=\"项目开发\"></a>项目开发</h2><p>这里讲的是iOS端如何整合阿里百川的SDK。我采用的是Swift开发，而阿里百川提供的官方文档是针对Objective-C项目的，所以在此记录一下Swift项目是怎样整合的。下面主要介绍快速集成和APNS推送，相信通过这两点，就会对如何在Swift中调用IMSDK相关功能有个了解，那么其他功能调用也会容易实现。</p>\n<h3 id=\"1-快速集成\"><a href=\"#1-快速集成\" class=\"headerlink\" title=\"1.快速集成\"></a>1.快速集成</h3><h4 id=\"Step1-Step5-引入IMSDK\"><a href=\"#Step1-Step5-引入IMSDK\" class=\"headerlink\" title=\"Step1-Step5 引入IMSDK\"></a>Step1-Step5 引入IMSDK</h4><p>按照阿里百川的即时通信服务的快速集成文档，完成Step1-Step5都是没有什么问题的。百川提供了非常好的胶水代码（将我们的App和IMSDK粘合起来的中间代码），其中包含对IMSDK主流程接口的调用代码，例如初始化、登录准备、登录、注销、打开会话列表、打开聊天页面。<br>通过调用、学习胶水代码可以为我们后期自己直接操作IMSDK来定制功能提供方向。</p>\n<p>在拖入胶水代码后就是初始化IMSDK，由于胶水代码是OC文件，在Swift项目中需要建立桥接头文件，这里可以偷个懒，直接在项目中新建一个OC文件，然后会自动生成一个桥接头文件，然后再把刚才这个OC文件删除即可，这样可以省去在项目中配置桥接头文件这一步。接着，在桥接头文件中，引入胶水代码的头文件：<code>#import &quot;SPKitExample.h&quot;</code></p>\n<h4 id=\"Step6-初始化IMSDK\"><a href=\"#Step6-初始化IMSDK\" class=\"headerlink\" title=\"Step6 初始化IMSDK\"></a>Step6 初始化IMSDK</h4><p>在AppDelegate.swift调用基础入口胶水函数：<code>callThisInDidFinishLaunching</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">application</span><span class=\"params\">(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?)</span></span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Override point for customization after application launch.</span></span><br><span class=\"line\">    <span class=\"comment\">//函数中初始化IMSDK</span></span><br><span class=\"line\">        <span class=\"type\">SPKitExample</span>.sharedInstance().callThisInDidFinishLaunching()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意：要到SPKitExample.m里exampleInit登录函数这把key换成我们自己申请的AppKey</p>\n<h4 id=\"Step7-登录IMSDK\"><a href=\"#Step7-登录IMSDK\" class=\"headerlink\" title=\"Step7 登录IMSDK\"></a>Step7 登录IMSDK</h4><p>在用户登录我们自己App的账号成功后，调用基础入口胶水函数callThisAfterISVAccountLoginSuccessWithYWLoginId，使其登录IMSDK。在应用里，我用Swift稍微封装了一下登录的代码:</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">loginBaichuan</span><span class=\"params\">(userid:String,password:String)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//应用登陆成功后，调用SDK</span></span><br><span class=\"line\">        <span class=\"type\">SPKitExample</span>.sharedInstance().callThisAfterISVAccountLoginSuccessWithYWLoginId(userid, passWord:password, preloginedBlock: <span class=\"literal\">nil</span>, successBlock: &#123;() -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span> (</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"哈哈哈，登录成功！\"</span>))&#125;, failedBlock: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意：在用户退出我们的App之后，还需要使其退出IMSDK，不然App在后台，用户没有登录我们的账号体系，但是还会受到来自即时通讯功能的新消息推送。这是退出的代码：</p>\n<p><code>SPKitExample.sharedInstance().callThisBeforeISVAccountLogout()</code></p>\n<h4 id=\"Step8-打开会话列表和聊天页面\"><a href=\"#Step8-打开会话列表和聊天页面\" class=\"headerlink\" title=\"Step8 打开会话列表和聊天页面\"></a>Step8 打开会话列表和聊天页面</h4><ol>\n<li><p>打开会话列表</p>\n<p> 我们app采用的是UINavigationController方式，所以打开会话列表的代码如下：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">openTalkList</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result:<span class=\"type\">YWConversationListViewController</span> = <span class=\"type\">SPKitExample</span>.sharedInstance().ywIMKit.makeConversationListViewController()</span><br><span class=\"line\">    result.title = <span class=\"string\">\"最近联系人\"</span></span><br><span class=\"line\">    result.setDidSelectItemBlock &#123; (<span class=\"type\">YWConversation</span>) -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span> (</span><br><span class=\"line\">        <span class=\"type\">SPKitExample</span>.sharedInstance().exampleOpenConversationViewControllerWithConversation(<span class=\"type\">YWConversation</span>, fromNavigationController: <span class=\"keyword\">self</span>.navigationController))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.navigationController?.navigationBarHidden = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.navigationController?.pushViewController(result, animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>打开单聊页面</p>\n<p> 我直接调用是胶水函数里面的<code>exampleOpenConversationViewControllerWithPerson</code>方法</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">talk2Teacher</span><span class=\"params\">(teacherId:String)</span></span> &#123; </span><br><span class=\"line\">    <span class=\"type\">SPKitExample</span>.sharedInstance().exampleOpenConversationViewControllerWithPerson(<span class=\"type\">YWPerson</span>(personId:teacherId),fromNavigationController:<span class=\"keyword\">self</span>.navigationController)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>打开群聊界面</p>\n<p> 阿里百川的文档里面写的是调用胶水函数里面的<code>exampleOpenConversationViewControllerWithTribe</code>方法，但是该方法要求传入一个<code>YWTribe</code>类型的群组聊天变量。由于阿里百川即时通讯的架构是自建账号体系，所以我们的App只能从服务器处获取当前用户所在群的群ID，但是胶水函数里面没有现成的通过群ID打开群聊的功能，所以我通过看胶水代码以及IMSDK的群服务相关的头文件<code>IYWTribeService.h</code>，找到<code>IMCore.getTribeService().requestTribeFromServer</code>函数，它可以返回一个<code>YWTribe</code>类型的群变量。所以我先通过该函数根据群ID查询到群信息，并且根据YWTribe类型的群变量再调用<code>exampleOpenConversationViewControllerWithTribe</code>方法。</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">talk2Group</span><span class=\"params\">(groudId:String)</span></span> &#123; </span><br><span class=\"line\">    <span class=\"type\">SPKitExample</span>.sharedInstance().ywIMKit.<span class=\"type\">IMCore</span>.getTribeService().requestTribeFromServer(groudId, completion: &#123; (<span class=\"type\">YWTribe</span>, <span class=\"type\">NSError</span>) -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span> <span class=\"type\">SPKitExample</span>.sharedInstance().exampleOpenConversationViewControllerWithTribe(<span class=\"type\">YWTribe</span>,fromNavigationController:<span class=\"keyword\">self</span>.navigationController))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 我觉得，胶水函数里既然有根据对方的用户ID来打开单聊界面的封装函数，就应该有这样一个根据群ID来打开群聊界面的封装函数。当时，由于对IMSDK结构的不熟悉，这个功能我还花了一些时间来找接口实现。</p>\n</li>\n</ol>\n<h3 id=\"2-APNS推送\"><a href=\"#2-APNS推送\" class=\"headerlink\" title=\"2.APNS推送\"></a>2.APNS推送</h3><p>我在另外一篇博文里介绍了在iOS9-Swift2-Xcode7环境下的APNS推送相关的内容，这里介绍一下具体的在阿里百川环境下的实现。</p>\n<h4 id=\"Step1-制作并上传证书\"><a href=\"#Step1-制作并上传证书\" class=\"headerlink\" title=\"Step1 制作并上传证书\"></a>Step1 制作并上传证书</h4><p>申请推送证书这个百度有很多教程，这里不在赘述了，反正要注意阿里百川的后台需要的生产环境的证书。</p>\n<h4 id=\"Step2-申请DeviceToken\"><a href=\"#Step2-申请DeviceToken\" class=\"headerlink\" title=\"Step2 申请DeviceToken\"></a>Step2 申请DeviceToken</h4><p>首先需要在<code>AppDelegate.swift</code>文件的<code>func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -&gt; Bool</code>函数里添加以下两句来向Apple的APNS服务器注册申请DeviceToken，这里可以设置新消息推送来App的展现形式，有Sound、Alert、Badge三种。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">UIApplication</span>.sharedApplication().registerUserNotificationSettings(<span class=\"type\">UIUserNotificationSettings</span>(forTypes: [<span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Sound</span> , <span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Alert</span> , <span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Badge</span>], categories: <span class=\"literal\">nil</span>))</span><br><span class=\"line\"><span class=\"type\">UIApplication</span>.sharedApplication().registerForRemoteNotifications()</span><br></pre></td></tr></table></figure>\n\n<p>接着添加注册申请DeviceToken成功的回调函数：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">application</span><span class=\"params\">(application:UIApplication,didRegisterForRemoteNotificationsWithDeviceToken deviceToken:NSData)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> token:<span class=\"type\">String</span> = deviceToken.description.stringByTrimmingCharactersInSet(<span class=\"type\">NSCharacterSet</span>(charactersInString: <span class=\"string\">\"&lt;&gt;\"</span>))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"token==\\(token)\"</span>)</span><br><span class=\"line\">    <span class=\"comment\">//将token发送到服务器</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意：IMSDK会自动得到该DeviceToken，你无须手动传给IMSDK</p>\n<h4 id=\"Step3-处理APNS消息\"><a href=\"#Step3-处理APNS消息\" class=\"headerlink\" title=\"Step3 处理APNS消息\"></a>Step3 处理APNS消息</h4><p>由于初始化SDK的时候就调用了<code>SPKitExample.sharedInstance().callThisInDidFinishLaunching()</code>函数，在<code>callThisInDidFinishLaunching</code>里面已经调用了<code>exampleHandleAPNSPush()</code>,所以就不用像文档里面说的那样再在<code>AppDelegate didFinishLoadingWithOptions</code>调用<code>IYWPushService</code>的<code>setHandlePushBlockV3:</code>方法。</p>\n<h4 id=\"Step4-Xcode设置为Distribution证书的AdHoc-Provision打包\"><a href=\"#Step4-Xcode设置为Distribution证书的AdHoc-Provision打包\" class=\"headerlink\" title=\"Step4 Xcode设置为Distribution证书的AdHoc Provision打包\"></a>Step4 Xcode设置为Distribution证书的AdHoc Provision打包</h4><p>由于阿里百川使用的生产环节下的推送证书，而我们又不能等到应用上线到AppStore后再测试，所以这里Provisioning Profiles使用AdHoc Provision，如何申请百度也有很多教程，这里就不在赘述。</p>\n<p>这里讲一下Xcode7设置打包环境的过程：</p>\n<p>首先设置Project下的Code Signing：<br>Code Signing Identity 全部设置为Distribution证书<br>Provisioning Profiles设置为申请的Distribution-AdHoc Provision证书</p>\n<p>再设置Target下的Code Signing：<br>Code Signing Identity 全部设置为Automatic证书<br>Provisioning Profiles设置为申请的Distribution-AdHoc Provision证书</p>\n<p>在这里我遇到很多坑，经过不断的测试才发现这样的设置可以正常使用。这里我有一个疑问，就是我在第一次使用阿里百川APNS推送时，对证书不是很了解，都没有申请Distribution-AdHoc Provision，糊里糊涂就实现了推送，但是后来不知道自己怎么改动了设置，APNS就不能推送到app了。后期我学习了苹果的证书系统，申请了Distribution-AdHoc Provision证书，才又实现了APNS推送，关于第一次是如何实现功能的，我到现在都没弄明白。</p>\n<h4 id=\"Q-amp-A\"><a href=\"#Q-amp-A\" class=\"headerlink\" title=\"Q&amp;A\"></a>Q&amp;A</h4><p>如果App在后台收不到推送的消息，请参考我那篇博文以及百川的文档，里面有教我们如何利用APNS调试工具通过使用我们的证书，手动Push一条消息到我们的App。通过此方法检测推送证书和DeviceToken是否正确。如果手动推送可以，则说明App证书打包以及申请DeviceToken都是没有问题的，此时应该检测一下提交到阿里百川后台的证书有没有问题。</p>\n<h2 id=\"项目总结\"><a href=\"#项目总结\" class=\"headerlink\" title=\"项目总结\"></a>项目总结</h2><p>即时通讯功能虽然只是我开发的app中的一个功能，但通过在项目中引用阿里百川即时通讯服务，让我懂了一点如何在Swift项目调用OC-SDK，这为我调用更多第三方OC语言SDK提供了基础。</p>\n<p>在这里非常感谢阿里百川-即时通讯的技术支持在我开发过程中提供的帮助！</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>在<a href=\"../../../../2015/11/06/iOS-webApp客户端开发-小记/\">iOS-webApp客户端开发小记</a> 的最后，我提到我们公司的产品需要在现有产品结构中加入即时通讯功能。经过对现有第三方即时通讯产品的试用和分析，我们最终选择了阿里百川提供的及时通讯功能。</p>\n<h2 id=\"项目需求\"><a href=\"#项目需求\" class=\"headerlink\" title=\"项目需求\"></a>项目需求</h2><p>1.学生与老师之间要能沟通（单聊）</p>\n<p>2.在同一门课程中，老师与学生们在一个聊天群里（群聊）</p>\n<p>3.学生和老师要可以和我们公司的技术支持人员能沟通（客服）</p>\n<h2 id=\"技术选型\"><a href=\"#技术选型\" class=\"headerlink\" title=\"技术选型\"></a>技术选型</h2><p>前期调研了容联云、LeanCloud、环信、Bmob、阿里百川、友盟等一些做即时通信服务的第三方服务。首先我们需要其提供iOS、Android、h5、Java的SDK，接着试用了他们的Demo，然后看他们的开发文档是否详尽（公司与公司之间的开发文档真的差距好大），最后看他们的技术实力与公司实力（总不能比我们的产品先倒闭吧，哈哈）。</p>\n<p>最后选中了阿里百川，首先其是阿里无线事业部下属的，他们的技术实力和公司实力不用怀疑。其实我第一眼看中的还是他们的开发文档，非常的完善，其次是这个项目应该开始不久，他们的技术支持非常给力，一线的开发人员在充当客服，在开发的时候还跟他们打了好几通电话，技术支持非常的棒。</p>\n<h2 id=\"项目开发\"><a href=\"#项目开发\" class=\"headerlink\" title=\"项目开发\"></a>项目开发</h2><p>这里讲的是iOS端如何整合阿里百川的SDK。我采用的是Swift开发，而阿里百川提供的官方文档是针对Objective-C项目的，所以在此记录一下Swift项目是怎样整合的。下面主要介绍快速集成和APNS推送，相信通过这两点，就会对如何在Swift中调用IMSDK相关功能有个了解，那么其他功能调用也会容易实现。</p>\n<h3 id=\"1-快速集成\"><a href=\"#1-快速集成\" class=\"headerlink\" title=\"1.快速集成\"></a>1.快速集成</h3><h4 id=\"Step1-Step5-引入IMSDK\"><a href=\"#Step1-Step5-引入IMSDK\" class=\"headerlink\" title=\"Step1-Step5 引入IMSDK\"></a>Step1-Step5 引入IMSDK</h4><p>按照阿里百川的即时通信服务的快速集成文档，完成Step1-Step5都是没有什么问题的。百川提供了非常好的胶水代码（将我们的App和IMSDK粘合起来的中间代码），其中包含对IMSDK主流程接口的调用代码，例如初始化、登录准备、登录、注销、打开会话列表、打开聊天页面。<br>通过调用、学习胶水代码可以为我们后期自己直接操作IMSDK来定制功能提供方向。</p>\n<p>在拖入胶水代码后就是初始化IMSDK，由于胶水代码是OC文件，在Swift项目中需要建立桥接头文件，这里可以偷个懒，直接在项目中新建一个OC文件，然后会自动生成一个桥接头文件，然后再把刚才这个OC文件删除即可，这样可以省去在项目中配置桥接头文件这一步。接着，在桥接头文件中，引入胶水代码的头文件：<code>#import &quot;SPKitExample.h&quot;</code></p>\n<h4 id=\"Step6-初始化IMSDK\"><a href=\"#Step6-初始化IMSDK\" class=\"headerlink\" title=\"Step6 初始化IMSDK\"></a>Step6 初始化IMSDK</h4><p>在AppDelegate.swift调用基础入口胶水函数：<code>callThisInDidFinishLaunching</code></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">application</span><span class=\"params\">(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?)</span></span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Override point for customization after application launch.</span></span><br><span class=\"line\">    <span class=\"comment\">//函数中初始化IMSDK</span></span><br><span class=\"line\">        <span class=\"type\">SPKitExample</span>.sharedInstance().callThisInDidFinishLaunching()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意：要到SPKitExample.m里exampleInit登录函数这把key换成我们自己申请的AppKey</p>\n<h4 id=\"Step7-登录IMSDK\"><a href=\"#Step7-登录IMSDK\" class=\"headerlink\" title=\"Step7 登录IMSDK\"></a>Step7 登录IMSDK</h4><p>在用户登录我们自己App的账号成功后，调用基础入口胶水函数callThisAfterISVAccountLoginSuccessWithYWLoginId，使其登录IMSDK。在应用里，我用Swift稍微封装了一下登录的代码:</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">loginBaichuan</span><span class=\"params\">(userid:String,password:String)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//应用登陆成功后，调用SDK</span></span><br><span class=\"line\">        <span class=\"type\">SPKitExample</span>.sharedInstance().callThisAfterISVAccountLoginSuccessWithYWLoginId(userid, passWord:password, preloginedBlock: <span class=\"literal\">nil</span>, successBlock: &#123;() -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span> (</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"哈哈哈，登录成功！\"</span>))&#125;, failedBlock: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意：在用户退出我们的App之后，还需要使其退出IMSDK，不然App在后台，用户没有登录我们的账号体系，但是还会受到来自即时通讯功能的新消息推送。这是退出的代码：</p>\n<p><code>SPKitExample.sharedInstance().callThisBeforeISVAccountLogout()</code></p>\n<h4 id=\"Step8-打开会话列表和聊天页面\"><a href=\"#Step8-打开会话列表和聊天页面\" class=\"headerlink\" title=\"Step8 打开会话列表和聊天页面\"></a>Step8 打开会话列表和聊天页面</h4><ol>\n<li><p>打开会话列表</p>\n<p> 我们app采用的是UINavigationController方式，所以打开会话列表的代码如下：</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">openTalkList</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result:<span class=\"type\">YWConversationListViewController</span> = <span class=\"type\">SPKitExample</span>.sharedInstance().ywIMKit.makeConversationListViewController()</span><br><span class=\"line\">    result.title = <span class=\"string\">\"最近联系人\"</span></span><br><span class=\"line\">    result.setDidSelectItemBlock &#123; (<span class=\"type\">YWConversation</span>) -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span> (</span><br><span class=\"line\">        <span class=\"type\">SPKitExample</span>.sharedInstance().exampleOpenConversationViewControllerWithConversation(<span class=\"type\">YWConversation</span>, fromNavigationController: <span class=\"keyword\">self</span>.navigationController))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.navigationController?.navigationBarHidden = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.navigationController?.pushViewController(result, animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>打开单聊页面</p>\n<p> 我直接调用是胶水函数里面的<code>exampleOpenConversationViewControllerWithPerson</code>方法</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">talk2Teacher</span><span class=\"params\">(teacherId:String)</span></span> &#123; </span><br><span class=\"line\">    <span class=\"type\">SPKitExample</span>.sharedInstance().exampleOpenConversationViewControllerWithPerson(<span class=\"type\">YWPerson</span>(personId:teacherId),fromNavigationController:<span class=\"keyword\">self</span>.navigationController)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>打开群聊界面</p>\n<p> 阿里百川的文档里面写的是调用胶水函数里面的<code>exampleOpenConversationViewControllerWithTribe</code>方法，但是该方法要求传入一个<code>YWTribe</code>类型的群组聊天变量。由于阿里百川即时通讯的架构是自建账号体系，所以我们的App只能从服务器处获取当前用户所在群的群ID，但是胶水函数里面没有现成的通过群ID打开群聊的功能，所以我通过看胶水代码以及IMSDK的群服务相关的头文件<code>IYWTribeService.h</code>，找到<code>IMCore.getTribeService().requestTribeFromServer</code>函数，它可以返回一个<code>YWTribe</code>类型的群变量。所以我先通过该函数根据群ID查询到群信息，并且根据YWTribe类型的群变量再调用<code>exampleOpenConversationViewControllerWithTribe</code>方法。</p>\n <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">talk2Group</span><span class=\"params\">(groudId:String)</span></span> &#123; </span><br><span class=\"line\">    <span class=\"type\">SPKitExample</span>.sharedInstance().ywIMKit.<span class=\"type\">IMCore</span>.getTribeService().requestTribeFromServer(groudId, completion: &#123; (<span class=\"type\">YWTribe</span>, <span class=\"type\">NSError</span>) -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span> <span class=\"type\">SPKitExample</span>.sharedInstance().exampleOpenConversationViewControllerWithTribe(<span class=\"type\">YWTribe</span>,fromNavigationController:<span class=\"keyword\">self</span>.navigationController))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 我觉得，胶水函数里既然有根据对方的用户ID来打开单聊界面的封装函数，就应该有这样一个根据群ID来打开群聊界面的封装函数。当时，由于对IMSDK结构的不熟悉，这个功能我还花了一些时间来找接口实现。</p>\n</li>\n</ol>\n<h3 id=\"2-APNS推送\"><a href=\"#2-APNS推送\" class=\"headerlink\" title=\"2.APNS推送\"></a>2.APNS推送</h3><p>我在另外一篇博文里介绍了在iOS9-Swift2-Xcode7环境下的APNS推送相关的内容，这里介绍一下具体的在阿里百川环境下的实现。</p>\n<h4 id=\"Step1-制作并上传证书\"><a href=\"#Step1-制作并上传证书\" class=\"headerlink\" title=\"Step1 制作并上传证书\"></a>Step1 制作并上传证书</h4><p>申请推送证书这个百度有很多教程，这里不在赘述了，反正要注意阿里百川的后台需要的生产环境的证书。</p>\n<h4 id=\"Step2-申请DeviceToken\"><a href=\"#Step2-申请DeviceToken\" class=\"headerlink\" title=\"Step2 申请DeviceToken\"></a>Step2 申请DeviceToken</h4><p>首先需要在<code>AppDelegate.swift</code>文件的<code>func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -&gt; Bool</code>函数里添加以下两句来向Apple的APNS服务器注册申请DeviceToken，这里可以设置新消息推送来App的展现形式，有Sound、Alert、Badge三种。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">UIApplication</span>.sharedApplication().registerUserNotificationSettings(<span class=\"type\">UIUserNotificationSettings</span>(forTypes: [<span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Sound</span> , <span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Alert</span> , <span class=\"type\">UIUserNotificationType</span>.<span class=\"type\">Badge</span>], categories: <span class=\"literal\">nil</span>))</span><br><span class=\"line\"><span class=\"type\">UIApplication</span>.sharedApplication().registerForRemoteNotifications()</span><br></pre></td></tr></table></figure>\n\n<p>接着添加注册申请DeviceToken成功的回调函数：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">application</span><span class=\"params\">(application:UIApplication,didRegisterForRemoteNotificationsWithDeviceToken deviceToken:NSData)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> token:<span class=\"type\">String</span> = deviceToken.description.stringByTrimmingCharactersInSet(<span class=\"type\">NSCharacterSet</span>(charactersInString: <span class=\"string\">\"&lt;&gt;\"</span>))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"token==\\(token)\"</span>)</span><br><span class=\"line\">    <span class=\"comment\">//将token发送到服务器</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>注意：IMSDK会自动得到该DeviceToken，你无须手动传给IMSDK</p>\n<h4 id=\"Step3-处理APNS消息\"><a href=\"#Step3-处理APNS消息\" class=\"headerlink\" title=\"Step3 处理APNS消息\"></a>Step3 处理APNS消息</h4><p>由于初始化SDK的时候就调用了<code>SPKitExample.sharedInstance().callThisInDidFinishLaunching()</code>函数，在<code>callThisInDidFinishLaunching</code>里面已经调用了<code>exampleHandleAPNSPush()</code>,所以就不用像文档里面说的那样再在<code>AppDelegate didFinishLoadingWithOptions</code>调用<code>IYWPushService</code>的<code>setHandlePushBlockV3:</code>方法。</p>\n<h4 id=\"Step4-Xcode设置为Distribution证书的AdHoc-Provision打包\"><a href=\"#Step4-Xcode设置为Distribution证书的AdHoc-Provision打包\" class=\"headerlink\" title=\"Step4 Xcode设置为Distribution证书的AdHoc Provision打包\"></a>Step4 Xcode设置为Distribution证书的AdHoc Provision打包</h4><p>由于阿里百川使用的生产环节下的推送证书，而我们又不能等到应用上线到AppStore后再测试，所以这里Provisioning Profiles使用AdHoc Provision，如何申请百度也有很多教程，这里就不在赘述。</p>\n<p>这里讲一下Xcode7设置打包环境的过程：</p>\n<p>首先设置Project下的Code Signing：<br>Code Signing Identity 全部设置为Distribution证书<br>Provisioning Profiles设置为申请的Distribution-AdHoc Provision证书</p>\n<p>再设置Target下的Code Signing：<br>Code Signing Identity 全部设置为Automatic证书<br>Provisioning Profiles设置为申请的Distribution-AdHoc Provision证书</p>\n<p>在这里我遇到很多坑，经过不断的测试才发现这样的设置可以正常使用。这里我有一个疑问，就是我在第一次使用阿里百川APNS推送时，对证书不是很了解，都没有申请Distribution-AdHoc Provision，糊里糊涂就实现了推送，但是后来不知道自己怎么改动了设置，APNS就不能推送到app了。后期我学习了苹果的证书系统，申请了Distribution-AdHoc Provision证书，才又实现了APNS推送，关于第一次是如何实现功能的，我到现在都没弄明白。</p>\n<h4 id=\"Q-amp-A\"><a href=\"#Q-amp-A\" class=\"headerlink\" title=\"Q&amp;A\"></a>Q&amp;A</h4><p>如果App在后台收不到推送的消息，请参考我那篇博文以及百川的文档，里面有教我们如何利用APNS调试工具通过使用我们的证书，手动Push一条消息到我们的App。通过此方法检测推送证书和DeviceToken是否正确。如果手动推送可以，则说明App证书打包以及申请DeviceToken都是没有问题的，此时应该检测一下提交到阿里百川后台的证书有没有问题。</p>\n<h2 id=\"项目总结\"><a href=\"#项目总结\" class=\"headerlink\" title=\"项目总结\"></a>项目总结</h2><p>即时通讯功能虽然只是我开发的app中的一个功能，但通过在项目中引用阿里百川即时通讯服务，让我懂了一点如何在Swift项目调用OC-SDK，这为我调用更多第三方OC语言SDK提供了基础。</p>\n<p>在这里非常感谢阿里百川-即时通讯的技术支持在我开发过程中提供的帮助！</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cjxbvqkb20001wq1kczgjyp1y","category_id":"cjxbvqkb80007wq1kcas23rdi","_id":"cjxbvqkbe000hwq1kbvk8royw"},{"post_id":"cjxbvqkaz0000wq1ke50tw665","category_id":"cjxbvqkb40002wq1kum0ty4oa","_id":"cjxbvqkbk000wwq1k2m5al65t"},{"post_id":"cjxbvqkaz0000wq1ke50tw665","category_id":"cjxbvqkbg000mwq1k9omsaf63","_id":"cjxbvqkbk000ywq1k8xg1h0zp"},{"post_id":"cjxbvqkb60004wq1ksxym311s","category_id":"cjxbvqkbb000bwq1kvggeoetb","_id":"cjxbvqkbn001cwq1keqkn9lax"},{"post_id":"cjxbvqkb60004wq1ksxym311s","category_id":"cjxbvqkbm0016wq1kqa12fs95","_id":"cjxbvqkbn001ewq1k8z81td0r"},{"post_id":"cjxbvqkbe000kwq1k580a2sun","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbo001kwq1kb4fakj1t"},{"post_id":"cjxbvqkbe000kwq1k580a2sun","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbo001lwq1kx83vlajc"},{"post_id":"cjxbvqkb70005wq1k5obdme6s","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbo001owq1kbk7r9n61"},{"post_id":"cjxbvqkb70005wq1k5obdme6s","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbp001qwq1kdnyavblr"},{"post_id":"cjxbvqkbf000lwq1k9wzmf6np","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbp001twq1kokka28ch"},{"post_id":"cjxbvqkbf000lwq1k9wzmf6np","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbp001wwq1kam9j85e0"},{"post_id":"cjxbvqkbg000owq1kbkjbyg83","category_id":"cjxbvqkbo001nwq1kaqjntknk","_id":"cjxbvqkbq001zwq1k6utbp6xt"},{"post_id":"cjxbvqkbh000qwq1k8do3y9a0","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbs0022wq1kx2hfhwgm"},{"post_id":"cjxbvqkbh000qwq1k8do3y9a0","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbs0023wq1k2mgnl2jx"},{"post_id":"cjxbvqkbi000swq1kscnqmsul","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbt0026wq1k7hhhjb47"},{"post_id":"cjxbvqkbi000swq1kscnqmsul","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbt0028wq1kf5pv02pr"},{"post_id":"cjxbvqkb70006wq1k8xfwqj86","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbt002cwq1kmaz7gq7m"},{"post_id":"cjxbvqkb70006wq1k8xfwqj86","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbu002ewq1kkdhujfsr"},{"post_id":"cjxbvqkb90009wq1kinubrl2g","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbu002iwq1kr52wglr1"},{"post_id":"cjxbvqkb90009wq1kinubrl2g","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbu002jwq1kkxgj7gdg"},{"post_id":"cjxbvqkba000awq1kvtctgpaq","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbv002lwq1kqnle2ifv"},{"post_id":"cjxbvqkba000awq1kvtctgpaq","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbv002owq1k9go1hzgs"},{"post_id":"cjxbvqkbc000dwq1k3j5t3lam","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbv002qwq1kj6netizv"},{"post_id":"cjxbvqkbc000dwq1k3j5t3lam","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbv002twq1kd1mzk66k"},{"post_id":"cjxbvqkbd000fwq1k6u96q8y4","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkbv002uwq1kvimsxywk"},{"post_id":"cjxbvqkbd000fwq1k6u96q8y4","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkbw002wwq1kory1voi4"},{"post_id":"cjxbvqkfl003ywq1kpb48bsh0","category_id":"cjxbvqkb40002wq1kum0ty4oa","_id":"cjxbvqkfq0043wq1kj2eukce6"},{"post_id":"cjxbvqkfl003ywq1kpb48bsh0","category_id":"cjxbvqkbg000mwq1k9omsaf63","_id":"cjxbvqkfr0044wq1keujwp2ho"},{"post_id":"cjxbvqkfn003zwq1kb74tpjsy","category_id":"cjxbvqkbe000iwq1khqoaomw4","_id":"cjxbvqkfr0045wq1keg484lis"},{"post_id":"cjxbvqkfn003zwq1kb74tpjsy","category_id":"cjxbvqkbm001bwq1kkus8f8nu","_id":"cjxbvqkfr0047wq1kjfpjf5ln"}],"PostTag":[{"post_id":"cjxbvqkaz0000wq1ke50tw665","tag_id":"cjxbvqkb60003wq1k8h31y8lb","_id":"cjxbvqkbd000ewq1kmtu6lxk1"},{"post_id":"cjxbvqkaz0000wq1ke50tw665","tag_id":"cjxbvqkb80008wq1k79mjjvt3","_id":"cjxbvqkbe000gwq1kzixvspdd"},{"post_id":"cjxbvqkb20001wq1kczgjyp1y","tag_id":"cjxbvqkbc000cwq1kwdu36b6t","_id":"cjxbvqkbh000pwq1kcov79bo2"},{"post_id":"cjxbvqkb20001wq1kczgjyp1y","tag_id":"cjxbvqkbe000jwq1kn4yucb5d","_id":"cjxbvqkbi000rwq1k84t426ks"},{"post_id":"cjxbvqkb60004wq1ksxym311s","tag_id":"cjxbvqkbg000nwq1kjsoacs9y","_id":"cjxbvqkbl0011wq1kcdyc0auj"},{"post_id":"cjxbvqkb60004wq1ksxym311s","tag_id":"cjxbvqkbi000uwq1k2wq9u190","_id":"cjxbvqkbl0013wq1kjk2e69n0"},{"post_id":"cjxbvqkb60004wq1ksxym311s","tag_id":"cjxbvqkbk000xwq1kcgzo4vxm","_id":"cjxbvqkbl0015wq1ktbdtamo5"},{"post_id":"cjxbvqkb70005wq1k5obdme6s","tag_id":"cjxbvqkbl0010wq1k80d7lvr0","_id":"cjxbvqkbm001awq1k3i228qx4"},{"post_id":"cjxbvqkb70005wq1k5obdme6s","tag_id":"cjxbvqkbl0014wq1kyk8epvzr","_id":"cjxbvqkbn001dwq1kzcoca1cz"},{"post_id":"cjxbvqkb70005wq1k5obdme6s","tag_id":"cjxbvqkbm0017wq1k3aktdtrl","_id":"cjxbvqkbn001gwq1k5fc19zmd"},{"post_id":"cjxbvqkb70006wq1k8xfwqj86","tag_id":"cjxbvqkbl0010wq1k80d7lvr0","_id":"cjxbvqkbo001pwq1ktr1hjbwx"},{"post_id":"cjxbvqkb70006wq1k8xfwqj86","tag_id":"cjxbvqkbn001fwq1khogc0ryf","_id":"cjxbvqkbp001rwq1kc24p9yji"},{"post_id":"cjxbvqkb70006wq1k8xfwqj86","tag_id":"cjxbvqkbn001iwq1k1zpa3e78","_id":"cjxbvqkbp001uwq1ksql7y0ah"},{"post_id":"cjxbvqkb90009wq1kinubrl2g","tag_id":"cjxbvqkbo001mwq1ktgafn527","_id":"cjxbvqkbt0027wq1k267t68ho"},{"post_id":"cjxbvqkb90009wq1kinubrl2g","tag_id":"cjxbvqkbl0010wq1k80d7lvr0","_id":"cjxbvqkbt0029wq1ktrewhz63"},{"post_id":"cjxbvqkb90009wq1kinubrl2g","tag_id":"cjxbvqkbp001xwq1k66mo1bab","_id":"cjxbvqkbu002dwq1kt4278s2y"},{"post_id":"cjxbvqkb90009wq1kinubrl2g","tag_id":"cjxbvqkbq0020wq1kjv6t4dh7","_id":"cjxbvqkbu002fwq1kxatu18j1"},{"post_id":"cjxbvqkba000awq1kvtctgpaq","tag_id":"cjxbvqkbl0010wq1k80d7lvr0","_id":"cjxbvqkbv002nwq1kilfkj1px"},{"post_id":"cjxbvqkba000awq1kvtctgpaq","tag_id":"cjxbvqkbl0014wq1kyk8epvzr","_id":"cjxbvqkbv002pwq1k9b88xc9b"},{"post_id":"cjxbvqkba000awq1kvtctgpaq","tag_id":"cjxbvqkbu002gwq1kfrvxnocp","_id":"cjxbvqkbv002swq1k7mw09iys"},{"post_id":"cjxbvqkbc000dwq1k3j5t3lam","tag_id":"cjxbvqkbv002mwq1k5bhybmvr","_id":"cjxbvqkbx002zwq1ktybpf17e"},{"post_id":"cjxbvqkbc000dwq1k3j5t3lam","tag_id":"cjxbvqkbv002rwq1kw3e2diem","_id":"cjxbvqkbx0030wq1kbhgzuu2q"},{"post_id":"cjxbvqkbc000dwq1k3j5t3lam","tag_id":"cjxbvqkbw002vwq1kmcevf7tn","_id":"cjxbvqkbx0032wq1ki1smv8cy"},{"post_id":"cjxbvqkbc000dwq1k3j5t3lam","tag_id":"cjxbvqkbw002xwq1kvkb8att6","_id":"cjxbvqkbx0033wq1kx1xlu2o3"},{"post_id":"cjxbvqkbd000fwq1k6u96q8y4","tag_id":"cjxbvqkbo001mwq1ktgafn527","_id":"cjxbvqkby0036wq1ky7r84d4e"},{"post_id":"cjxbvqkbd000fwq1k6u96q8y4","tag_id":"cjxbvqkbl0010wq1k80d7lvr0","_id":"cjxbvqkby0037wq1kjqic2elm"},{"post_id":"cjxbvqkbd000fwq1k6u96q8y4","tag_id":"cjxbvqkbx0034wq1kf24e7xse","_id":"cjxbvqkby0039wq1kahgk1dzt"},{"post_id":"cjxbvqkbe000kwq1k580a2sun","tag_id":"cjxbvqkbo001mwq1ktgafn527","_id":"cjxbvqkby003bwq1k5yvum5jg"},{"post_id":"cjxbvqkbe000kwq1k580a2sun","tag_id":"cjxbvqkby0038wq1kir3zxloj","_id":"cjxbvqkby003cwq1k7kzag154"},{"post_id":"cjxbvqkbf000lwq1k9wzmf6np","tag_id":"cjxbvqkbo001mwq1ktgafn527","_id":"cjxbvqkc0003hwq1kcjx3nyr6"},{"post_id":"cjxbvqkbf000lwq1k9wzmf6np","tag_id":"cjxbvqkbl0010wq1k80d7lvr0","_id":"cjxbvqkc0003iwq1kq84hdq7b"},{"post_id":"cjxbvqkbf000lwq1k9wzmf6np","tag_id":"cjxbvqkbl0014wq1kyk8epvzr","_id":"cjxbvqkc0003kwq1kndge6opk"},{"post_id":"cjxbvqkbf000lwq1k9wzmf6np","tag_id":"cjxbvqkbz003fwq1kvn69ynu7","_id":"cjxbvqkc0003lwq1ko1qi24f6"},{"post_id":"cjxbvqkbg000owq1kbkjbyg83","tag_id":"cjxbvqkbz003gwq1kn1vo73c2","_id":"cjxbvqkc0003nwq1kiqtsjxg8"},{"post_id":"cjxbvqkbh000qwq1k8do3y9a0","tag_id":"cjxbvqkc0003jwq1k3y15pltb","_id":"cjxbvqkc1003qwq1kzlwo3o64"},{"post_id":"cjxbvqkbh000qwq1k8do3y9a0","tag_id":"cjxbvqkc0003mwq1k7vx8yvaz","_id":"cjxbvqkc1003rwq1k3310ym4v"},{"post_id":"cjxbvqkbh000qwq1k8do3y9a0","tag_id":"cjxbvqkc0003owq1k8aopeugy","_id":"cjxbvqkc1003twq1kjatzn7vi"},{"post_id":"cjxbvqkbi000swq1kscnqmsul","tag_id":"cjxbvqkbl0010wq1k80d7lvr0","_id":"cjxbvqkc2003vwq1kbzuqn747"},{"post_id":"cjxbvqkbi000swq1kscnqmsul","tag_id":"cjxbvqkc0003mwq1k7vx8yvaz","_id":"cjxbvqkc2003wwq1k2z86xto4"},{"post_id":"cjxbvqkbi000swq1kscnqmsul","tag_id":"cjxbvqkc1003uwq1kly84zut5","_id":"cjxbvqkc2003xwq1k7drsodhq"},{"post_id":"cjxbvqkfl003ywq1kpb48bsh0","tag_id":"cjxbvqkb60003wq1k8h31y8lb","_id":"cjxbvqkfp0040wq1kfjldm3b9"},{"post_id":"cjxbvqkfl003ywq1kpb48bsh0","tag_id":"cjxbvqkb80008wq1k79mjjvt3","_id":"cjxbvqkfq0042wq1kmjdv607a"},{"post_id":"cjxbvqkfn003zwq1kb74tpjsy","tag_id":"cjxbvqkbo001mwq1ktgafn527","_id":"cjxbvqkfr0046wq1kg3ah6uh7"},{"post_id":"cjxbvqkfn003zwq1kb74tpjsy","tag_id":"cjxbvqkbl0010wq1k80d7lvr0","_id":"cjxbvqkfs0048wq1ka16f04ig"},{"post_id":"cjxbvqkfn003zwq1kb74tpjsy","tag_id":"cjxbvqkfq0041wq1kketvea0v","_id":"cjxbvqkfs0049wq1kpd5e1fyo"},{"post_id":"cjxbvqkfn003zwq1kb74tpjsy","tag_id":"cjxbvqkc0003mwq1k7vx8yvaz","_id":"cjxbvqkft004awq1knwa3mr0o"}],"Tag":[{"name":"ARKit","_id":"cjxbvqkb60003wq1k8h31y8lb"},{"name":"翻译","_id":"cjxbvqkb80008wq1k79mjjvt3"},{"name":"HomeKit","_id":"cjxbvqkbc000cwq1kwdu36b6t"},{"name":"HomeKit Accessory Protocol","_id":"cjxbvqkbe000jwq1kn4yucb5d"},{"name":"Server","_id":"cjxbvqkbg000nwq1kjsoacs9y"},{"name":"Tools","_id":"cjxbvqkbi000uwq1k2wq9u190"},{"name":"记录","_id":"cjxbvqkbk000xwq1kcgzo4vxm"},{"name":"Swift","_id":"cjxbvqkbl0010wq1k80d7lvr0"},{"name":"Alamofire","_id":"cjxbvqkbl0014wq1kyk8epvzr"},{"name":"模拟登陆","_id":"cjxbvqkbm0017wq1k3aktdtrl"},{"name":"Xib","_id":"cjxbvqkbn001fwq1khogc0ryf"},{"name":"自定义View","_id":"cjxbvqkbn001iwq1k1zpa3e78"},{"name":"iOS","_id":"cjxbvqkbo001mwq1ktgafn527"},{"name":"UIWebView","_id":"cjxbvqkbp001xwq1k66mo1bab"},{"name":"二维码扫描","_id":"cjxbvqkbq0020wq1kjv6t4dh7"},{"name":"Today-Extension","_id":"cjxbvqkbu002gwq1kfrvxnocp"},{"name":"Swift 3.x","_id":"cjxbvqkbv002mwq1k5bhybmvr"},{"name":"Alamofire 4.x","_id":"cjxbvqkbv002rwq1kw3e2diem"},{"name":"Kanna 2.x","_id":"cjxbvqkbw002vwq1kmcevf7tn"},{"name":"Eureka 2.x","_id":"cjxbvqkbw002xwq1kvkb8att6"},{"name":"APNS推送","_id":"cjxbvqkbx0034wq1kf24e7xse"},{"name":"UITextView","_id":"cjxbvqkby0038wq1kir3zxloj"},{"name":"GB2312编码","_id":"cjxbvqkbz003fwq1kvn69ynu7"},{"name":"总结","_id":"cjxbvqkbz003gwq1kn1vo73c2"},{"name":"Android","_id":"cjxbvqkc0003jwq1k3y15pltb"},{"name":"阿里百川","_id":"cjxbvqkc0003mwq1k7vx8yvaz"},{"name":"友盟推送","_id":"cjxbvqkc0003owq1k8aopeugy"},{"name":"用户反馈","_id":"cjxbvqkc1003uwq1kly84zut5"},{"name":"即时通讯","_id":"cjxbvqkfq0041wq1kketvea0v"}]}}